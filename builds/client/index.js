!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=44)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(28);t.ServerSystem=n.default;const s=i(45);t.ClientSystem=s.default;var r=i(30);t.ServerProcess=r.ServerProcess;var o=i(33);t.ClientProcess=o.ClientProcess;var a=i(54);t.ClientManager=a.ClientManager;var h=i(55);t.Entity=h.Entity;var l=i(56);t.Component=l.Component;const d=i(57);t.Client=d.Client;const c={};t.setDefaultClientExport=function(e){Object.keys(c).forEach(e=>{delete c[e]}),Object.keys(e.publicApi).forEach(t=>{c[t]=e.publicApi[t],Object.defineProperty(c,t,{writable:!1})})},t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIRECTION_INDEX_DATA=t.PLAYER_EVENTS=t.COLLIDER_TAGS=t.MESSAGES=t.SYSTEMS=void 0,function(e){e[e.PLAYER_ACTION=0]="PLAYER_ACTION",e[e.PLAYER_MOVEMENT=1]="PLAYER_MOVEMENT",e[e.PLAYER_ANIMATION=2]="PLAYER_ANIMATION",e[e.PLAYER_MANAGER=3]="PLAYER_MANAGER",e[e.NPC_MOVEMENT=4]="NPC_MOVEMENT",e[e.POSITION=5]="POSITION",e[e.INPUT=6]="INPUT",e[e.PATHFINDING=7]="PATHFINDING",e[e.TIMER=8]="TIMER",e[e.TREE=9]="TREE",e[e.LEVEL=10]="LEVEL",e[e.INVENTORY=11]="INVENTORY",e[e.ITEM_DROP=12]="ITEM_DROP",e[e.DIALOGUE=13]="DIALOGUE",e[e.GAME_STATE=14]="GAME_STATE",e[e.FLOWER=15]="FLOWER",e[e.BUG_SPAWN=16]="BUG_SPAWN",e[e.BUG_MOVEMENT=17]="BUG_MOVEMENT",e[e.BUG_CATCH=18]="BUG_CATCH",e[e.BEE_KEEP=19]="BEE_KEEP",e[e.DIG=20]="DIG"}(t.SYSTEMS||(t.SYSTEMS={})),function(e){e[e.GAME_STATE_INITIALIZED=0]="GAME_STATE_INITIALIZED",e[e.INITIAL_MAP_LOADED=1]="INITIAL_MAP_LOADED",e[e.CLIENT_PLAYER_ENTITY_INITIALIZED=2]="CLIENT_PLAYER_ENTITY_INITIALIZED",e[e.DROP_ITEM=3]="DROP_ITEM",e[e.PICKUP_ITEM=4]="PICKUP_ITEM",e[e.EQUIP_ITEM=5]="EQUIP_ITEM",e[e.USE_ITEM=6]="USE_ITEM",e[e.REMOVE_DROPPED_ITEM=7]="REMOVE_DROPPED_ITEM",e[e.INVENTORY_ERROR=8]="INVENTORY_ERROR",e[e.NEW_FLOWER=9]="NEW_FLOWER",e[e.PLANTED_TREE=10]="PLANTED_TREE",e[e.REMOVED_TREE=11]="REMOVED_TREE",e[e.REMOVED_FLOWER=12]="REMOVED_FLOWER",e[e.FLOWER_FULLY_GROWN=13]="FLOWER_FULLY_GROWN",e[e.SPAWNED_BUG=14]="SPAWNED_BUG",e[e.REMOVED_BUG=15]="REMOVED_BUG",e[e.START_TIMERS=16]="START_TIMERS",e[e.ADDED_HOLE=17]="ADDED_HOLE",e[e.REMOVED_HOLE=18]="REMOVED_HOLE"}(t.MESSAGES||(t.MESSAGES={})),function(e){e.hole="hole",e.flower="flower",e.bug="bug",e.blocking="blocking",e.sort="sort",e.tree="tree",e.tree_stump="tree_stump",e.client_player="client_player",e.in_front_of_client_player="in_front_of_client_player",e.client_player_bug_detector="client_player_bug_detector",e.player="player",e.dropped_item="dropped_item",e.npc="npc",e.water="water"}(t.COLLIDER_TAGS||(t.COLLIDER_TAGS={})),function(e){e.INVENTORY_CHANGE="inventory_change"}(t.PLAYER_EVENTS||(t.PLAYER_EVENTS={})),t.DIRECTION_INDEX_DATA={DIRECTIONS_NAMES:["east","north","west","south"],NAMES_TO_INDEX:{east:0,north:1,west:2,south:3},ROTATIONS:[180,90,0,270]}},function(e,t){e.exports={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4}},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.GameValues=t.NPC_TYPES=t.EntityTypes=t.BugTypes=t.defaultGameData=t.ItemTypes=void 0,function(e){e[e.TOOL=0]="TOOL",e[e.TREE=1]="TREE",e[e.FLOWER=2]="FLOWER",e[e.BUG=3]="BUG",e[e.FURNITURE=4]="FURNITURE",e[e.RESOURCE=5]="RESOURCE",e[e.PLANTABLE=6]="PLANTABLE"}(n=t.ItemTypes||(t.ItemTypes={})),t.defaultGameData=function(e,t){return{totalElapsedTime:0,lastUid:0,bells:0,playerName:e=e||"Player",levels:[{name:"home",isHome:!0,droppableItems:[n.FURNITURE,n.RESOURCE],state:{items:[],wall:"default",floor:"default"}},{name:"island",droppableItems:[n.FURNITURE,n.RESOURCE,n.TREE],state:{items:[],holes:[]}}],house:{wall:"default",floor:"default",items:[]},task:{tomNook:0},level:t.level,direction:"south",position:{x:t.x,y:t.y},inventory:[]}},function(e){e.BEE="bee",e.BUTTERFLY="butterfly"}(t.BugTypes||(t.BugTypes={})),function(e){e[e.ClientPlayer=0]="ClientPlayer",e[e.RemotePlayer=1]="RemotePlayer",e[e.NPC=2]="NPC",e[e.Tree=3]="Tree",e[e.DroppedItem=4]="DroppedItem",e[e.Bug=5]="Bug"}(t.EntityTypes||(t.EntityTypes={})),function(e){e[e.Neighbor=0]="Neighbor",e[e.Townperson=1]="Townperson",e[e.Mayor=2]="Mayor"}(t.NPC_TYPES||(t.NPC_TYPES={})),t.GameValues={PlayerSpeed:100,PlayerDirections:{east:"east",west:"west",north:"north",south:"south"},InventorySlots:50}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};function s(e){return n(this,void 0,void 0,(function*(){const t=new FileReader;return new Promise((i,n)=>{t.readAsDataURL(e),t.onload=e=>i(e.target.result)})}))}function r(e,t=!1){return t?Math.round(e*(180/Math.PI)):e*(180/Math.PI)}function o(e){return e/(180/Math.PI)}function a(e){if(Array.isArray(e))return"polygon";if("r"in e)return"circle";if("x"in e)return"w"in e?"rect":"point";throw console.error(e),new Error("Invalid shape data found on collider")}function h(e,t){return n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{e.extract.canvas(t).toBlob(e=>i(e))})}))}function l(e,t){return n(this,void 0,void 0,(function*(){return h(e,new PIXI.Sprite(t))}))}function d(e){return btoa(new Uint8Array(e).reduce((e,t)=>e+String.fromCharCode(t),""))}function c(e){return n(this,void 0,void 0,(function*(){const t=window.URL||window.webkitURL;let i,n=!0;try{i=t.createObjectURL(e)}catch(t){n=!1;const s=d(e);i="data:image/png;base64,"+s}const s=new Image;return new Promise((e,r)=>{s.src=i,s.addEventListener("load",r=>(n&&t.revokeObjectURL(i),e(new PIXI.Texture(new PIXI.BaseTexture(s)))))})}))}function u(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),s=n.length,r=new Uint8Array(s);for(;s--;)r[s]=n.charCodeAt(s);return new Blob([r],{type:i})}function p(e,t){const i=Math.round(Math.max(e.x,t.x)),n=Math.round(Math.min(e.x,t.x)),s=Math.round(Math.max(e.y,t.y)),r=Math.round(Math.min(e.y,t.y));return{x:n,y:r,w:i-n,h:s-r}}function f(e,t,i,n,s,r,o,a=0,h,l){let d,c,u=0,p=0;if(a>0){var f=(r+o)*a;f<r?u=r-f:p=o-(f-r)}const m=null!==s?y(t,s):t;let g=0;for(let t=0;t<m.length;t++){d=m[t];const s=(c=t==m.length-1?m[0]:m[t+1]).x-d.x,a=c.y-d.y,f=Math.sqrt(s*s+a*a),y={x:s/f,y:a/f};let v=0;for(e.moveTo(i+d.x+p*y.x,n+d.y+p*y.y);v<=f;)null!=h&&null!=l&&(e.lineColor=g%2==0?h:l),g++,v+=p,(v+=u>0?u:r)>f?(u=v-f,v=f):u=0,e.lineTo(i+d.x+v*y.x,n+d.y+v*y.y),(v+=o)>f&&0==u?p=v-f:(p=0,e.moveTo(i+d.x+v*y.x,n+d.y+v*y.y))}}function m(e){if(Array.isArray(e)){if(e.length>4)throw new Error("Rect is longer than length 4.");return{x:e[0],y:e[1],h:e[2],w:e[3]}}if(!("x"in e&&"y"in e))throw new Error("Can not normalize rect");if("width"in e&&"height"in e)return{x:e.x,y:e.y,w:e.width,h:e.height};if("w"in e&&"h"in e)return e;throw new Error("Can not normalize rect")}function g(e,t,i){var n=e.x,s=e.y,r=i,o=Math.cos(r),a=Math.sin(r);return{x:o*(n-t.x)-a*(s-t.y)+t.x,y:a*(n-t.x)+o*(s-t.y)+t.y}}function y(e,t){return e.map(e=>{const i={x:e.x,y:e.y},n=Math.cos(t),s=Math.sin(t),r=i.x,o=i.y;return i.x=r*n-o*s,i.y=r*s+o*n,i})}function v(e){const{minX:t,minY:i,maxX:n,maxY:s}=e;return[{x:t,y:i},{x:n,y:i},{x:n,y:s},{x:t,y:s},{x:t,y:i}]}function C(e){const{minX:t,maxX:i,minY:n,maxY:s}=e;return{x:t,y:n,w:i-t,h:s-n}}function S(e){if(e.length<=3)throw new Error("Not enough points in polygon.");let t=e[0].x,i=e[0].y,n=e[0].x,s=e[0].y;for(let r=1;r<e.length;r++){const{x:o,y:a}=e[r];n=Math.min(o,n),s=Math.min(a,s),t=Math.max(o,t),i=Math.max(a,i)}return{minX:n,minY:s,maxX:t,maxY:i}}function w(e){e=m(e);const{x:t,y:i,w:n,h:s}=e;return{minX:t,minY:i,maxX:t+n,maxY:i+s}}function b(e,t,i){const n=n=>{throw console.error("invalid param:",e),t&&console.error("id lookup:",t),i&&console.error("name lookup:",i),console.error(n),new Error(n)};try{e.atlasName||e.atlasId||n(`No atlasId or atlasName property in the SkinParam: ${JSON.stringify(e)}`),e.skinName||e.skinUrl||n(`No skinName or atlasName property in the SkinParam: ${JSON.stringify(e)}`),!e.atlasId||!t||e.atlasId in t||n(`Invalid atlas id: ${e.atlasId}, it was not found in the lookup.`),!e.atlasName||!i||e.atlasName in i||n(`Invalid atlas name: ${e.atlasId}, it was not found in the lookup.`)}catch(e){throw e}}Object.defineProperty(t,"__esModule",{value:!0}),t.addObject=t.updateObject=t.boundingFromPositions=t.rectFromPolygon=t.boundingBoxFromRect=t.boundingBoxFromPolygon=t.floorPoint=t.roundPoint=t.ceilPoint=t.rectFromBoundingBox=t.boundingBoxToPolygon=t.rectToPolygon=t.getDistance=t.rotatePoints=t.findNeededOrigin=t.pivotPoint=t.getNearestPriorFrame=t.drawDashedRect=t.drawDashedBoundingBox=t.drawDashedPolygon=t.getPixiRectFromPoints=t.getRectFromPoints=t.dataURLtoBlob=t.dataUrlToTexture=t.getTextureFromBlob=t.bufferToBase64=t.getBlobFromTexture=t.rectsEqual=t.getBlobFromSprite=t.getDataURLFromTexture=t.resolveColliderType=t.circleContainsPoint=t.deg2rad=t.applyParentBonesToCollider=t.applyRotationToCollider=t.applyScaleToCollider=t.rad2deg=t.roundRadian=t.round=t.applyCascadedBoneData=t.isFunction=t.logPoint=t.roundToNearest=t.deltaPoints=t.inherittedTransformItemHasDeltas=t.FrameFromType=t.blobToDataURL=t.shapeDataToArray=t.rectsCollide=t.rectContainsPoint=void 0,t.httpGetAsync=t.validateSkinParam=t.validateSkinParams=t.removeObject=void 0,t.rectContainsPoint=function(e,t){return e=m(e),t.x>=e.x&&t.x<=e.x+e.w&&t.y>e.y&&t.y<e.y+e.h},t.rectsCollide=function(e,t){return e=m(e),t=m(t),e.x+e.w>=t.x&&e.x<=t.x+t.w&&e.y+e.h>=t.y&&e.y<=t.y+t.h},t.shapeDataToArray=function(e){switch(a(e)){case"rect":return[(e=e).x,e.y,e.w,e.h];case"polygon":return(e=e).map(e=>[e.x,e.y]).flat();case"circle":return[(e=e).r,e.cx,e.cy];case"point":return[(e=e).x,e.y]}},t.blobToDataURL=s,function(e){e[e.ATTACHMENT_SETUP=0]="ATTACHMENT_SETUP",e[e.SUB_ATTACHMENT_SETUP=1]="SUB_ATTACHMENT_SETUP",e[e.ANIMATION_FRAME=2]="ANIMATION_FRAME"}(t.FrameFromType||(t.FrameFromType={})),t.inherittedTransformItemHasDeltas=function(e){return 1!=e.scaleX||1!=e.scaleY&&0!=e.rotation||0!=e.x||0!=e.y},t.deltaPoints=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.roundToNearest=function(e,t,i="ceil"){const n=Math[i],s=Math.sign(e)||1;return n(Math.abs(e)*t)/t*s},t.logPoint=function(e,t,i="log"){t?console[i](`Point: ${t}, X: ${e.x}, Y: ${e.y}`):console[i]("X:",e.x,"Y:",e.y)},t.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},t.applyCascadedBoneData=function e(t,i,n=!1){const s=i.find(e=>e.id==t),r=i.find(e=>e.id==t).sortedFrames,a={x:0,y:0,rotation:0,scaleX:0,scaleY:0,visible:r[r.length-1].visible,slotId:r[0].slotId};for(let e=0;e<r.length;e++){const{x:t,y:i,rotation:n,scaleX:s,scaleY:o,visible:h,slotId:l}=r[e];a.x+=t,a.y+=i,a.rotation+=n,a.scaleX+=s-1,a.scaleY+=o-1,(!h||l&&a.slotId!==l)&&(a.slotId=l)}if(s.parentId){if(i.find(e=>e.id==s.parentId)){const t=e(s.parentId,i);if(a.x+=t.x,a.y+=t.y,a.rotation+=t.rotation,t.rotation){const{x:e,y:i}=g(a,t,o(t.rotation));a.x=e,a.y=i}a.scaleX+=t.scaleX-1,a.scaleY+=t.scaleY-1}else console.warn("Cascading frame data on an item that has a parentId but the parent does not have frame data in the array.")}return a.x=Math.round(a.x),a.y=Math.round(a.y),a.rotation=Math.round(a.rotation),n&&console.log("FINAL FRAME DATA;",a),a.scaleX++,a.scaleY++,a.visible=r[r.length-1].visible,a},t.round=function(e){return Math.sign(e)*Math.round(Math.abs(e))},t.roundRadian=function(e){return o(Math.round(r(e)))},t.rad2deg=r,t.applyScaleToCollider=function(e,t,i){return i},t.applyRotationToCollider=function(e,t){return t},t.applyParentBonesToCollider=function(e,t,i){return e},t.deg2rad=o,t.circleContainsPoint=function(e,t){const{cx:i,cy:n,r:s}=e,{x:r,y:o}=t;return(r-i)*(r-i)+(o-n)*(o-n)<s*s},t.resolveColliderType=a,t.getDataURLFromTexture=function(e,t){return n(this,void 0,void 0,(function*(){return s(yield l(e,t))}))},t.getBlobFromSprite=h,t.rectsEqual=function(e,t){return e.x===t.x&&e.y===t.y&&e.w===t.w&&e.h===t.h},t.getBlobFromTexture=l,t.bufferToBase64=d,t.getTextureFromBlob=c,t.dataUrlToTexture=function(e){return n(this,void 0,void 0,(function*(){return c(u(e))}))},t.dataURLtoBlob=u,t.getRectFromPoints=p,t.getPixiRectFromPoints=function(e,t){const{x:i,y:n,w:s,h:r}=p(e,t);return new PIXI.Rectangle(i,n,s,r)},t.drawDashedPolygon=f,t.drawDashedBoundingBox=function(e,t,i,n,s,r,o,a=0,h,l){return f(e,v(t),i,n,s,r,o,a,h,l)},t.drawDashedRect=function(e,t,i,n,s,r=0,o,a){return f(e,v(w(m(t))),0,0,i,n,s,r,o,a)},t.getNearestPriorFrame=function(e,t){if(!t.length)return null;const i=t.find(t=>t.time>=e);if(!i)return t[t.length-1];const n=t.indexOf(i);return n?t[n-1]:null},t.pivotPoint=g,t.findNeededOrigin=function(e,t){},t.rotatePoints=y,t.getDistance=function(e,t){const{x:i,y:n}=e,{x:s,y:r}=t;return Math.sqrt((s-i)*(s-i)+(r-n)*(r-n))},t.rectToPolygon=function(e){return v(w(e))},t.boundingBoxToPolygon=v,t.rectFromBoundingBox=C,t.ceilPoint=function(e){return{x:Math.ceil(e.x),y:Math.ceil(e.y)}},t.roundPoint=function(e,t=!1){return t?(e.x=Math.round(e.x),e.y=Math.round(e.y),e):{x:Math.round(e.x),y:Math.round(e.y)}},t.floorPoint=function(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}},t.boundingBoxFromPolygon=S,t.boundingBoxFromRect=w,t.rectFromPolygon=function(e){return C(S(e))},t.boundingFromPositions=function(e,t){return{minX:Math.min(e.x,t.x),maxX:Math.max(e.x,t.x),minY:Math.min(e.y,t.y),maxY:Math.max(e.y,t.y)}},t.updateObject=function(e,t){for(let i in e){const n=t[i];if(!n)continue;const s=e[i];Array.isArray(e[i])&&n.forEach(e=>{const t=s.find(t=>t.id==e.id);t?s[s.indexOf(t)]=e:s.push(e)})}},t.addObject=function(e,t){for(let i in e){if(!t[i])continue;e[i];Array.isArray(e[i])}},t.removeObject=function(e,t){},t.validateSkinParams=function(e,t,i){const n=[],s=[];for(let r=0;r<e.length;r++)try{b(e[r],t,i),n.push(e[r])}catch(t){s.push({param:e[r],error:t.message?t.message:t})}return{valid:n,invalid:s}},t.validateSkinParam=b,t.httpGetAsync=function(e,t=!0){return n(this,void 0,void 0,(function*(){const i=new XMLHttpRequest;return t||(i.responseType="arraybuffer"),i.open("GET",e,!0),i.send(null),new Promise((e,n)=>{i.onreadystatechange=()=>{if(4==i.readyState){if(200==i.status)return e(t?JSON.parse(i.responseText):i.response);try{return n(t?JSON.parse(i.responseText):i.response)}catch(e){return console.error("Error parsing http error response",i),n(e)}}}})}))}},function(e,t){function i(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}function n(e,t,i,n){var s,r,o,a,h,l,d=Math.abs,c=[];for(s=e<i?1:-1,r=t<n?1:-1,h=(o=d(i-e))-(a=d(n-t));c.push([e,t]),e!==i||t!==n;)(l=2*h)>-a&&(h-=a,e+=s),l<o&&(h+=o,t+=r);return c}t.backtrace=i,t.biBacktrace=function(e,t){var n=i(e),s=i(t);return n.concat(s.reverse())},t.pathLength=function(e){var t,i,n,s,r,o=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],s=i[0]-n[0],r=i[1]-n[1],o+=Math.sqrt(s*s+r*r);return o},t.interpolate=n,t.expandPath=function(e){var t,i,s,r,o,a,h=[],l=e.length;if(l<2)return h;for(o=0;o<l-1;++o)for(t=e[o],i=e[o+1],r=(s=n(t[0],t[1],i[0],i[1])).length,a=0;a<r-1;++a)h.push(s[a]);return h.push(e[l-1]),h},t.smoothenPath=function(e,t){var i,s,r,o,a,h,l,d,c,u=t.length,p=t[0][0],f=t[0][1],m=t[u-1][0],g=t[u-1][1];for(r=[[i=p,s=f]],o=2;o<u;++o){for(l=n(i,s,(h=t[o])[0],h[1]),c=!1,a=1;a<l.length;++a)if(d=l[a],!e.isWalkableAt(d[0],d[1])){c=!0;break}c&&(lastValidCoord=t[o-1],r.push(lastValidCoord),i=lastValidCoord[0],s=lastValidCoord[1])}return r.push([m,g]),r},t.compressPath=function(e){if(e.length<3)return e;var t,i,n,s,r,o,a=[],h=e[0][0],l=e[0][1],d=e[1][0],c=e[1][1],u=d-h,p=c-l;for(u/=r=Math.sqrt(u*u+p*p),p/=r,a.push([h,l]),o=2;o<e.length;o++)t=d,i=c,n=u,s=p,u=(d=e[o][0])-t,p=(c=e[o][1])-i,p/=r=Math.sqrt(u*u+p*p),(u/=r)===n&&p===s||a.push([t,i]);return a.push([d,c]),a}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};function s(e){if(Array.isArray(e)){if(e.length>4)throw new Error("Rect is longer than length 4.");return{x:e[0],y:e[1],h:e[2],w:e[3]}}return"width"in e?{x:e.x,y:e.y,w:e.width,h:e.height}:e}function r(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function o(e){return e*Math.PI/180}function a(e){return[{x:e.x,y:e.y},{x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height}]}function h(e,t,i){var n=e.x,s=e.y,r=i,o=Math.cos(r),a=Math.sin(r);return{x:o*(n-t.x)-a*(s-t.y)+t.x,y:a*(n-t.x)+o*(s-t.y)+t.y}}function l(e,t){const i=t[0].x,n=t[0].y,s=t[1].x,r=t[1].y,o=e.x,a=e.y,h=e.radius,l=f(i,n,o,a,h),d=f(s,r,o,a,h);if(l||d){Math.atan2(n-r,i-s);return{collide:!0}}let c=i-s,u=n-r;const p=Math.sqrt(c*c+u*u),m=((o-i)*(s-i)+(a-n)*(r-n))/Math.pow(p,2),y=i+m*(s-i),v=n+m*(r-n);if(!g(i,n,s,r,y,v))return!1;if(c=y-o,u=v-a,Math.sqrt(c*c+u*u)<=h){return{collide:!0,angle:(C=e,(S={x:y,y:v})?Math.atan2(C.x-S.x,C.y-S.y):null)}}var C,S;return!1}function d(e){let t=[];return t.push({x:e.x,y:e.y}),t.push({x:e.x+e.width,y:e.y}),t.push({x:e.x+e.width,y:e.y+e.height}),t.push({x:e.x,y:e.y+e.height}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomColor=t.getRandomNumber=t.getRandomPositionFromRect=t.getRandomPositionFromCircle=t.getRandomPositionFromPolygon=t.boundingFromPositions=t.polygonContainsPoint=t.rectFromPolygon=t.rectFromBoundingBox=t.boundingBoxFromRect=t.boundingBoxFromPolygon=t.normalizePolygon=t.popRandomFromArray=t.getRandomItemFromArray=t.lineCircle=t.polyCircleCollision=t.getRect1CollisionAngleAndSlope=t.getRectRectSegmentCollisions=t.getVerticesFromRect=t.rectContainsPoint=t.rectCircleColliding=t.circleCircleColliding=t.rotatePolygon=t.flipPolygon=t.translatePoint=t.getLinesFromPolygon=t.getScreenPositionFromWorldPosition=t.getDirectionAndRelativeAngleFromAngle=t.pivotPoint=t.getDegreeAngleFromPositions=t.getRadianAngleFromPositions=t.removeAndDeleteSprite=t.getMinRectToRectDistance=t.unflattenPointArrays=t.flattenPointArray=t.rectsAreWithinDistance=t.pointIsWithinRectDistance=t.getRectEdges=t.toRadian=t.getMovementDataFromDeltas=t.rectsAreColliding=t.getDistance=t.getPercentage=t.asyncTimeout=void 0,t.asyncTimeout=function(e){return n(this,void 0,void 0,(function*(){return new Promise(t=>{setTimeout(()=>t(),e)})}))},t.getPercentage=function(e,t){return e/100*t},t.getDistance=r,t.rectsAreColliding=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.height+e.y>t.y},t.getMovementDataFromDeltas=function(e,t){let i=-1;return t<0&&e<=0?i=1:e>0?i=0:t>0&&0===e?i=3:e<0&&(i=2),i},t.toRadian=o,t.getRectEdges=a,t.pointIsWithinRectDistance=function(e,t,i){const n=a(t);for(let t=0;t<n.length;t++)if(r(n[t],e)<=i)return!0;return!1},t.rectsAreWithinDistance=function(e,t,i){const n=a(e),s=a(t);for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(r(n[e],s[t])<=i)return!0;return!1},t.flattenPointArray=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].x,e[i].y);return t},t.unflattenPointArrays=function(e){const t=[];for(let i=0;i<e.length;i+=2)t.push({x:e[i],y:e[i+1]});return t},t.getMinRectToRectDistance=function(e,t){const i=a(e),n=a(t);let s=99999999;for(let e=0;e<i.length;e++)for(let t=0;t<n.length;t++)s=Math.min(r(i[e],n[t]),99999999);return s},t.removeAndDeleteSprite=function(e,t=!1){e&&(e.parent&&e.parent.removeChild(e),t?e.destroy({children:!0,texture:!1,baseTexture:!1}):e.destroy({children:!0}))},t.getRadianAngleFromPositions=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},t.getDegreeAngleFromPositions=function(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI},t.pivotPoint=h,t.getDirectionAndRelativeAngleFromAngle=function(e){let t=0,i=0;return e>=-180&&e<=-157.5||e<=180&&e>157.5?(t=6,i=e>=-180&&e<=-157.5?Math.abs(-180-e)+22.5:Math.abs(157.5-e)):e>=-157.5&&e<-112.5?(t=5,i=Math.abs(-157.5-e)):e>=-112.5&&e<-67.5?(t=4,i=Math.abs(-112.5-e)):e>=-67.5&&e<-22.5?(t=3,i=Math.abs(-67.5-e)):e>=-22.5&&e<22.5?(i=e+22.5,t=2):e>=22.5&&e<67.5?(i=e-22.5,t=1):e>=67.5&&e<112.5?(t=0,i=e-67.5):e>=112.5&&e<157.5&&(t=7,i=e-112.5),{dirIndex:t,relativeAngle:i}},t.getScreenPositionFromWorldPosition=function(e,t){},t.getLinesFromPolygon=function(e){},t.translatePoint=function(e,t,i){return{x:e.x+i*Math.cos(t),y:e.y+i*Math.sin(t)}},t.flipPolygon=function(e,t,i){let n=(e=e.map(e=>Object.assign({},e)))[0].x,s=e[0].x,r=e[0].y,o=e[0].y;for(let t=1;t<e.length;t++)n=Math.max(n,e[t].x),s=Math.min(s,e[t].x),r=Math.max(r,e[t].y),o=Math.min(o,e[t].y);if(t)for(let t=0;t<e.length;t++)e[t].x===s?e[t].x=n:e[t].x===n?e[t].x=s:e[t].x=n-(e[t].x-s);if(i)for(let t=0;t<e.length;t++)e[t].y===o?e[t].y=r:e[t].y===r?e[t].y=o:e[t].y=r-(e[t].y-o);return e},t.rotatePolygon=function(e,t){const i=function(e){let t,i,n,s;for(var r=0;r<e.length;r++)t=e[r].x<t||null==t?e[r].x:t,i=e[r].x>i||null==i?e[r].x:i,n=e[r].y<n||null==n?e[r].y:n,s=e[r].y>s||null==s?e[r].y:s;return{x:(t+i)/2,y:(n+s)/2}}(e);return e.map(e=>h(e,i,o(t)))},t.circleCircleColliding=function(e,t){const i=e.radius?e.radius:e.r,n=t.radius?t.radius:t.r,s=e.x-t.x,r=e.y-t.y;return Math.sqrt(s*s+r*r)<i+n},t.rectCircleColliding=function(e,t){var i=Math.abs(t.x-e.x-e.width/2),n=Math.abs(t.y-e.y-e.height/2);if(i>e.width/2+t.radius)return!1;if(n>e.height/2+t.radius)return!1;if(i<=e.width/2)return!0;if(n<=e.height/2)return!0;var s=i-e.width/2,r=n-e.height/2;return s*s+r*r<=t.radius*t.radius},t.rectContainsPoint=function(e,t){return e.x<=t.x&&t.x<=e.x+e.width&&e.y<=t.y&&t.y<=e.y+e.height},t.getVerticesFromRect=d,t.getRectRectSegmentCollisions=function(e,t){const i=e.width/2,n={x:e.x+i,y:e.y+i,radius:i},s=function(e){const t=d(e);return[[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[1].y}],[{x:t[1].x,y:t[1].y},{x:t[2].x,y:t[2].y}],[{x:t[3].x,y:t[3].y},{x:t[2].x,y:t[2].y}],[{x:t[0].x,y:t[0].y},{x:t[3].x,y:t[3].y}]]}(t),r=l(n,s[0]),o=l(n,s[1]),a=l(n,s[2]),h=l(n,s[3]);let c=[];return r&&c.push({angle:0,slope:0}),o&&c.push(Object.assign(Object.assign({},o),{slope:"vertical"})),a&&c.push({angle:0,slope:0}),h&&c.push(Object.assign(Object.assign({},h),{slope:"vertical"})),c};const c={angle:1.5707963267948966,slope:"vertical"},u={angle:-1.5707963267948966,slope:"vertical"},p={angle:0,slope:0};function f(e,t,i,n,s){var r=e-i,o=t-n;return Math.sqrt(r*r+o*o)<=s}function m(e,t,i,n,s,r,o){var a=f(e,t,s,r,o),h=f(i,n,s,r,o);if(a||h)return{collide:!0,angle:Math.atan2(t-n,e-i)};var l=e-i,d=t-n,c=Math.sqrt(l*l+d*d),u=((s-e)*(i-e)+(r-t)*(n-t))/Math.pow(c,2),p=e+u*(i-e),m=t+u*(n-t);return!!g(e,t,i,n,p,m)&&(l=p-s,d=m-r,Math.sqrt(l*l+d*d)<=o&&{collide:!0,angle:Math.atan2(t-n,e-i),hitPoint:{x:p,y:p}})}function g(e,t,i,n,s,o){var a=r({x:s,y:o},{x:e,y:t}),h=r({x:s,y:o},{x:i,y:n}),l=r({x:e,y:t},{x:i,y:n});return a+h>=l-.1&&a+h<=l+.1}function y(e){return e[Math.floor(Math.random()*e.length)]}function v(e){if(!e.length)throw new Error("No points in polygon data.");const t=[];if("object"==typeof e[0])Array.isArray(e[0])?e.forEach(e=>{t.push({x:e[0],y:e[1]})}):e.forEach(e=>{t.push({x:e.x,y:e.y})});else for(let i=0;i<e.length;i+=2)t.push({x:e[i],y:e[i+1]});return t}function C(e){if(e.length<=3)throw new Error("Not enough points in polygon.");let t=e[0].x,i=e[0].y,n=e[0].x,s=e[0].y;for(let r=1;r<e.length;r++){const{x:o,y:a}=e[r];n=Math.min(o,n),s=Math.min(a,s),t=Math.max(o,t),i=Math.max(a,i)}return{minX:n,minY:s,maxX:t,maxY:i}}function S(e){const{minX:t,maxX:i,minY:n,maxY:s}=e;return{x:t,y:n,w:i-t,h:s-n}}function w(e){return S(C(e))}function b(e,t){let i=!1,n=0;for(let s=0;s<e.length;s++){(n=s+1)===e.length&&(n=0);let r=e[s],o=e[n];(r.y>=t.y&&o.y<t.y||r.y<t.y&&o.y>=t.y)&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}function T(e,t,i,n,r){let{x:o,y:a,w:h,h:l}=s(e);a-=r=r||0;const d=l+(n=n||0)+r;return{x:_(o-=t=t||0,o+(h+t+(i=i||0))),y:_(a,a+d)}}function _(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}t.getRect1CollisionAngleAndSlope=function(e,t){console.log("rect1:",e),console.log("rect2:",t);const i=e.x<t.x+t.width&&e.x+e.width>t.x+t.width,n=e.x+e.width>t.x&&e.x<t.x,s=e.y+e.height>t.y&&t.y+t.height>t.y+t.height,r=e.y<t.y+t.height&&e.y<t.height;return!i||r||s?!n||r||s?p:u:c},t.polyCircleCollision=function(e,t,i,n){for(var s=0,r=0;r<e.length;r++){(s=r+1)==e.length&&(s=0);var o=e[r],a=e[s],h=m(o.x,o.y,a.x,a.y,t,i,n);if(h)return h}return!1},t.lineCircle=m,t.getRandomItemFromArray=y,t.popRandomFromArray=function(e){const t=Math.floor(Math.random()*e.length),i=e[t];return e.splice(t,1),i},t.normalizePolygon=v,t.boundingBoxFromPolygon=C,t.boundingBoxFromRect=function(e){e=s(e);const{x:t,y:i,w:n,h:r}=e;return{minX:t,minY:i,maxX:t+n,maxY:i+r}},t.rectFromBoundingBox=S,t.rectFromPolygon=w,t.polygonContainsPoint=b,t.boundingFromPositions=function(e,t){return{minX:Math.min(e.x,t.x),maxX:Math.max(e.x,t.x),minY:Math.min(e.y,t.y),maxY:Math.max(e.y,t.y)}},t.getRandomPositionFromPolygon=function(e,t=20){const i=w(e=v(e));let n=T(i),s=0,r=b(e,n);do{r=b(e,n=T(i)),s++}while(!r&&s<t);return n=r?n:y(e)},t.getRandomPositionFromCircle=function(e){const t=2*Math.random()*Math.PI,i=Math.random()*e.r*e.r;return{x:Math.sqrt(i)*Math.cos(t),y:Math.sqrt(i)*Math.cos(t)}},t.getRandomPositionFromRect=T,t.getRandomNumber=_,t.getRandomColor=function(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}},function(e,t,i){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},n.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},n.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1];break;case"ufrag":i.ufrag=t[n+1],i.usernameFragment=t[n+1];break;default:i[t[n]]=t[n+1]}return i},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,i={},n=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)i[(t=n[s].trim().split("="))[0].trim()]=t[1];return i},n.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},n.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(e,t){var i=n.matchPrefix(e+t,"a=ice-ufrag:")[0],s=n.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substr(12),password:s.substr(10)}:null},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(e)[0].split(" "),s=3;s<i.length;s++){var r=i[s],o=n.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){var a=n.parseRtpMap(o),h=n.matchPrefix(e,"a=fmtp:"+r+" ");switch(a.parameters=h.length?n.parseFmtp(h[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(n.parseExtmap(e))})),t},n.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){i+=n.writeRtpMap(e),i+=n.writeFmtp(e),i+=n.writeRtcpFb(e)}));var s=0;return t.codecs.forEach((function(e){e.maxptime>s&&(s=e.maxptime)})),s>0&&(i+="a=maxptime:"+s+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){i+=n.writeExtmap(e)})),i},n.parseRtpEncodingParameters=function(e){var t,i=[],s=n.parseRtpParameters(e),r=-1!==s.fecMechanisms.indexOf("RED"),o=-1!==s.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),h=a.length>0&&a[0].ssrc,l=n.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===h&&(t=l[0][1]),s.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:h,codecPayloadType:parseInt(e.parameters.apt,10)};h&&t&&(n.rtx={ssrc:t}),i.push(n),r&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:h,mechanism:o?"red+ulpfec":"red"},i.push(n))}})),0===i.length&&h&&i.push({ssrc:h});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=d}))),i},n.parseRtcpParameters=function(e){var t={},i=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var s=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=0===s.length;var r=n.matchPrefix(e,"a=rtcp-mux");return t.mux=r.length>0,t},n.parseMsid=function(e){var t,i=n.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var s=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return s.length>0?{stream:(t=s[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,i=n.parseMLine(e),s=n.matchPrefix(e,"a=max-message-size:");s.length>0&&(t=parseInt(s[0].substr(19),10)),isNaN(t)&&(t=65536);var r=n.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substr(12),10),protocol:i.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var o=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,i){var s=void 0!==t?t:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,i,s){var r=n.writeRtpDescription(e.kind,t);if(r+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var o="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+o,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),r},n.getDirection=function(e,t){for(var i=n.splitLines(e),s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},e.exports=n},function(e,t){e.exports={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var i=Math.SQRT2-1;return e<t?i*e+t:i*t+e},chebyshev:function(e,t){return Math.max(e,t)}}},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,r),h=s?s+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],a]:e._events[h].push(a):(e._events[h]=a,e._eventsCount++),e}function h(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function l(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),l.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},l.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},l.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},l.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var h,l,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,r),!0;case 6:return d.fn.call(d.context,t,i,n,r,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];d.fn.apply(d.context,h)}else{var u,p=d.length;for(l=0;l<p;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,i);break;case 4:d[l].fn.call(d[l].context,t,i,n);break;default:if(!h)for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];d[l].fn.apply(d[l].context,h)}}return!0},l.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},l.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},l.prototype.removeListener=function(e,t,i,n){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return h(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||h(this,r);else{for(var a=0,l=[],d=o.length;a<d;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=1===l.length?l[0]:l:h(this,r)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&h(this,t)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=s,l.EventEmitter=l,e.exports=l},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){e.exports=i(91)},function(e,t,i){var n=i(11),s=i(5),r=i(8);i(2);function o(e){e=e||{},this.heuristic=e.heuristic||r.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}o.prototype.findPath=function(e,t,i,r,o){var a,h=this.openList=new n((function(e,t){return e.f-t.f})),l=this.startNode=o.getNodeAt(e,t),d=this.endNode=o.getNodeAt(i,r);for(this.grid=o,l.g=0,l.f=0,h.push(l),l.opened=!0;!h.empty();){if((a=h.pop()).closed=!0,a===d)return s.expandPath(s.backtrace(d));this._identifySuccessors(a)}return[]},o.prototype._identifySuccessors=function(e){var t,i,n,s,o,a,h,l,d,c,u=this.grid,p=this.heuristic,f=this.openList,m=this.endNode.x,g=this.endNode.y,y=e.x,v=e.y,C=Math.abs;Math.max;for(s=0,o=(t=this._findNeighbors(e)).length;s<o;++s)if(i=t[s],n=this._jump(i[0],i[1],y,v)){if(a=n[0],h=n[1],(c=u.getNodeAt(a,h)).closed)continue;l=r.octile(C(a-y),C(h-v)),d=e.g+l,(!c.opened||d<c.g)&&(c.g=d,c.h=c.h||p(C(a-m),C(h-g)),c.f=c.g+c.h,c.parent=e,c.opened?f.updateItem(c):(f.push(c),c.opened=!0))}},e.exports=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Position=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e=0,t=0){super(s.SYSTEMS.POSITION),this.setPositionCallback=null,this.lastPosition={x:0,y:0},this.framesSinceReceivedNewPosition=0,this.expectedFramesBetweenPosition=3,this.position={x:0,y:0},this.setPosition(e,t)}getPosition(){return this.position}lockPosition(e){e&&(this.x=e.x,this.y=e.y),this.positionLocked=!0,this.setPositionCallback&&this.setPositionCallback(this.x,this.y)}addLockUnlockPositionCallback(e){this.setPositionCallback=e}getDistance(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}unlockPosition(e){e&&(this.x=e.x,this.y=e.y),this.positionLocked=!1,this.setPositionCallback&&this.setPositionCallback(this.x,this.y)}interpolatePosition(){if(this.framesSinceReceivedNewPosition++,this.framesSinceReceivedNewPosition>=this.expectedFramesBetweenPosition)return this.x=this._nextX,this.y=this._nextY,!0;{const e=this.framesSinceReceivedNewPosition/this.expectedFramesBetweenPosition;return this.setPosition(this._startInterpolationX+(this._nextX-this._startInterpolationX)*e,this._startInterpolationY+(this._nextY-this._startInterpolationY)*e),!1}}setLastPosition(){this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y}getLastPosition(){return Object.assign({},this.lastPosition)}setPosition(e,t){return this.positionLocked||(this.x=e,this.y=t),this.position}setPositionByDeltas(e,t){return this.positionLocked||(this.x=this._x+e,this.y=this._y+t),this.position}setNextPositions(e,t){this.framesSinceReceivedNewPosition=0,this._startInterpolationX=this._x,this._startInterpolationY=this._y,this._nextX=e,this._nextY=t}get x(){return this._x}get y(){return this._y}set x(e){var t,i;this._x=e,this.position.x=e,null===(i=null===(t=this.entity)||void 0===t?void 0:t.gameObject)||void 0===i||i.setPosition(e,this.y)}set y(e){var t,i;this._y=e,this.position.y=e,null===(i=null===(t=this.entity)||void 0===t?void 0:t.gameObject)||void 0===i||i.setPosition(this._x,e)}onAdded(e){this.entity=e,this.setAttributeGetter("x",()=>this._x),this.setAttributeGetter("y",()=>this._y)}onRemoved(){}}t.Position=r},function(e,t,i){var n=i(155);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,i(27).default)("0f223f67",n,!1,{})},function(e,t,i){var n=i(157);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,i(27).default)("5d4be83c",n,!1,{})},function(e,t,i){var n=i(162);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,i(27).default)("6a160431",n,!1,{})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(46),s=i(47);var r;!function(e){e[e.CLIENT=0]="CLIENT",e[e.SERVER=1]="SERVER"}(r=t.PROCESS_ENV||(t.PROCESS_ENV={}));const o=i(48),a=i(49),h=i(50);t.Process=class{constructor(e,t={},i=[]){this.$api={},this.apiSystemLookup={},this.pluginInit=[],this.globals=t,this.processEnv=e,this.systems={},this.systemNames=[],this.systemInitializedOrder=new Map,this.startedSystems=[],this._serverGameData={},this.stoppedSystems=[],this.messageQueue=e===r.SERVER?new a.ServerMessageQueue:new o.ClientMessageQueue,this.entityManager=new n.EntityManager(this.systems),this.initializerFactory=e===r.SERVER?h.server:h.client}addGlobal(e,t){this.globals[e]=t}installPlugin(e,t){let i=this.pluginInit.find(t=>e.name===t.plugin.name);const n=i?i.plugin:new s.Plugin(e,this.globals);i||n.initialize(),t||(t=[...this.systemNames]);const r=[...t];let o=0;for(let e=0;e<t.length;e++){const i=this.systems[t[e]];i&&(n.applyToSystem(i),r.splice(e-o,1),o++)}i?i.systems=[...i.systems,...r].filter((e,t,i)=>i.indexOf(e)===t):this.pluginInit.push({plugin:n,systems:r})}set serverGameData(e){this._serverGameData=e,this.startedSystems.forEach(t=>{t.serverGameData=e})}addSystem(e,...t){let i=new e(...t);if(this.systems[i.name])throw`Duplicate systen name ${i.name}`;return i.installPlugin=e=>{this.installPlugin(e)},this.systemInitializer(i),this.systems[i.name]=i,this.systemNames.push(i.name),this.systemInitializedOrder.set(i.name,this.systemInitializedOrder.size),this.stoppedSystems.push(i),this.pluginInit.forEach(({plugin:e,systems:t})=>{t.includes(i.name)&&e.applyToSystem(i)}),i}_stopAllSystems(){for(let e=0;e<this.systemNames.length;e++)this._stopSystem(this.systemNames[e])}_stopSystem(e){const t="string"==typeof e||"number"==typeof e?this.startedSystems.find(t=>t.name===e):this.startedSystems.find(t=>t.constructor===e);if(t){this.messageQueue.removeSystem(t.name),t.onStop();for(let e=0;e<this.startedSystems.length;e++)if(this.startedSystems[e]===t){this.startedSystems.splice(e,1);break}const e=this.apiSystemLookup[t.name];e&&(e.forEach(e=>{delete this.$api[e]}),delete this.apiSystemLookup[t.name]),this.stoppedSystems.push(t)}}_startAllSystems(){for(let e=0;e<this.systemNames.length;e++)this._startSystem(this.systemNames[e])}_restartSystem(e){const t="string"==typeof e||"number"==typeof e?this.startedSystems.find(t=>t.name===e):this.startedSystems.find(t=>t.constructor===e);if(!t)throw new Error(`Couldin't restart system ${e} since it wasn't started.`);t.onRestart()}_startSystem(e){const t="string"==typeof e||"number"==typeof e?this.stoppedSystems.find(t=>t.name===e):this.stoppedSystems.find(t=>t.constructor===e);if(!t)throw new Error("Couldnt find system");{this.messageQueue.addSystem(t);const e=t.name,i=this.systemInitializedOrder.get(e);if(0===this.startedSystems.length)this.startedSystems.push(this.systems[e]);else{const t=this.startedSystems[this.startedSystems.length-1].name;if(i>this.systemInitializedOrder.get(t))this.startedSystems.push(this.systems[e]);else for(let t=0;t<this.startedSystems.length;t++){if(this.systemInitializedOrder.get(this.startedSystems[t].name)>i){this.startedSystems.splice(t,0,this.systems[e]);break}}}this.systems[e].serverGameData=this._serverGameData,this.stoppedSystems.splice(this.stoppedSystems.indexOf(t),1),this.systems[e].onStart()}}tick(e){for(let t=0;t<this.startedSystems.length;t++)this.messageQueue.dispatch(this.startedSystems[t].name),this.startedSystems[t].update(e)}clear(){this._stopAllSystems();for(let e=0;e<this.systemNames.length;e++)this.systems[this.systemNames[e]].onClear();this.systems={},this.startedSystems.length=0,this.stoppedSystems.length=0,this.systemNames.length=0,this.systemInitializedOrder=new Map}addApi(e,t,i){if(!(t&&("[object Function]"==={}.toString.call(t)||"[object AsyncFunction]"==={}.toString.call(t))))throw new Error("addApi must be called with a valid function to add as an api method");if(!(i=i||t.name))throw new Error(`no name provided for api method ${t} from system ${e} if youre adding an anonynmous function to the api from a system you must supply a name as second parameter`);this.$api[i]=t.bind(e),this.apiSystemLookup[e.name]?this.apiSystemLookup[e.name].push(i):this.apiSystemLookup[e.name]=[i]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(34);t.OnceSignal=n.OnceSignal;var s=i(58);t.Signal=s.Signal;var r=i(36);t.Slot=r.Slot;var o=i(35);t.SlotList=o.SlotList},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GOTTI_ROUTE_BODY_PAYLOAD="__GOTTI_ROUTE_BODY_PAYLOAD__",t.GOTTI_GET_GAMES_OPTIONS="__GOTTI_GET_GAMES_OPTIONS__",t.GOTTI_GATE_AUTH_ID="__GOTTI_AUTH_ID__",t.GOTTI_AUTH_KEY="__GOTTI_AUTH_KEY__",t.GOTTI_HTTP_ROUTES={BASE_AUTH:"/gotti_auth",AUTHENTICATE:"/gotti_authenticate",REGISTER:"/gotti_register",BASE_GATE:"/gotti_gate",GET_GAMES:"/gotti_games",JOIN_GAME:"/gotti_join_game",BASE_PUBLIC_API:"/gotti_api",CONNECTOR:"/gotti_connector"},function(e){e[e.PEER_PLAYER_DISCONNECTED_FROM_SERVER=0]="PEER_PLAYER_DISCONNECTED_FROM_SERVER",e[e.PEER_PLAYER_TIMED_OUT=1]="PEER_PLAYER_TIMED_OUT",e[e.PEER_MANUALLY_CLOSED=2]="PEER_MANUALLY_CLOSED"}(t.PeerDisconnectionReasons||(t.PeerDisconnectionReasons={})),function(e){e[e.PING=0]="PING",e[e.PONG=1]="PONG"}(t.PEER_TO_PEER_PROTOCOLS||(t.PEER_TO_PEER_PROTOCOLS={})),function(e){e[e.SET=0]="SET",e[e.PATCH=1]="PATCH"}(t.StateProtocol||(t.StateProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(71),s=i(72);t.decode=n,t.encode=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bone=void 0;const n=i(4);class s extends PIXI.Sprite{constructor(e,t){var i;super(),this.currentColliders={},this.curFrameX=0,this.curFrameY=0,this.curFrameScaleX=1,this.curFrameScaleY=1,this.curFrameRotation=0,this.animationTrackOverridesByLevel=[],this.setupTrackOverridesByLevel=[],this.slotColliderDatas=[],this.frameTransformsDeltas=[],this.frameIndex=0,this.skeleton=t,this.slotIdToColliderLookup=(null===(i=null==t?void 0:t.atlasLoader)||void 0===i?void 0:i.slotIdToColliderLookup)||{},this.id=e,this.paramsObj={bone:this,skeleton:this.skeleton,track:null}}addColliderId(e){if(this.colliderIds){if(this.colliderIds.indexOf(e)>-1)throw new Error("Trying to add duplicate collider");this.colliderIds.push(e)}else this.colliderIds=[e]}removeColliderId(e){for(let t=0;t<this.colliderIds.length;t++)if(this.colliderIds[t]==e)return this.colliderIds.splice(t,1),void(this.colliderIds.length||delete this.colliderIds);throw new Error(`Did not find collider id ${e} on bone`)}determineNewTrackOverride(){this.curAnimationOverrideTrack?this.curSetupOverrideTrack&&this.curSetupOverrideTrack.level>this.curAnimationOverrideTrack.level?this.curTrackOverride=this.curSetupOverrideTrack:this.curTrackOverride=this.curAnimationOverrideTrack:this.curTrackOverride=this.curSetupOverrideTrack,this.curTrackOverride?this.changeSlot(this.curTrackOverride.computeCurrentSlotForBone(this.id,this.curTrackOverride!==this.curAnimationOverrideTrack)):this.changeSlot(-1)}applyTransformToShapeData(e,t){return t=t||n.resolveColliderType(e),e}changeSlot(e){this.slotColliderDatas=this.slotIdToColliderLookup[e];const t=this.slotColliders?[...this.slotColliders]:null;if(delete this.slotColliders,this.visible=!0,e&&(-1===e?(this.visible=!1,this.texture=PIXI.Texture.EMPTY):this.texture=this.skeleton.activeSlotTextures[e]),this.slotId!==e){let i;if(e>0&&(i=this.skeleton.allSlotColliderLookup[e]))for(let e=0;e<i.length;e++){const{id:n,shapeData:s}=i[e];this.slotColliders?this.slotColliders.push(n):this.slotColliders=[n];const r=this.applyTransformToShapeData(s);if(t){const e=t.indexOf(n);e>-1?(t.splice(e,1),this.colliderManager.onAdjusted(this.paramsObj,{id:n,shapeData:r},!1)):this.colliderManager.onAdded(this.paramsObj,{id:n,shapeData:r})}}this.slotId=e}if(t)for(let e=0;e<t.length;e++)this.colliderManager.onRemoved(this.paramsObj,t[e])}removeSlotOverrideLevel(e,t){if(t){if(e===this.curSetupOverrideTrack)this.setupTrackOverridesByLevel.pop(),this.curSetupOverrideTrack=this.setupTrackOverridesByLevel[this.setupTrackOverridesByLevel.length-1],e===this.curTrackOverride&&this.determineNewTrackOverride();else for(let t=0;t<this.setupTrackOverridesByLevel.length;t++)if(this.setupTrackOverridesByLevel[t]===e)return void this.setupTrackOverridesByLevel.splice(t,1)}else if(e===this.curAnimationOverrideTrack)this.animationTrackOverridesByLevel.pop(),this.curAnimationOverrideTrack=this.animationTrackOverridesByLevel[this.animationTrackOverridesByLevel.length-1],e===this.curTrackOverride&&this.determineNewTrackOverride();else for(let t=0;t<this.animationTrackOverridesByLevel.length;t++)if(this.animationTrackOverridesByLevel[t]===e)return void this.animationTrackOverridesByLevel.splice(t,1)}addSlotOverrideLevel(e,t){if(t){if(this.setupTrackOverridesByLevel.push(e),!this.curTrackOverride)return this.curSetupOverrideTrack=e,this.curTrackOverride=e,this.changeSlot(e.computeCurrentSlotForBone(this.id,!0));if(!this.curSetupOverrideTrack||e.level>this.curSetupOverrideTrack.level)return this.curSetupOverrideTrack=e,this.curTrackOverride.level<e.level?(this.curTrackOverride=e,this.changeSlot(e.computeCurrentSlotForBone(this.id,!0))):void 0;this.setupTrackOverridesByLevel.sort((e,t)=>e.level-t.level)}else{if(this.animationTrackOverridesByLevel.push(e),!this.curTrackOverride)return this.curAnimationOverrideTrack=e,this.curTrackOverride=e,void this.changeSlot(e.computeCurrentSlotForBone(this.id));if(!this.curAnimationOverrideTrack||e.level>this.curAnimationOverrideTrack.level||this.curAnimationOverrideTrack.passive&&e.level===this.curAnimationOverrideTrack.level)return this.curAnimationOverrideTrack=e,void(this.curTrackOverride.level<=e.level&&(this.curTrackOverride=e,this.changeSlot(e.computeCurrentSlotForBone(this.id))));this.animationTrackOverridesByLevel.sort((e,t)=>e.level===t.level?e.passive?t.passive?0:-1:t.passive?1:0:e.level-t.level)}}_addChildBones(e){const t={x:this.curFrameX,y:this.curFrameY,rotation:this.curFrameRotation,scaleX:1-this.curFrameScaleX,scaleY:1-this.curFrameScaleY};if(this.childBones)for(let i=0;i<e.length;i++){if(e[i].parentBone)throw new Error("A bone should not have already had a parent when being added to a bone.");e[i].parentBone=this,this.childBones.push(e[i]),e[i].applyTrackTransform(t)}else{this.childBones=new Array(e.length);for(let i=0;i<e.length;i++){if(e[i].parentBone)throw new Error("A bone should not have already had a parent when being added to a bone.");e[i].parentBone=this,this.childBones[i]=e[i],e[i].applyTrackTransform(t)}}}_addChildBone(e){e.parentBone=this,this.childBones?this.childBones.push(e):this.childBones=[e],e.applyTrackTransform({x:this.curFrameX,y:this.curFrameY,rotation:this.curFrameRotation,scaleX:1-this.curFrameScaleX,scaleY:1-this.curFrameScaleY})}transformColliderData(e){this.rotation,this.scale.x||this.scale.y}_removeChildBone(e){for(let t=0;t<this.childBones.length;t++)if(this.childBones[t]===e)return delete e.parentBone,this.childBones.splice(t,1),void(this.childBones.length||delete this.childBones)}_removeChildBones(e){const t=this.childBones.length;if(e.length===t){delete this.childBones;for(let t=0;t<e.length;t++)delete e[t].parentBone}else{let i=e.length;const n=new Array(this.childBones.length-i);let s=e.pop();delete s.parentBone;for(let r=t-1;r>=0;--r)s&&this.childBones[r]===s?(s=e.pop(),i--,s&&delete s.parentBone):n[r-i]=this.childBones[r];if(this.childBones=n,e.length)throw new Error("Should have had no bones left in this array to remove. Make sure you pass in the bonesToRemove array in the same order as it was added.")}}recalculateFrameTransform(){for(let e=0;e<this.frameTransformsDeltas.length;e++){const t=this.frameTransformsDeltas[e];t&&(this.curFrameX+=t.x||0,this.curFrameY+=t.y||0,this.curFrameScaleX+=t.scaleX||0,this.curFrameScaleY+=t.scaleY||0,this.curFrameRotation+=t.rotation||0)}if(this.childBones)for(let e=0;e<this.childBones.length;e++)this.childBones[e].recalculateFrameTransform()}applyTransformToCollider(e,t){return"polygon"===(t=t||n.resolveColliderType(e))?e.map(e=>({x:e.x+this.curFrameX+this.skeleton.x,y:e.y+this.curFrameY+this.skeleton.y})):Object.assign(Object.assign({},e),{x:e.x*this.curFrameScaleX+this.curFrameX+this.skeleton.x,y:e.y*this.curFrameScaleY+this.curFrameY+this.skeleton.y})}applyTrackTransform(e,t){if(t?(this.curFrameX-=e.x||0,this.curFrameY-=e.y||0,this.curFrameScaleX-=e.scaleX||0,this.curFrameScaleY-=e.scaleY||0,this.curFrameRotation-=e.rotation||0,this.setTransform(this.curFrameX,this.curFrameY,this.curFrameScaleX,this.curFrameScaleY,this.curFrameRotation)):(this.curFrameX+=e.x||0,this.curFrameY+=e.y||0,this.curFrameScaleX+=e.scaleX||0,this.curFrameScaleY+=e.scaleY||0,this.curFrameRotation+=e.rotation||0,this.setTransform(this.curFrameX,this.curFrameY,this.curFrameScaleX,this.curFrameScaleY,this.curFrameRotation)),this.colliderManager&&this.colliderIds){for(let e=0;e<this.colliderIds.length;e++){const i=this.colliderIds[e],n=this.applyTransformToShapeData(this.skeleton.nonSlotColliderLookup[i]);this.colliderManager.onAdjusted(this.paramsObj,{id:i,shapeData:n},t)}if(this.slotId){const e=this.skeleton.allSlotColliderLookup[this.slotId];if(e)for(let t=0;t<e.length;t++){const i=this.applyTransformToShapeData(e[t]);this.colliderManager.onAdjusted(this.paramsObj,{id:e[t].slotId,shapeData:i},!1)}}}if(this.childBones)for(let i=0;i<this.childBones.length;i++)this.childBones[i].applyTrackTransform(e,t)}nextFrame(){}}t.Bone=s},function(e,t){e.exports=function(e,t,i){this.x=e,this.y=t,this.walkable=void 0===i||i}},function(e,t,i){var n=i(11),s=i(5),r=i(8),o=i(2);function a(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never),this.diagonalMovement===o.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}a.prototype.findPath=function(e,t,i,r,o){var a,h,l,d,c,u,p,f,m=new n((function(e,t){return e.f-t.f})),g=o.getNodeAt(e,t),y=o.getNodeAt(i,r),v=this.heuristic,C=this.diagonalMovement,S=this.weight,w=Math.abs,b=Math.SQRT2;for(g.g=0,g.f=0,m.push(g),g.opened=!0;!m.empty();){if((a=m.pop()).closed=!0,a===y)return s.backtrace(y);for(d=0,c=(h=o.getNeighbors(a,C)).length;d<c;++d)(l=h[d]).closed||(u=l.x,p=l.y,f=a.g+(u-a.x==0||p-a.y==0?1:b),(!l.opened||f<l.g)&&(l.g=f,l.h=l.h||S*v(w(u-i),w(p-r)),l.f=l.g+l.h,l.parent=a,l.opened?m.updateItem(l):(m.push(l),l.opened=!0)))}return[]},e.exports=a},function(e,t,i){var n=i(11),s=i(5),r=i(8),o=i(2);function a(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||r.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.OnlyWhenNoObstacles:this.diagonalMovement=o.IfAtMostOneObstacle:this.diagonalMovement=o.Never),this.diagonalMovement===o.Never?this.heuristic=e.heuristic||r.manhattan:this.heuristic=e.heuristic||r.octile}a.prototype.findPath=function(e,t,i,r,o){var a,h,l,d,c,u,p,f,m=function(e,t){return e.f-t.f},g=new n(m),y=new n(m),v=o.getNodeAt(e,t),C=o.getNodeAt(i,r),S=this.heuristic,w=this.diagonalMovement,b=this.weight,T=Math.abs,_=Math.SQRT2;for(v.g=0,v.f=0,g.push(v),v.opened=1,C.g=0,C.f=0,y.push(C),C.opened=2;!g.empty()&&!y.empty();){for((a=g.pop()).closed=!0,d=0,c=(h=o.getNeighbors(a,w)).length;d<c;++d)if(!(l=h[d]).closed){if(2===l.opened)return s.biBacktrace(a,l);u=l.x,p=l.y,f=a.g+(u-a.x==0||p-a.y==0?1:_),(!l.opened||f<l.g)&&(l.g=f,l.h=l.h||b*S(T(u-i),T(p-r)),l.f=l.g+l.h,l.parent=a,l.opened?g.updateItem(l):(g.push(l),l.opened=1))}for((a=y.pop()).closed=!0,d=0,c=(h=o.getNeighbors(a,w)).length;d<c;++d)if(!(l=h[d]).closed){if(1===l.opened)return s.biBacktrace(l,a);u=l.x,p=l.y,f=a.g+(u-a.x==0||p-a.y==0?1:_),(!l.opened||f<l.g)&&(l.g=f,l.h=l.h||b*S(T(u-e),T(p-t)),l.f=l.g+l.h,l.parent=a,l.opened?y.updateItem(l):(y.push(l),l.opened=2))}}return[]},e.exports=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputSystem=void 0;t.InputSystem=class{constructor(e){this._onActionListeners={},this._onMappedActionAddedListeners=[],this._onMappedActionRemovedListeners=[],this.actionState={},this.actionNames=[],this.mappedInputIdToActions={},this.mappedActionToInputIds={},e&&this.applyActionToInputMap(e)}applyActionToInputMap(e){if(!this.validateActionToInputMap(e))throw new Error("Invalid.");for(let t in e)this.addActionState(t,!1),e[t].forEach(e=>{this.mapInputIdToAction(e,t)})}getMappedActionInputs(){return Object.assign({},this.mappedActionToInputIds)}validateActionToInputMap(e){return!0}update(){var e,t,i;const n=Object.assign({},this.actionState);this.updateState();let s=null;for(let r=0;r<this.actionNames.length;r++){const o=this.actionNames[r],a=n[o],h=this.actionState[o];if("object"!=typeof h&&a!==h||h.power!==(null==a?void 0:a.power)||(null===(e=h.angles)||void 0===e?void 0:e.default.degrees)!==(null===(t=a.angles)||void 0===t?void 0:t.default.degrees)){const e={previous:a,current:h};(s=s||{})[o]=e,null===(i=this._onActionListeners[o])||void 0===i||i.forEach(t=>t(e))}}return{state:this.actionState,changed:s}}getUnmappedActions(){return this.actionNames.filter(e=>!(e in this.mappedActionToInputIds))}handleActionChange(e,t){if(!(e in this.actionState))throw new Error(`Invalid action changed ${e}`)}addActionState(e,t=!1){if(e in this.actionState)throw new Error(`Already added action ${e}`);this.actionState[e]=t,this.actionNames=Object.keys(this.actionState)}removeActionState(e){if(!(e in this.actionState))throw new Error(`No action added: ${e}`);delete this.actionState[e],this.actionNames=Object.keys(this.actionState)}onActionChange(e,t){this._onActionListeners[e]?this._onActionListeners[e].push(t):this._onActionListeners[e]=[t]}offActionChange(e,t){const i=this._onActionListeners[e];if(i){const n=i.indexOf(t);n>-1&&i.splice(n,1),i.length||delete this._onActionListeners[e]}}onMappedActionAdded(e){return this._onMappedActionAddedListeners.push(e)}offMappedActionAdded(e){const t=this._onMappedActionAddedListeners.push(e);return t>-1&&this._onMappedActionAddedListeners.splice(t,1),this._onMappedActionAddedListeners.length}onMappedActionRemoved(e){return this._onMappedActionRemovedListeners.push(e)}offMappedActionRemoved(e){const t=this._onMappedActionRemovedListeners.indexOf(e);return t>-1&&this._onMappedActionRemovedListeners.splice(t,1),this._onMappedActionRemovedListeners.length}unmapInputFromAction(e,t){if(Array.isArray(e))return void e.forEach(e=>{this.unmapInputFromAction(e,t)});const i=this.mappedInputIdToActions[e];if(void 0===i)throw new Error(`The inputId ${e} was not mapped to any action.`);const n={inputId:e,action:t,actionNowUnmapped:!1},s=i.indexOf(t);if(s<0)throw new Error(`The inputId ${e} was not mapped to action ${t}.`);i.splice(s,1),i.length||delete this.mappedInputIdToActions[e];const r=this.mappedActionToInputIds[t].indexOf(e);if(r<0)throw new Error("Index should be greater than -1");return this.mappedActionToInputIds[t].splice(r,1),this.mappedActionToInputIds[t].length||delete this.mappedActionToInputIds[t],this._onMappedActionRemovedListeners.forEach(e=>e(n)),n}mapInputIdToAction(e,t){if(Array.isArray(e))return void e.forEach(e=>{this.mapInputIdToAction(e,t)});Array.isArray(t)&&t.forEach(t=>{this.mapInputIdToAction(e,t)}),this.actionState[t]=!1;const i={action:t,inputId:e},n=this.mappedInputIdToActions[e];return null!=n&&n.includes(t)?void 0:(this.mappedInputIdToActions[e]?this.mappedInputIdToActions[e].push(t):this.mappedInputIdToActions[e]=[t],this.mappedActionToInputIds[t]?this.mappedActionToInputIds[t].push(e):this.mappedActionToInputIds[t]=[e],this._onMappedActionAddedListeners.forEach(e=>e(i)),i)}resolveActions(e,t=!1){return this.mappedInputIdToActions[e]}resolveInputs(e){return this.mappedActionToInputIds[e]}getDuplicateInputs(){const e={};return Object.keys(this.mappedInputIdToActions).forEach(t=>{this.mappedActionToInputIds[t].length>1&&(e[t]=this.mappedActionToInputIds[t])}),e}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var s=(o=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(h," */")),r=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")}));return[i].concat(r).concat([s]).join("\n")}var o,a,h;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(i,"}"):i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},s=0;s<this.length;s++){var r=this[s][0];null!=r&&(n[r]=!0)}for(var o=0;o<e.length;o++){var a=e[o];null!=a[0]&&n[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="(".concat(a[2],") and (").concat(i,")")),t.push(a))}},t}},function(e,t,i){"use strict";function n(e,t){for(var i=[],n={},s=0;s<t.length;s++){var r=t[s],o=r[0],a={id:e+":"+s,css:r[1],media:r[2],sourceMap:r[3]};n[o]?n[o].parts.push(a):i.push(n[o]={id:o,parts:[a]})}return i}i.r(t),i.d(t,"default",(function(){return f}));var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var r={},o=s&&(document.head||document.getElementsByTagName("head")[0]),a=null,h=0,l=!1,d=function(){},c=null,u="data-vue-ssr-id",p="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,i,s){l=i,c=s||{};var o=n(e,t);return m(o),function(t){for(var i=[],s=0;s<o.length;s++){var a=o[s];(h=r[a.id]).refs--,i.push(h)}t?m(o=n(e,t)):o=[];for(s=0;s<i.length;s++){var h;if(0===(h=i[s]).refs){for(var l=0;l<h.parts.length;l++)h.parts[l]();delete r[h.id]}}}}function m(e){for(var t=0;t<e.length;t++){var i=e[t],n=r[i.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](i.parts[s]);for(;s<i.parts.length;s++)n.parts.push(y(i.parts[s]));n.parts.length>i.parts.length&&(n.parts.length=i.parts.length)}else{var o=[];for(s=0;s<i.parts.length;s++)o.push(y(i.parts[s]));r[i.id]={id:i.id,refs:1,parts:o}}}}function g(){var e=document.createElement("style");return e.type="text/css",o.appendChild(e),e}function y(e){var t,i,n=document.querySelector("style["+u+'~="'+e.id+'"]');if(n){if(l)return d;n.parentNode.removeChild(n)}if(p){var s=h++;n=a||(a=g()),t=S.bind(null,n,s,!1),i=S.bind(null,n,s,!0)}else n=g(),t=w.bind(null,n),i=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else i()}}var v,C=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join("\n")});function S(e,t,i,n){var s=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=C(t,s);else{var r=document.createTextNode(s),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function w(e,t){var i=t.css,n=t.media,s=t.sourceMap;if(n&&e.setAttribute("media",n),c.ssrId&&e.setAttribute(u,t.id),s&&(i+="\n/*# sourceURL="+s.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(29);class s extends n.default{constructor(e){super(e)}initialize(e,t,i){i&&"object"==typeof i&&(this.globals=i),this.initializeEntity=t.initializeEntity.bind(t),this.destroyEntity=t.destroyEntity.bind(t),this.messageQueue=e,this.messageQueue.addSystem(this),this.dispatchLocal=e.add,this.initialized=!0,this._onInit()}dispatchToAreas(e,t){}dispatchToClient(e,t){}dispatchToAllClients(e){}dispatchToLocalClients(e){}dispatchToMaster(e){}setClientWrite(e,t,i){throw"clientManager.setClientWrite should be overidden in area initialization before use."}addClientListener(e,t,i){throw"clientManager.addClientListen should be overidden in area initialization before use."}removeClientListener(e,t){throw"removeClientListener should be overidden in area initialization before use."}}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(9);t.default=class{constructor(e){if(this.$=new n,!e&&0!==e)throw"Systems must be created with a valid name passed into the super constructor call.";this.name=e}onRemoteMessage(e){}installPlugin(e){}set serverGameData(e){const t=Object.assign({},this._serverGameData);this._serverGameData=e,this.onServerDataUpdated(e,t)}get serverGameData(){return this._serverGameData}_onInit(){this.addMessageListener=this.messageQueue.addGameSystemMessageListener.bind(this.messageQueue,this.name),this.removeMessageListener=this.messageQueue.removeGameSystemMessageListener.bind(this.messageQueue,this.name),this.dispatchLocal=this.messageQueue.add.bind(this.messageQueue),this.dispatchAllLocal=this.messageQueue.addAll.bind(this.messageQueue),this.dispatchLocalInstant=this.messageQueue.instantDispatch.bind(this.messageQueue),this.dispatchAllLocalInstant=this.messageQueue.instantDispatchAll.bind(this.messageQueue),this.onInit()}addMessageListener(e){throw new Error("addMessageListener must be called after the systems onInit function is executed")}removeMessageListener(e){throw new Error("removeMessageListener must be called after the systems onInit function is executed")}getSystemComponent(e){return e?e.getComponent(this.name):null}initializeEntity(e,t){}destroyEntity(e){}onEntityRemovedComponent(e,t){}onEntityAddedComponent(e,t){}onInit(){}onStop(){}onStart(){}onRestart(){}onServerDataUpdated(e,t){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(17),s=i(51);class r extends n.Process{constructor(e,t,i){super(n.PROCESS_ENV.SERVER,t),this.gameloop=null,this.room=null,this.fpsTickRate=20,i&&i.fpsTickRate&&(this.fpsTickRate=i.fpsTickRate),this.systemInitializer=this.initializerFactory(this),this.clientManager=this.addSystem(e);let s=this.addSystem.bind(this);this.addSystem=(e,...t)=>{let i=s(e,...t);return this.room&&this.decorateSystemWithRoomFunctions(i,this.room),this.clientManager&&this.decorateSystemWithClientManagerFunctions(i,this.clientManager),i}}addRoom(e){this.room=e;for(let t in this.systems){const i=this.systems[t];this.decorateSystemWithRoomFunctions(i,e),this.clientManager&&this.decorateSystemWithClientManagerFunctions(i,this.clientManager)}}decorateSystemWithClientManagerFunctions(e,t){e.setClientWrite=this.clientManager.setClientWrite.bind(t),e.removeClientListener=this.clientManager.removeClientListener.bind(t),e.addClientListener=this.clientManager.addClientListener.bind(t)}decorateSystemWithRoomFunctions(e,t){e.dispatchToAllClients=t.dispatchToAllClients.bind(t),e.dispatchToLocalClients=t.dispatchToLocalClients.bind(t),e.dispatchToClient=t.dispatchToClient.bind(t),e.dispatchToAreas=t.dispatchToAreas.bind(t),e.dispatchToMaster=t.dispatchToMaster.bind(t),e.areaId=t.areaId}startLoop(e=this.fpsTickRate){let t=1e3/e;this.gameloop=s.setGameLoop(this.tick.bind(this),t)}stopLoop(){null!=this.gameloop&&s.clearGameLoop(this.gameloop)}startSystem(e){this._startSystem(e)}startAllSystems(){this._startAllSystems()}stopSystem(e){this._stopSystem(e)}stopAllSystems(){this._stopAllSystems()}}t.ServerProcess=r},function(e,t){var i,n,s=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var h,l=[],d=!1,c=-1;function u(){d&&h&&(d=!1,h.length?l=h.concat(l):c=-1,l.length&&p())}function p(){if(!d){var e=a(u);d=!0;for(var t=l.length;t;){for(h=l,l=[];++c<t;)h&&h[c].run();c=-1,t=l.length}h=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new f(e,t)),1!==l.length||d||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,i){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function r(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new r(s.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new r(s.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i(52),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(10))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(17),s=i(53);class r extends n.Process{constructor(e,t,i,s){if(super(n.PROCESS_ENV.CLIENT,i),this.fpsTickRate=60,this.isNetworked=!1,this.peers=[],this.isNetworked=t,!e)throw new Error("Client process needs a web client to construct correctly.");s&&s.fpsTickRate&&(this.fpsTickRate=s.fpsTickRate),this.client=e,this.systemInitializer=this.initializerFactory(this)}setClientIds(e,t){this.gottiId=e,this.clientId=t,this.startedSystems.forEach(i=>{i.gottiId=e,i.clientId=t})}dispatchOnAreaWrite(e,t,i){for(let n=0;n<this.startedSystems.length;n++){const s=this.startedSystems[n];s.onAreaWrite&&s.onAreaWrite(e,t,i)}}dispatchOnAreaListen(e,t,i){const n=this.startedSystems.length;for(let t=0;t<this.startedSystems.length;t++){const n=this.startedSystems[t];n.onAreaListen&&n.onAreaListen(e,i)}for(let e=0;e<n;e++);}onPeerDisconnection(e,t){for(let i=0;i<this.startedSystems.length;i++){const n=this.startedSystems[i];n.onPeerDisconnection&&n.onPeerDisconnection(e,t)}}dispatchOnRemoveAreaListen(e,t){for(let i=0;i<this.startedSystems.length;i++){const n=this.startedSystems[i];n.onRemoveAreaListen&&n.onRemoveAreaListen(e,t)}}onPeerConnectionRequest(e,t,i){const n=this.systems[t];return!!(this.startedSystems.indexOf(n)>-1&&n.onPeerConnectionRequest)&&n.onPeerConnectionRequest(e,i)}onPeerConnection(e,t){for(let i=0;i<this.startedSystems.length;i++){const n=this.startedSystems[i];n.onPeerConnection&&n.onPeerConnection(e,t)}}onPeerMissedPing(e,t){for(let i=0;i<this.startedSystems.length;i++){const n=this.startedSystems[i];n.onPeerMissedPing&&n.onPeerMissedPing(e,t)}}startLoop(e=this.fpsTickRate){s.setGameLoop(this.tick.bind(this),1e3/e)}stopLoop(){this.clear(),s.clearGameLoop()}clearGame(){this.clear(),s.clearGameLoop()}startSystem(e){this._startSystem(e)}startAllSystems(){this._startAllSystems()}restartSystem(e){this._restartSystem(e)}stopSystem(e){this._stopSystem(e)}stopAllSystems(){this._stopAllSystems()}}t.ClientProcess=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(35),s=i(36),r=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.slots=n.SlotList.NIL,this.valueClasses=1===e.length&&e[0]instanceof Array?e[0]:e}return Object.defineProperty(e.prototype,"valueClasses",{get:function(){return this._valueClasses},set:function(e){this._valueClasses=e?e.slice():[];for(var t=this._valueClasses.length;t--;)if(!(this._valueClasses[t]instanceof Object))throw new Error("Invalid valueClasses argument: item at index "+t+" should be a Class but was:<"+this._valueClasses[t]+">."+this._valueClasses[t])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numListeners",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),e.prototype.addOnce=function(e){return this.registerListener(e,!0)},e.prototype.once=function(e){return this.addOnce(e)},e.prototype.remove=function(e){var t=this.slots.find(e);return t?(this.slots=this.slots.filterNot(e),t):null},e.prototype.removeAll=function(){this.slots=n.SlotList.NIL},e.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this._valueClasses.length,n=e.length;if(n<i)throw new Error("Incorrect number of arguments. Expected at least "+i+" but received "+n+".");for(var s=0;s<i;s++)if(!(null===e[s]||e[s]instanceof this._valueClasses[s]||e[s].constructor===this._valueClasses[s]))throw new Error("Value object <"+e[s]+"> is not an instance of <"+this._valueClasses[s]+">.");var r=this.slots;if(r.nonEmpty)for(;r.nonEmpty;)r.head.execute(e),r=r.tail},e.prototype.registerListener=function(e,t){if(void 0===t&&(t=!1),this.registrationPossible(e,t)){var i=new s.Slot(e,this,t);return this.slots=this.slots.prepend(i),i}return this.slots.find(e)},e.prototype.registrationPossible=function(e,t){if(!this.slots.nonEmpty)return!0;var i=this.slots.find(e);if(!i)return!0;if(i.once!==t)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1},e}();t.OnceSignal=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t,i){if(void 0===i&&(i=null),this.nonEmpty=!1,t||i){if(!t)throw new Error("Parameter head cannot be null.");this.head=t,this.tail=i||e.NIL,this.nonEmpty=!0}else{if(e.NIL)throw new Error("Parameters head and tail are null. Use the NIL element instead.");this.nonEmpty=!1}}return Object.defineProperty(e.prototype,"length",{get:function(){if(!this.nonEmpty)return 0;if(this.tail===e.NIL)return 1;for(var t=0,i=this;i.nonEmpty;)++t,i=i.tail;return t},enumerable:!0,configurable:!0}),e.prototype.prepend=function(t){return new e(t,this)},e.prototype.append=function(t){if(!t)return this;if(!this.nonEmpty)return new e(t);if(this.tail===e.NIL)return new e(t).prepend(this.head);for(var i=new e(this.head),n=i,s=this.tail;s.nonEmpty;)n=n.tail=new e(s.head),s=s.tail;return n.tail=new e(t),i},e.prototype.insertWithPriority=function(t){if(!this.nonEmpty)return new e(t);var i=t.priority;if(i>this.head.priority)return this.prepend(t);for(var n=new e(this.head),s=n,r=this.tail;r.nonEmpty;){if(i>r.head.priority)return s.tail=r.prepend(t),n;s=s.tail=new e(r.head),r=r.tail}return s.tail=new e(t),n},e.prototype.filterNot=function(t){if(!this.nonEmpty||null==t)return this;if(t===this.head.listener)return this.tail;for(var i=new e(this.head),n=i,s=this.tail;s.nonEmpty;){if(s.head.listener===t)return n.tail=s.tail,i;n=n.tail=new e(s.head),s=s.tail}return this},e.prototype.contains=function(e){if(!this.nonEmpty)return!1;for(var t=this;t.nonEmpty;){if(t.head.listener===e)return!0;t=t.tail}return!1},e.prototype.find=function(e){if(!this.nonEmpty)return null;for(var t=this;t.nonEmpty;){if(t.head.listener===e)return t.head;t=t.tail}return null},e.prototype.toString=function(){for(var e="",t=this;t.nonEmpty;)e+=t.head+" -> ",t=t.tail;return"[List "+(e+="NIL")+"]"},e.NIL=new e(null,null),e}();t.SlotList=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,i,n){void 0===i&&(i=!1),void 0===n&&(n=0),this._enabled=!0,this._once=!1,this._priority=0,this._listener=e,this._once=i,this._signal=t,this._priority=n,this.verifyListener(e)}return e.prototype.execute0=function(){this._enabled&&(this._once&&this.remove(),this._params&&this._params.length?this._listener.apply(null,this._params):this._listener())},e.prototype.execute1=function(e){this._enabled&&(this._once&&this.remove(),this._params&&this._params.length?this._listener.apply(null,[e].concat(this._params)):this._listener(e))},e.prototype.execute=function(e){if(this._enabled){this._once&&this.remove(),this._params&&this._params.length&&(e=e.concat(this._params));var t=e.length;0===t?this._listener():1===t?this._listener(e[0]):2===t?this._listener(e[0],e[1]):3===t?this._listener(e[0],e[1],e[2]):this._listener.apply(null,e)}},Object.defineProperty(e.prototype,"listener",{get:function(){return this._listener},set:function(e){if(null==e)throw new Error("Given listener is null.\nDid you want to set enabled to false instead?");this.verifyListener(e),this._listener=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"once",{get:function(){return this._once},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"[Slot listener: "+this._listener+", once: "+this._once+", priority: "+this._priority+", enabled: "+this._enabled+"]"},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"params",{get:function(){return this._params},set:function(e){this._params=e},enumerable:!0,configurable:!0}),e.prototype.remove=function(){this._signal.remove(this._listener)},e.prototype.verifyListener=function(e){if(null==e)throw new Error("Given listener is null.");if(null==this._signal)throw new Error("Internal signal reference has not been set yet.")},e}();t.Slot=n},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Gottimation=t.DEFAULT_SKIN_ID=void 0;const s=i(81),r=i(82),o=i(38),a=i(83),h=i(87),l=i(4),d=i(21);t.DEFAULT_SKIN_ID="default.png";const c=e=>{if("undefined"==typeof PIXI)throw new Error("No global PIXI object found.");{let t,i;if(e&&e.rendererOpts)i=e.rendererOpts;else{if(e&&e.canvas)t=e.canvas;else{if("undefined"==typeof document)throw new Error("No document object found on global scope.");let t;if(null==e?void 0:e.canvasId){if("undefined"!=typeof document&&(t=document.getElementById(e.canvasId)),!t)throw new Error(`Could not find a canvas reference for id: ${e.canvasId}`)}else t=document.createElement("canvas"),document.body.appendChild(t);if(!t)throw new Error("Was not able to create a canvas and no canvas was passed in as an init prop.")}i={view:t}}if(void 0!==PIXI.autoDetectRenderer)return PIXI.autoDetectRenderer(i);if(void 0===PIXI.WebGLRenderer){if(void 0!==PIXI.CanvasRenderer)return new PIXI.CanvasRenderer(i);throw new Error("Could not find a Renderer constructor on PIXI global object")}try{return new PIXI.WebGLRenderer(i)}catch(e){return new PIXI.CanvasRenderer(i)}}};class u{constructor(e,t,i,n,o){this.allSkeletons=[],n=n||{lazyLoadTextures:!0},this.skeletonData=r.formatSkeletonData(e);const h=n.renderer||c(n);this.renderer=h,this.atlasLoader=new a.LazyDynamicAtlasLoader(e.atlases,i,t,h,o),s.Skeleton.create=this.createSkeleton.bind(this),s.Skeleton.createWithAsyncOptions=this.createSkeletonWithAsyncOptions.bind(this)}init(e){return n(this,void 0,void 0,(function*(){}))}handleUpdate(e,t,i){switch(t){case"animation":e;case"attachment":e;case"skeleton":e;case"skin":e;case"sub-attachment":e}}static clearColliderManager(e){delete s.Skeleton.prototype.colliderManager,delete d.Bone.prototype.colliderManager,delete o.AnimationTrack.prototype.colliderManager}static useColliderManager(e){o.AnimationTrack.prototype.colliderManager&&(o.AnimationTrack.prototype.colliderManager!==e?console.warn("Changing the collider manager after already setting it can cause undocumented behavior and issues/bugs."):console.warn("Redundantly using the same collider manager")),s.Skeleton.prototype.colliderManager=e,d.Bone.prototype.colliderManager=e,o.AnimationTrack.prototype.colliderManager=e}getSlotTags(e){return this.atlasLoader.slotIdToTagLookup[e]}getSkinSlotTexturesByTag(e,t){return n(this,void 0,void 0,(function*(){if(t.skinTexture){const i=this.atlasLoader.getSlotsForTexture(t.skinTexture,t.atlasName,e);return Object.keys(i).map(e=>({slotId:parseInt(e),texture:i[e]})).flat()}{if(!(t.atlasName in this.atlasLoader.atlasNameToSkinNameToSlotTextures))throw new Error(`Invalid atlas name ${t.atlasName}`);const i=[],n=t.skinUrl?yield this.atlasLoader.loadSkinSlotsByUrl(t.atlasName,t.skinUrl):yield this.atlasLoader.loadSkinSlots(t.atlasName,t.skinName);for(let t in n){const s=parseInt(t);this.atlasLoader.slotHasTag(s,e)&&i.push({slotId:s,texture:n[t]})}return i}}))}static Init(e,i,s){return n(this,void 0,void 0,(function*(){s||(s=new h.Loader(e),yield s.initialize()),(null==i?void 0:i.colliderManager)&&u.useColliderManager(null==i?void 0:i.colliderManager),i&&i.renderer||console.warn("No pixi renderer was passed in to init options, this will cause problems unless you use the renderer made in the gottimation constructor for the rest of your game rendering. (Accessed through gottimation.renderer)");let r=0;const o=`${e}/last_edit_timestamp`,a=`${e}/project.json`,d=`${e}/meta.json`,c=[],p=(i,r,o)=>n(this,void 0,void 0,(function*(){for(let n=0;n<r.length;n++){const a=r[n],h=`${e}/atlases/${a.name}/${t.DEFAULT_SKIN_ID}`,d=yield i(h,!o);if(!d){console.warn(`Failed to load default atlas image for atlas: ${a.name}`);continue}o&&s&&(yield s.saveImageData(h,d));const u=yield l.getTextureFromBlob(d);c.push({atlasName:a.name,skinId:t.DEFAULT_SKIN_ID,texture:u})}})),f=()=>n(this,void 0,void 0,(function*(){const e=yield l.httpGetAsync(a);if(!e)throw new Error(`Could not find global project data at path ${e}`);return s&&(yield s.saveJson(o,Date.now()),yield s.saveJson(a,e)),(null==i?void 0:i.preloadAtlasDefaults)&&(yield p(l.httpGetAsync,e.atlases,!0)),e}));let m,g=!0;try{r=yield s.loadJson(o,!0)}catch(e){}if(!r){const t=yield f();return new u(t,e,s,i,c)}{const e=(null==i?void 0:i.metaData)||(yield l.httpGetAsync(d));e&&e.ts<r&&(g=!1),e||console.warn(`Did not find any meta.json file at ${d} Could not adhoc updates, requesting global data.`)}if(g)return m=yield f(),new u(m,e,s,i,c);if((m=yield null==s?void 0:s.loadJson(a))?i.preloadAtlasDefaults&&(yield p(s.loadImageData.bind(s),m.atlases,!1)):console.warn("Initialization expected local global data to be found but it was not, making http request."),!m)return m=yield f(),new u(m,e,s,i);if(null==i?void 0:i.adhocUpdateGetter)try{i.adhocUpdateGetter(r)}catch(e){console.error(e)}return new u(m,e,s,i,c)}))}_createSkeleton(e,t){const i=this.skeletonData[e];if(!i)throw new Error(`Invalid skeleton name: ${e}. Not found in the lookup.`);const n=new s.Skeleton(i,this.atlasLoader,null==t?void 0:t.activeSlotTextures,null==t?void 0:t.direction);return(null==t?void 0:t.action)&&n.play(t.action,null,t.playOptions),n}createSkeleton(e,t){return this._createSkeleton(e,t)}createSkeletonWithAsyncOptions(e,t){return n(this,void 0,void 0,(function*(){const i=this._createSkeleton(e,t),n=t.attachmentSlots?t.attachmentSlots.map(e=>i.mountAttachment(e.attachmentSlotName,e.attachmentName,e.action,e.playOptions)):[];if(t.skins){const e=[];for(let i=0;i<t.skins.length;i++)this.atlasLoader.loadedSkins[t.skins[i].skinName]&&e.push(t.skins[i]);yield i.setSkins(t.skins)}return{skeleton:i,tracks:n}}))}preloadSkins(e){return n(this,void 0,void 0,(function*(){const{valid:t}=l.validateSkinParams(e);return null}))}}t.Gottimation=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationTrack=t.defaultPlayOptions=void 0;const n=i(21),s=i(39);t.defaultPlayOptions={loop:!1,timeScale:1,resetTimeOnDirectionChange:!1,pausedPassiveTracks:!1};class r{constructor(e,t,i={},n,r,o,a,h=!1,l,d){this.displayedBoneOrders=[],this.managingChildImplicitTracks=[],this.elapsedTime=0,this.nextFinished=0,this.pausedPassiveTracks=!1,this.didResetFrameDataOnPause=!1,this._timeScale=0,this.isReverse=!1,this.activeAnimationStates=[],this.addedSlotBones=[],this.addedAttachmentBones=[],this.selfManagedImplicitTracks=[],this.outerManagedImplicitActions={},this.overridedBoneParents={},this.lastAppliedBoneOrder=[],this.currentImplicitAnimationIndex=-1,this.activeSlotTextures={},this.eventQueue={},this.addedColliders={},this.slotColliderLookup={},this.setupData={attachment:null,attachmentSlot:null},s.TrackMixin.ApplyMixin(this),a&&(this.setupData.attachmentSlot=a),this.id=l,this.passiveManager=d,this.passive=h,this.stopped=!1,this._timeScale=0,this.isReverse=!1,this.elapsedTime=-1,this.nextFinished=0,this.animationLookup=o,this.direction=e.direction,this.slotColliderLookup=r,this.skeleton=e,this.activeSlotTextures=i,this.level=t,this.bones=n,this.handleColliderAdjustment&&(this.colliderParentObjectParam={track:this,skeleton:e})}set timeScale(e){var t,i;this._timeScale=e;const n=this.isReverse;this.isReverse=e<0,this.isReverse!==n&&(this.isReverse?(this.nextFinished=this.currentFrameData.time,this.nextFinished===this.elapsedTime&&(this.currentFrame?(this.currentFrame--,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame]):(this.currentFrame=this.currentAnimation.frameData.length-1,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.elapsedTime=this.currentAnimation.endTime),this.nextFinished=this.currentFrameData.time)):this.currentFrame===this.currentAnimation.frameData.length-1?(this.nextFinished=this.currentAnimation.endTime,this.elapsedTime===this.nextFinished&&(this.elapsedTime=0,this.currentFrame=0,this.currentFrameData=this.currentAnimation.frameData[0],this.nextFinished=(null===(t=this.currentAnimation.frameData[1])||void 0===t?void 0:t.time)||this.currentAnimation.endTime)):(this.nextFinished=this.currentAnimation.frameData[this.currentFrame+1].time,this.elapsedTime===this.nextFinished&&(this.elapsedTime===this.currentAnimation.endTime?(this.elapsedTime=0,this.currentFrame=0,this.currentFrameData=this.currentAnimation.frameData[0],this.nextFinished=this.currentAnimation.frameData[1].time):(this.currentFrame++,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.nextFinished=(null===(i=this.currentAnimation.frameData[this.currentFrame+1])||void 0===i?void 0:i.time)||this.currentAnimation.endTime))))}get timeScale(){return this._timeScale}getCollider(e){return null}_mountToParent(e){if(this.parentTrack)throw new Error("Expected no parent.");for(this.parentTrack=e,e.childTracks?e.childTracks.push(this):e.childTracks=[this];e;)e.emitAttachmentEvents("_onAddededListeners",this.attachmentSlot,this.attachment,this),e=e.parentTrack}setAttachment(e){this.skeleton.mountAttachment(this.attachmentSlot,e)}applyLastBoneOrder(){this.applyBoneSort(this.lastAppliedBoneOrder,Array.from(this.skeleton.children))}applySetupData(e,t){const{bones:i,boneParentChanges:n,overriddenBones:s,frames:r,boneOrder:o}=e;this.toggleBoneSlotOverrides(s,t,!0);const a=(e,i)=>{var n;let s,r;const o=this.bones[e];if(t)(null===(n=o.parentBone)||void 0===n?void 0:n.id)!==i&&(s=o.parentBone,r=this.bones[i],s&&(this.overridedBoneParents[e]=o.parentBone.id));else{s=this.bones[i];const t=this.overridedBoneParents[e];t&&(r=this.bones[t]),delete this.overridedBoneParents[e]}null==s||s._removeChildBone(o),null==r||r._addChildBone(o)};if(i)for(let e=0;e<i.length;e++){const{parentBoneId:t,id:n}=i[e];t&&a(n,t)}if(n)for(let e=0;e<n.length;e+=2)a(n[e],n[e+1]);t&&o&&(this.lastAppliedBoneOrder=o,this.applyBoneSort(o,Array.from(this.skeleton.children))),this.colliderManager?t?(this.applyAddedColliders(e,!1),e.frames&&this.applyDirectionalSetupFrame(t,r[this.direction])):(r&&this.applyDirectionalSetupFrame(t,r[this.direction]),this.applyAddedColliders(e,!0)):r&&this.applyDirectionalSetupFrame(t,r[this.direction])}_updateAttachmentData(e,t,i){var s,r,o;const a=this.attachment;this.setupData.attachment=null==t?void 0:t.setupData,this.attachment=null==t?void 0:t.name,this.animationLookup=e,this.boneOrderWhenMounted=this.skeleton.children.map(e=>e.id);const h=(e,t)=>{if(e)for(let i=0;i<e.length;i++){const s=e[i];if(this.bones[s])continue;const r=new n.Bone(s,this.skeleton);this.bones[s]=r,this.skeleton.addChild(r),t.push(r)}};if(this.attachmentSlot!==i.name){this.attachmentSlot=i.name,h(null===(s=i.setupData)||void 0===s?void 0:s.addedBoneIds,this.addedSlotBones),h(null===(r=t.setupData)||void 0===r?void 0:r.addedBoneIds,this.addedAttachmentBones);let e=this.parentTrack;for(;e;)e.emitAttachmentEvents("_onAddededListeners",this.attachmentSlot,this.attachment,this),e=e.parentTrack;i.setupData?(this.setupData.attachmentSlot=i.setupData,this.applySetupData(i.setupData,!0)):delete this.setupData.attachmentSlot}else{if(h(null===(o=t.setupData)||void 0===o?void 0:o.addedBoneIds,this.addedAttachmentBones),this._onChangeAttachmentListeners)for(let e=0;e<this._onChangeAttachmentListeners.length;e++)this._onChangeAttachmentListeners[e](this,this.attachment,a);let e=this.parentTrack;for(;e;){if(e._onChangeAttachmentListeners)for(let t=0;t<e._onChangeAttachmentListeners.length;t++)e._onChangeAttachmentListeners[t](this,this.attachment,a);e=e.parentTrack}}this.setupData.attachment&&this.applySetupData(this.setupData.attachment,!0)}applySetupTextures(){if(this.setupData){const{attachmentSlot:e,attachment:t}=this.setupData;if(e){const{frames:t}=e;t&&t[this.direction]&&t[this.direction].bones.forEach(e=>{var t;e.slotId&&(null===(t=this.bones[e.id])||void 0===t?void 0:t.curTrackOverride)===this&&this.bones[e.id].changeSlot(e.slotId)})}if(t){const{frames:e}=t;e&&e[this.direction]&&e[this.direction].bones.forEach(e=>{var t;e.slotId&&(null===(t=this.bones[e.id])||void 0===t?void 0:t.curTrackOverride)===this&&this.bones[e.id].changeSlot(e.slotId)})}}}applyDirectionalSetupFrame(e,t){t&&(this.toggleBoneSlotOverrides(t.overriddenBones,e,!0),this.applyFrame(t,!e))}toggleBoneSlotOverrides(e,t,i){var n,s;if(e)if(t)for(let t=0;t<e.length;t++)null===(n=this.bones[e[t]])||void 0===n||n.addSlotOverrideLevel(this,i);else for(let t=0;t<e.length;t++)null===(s=this.bones[e[t]])||void 0===s||s.removeSlotOverrideLevel(this,i)}mountAttachment(e,t,i,n){const s=this.skeleton.data.attachmentSlotData[e].parentAttachmentName;if(s!==this.attachment)throw new Error(`Trying to mount an attachment slot: ${e} and attachment: ${t} on a track that was expected to have its current attachment be ${s}. But the tracks current attachment is ${this.attachment}`);return this.skeleton.mountAttachment(e,t,i,n)}unmountAttachment(e){var t;const i=null===(t=this.childTracks)||void 0===t?void 0:t.find(t=>t.attachmentSlot===e);if(!i)throw new Error(`Could not find attachment: ${e} in the current tracks for the attachment ${this.attachment}`);if(i.parentTrack!==this)throw new Error("Expected the parent track to be the current attachment trying to unmount it.");i.unmount()}clearPassiveTracks(){var e;for(let e=0;e<this.passiveTracks.length;e++){const t=this.passiveTracks[e];if(!t.stopped&&t.currentAnimation){t.reapplyPreviousFrameDeltas(!0);const e=t.currentAnimation.overriddenBones;if(e)for(let i=0;i<e.length;i++)this.bones[e[i]].removeSlotOverrideLevel(t,!1)}}const t=this.skeleton.activePassiveAttachmentTracks;if(t)for(let e=0;e<t.length;e++)if(t[e]===this){t.splice(e,1),t.length||delete this.skeleton.activePassiveAttachmentTracks;break}const i=null===(e=this.parentTrack)||void 0===e?void 0:e.activePassiveAttachmentTracks;if(i)for(let e=0;e<i.length;e++)if(i[e]===this){i.splice(e,1),i.length||delete this.parentTrack.activePassiveAttachmentTracks;break}delete this.passiveTracks}unmount(e=!1){var t,i,n,s;if(this.passive)throw new Error("Passive animation tracks should never have unmounted called.");this.reapplyPreviousFrameDeltas(!0),this.passiveTracks&&this.clearPassiveTracks(),this.setupData.attachment&&(this.applySetupData(this.setupData.attachment,!1),this.setupData.attachment=null);if(!this.parentTrack&&!this.passive)throw new Error("Expected parent track.");let r=this.parentTrack;if(this.childTracks){const e=[...this.childTracks];delete this.childTracks;for(let t=0;t<e.length;t++){e[t].unmount(!1)}}const o=e=>{for(let t=0;t<e.length;t++){const i=e[t];delete this.bones[i.id],this.skeleton.removeChild(i),i.destroy(!1)}e.length=0};if(e){if(delete this.skeleton.attachments[this.attachment],this.setupData.attachmentSlot){null===(t=this.setupData.attachmentSlot.overriddenBones)||void 0===t||t.forEach(e=>{this.skeleton.bones[e].determineNewTrackOverride()}),null===(n=null===(i=this.setupData.attachmentSlot.frames[this.direction])||void 0===i?void 0:i.overriddenBones)||void 0===n||n.forEach(e=>{this.skeleton.bones[e].determineNewTrackOverride()})}}else{this.setupData.attachmentSlot&&(this.applySetupData(this.setupData.attachmentSlot,!1),this.setupData.attachmentSlot=null),this.skeleton._removeAttachmentFromLookups(this.attachmentSlot,this.attachment),o(this.addedSlotBones);const e=this.parentTrack.childTracks;if(e)for(let t=0;t<e.length;t++)if(e[t]===this){e.splice(t,1),e.length||delete this.parentTrack.childTracks;break}if(delete this.parentTrack,this._onRemovedFromParentListeners)for(let e=0;e<this._onRemovedFromParentListeners.length;e++)this._onRemovedFromParentListeners[e](r);for(;r;)r.emitAttachmentEvents("_onRemovedListeners",this.attachmentSlot,this.attachment,this),r=r.parentTrack}if(o(this.addedAttachmentBones),this.toggleBoneSlotOverrides(null===(s=this.currentAnimation)||void 0===s?void 0:s.overriddenBones,!1,!1),this.currentAction="",this.currentAnimation=null,this._timeScale=0,this.isReverse=!1,this.elapsedTime=-1,this.nextFinished=0,this.childTracks)throw new Error("Expected child tracks to get deleted if we had them by the end of unmount.");this.boneOrderWhenMounted&&(this.applyBoneSort(this.boneOrderWhenMounted,Array.from(this.skeleton.children)),this.boneOrderWhenMounted=null)}computeCurrentSlotForBone(e,t){var i,n;const s=(null===(i=this.setupData.attachment)||void 0===i?void 0:i.frames)?this.setupData.attachment.frames[this.direction]:null,r=(null===(n=this.setupData.attachmentSlot)||void 0===n?void 0:n.frames)?this.setupData.attachmentSlot.frames[this.direction]:null,o=()=>{if(s&&s.bones)for(let t=0;t<s.bones.length;t++){const{id:i,slotId:n,hide:r}=s.bones[t];if(i==e){if(r)return-1;if(n)return n}}if(r&&r.bones)for(let t=0;t<r.bones.length;t++){const{id:i,slotId:n,hide:s}=r.bones[t];if(i==e){if(s)return-1;if(n)return n}}return null};if(t){const e=o();if(e)return e}if(!this.currentAnimation)return-1;let a=this.currentFrame;if(this.isReverse)for(;a<this.currentAnimation.frameData.length;){const t=this.currentAnimation.frameData[a];for(let i=0;i<t.bones.length;i++){const n=t.bones[i];if(n.id==e){if(n.slotId)return n.slotId;if(n.hide)return-1}}a++}else for(;a>=0;){const t=this.currentAnimation.frameData[a];for(let i=0;i<t.bones.length;i++){const n=t.bones[i];if(n.id==e){if(n.slotId)return n.slotId;if(n.hide)return-1}}a--}if(!t){const e=o();if(e)return e}return-1}applyCurrentFrameSlotTextures(){const e=this.currentFrameData.bones;if(e)for(let t=0;t<e.length;t++){const i=this.bones[e[t].id];i.curTrackOverride===this&&(e[t].slotId?i.changeSlot(e[t].slotId):e[t].hide&&i.changeSlot(-1))}}setTimeScale(e,t){}setElapsedTime(e){if(e>this.currentAnimation.endTime&&(e=this.currentAnimation.endTime),this.isReverse)throw new Error("Unimplmented");if(e<this.nextFinished&&(this.reapplyPreviousFrameDeltas(!0),this.resetCurrentAnimationState()),e>this.nextFinished){let t=e;for(;t>0;){let e=this.nextFinished-this.elapsedTime;(t-=e)<0&&(e=Math.max(0,e-Math.abs(t))),this.update(e)}}else this.update(e-this.elapsedTime)}reapplyPreviousFrameDeltas(e){if(!this.didResetFrameDataOnPause)if(this.isReverse)for(let t=0;t<=this.currentFrame;t++)this.applyFrame(this.currentAnimation.frameData[t],e);else if(e)for(let t=this.currentFrame;t>=0;t--)this.applyFrame(this.currentAnimation.frameData[t],e);else for(let t=0;t<=this.currentFrame;t++)this.applyFrame(this.currentAnimation.frameData[t],e)}changeDirection(e){if(!this.passive){const{attachment:t,attachmentSlot:i}=this.setupData;t&&t.frames?(this.applyDirectionalSetupFrame(!1,t.frames[this.direction]),i&&i.frames&&(this.applyDirectionalSetupFrame(!1,i.frames[this.direction]),this.applyDirectionalSetupFrame(!0,i.frames[e])),this.applyDirectionalSetupFrame(!0,t.frames[e])):i&&i.frames&&(this.applyDirectionalSetupFrame(!1,i&&i.frames[this.direction]),this.applyDirectionalSetupFrame(!0,i&&i.frames[e]))}if(this.direction=e,this.currentAction){const t=this.currentAnimation;if(t&&this.reapplyPreviousFrameDeltas(!0),this.currentAnimation=this.animationLookup[this.currentAction][e],this.currentAnimation){const e=this.currentAnimation.frameData.length;if(this.elapsedTime>=this.currentAnimation.endTime)this.currentFrame=0,this.elapsedTime=0;else for(let t=0;t<e;t++){const e=this.currentAnimation.frameData[t],i=this.currentAnimation.frameData[t+1];if(this.elapsedTime>=e.time&&(!i||i.time>this.elapsedTime)){this.currentFrame=t,this.currentFrameData=e;break}}this.updateAnimationBoneOverrides(t),t?this.nextFinished=this.currentFrame===e-1?this.currentAnimation.endTime:this.currentAnimation.frameData[this.currentFrame+1].time:(this.currentFrame=0,this.elapsedTime=0,this.nextFinished=this.currentAnimation.frameData[0].time),this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.reapplyPreviousFrameDeltas()}else this.updateAnimationBoneOverrides(t)}if(this.passiveTracks)for(let t=0;t<this.passiveTracks.length;t++)this.passiveTracks[t].changeDirection(e)}addPassiveTrack(e,t){if(this.animationLookup[e]){const i=new r(this.skeleton,this.level,this.activeSlotTextures,this.bones,this.slotColliderLookup,this.animationLookup,null,!0,null,this);return this.passiveTracks?this.passiveTracks.push(i):this.passiveTracks=[i],i.attachmentSlot=this.attachmentSlot,i.attachment=this.attachment,i.play(e,t),!this.pausedPassiveTracks||this.explicitPausedPassiveActions&&!this.explicitPausedPassiveActions.includes(e)||i.pause(!0),t.loop||i.onEnd(()=>{}),!0}return!1}removePassiveTrack(e){for(let t=0;t<this.passiveTracks.length;t++)if(this.passiveTracks[t].currentAction===e){if(!this.passiveTracks[t].didResetFrameDataOnPause){const e=this.passiveTracks[t].currentAnimation;e&&(this.passiveTracks[t].reapplyPreviousFrameDeltas(!0),this.passiveTracks[t].currentAnimation=null,this.passiveTracks[t].updateAnimationBoneOverrides(e))}return this.passiveTracks.splice(t,1),this.passiveTracks.length||delete this.passiveTracks,!0}return!1}resetCurrentAnimationState(){var e;this.isReverse?(this.currentFrame=this.currentAnimation.frameData.length-1,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.elapsedTime=this.currentAnimation.endTime,this.nextFinished=this.currentAnimation.frameData[this.currentFrame].time||0,this.reapplyPreviousFrameDeltas()):(this.currentFrame=0,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.elapsedTime=0,this.nextFinished=(null===(e=this.currentAnimation.frameData[1])||void 0===e?void 0:e.time)||this.currentAnimation.endTime,!this.didResetFrameDataOnPause&&this.applyFrame(this.currentFrameData))}play(e,i){if(this.stopped=!1,i=i||t.defaultPlayOptions,!(e in this.animationLookup||this.passive))throw new Error(`Invalid action: ${e} being played on animation track. The only valid animations for this track are ${Object.keys(this.animationLookup).join(", ")}`);const n=this.currentAnimation;if(n&&this.reapplyPreviousFrameDeltas(!0),this.currentAnimation=this.animationLookup[e][this.direction],!this.currentAnimation&&!this.passive)throw new Error(`Missing direction: ${this.direction} for animation ${e} on animation track: ${this.attachment} : ${this.attachmentSlot}`);if(!this.passive)if(i.stopPassiveActions){if(!0===i.stopPassiveActions){if(delete this.explicitPausedPassiveActions,this.passiveTracks)for(let e=0;e<this.passiveTracks.length;e++)this.passiveTracks[e].pause(!0)}else if(this.explicitPausedPassiveActions=[...i.stopPassiveActions],this.passiveTracks){for(let e=0;e<this.passiveTracks.length;e++)this.passiveTracks[e].resume();for(let e=0;e<this.explicitPausedPassiveActions.length;e++)for(let t=0;t<this.passiveTracks.length;t++)if(this.passiveTracks[t].currentAction===i.stopPassiveActions[e]){this.passiveTracks[t].pause(!0);break}}}else if(this.pausedPassiveTracks&&(delete this.explicitPausedPassiveActions,this.passiveTracks))for(let e=0;e<this.passiveTracks.length;e++)this.passiveTracks[e].resume();this.pausedPassiveTracks=!!i.stopPassiveActions,this.usingImplicit=!1,this.loop=i.loop,this.resetTimeOnDirectionChange=i.resetTimeOnDirectionChange,this._timeScale=(null==i?void 0:i.timeScale)||this._timeScale||1,this.isReverse=this._timeScale<0;const s=this.currentAction;this.currentAction=e,this.currentAnimation&&this.resetCurrentAnimationState(),this.updateAnimationBoneOverrides(n),this.emitAnimationEvents("_onStartListeners",e,this),this.skeleton.emitAnimationEvents("_onStartListeners",e,this),this.removeChildPassiveTracks(s),this.childTracks&&this.addNeededChildPassiveTracks(e,this.childTracks,i),this.skeleton.reapplyBoneSortSetups(this.direction),i.startTime&&this.setElapsedTime(i.startTime)}updateAnimationBoneOverrides(e){var t;if(!this.didResetFrameDataOnPause)if(null===(t=this.currentAnimation)||void 0===t?void 0:t.overriddenBones)if(null==e?void 0:e.overriddenBones){if(e.overriddenBones!==this.currentAnimation.overriddenBones){for(let t=0;t<e.overriddenBones.length;t++)this.bones[e.overriddenBones[t]].removeSlotOverrideLevel(this,!1);for(let e=0;e<this.currentAnimation.overriddenBones.length;e++)this.bones[this.currentAnimation.overriddenBones[e]].addSlotOverrideLevel(this,!1)}}else for(let e=0;e<this.currentAnimation.overriddenBones.length;e++)this.bones[this.currentAnimation.overriddenBones[e]].addSlotOverrideLevel(this,!1);else if(null==e?void 0:e.overriddenBones)for(let t=0;t<e.overriddenBones.length;t++)this.bones[e.overriddenBones[t]].removeSlotOverrideLevel(this,!1)}_playNextImplicit(){this.usingImplicit=!0;for(let e=this.level;e>=0;--e)if(this.animationLookup[void 0]){this.resetTimeOnDirectionChange=(void 0).resetTimeOnDirectionChange,this.loop=(void 0).loop,this.currentImplicitAnimationIndex=e;break}throw new Error("No implicit")}pause(e=!1){var t;if(this.stopped=!0,e&&!this.didResetFrameDataOnPause&&(this.reapplyPreviousFrameDeltas(!0),null===(t=this.currentAnimation)||void 0===t?void 0:t.overriddenBones))for(let e=0;e<this.currentAnimation.overriddenBones.length;e++)this.bones[this.currentAnimation.overriddenBones[e]].removeSlotOverrideLevel(this,!1);this.didResetFrameDataOnPause=this.didResetFrameDataOnPause||e}resume(){var e;if(this.stopped=!1,this.didResetFrameDataOnPause&&(this.didResetFrameDataOnPause=!1,this.reapplyPreviousFrameDeltas(!1),null===(e=this.currentAnimation)||void 0===e?void 0:e.overriddenBones))for(let e=0;e<this.currentAnimation.overriddenBones.length;e++)this.bones[this.currentAnimation.overriddenBones[e]].addSlotOverrideLevel(this,!1);this.didResetFrameDataOnPause=!1}stop(){this.stopped=!0,this.currentAnimation&&(this.reapplyPreviousFrameDeltas(!0),this.resetCurrentAnimationState())}start(){this.stopped=!1}applyBones(){const e=this.currentFrameData.bones;for(let t=0;t<e.length;t++){e[t].id}}applyAddedColliders(e,t){if(e.addedColliders)if(t)for(let t=0;t<e.addedColliders.length;t++){const{boneId:i,id:n}=e.addedColliders[t];this.colliderManager.onRemoved(this.colliderParentObjectParam,n),delete this.skeleton.nonSlotColliderLookup[n],i&&this.skeleton.bones[i].removeColliderId(n)}else for(let t=0;t<e.addedColliders.length;t++){const i=e.addedColliders[t];this.colliderManager.onAdded(this.colliderParentObjectParam,i),this.skeleton.nonSlotColliderLookup[i.id]=i.shapeData,i.boneId&&this.skeleton.bones[i.boneId].addColliderId(i.id)}}applyFrame(e,t){var i;if(e.adjustedColliders)for(let i=0;i<e.adjustedColliders.length;i++){const n=e.adjustedColliders[i];this.skeleton.nonSlotColliderLookup[n.id]=n.shapeData,this.colliderManager.onAdjusted(this.colliderParentObjectParam,n,t)}if(e.bones)for(let n=0;n<e.bones.length;n++){const s=e.bones[n],r=this.bones[s.id];if(r){if(null===(i=this.skeleton.children[n])||void 0===i||i.id,s.id,r.curTrackOverride===this)if(s.slotId){r.changeSlot(s.slotId);const e=this.slotColliderLookup[s.slotId];if(e)for(let t=0;t<e.length;t++);}else s.hide&&(this.bones[s.id].visible=!1);r.applyTrackTransform(s,t)}}e.boneOrder&&this.applyBoneSort(e.boneOrder,Array.from(this.skeleton.children)),this.lastAppliedBoneOrder=Array.from(this.skeleton.children).map(e=>e.id)}applyBoneSort(e,t){t.map(e=>e.id);if(1===(e=e.filter(e=>this.skeleton.bones[e])).length){const i=t.find(t=>t.id==e[0]);return this.skeleton.removeChild(i),void this.skeleton.addChildAt(i,0)}const i=e.map(i=>{const n=t.find(e=>e.id==i);if(!n)throw console.error(i,n,e,i),new Error("wtf");return n}),n=i.length;t.forEach((e,t)=>{if(!i.includes(e)){const s=t<=n?t:t-1;i.splice(s,0,e)}}),this.assertBoneArraysContainSameBones(this.skeleton.children,i),this.skeleton.removeChildren(),i.forEach(e=>this.skeleton.addChild(e))}assertBoneArraysContainSameBones(e,t){if(!e.every(e=>t.includes(e)))throw new Error("not same.")}handleLoopedAnimationFinished(e){var t;if(this.isReverse){let t=this.currentAnimation.frameData.length-1;for(let e=1;e<=t;e++)this.applyFrame(this.currentAnimation.frameData[e],!1);this.currentFrame=t,this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.elapsedTime=this.currentAnimation.endTime+e,this.nextFinished=this.currentFrameData.time,this.elapsedTime<=this.nextFinished&&(this.elapsedTime=this.currentAnimation.endTime)}else{this.currentFrame--;for(let e=this.currentFrame;e>=1;e--)this.applyFrame(this.currentAnimation.frameData[e],!0);this.applySetupTextures(),this.currentFrame=0,this.currentFrameData=this.currentAnimation.frameData[0],this.elapsedTime=this.currentFrameData.time+e,this.nextFinished=(null===(t=this.currentAnimation.frameData[1])||void 0===t?void 0:t.time)||this.currentAnimation.endTime,this.elapsedTime>=this.nextFinished&&(this.elapsedTime=this.currentFrameData.time)}this.applyCurrentFrameSlotTextures()}playDefault(){}handleUnloopedExplicitAnimationFinished(e){}handleUnloopedImplicitAnimationFinished(e){--this.currentImplicitAnimationIndex>-1&&this._playNextImplicit()}handleAnimationFinish(e=0){if(this.loop){const t=this.currentAction;this.handleLoopedAnimationFinished(e),this.emitAnimationEvents("_onEndListeners",t,this),this.skeleton.emitAnimationEvents("_onEndListeners",t,this),this.emitAnimationEvents("_onStartListeners",t,this),this.skeleton.emitAnimationEvents("_onStartListeners",t,this)}else{if(this.isReverse)this.reapplyPreviousFrameDeltas(!0);else for(let e=0;e<this.currentAnimation.frameData.length;e++)this.applyFrame(this.currentAnimation.frameData[e],!0);this.currentFrame=-1;const e=this.currentAnimation;if(this.currentAnimation=null,this.updateAnimationBoneOverrides(e),this.pausedPassiveTracks&&this.passiveTracks)for(let e=0;e<this.passiveTracks.length;e++)this.passiveTracks[e].resume();this.pausedPassiveTracks=!1,delete this.explicitPausedPassiveActions,this.stopped=!0,this.elapsedTime=0,this.nextFinished=0;const t=this.currentAction;this.currentAction="",this.skeleton.baseTrack.applyLastBoneOrder(),this.skeleton.reapplyBoneSortSetups(this.direction),this.emitAnimationEvents("_onEndListeners",t,this),this.skeleton.emitAnimationEvents("_onEndListeners",t,this)}}resumePassiveTracks(){for(let e=0;e<this.passiveTracks.length;e++)this.passiveTracks[e].resume();this.pausedPassiveTracks=!1}update(e){if(this.passiveTracks)for(let t=0;t<this.passiveTracks.length;t++)this.passiveTracks[t].update(e);if(!this.stopped&&this.currentAnimation){if(this.elapsedTime+=e*this._timeScale,this.selfManagedImplicitTracks)for(let t=0;t<this.selfManagedImplicitTracks.length;t++)this.selfManagedImplicitTracks[t].update(e);if(this.isReverse){if(this.elapsedTime<=this.nextFinished){const e=this.elapsedTime-this.nextFinished;this.currentFrame--,this.currentFrame<0?this.handleAnimationFinish(e):(this.applyFrame(this.currentFrameData,!0),this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.applyCurrentFrameSlotTextures(),this.nextFinished=this.currentFrameData.time,this.elapsedTime<=this.nextFinished&&(this.elapsedTime=this.nextFinished+1))}}else if(this.elapsedTime>=this.nextFinished){const e=this.elapsedTime-this.nextFinished;this.currentFrame++,this.currentFrame>=this.currentAnimation.frameData.length?this.handleAnimationFinish(e):(this.currentFrameData=this.currentAnimation.frameData[this.currentFrame],this.nextFinished=this.currentFrame===this.currentAnimation.frameData.length-1?this.currentAnimation.endTime:this.currentAnimation.frameData[this.currentFrame+1].time,this.elapsedTime>this.nextFinished&&(this.elapsedTime=this.nextFinished-1),this.applyFrame(this.currentFrameData))}}}}t.AnimationTrack=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrackMixin=void 0;class n{static ApplyMixin(e){e.onChangedAttachment=n.prototype.onChangedAttachment.bind(e),e.offChangedAttachment=n.prototype.offChangedAttachment.bind(e),e.offEventListener=n.prototype.offEventListener.bind(e),e.removeAllAnimationListeners=n.prototype.removeAllAnimationListeners.bind(e),e.emitAttachmentEvents=n.prototype.emitAttachmentEvents.bind(e),e.emitAnimationEvents=n.prototype.emitAnimationEvents.bind(e),e.emitFrameEvents=n.prototype.emitFrameEvents.bind(e),e.onEnd=n.prototype.onEnd.bind(e),e.onStart=n.prototype.onStart.bind(e),e.offEnd=n.prototype.offEnd.bind(e),e.offStart=n.prototype.offStart.bind(e),e.onRemovedFromParent=n.prototype.onRemovedFromParent.bind(e),e.onRemovedAttachment=n.prototype.onRemovedAttachment.bind(e),e.onAddedAttachment=n.prototype.onAddedAttachment.bind(e),e.offRemovedAttachment=n.prototype.offRemovedAttachment.bind(e),e.offAddedAttachment=n.prototype.offAddedAttachment.bind(e),e.removeChildPassiveTracks=n.prototype.removeChildPassiveTracks.bind(e),e.addNeededChildPassiveTracks=n.prototype.addNeededChildPassiveTracks.bind(e)}removeChildPassiveTracks(e){if(this.activePassiveAttachmentTracks){for(let t=0;t<this.activePassiveAttachmentTracks.length;t++)if(!this.activePassiveAttachmentTracks[t].removePassiveTrack(e))throw new Error("expected true");delete this.activePassiveAttachmentTracks}}addNeededChildPassiveTracks(e,t,i){if(t)for(let n=0;n<t.length;n++)t[n].addPassiveTrack(e,i)&&(this.activePassiveAttachmentTracks?this.activePassiveAttachmentTracks.push(t[n]):this.activePassiveAttachmentTracks=[t[n]])}removeAllAnimationListeners(){this._onFrameEventListeners&&Object.keys(this._onFrameEventListeners).forEach(e=>{this._onFrameEventListeners[e].length=0,delete this._onFrameEventListeners[e]}),delete this._onFrameEventListeners,this._onEndListeners&&(this._onEndListeners.length=0),delete this._onEndListeners,this._onStartListeners&&(this._onStartListeners.length=0),delete this._onStartListeners,this._onAddededListeners&&(this._onAddededListeners.length=0),delete this._onAddededListeners,this._onRemovedListeners&&(this._onRemovedListeners.length=0),delete this._onAddededListeners,this._onEndListeners&&(this._onEndListeners.length=0),delete this._onEndListeners}onFrameEvent(e,t){this._onFrameEventListeners?this._onFrameEventListeners[e]?this._onFrameEventListeners[e].push(t):this._onFrameEventListeners[e]=[t]:this._onFrameEventListeners={[e]:[t]}}offFrameEvent(e,t){if(this._onFrameEventListeners){const i=this._onFrameEventListeners[e];i&&!this.offEventListener(i,t)&&(delete this._onFrameEventListeners[e],Object.keys(this._onFrameEventListeners).length||delete this._onFrameEventListeners)}}emitFrameEvents(e,t,i,n){if(this._onFrameEventListeners){const s=this._onFrameEventListeners[e];if(s)for(let e=0;e<s.length;e++)s[e](t,n,i)}}emitAttachmentEvents(e,t,i,n){if(this[e])for(let s=0;s<this[e].length;s++)this[e][s](t,i,n)}emitAnimationEvents(e,t,i){if(this[e])for(let n=0;n<this[e].length;n++)this[e][n](t,i)}onChangedAttachment(e){this._onChangeAttachmentListeners?this._onChangeAttachmentListeners.push(e):this._onChangeAttachmentListeners=[e]}offChangedAttachment(e){this.offEventListener(this._onChangeAttachmentListeners,e)||delete this._onChangeAttachmentListeners}onEnd(e){this._onEndListeners?this._onEndListeners.push(e):this._onEndListeners=[e]}offEnd(e){this.offEventListener(this._onEndListeners,e)||delete this._onEndListeners}onStart(e){this._onStartListeners?this._onStartListeners.push(e):this._onStartListeners=[e]}offStart(e){this.offEventListener(this._onStartListeners,e)||delete this._onStartListeners}onRemovedFromParent(e){this._onRemovedFromParentListeners?this._onRemovedFromParentListeners.push(e):this._onRemovedFromParentListeners=[e]}onRemovedAttachment(e){this._onRemovedListeners?this._onRemovedListeners.push(e):this._onRemovedListeners=[e]}offRemovedAttachment(e){this.offEventListener(this._onRemovedListeners,e)||delete this._onRemovedListeners}onAddedAttachment(e){this._onAddededListeners?this._onAddededListeners.push(e):this._onAddededListeners=[e]}offAddedAttachment(e){this.offEventListener(this._onAddededListeners,e)||delete this._onAddededListeners}offEventListener(e,t){for(let i=0;i<e.length;i++)if(e[i]===t)return e.splice(i,1),e.length;return-1}}t.TrackMixin=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseGameObjectAtlas=void 0;const n=i(85);t.BaseGameObjectAtlas=class{constructor(e,t){this.nextOpenPositions=[],this.atlases=[],this.cachedTextureData={},this.maxTextureSize=e>=4096?e-e%4096:e>=2048?e-e%2048:e>=1024?e-e%1024:e>=512?e-e%512:256,this.renderer=t,this.packer=new n.MaxRectsPacker(this.maxTextureSize,this.maxTextureSize,0,{smart:!0,pot:!0,allowRotation:!1,tag:!0})}addTexture(e,t,i,n=!1){const s={id:e,width:t.width,height:t.height};i&&(s.tag=i);const r=this.packer.add(s);let o=-1;for(let t=0;t<this.packer.bins.length;t++){for(let i=0;i<this.packer.bins[t].rects.length;i++)if(this.packer.bins[t].rects[i].id===e){o=t;break}if(o>-1)break}if(o<0)throw new Error(`No atlas index found for image after adding texture ${e}`);this.atlases[o]||this.atlases.push(PIXI.RenderTexture.create(this.maxTextureSize,this.maxTextureSize));const a=this.atlases[o];if(!a)throw new Error("Should have texture atlas at this point");const h=new PIXI.Sprite(t);return h.setTransform(r.x,r.y),this.renderer.render(h,a,!1),this.cachedTextureData[e]=[r.x,r.y,r.width,r.height,o],{texture:a.baseTexture,rect:r}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemDropComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e,t){super(s.SYSTEMS.ITEM_DROP),this.itemName=e,this.itemData=t}}t.ItemDropComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDirectionFromNorth0Degrees=t.isValidDirection=t.normalizeAxes=void 0;const n=180/Math.PI,s=Math.PI/180;t.normalizeAxes=function(e,t){if(Math.abs(e)<=.05&&Math.abs(t)<=.05)return{angles:null,power:0};const i=Math.atan2(t,e),r=i*n;let o=90-r;return o<0&&(o+=360),{angles:{default:{radians:i,degrees:r},north0:{degrees:o,radians:o*s}},power:Math.max(Math.abs(e)+Math.abs(t))}},t.isValidDirection=function(e){return["north","northeast","east","southeast","south","southwest","west","northwest"].includes(e)},t.getDirectionFromNorth0Degrees=function(e){const t=Math.round(e/45);return t>7?"north":["north","northeast","east","southeast","south","southwest","west","northwest"][t]}},function(e,t,i){"use strict";var n=i(7);function s(e,t,i,s,r){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":r||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var h="msid:"+(s?s.id:"-")+" "+a+"\r\n";o+="a="+h,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+h,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+h,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o}function r(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},s=function(e,t,i,s){var r=n(e.parameters.apt,i),o=n(t.parameters.apt,s);return r&&o&&r.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(n){for(var r=0;r<t.codecs.length;r++){var o=t.codecs[r];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!s(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),i.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var s=t.headerExtensions[n];if(e.uri===s.uri){i.headerExtensions.push(s);break}}})),i}function o(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function a(e,t){var i=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return i||e.addRemoteCandidate(t),!i}function h(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}e.exports=function(e,t){function i(t,i){i.addTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,i,n,s){var r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=s,e.setTimeout((function(){t._dispatchEvent("track",r)}))}var d=function(i){var s=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){s[e]=r[e].bind(r)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw h("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s="string"==typeof n;return s&&(n=[n]),n=n.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!i?(i=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=s?n[0]:n,!!n.length}}))}(i.iceServers||[],t),this._iceGatherers=[],i.iceCandidatePoolSize)for(var o=i.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this._config=i,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var i=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var s=this._createIceAndDtlsTransports();n.iceTransport=s.iceTransport,n.dtlsTransport=s.dtlsTransport}return t||this.transceivers.push(n),n},d.prototype.addTrack=function(t,i){if(this._isClosed)throw h("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw h("InvalidAccessError","Track already exists.");for(var s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==t.kind||(n=this.transceivers[s]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),n.track=t,n.stream=i,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},d.prototype.addStream=function(e){var i=this;if(t>=15025)e.getTracks().forEach((function(t){i.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var i=n.getTracks()[t];e.addEventListener("enabled",(function(e){i.enabled=e.enabled}))})),n.getTracks().forEach((function(e){i.addTrack(e,n)}))}},d.prototype.removeTrack=function(t){if(this._isClosed)throw h("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find((function(e){return e.rtpSender===t}));if(!i)throw h("InvalidAccessError","Sender was not created by this connection.");var n=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var i=t.getSenders().find((function(t){return t.track===e}));i&&t.removeTrack(i)}))},d.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},d.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},d.prototype._createIceGatherer=function(t,i){var n=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var i=!e.candidate||0===Object.keys(e.candidate).length;s.state=i?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},s.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),s},d.prototype._gather=function(t,i){var s=this,r=this.transceivers[i].iceGatherer;if(!r.onlocalcandidate){var o=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),r.onlocalcandidate=function(e){if(!(s.usingBundle&&i>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:i};var a=e.candidate,h=!a||0===Object.keys(a).length;if(h)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),a.component=1,a.ufrag=r.getLocalParameters().usernameFragment;var l=n.writeCandidate(a);o.candidate=Object.assign(o.candidate,n.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=n.getMediaSections(s._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=h?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",s._localDescription.sdp=n.getDescription(s._localDescription.sdp)+d.join("");var c=s.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),h||s._dispatchEvent("icecandidate",o),c&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){r.onlocalcandidate(e)}))}),0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,i=new e.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(i);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:n}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,i,s){var o=r(e.localCapabilities,e.remoteCapabilities);i&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),s&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},d.prototype.setLocalDescription=function(e){var t,i,s=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(h("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,s.signalingState)||s._isClosed)return Promise.reject(h("InvalidStateError","Can not set local "+e.type+" in state "+s.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),i=t.shift(),t.forEach((function(e,t){var i=n.parseRtpParameters(e);s.transceivers[t].localCapabilities=i})),s.transceivers.forEach((function(e,t){s._gather(e.mid,t)}));else if("answer"===e.type){t=n.splitSections(s._remoteDescription.sdp),i=t.shift();var a=n.matchPrefix(i,"a=ice-lite").length>0;t.forEach((function(e,t){var o=s.transceivers[t],h=o.iceGatherer,l=o.iceTransport,d=o.dtlsTransport,c=o.localCapabilities,u=o.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var p=n.getIceParameters(e,i),f=n.getDtlsParameters(e,i);a&&(f.role="server"),s.usingBundle&&0!==t||(s._gather(o.mid,t),"new"===l.state&&l.start(h,p,a?"controlling":"controlled"),"new"===d.state&&d.start(f));var m=r(c,u);s._transceive(o,m.codecs.length>0,!1)}}))}return s._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?s._updateSignalingState("have-local-offer"):s._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(s){var d=this;if(-1===["offer","answer"].indexOf(s.type))return Promise.reject(h("TypeError",'Unsupported type "'+s.type+'"'));if(!o("setRemoteDescription",s.type,d.signalingState)||d._isClosed)return Promise.reject(h("InvalidStateError","Can not set remote "+s.type+" in state "+d.signalingState));var c={};d.remoteStreams.forEach((function(e){c[e.id]=e}));var u=[],p=n.splitSections(s.sdp),f=p.shift(),m=n.matchPrefix(f,"a=ice-lite").length>0,g=n.matchPrefix(f,"a=group:BUNDLE ").length>0;d.usingBundle=g;var y=n.matchPrefix(f,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(o,h){var l=n.splitLines(o),p=n.getKind(o),y=n.isRejected(o)&&0===n.matchPrefix(o,"a=bundle-only").length,v=l[0].substr(2).split(" ")[2],C=n.getDirection(o,f),S=n.parseMsid(o),w=n.getMid(o)||n.generateIdentifier();if(y||"application"===p&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))d.transceivers[h]={mid:w,kind:p,protocol:v,rejected:!0};else{var b,T,_,x,E,A,k,P,I;!y&&d.transceivers[h]&&d.transceivers[h].rejected&&(d.transceivers[h]=d._createTransceiver(p,!0));var M,R,O=n.parseRtpParameters(o);y||(M=n.getIceParameters(o,f),(R=n.getDtlsParameters(o,f)).role="client"),k=n.parseRtpEncodingParameters(o);var L=n.parseRtcpParameters(o),D=n.matchPrefix(o,"a=end-of-candidates",f).length>0,N=n.matchPrefix(o,"a=candidate:").map((function(e){return n.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===s.type||"answer"===s.type)&&!y&&g&&h>0&&d.transceivers[h]&&(d._disposeIceAndDtlsTransports(h),d.transceivers[h].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[h].iceTransport=d.transceivers[0].iceTransport,d.transceivers[h].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[h].rtpSender&&d.transceivers[h].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[h].rtpReceiver&&d.transceivers[h].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==s.type||y){if("answer"===s.type&&!y){T=(b=d.transceivers[h]).iceGatherer,_=b.iceTransport,x=b.dtlsTransport,E=b.rtpReceiver,A=b.sendEncodingParameters,P=b.localCapabilities,d.transceivers[h].recvEncodingParameters=k,d.transceivers[h].remoteCapabilities=O,d.transceivers[h].rtcpParameters=L,N.length&&"new"===_.state&&(!m&&!D||g&&0!==h?N.forEach((function(e){a(b.iceTransport,e)})):_.setRemoteCandidates(N)),g&&0!==h||("new"===_.state&&_.start(T,M,"controlling"),"new"===x.state&&x.start(R)),!r(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,d._transceive(b,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!E||"sendrecv"!==C&&"sendonly"!==C?delete b.rtpReceiver:(I=E.track,S?(c[S.stream]||(c[S.stream]=new e.MediaStream),i(I,c[S.stream]),u.push([I,E,c[S.stream]])):(c.default||(c.default=new e.MediaStream),i(I,c.default),u.push([I,E,c.default])))}}else{(b=d.transceivers[h]||d._createTransceiver(p)).mid=w,b.iceGatherer||(b.iceGatherer=d._createIceGatherer(h,g)),N.length&&"new"===b.iceTransport.state&&(!D||g&&0!==h?N.forEach((function(e){a(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(N)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter((function(e){return"rtx"!==e.name}))),A=b.sendEncodingParameters||[{ssrc:1001*(2*h+2)}];var B,j=!1;if("sendrecv"===C||"sendonly"===C){if(j=!b.rtpReceiver,E=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,p),j)I=E.track,S&&"-"===S.stream||(S?(c[S.stream]||(c[S.stream]=new e.MediaStream,Object.defineProperty(c[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(I,"id",{get:function(){return S.track}}),B=c[S.stream]):(c.default||(c.default=new e.MediaStream),B=c.default)),B&&(i(I,B),b.associatedRemoteMediaStreams.push(B)),u.push([I,E,B])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var i=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));i&&function(t,i){i.removeTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(i,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=P,b.remoteCapabilities=O,b.rtpReceiver=E,b.rtcpParameters=L,b.sendEncodingParameters=A,b.recvEncodingParameters=k,d._transceive(d.transceivers[h],!1,j)}}})),void 0===d._dtlsRole&&(d._dtlsRole="offer"===s.type?"active":"passive"),d._remoteDescription={type:s.type,sdp:s.sdp},"offer"===s.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(c).forEach((function(t){var i=c[t];if(i.getTracks().length){if(-1===d.remoteStreams.indexOf(i)){d.remoteStreams.push(i);var n=new Event("addstream");n.stream=i,e.setTimeout((function(){d._dispatchEvent("addstream",n)}))}u.forEach((function(e){var t=e[0],n=e[1];i.id===e[2].id&&l(d,t,n,[i])}))}})),u.forEach((function(e){e[2]||l(d,e[0],e[1],[])})),e.setTimeout((function(){d&&d.transceivers&&d.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},d.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(h("InvalidStateError","Can not call createOffer after close"));var r=i.transceivers.filter((function(e){return"audio"===e.kind})).length,o=i.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(i.transceivers.forEach((function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));r>0||o>0;)r>0&&(i._createTransceiver("audio"),r--),o>0&&(i._createTransceiver("video"),o--);var l=n.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach((function(s,r){var o=s.track,a=s.kind,h=s.mid||n.generateIdentifier();s.mid=h,s.iceGatherer||(s.iceGatherer=i._createIceGatherer(r,i.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),s.remoteCapabilities&&s.remoteCapabilities.codecs&&s.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(s.remoteCapabilities&&s.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=s.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),s.wantReceive&&(s.rtpReceiver=new e.RTCRtpReceiver(s.dtlsTransport,a)),s.localCapabilities=l,s.sendEncodingParameters=d})),"max-compat"!==i._config.bundlePolicy&&(l+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",i.transceivers.forEach((function(e,t){l+=s(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+n.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var d=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(d)},d.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(h("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(h("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var o=n.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(o+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=n.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach((function(e,n){if(!(n+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var h;if(e.stream)"audio"===e.kind?h=e.stream.getAudioTracks()[0]:"video"===e.kind&&(h=e.stream.getVideoTracks()[0]),h&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=r(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=s(e,l,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},d.prototype.addIceCandidate=function(e){var t,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(s,r){if(!i._remoteDescription)return r(h("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<i.transceivers.length;l++)if(i.transceivers[l].mid===e.sdpMid){o=l;break}var d=i.transceivers[o];if(!d)return r(h("OperationError","Can not add ICE candidate"));if(d.rejected)return s();var c=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return s();if(c.component&&1!==c.component)return s();if((0===o||o>0&&d.iceTransport!==i.transceivers[0].iceTransport)&&!a(d.iceTransport,c))return r(h("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=n.getMediaSections(i._remoteDescription.sdp))[o]+="a="+(c.type?u:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=n.getDescription(i._remoteDescription.sdp)+t.join("")}else for(var p=0;p<i.transceivers.length&&(i.transceivers[p].rejected||(i.transceivers[p].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(i._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=n.getDescription(i._remoteDescription.sdp)+t.join(""),!i.usingBundle));p++);s()}))},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var i=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)})),!i)throw h("InvalidAccessError","Invalid selector.");return i.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var i=e[t];if(i&&i.prototype&&i.prototype.getStats){var n=i.prototype.getStats;i.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(i){var n;e[i].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[i]).type]||n.type,t.set(i,e[i])})),t}))}}}));var c=["createOffer","createAnswer"];return c.forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(c=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),d}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);let s=i(78);s=s.default&&s.__esModule?s.default:s;const r=[];r.push({areas:s.areas.map(e=>({type:e.type,systems:[...e.systems],plugins:e.plugins?[...e.plugins]:null})),fps:s.fps?s.fps:60,globals:s.globals?s.globals:null,isNetworked:!("isNetworked"in s)||s.isNetworked,plugins:s.plugins?s.plugins:null,systems:s.systems,type:s.type});const o=new n.Client(r,null,!1,"http");console.log("created gotti client",o);const a=i(153),h=i(164);a.default.config.productionTip=!1,new a.default({render:e=>e(h.default)}).$mount("#app")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new i((function(t){t(e.value)})).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(29);class r extends s.default{constructor(e){super(e),this.isNetworked=!1,this.onRemoteMessage=this.onServerMessage.bind(this)}initialize(e,t,i,n,s,r,o){this.isNetworked=n,s&&"object"==typeof s&&(this.globals=s),this.gottiId=r,this.clientId=o,this._peers=e.connector.connectedPeerIndexes,this._peerMap=e.connector.peerConnections,this.client=e,this.messageQueue=t,this.dispatchProcessMessage=e.raiseMessage.bind(e),this.initializeEntity=i.initializeEntity.bind(i),this.destroyEntity=i.destroyEntity.bind(i),this.dispatchToServer=e.sendSystemMessage.bind(e),this.immediateDispatchToServer=e.sendImmediateSystemMessage.bind(e),this.initialized=!0,this.dispatchToPeer=e.connector.sendPeerMessage.bind(e.connector),this.dispatchToAllPeers=e.connector.sendAllPeersMessage.bind(e.connector),this.dispatchToPeers=e.connector.sendPeersMessage.bind(e.connector),this._requestPeer=e.connector.requestPeerConnection.bind(e.connector),this.removePeer=e.connector.stopPeerConnection.bind(e.connector),this._onInit()}addListenStatePaths(e){Array.isArray(e)?e.forEach(e=>{this.client.addSystemPathListener(this,e)}):this.client.addSystemPathListener(this,e)}onStateUpdate(e,t,i,n){}requestPeer(e,t,i,s){return n(this,void 0,void 0,(function*(){if(!this.onPeerConnectionRequest)throw new Error(`Cannot add a peer from the system ${this.name} it does not implement onPeerConnectionRequest`);return new Promise((n,r)=>{this._requestPeer(e,this.name,t,(e,t)=>e?r(e):n(t=t||!0),i,s)})}))}get peers(){return this._peers}isPeer(e){return this._peers.indexOf(e)>-1}getPeerPing(e){const t=this._peerMap[e];return t&&t.connected?t.ping:null}_requestPeer(e,t,i,n,s,r){}dispatchToPeer(e,t){}dispatchToPeers(e,t){}dispatchToAllPeers(e){}removePeer(e){}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EntityManager=class{constructor(e){this.systemMap=e}initializeEntity(e,t){const i=e.addComponent;e.addComponent=t=>{i.call(e,t);const n=this.systemMap[t.name];n&&(t.$=n.$,n.onEntityAddedComponent(e,t))};const n=e.removeComponent;return e.removeComponent=t=>{const i=this.systemMap[t];i&&i.onEntityRemovedComponent(e,e.getComponent(t)),n.call(e,t)},e.initialize(t),e}destroyEntity(e){e.destroy()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(9);t.Plugin=class{constructor(e,t){this.propMethod=null,this.methods={},this._props={},this.props={},this.systemPlugs=[],this.propNames=[],this.methodNames=[],this.globals={},this.initialize=()=>{},t&&(this.globals=t),this.name=e.name;const i=e.props?e.props:null,n=e.methods?e.methods:null;i&&this.applyProps(i()),n&&this.applyMethods(n),e.hasOwnProperty("init")&&(this.initialize=e.init)}emit(e,t){for(let i=0;i<this.systemPlugs.length;i++)this.systemPlugs[i].emit(e,t)}applyProps(e){const t=e=>({set:t=>{this._props[e]=t},get:()=>this._props[e]});for(let i in e){if(i in this)throw this.propNames.includes(i)?new Error(`Duplicate prop name: ${i} in plugin: ${this.name}`):new Error(`Prop name: ${i} in plugin: ${this.name} cannot be used in a plugin`);this.propNames.push(i),this[i]=e[i],this._props[i]=e[i],this.props[i]=e[i];const n=t(i);Object.defineProperty(this,i,n),Object.defineProperty(this.props,i,n)}}applyMethods(e){for(let t in e){if(t in this)throw this.propNames.includes(t)?new Error(`Cannot use method name: ${t} because it is already used as a prop name in plugin: ${this.name}`):t in e?new Error(`Duplicate method name: ${t} in plugin: ${this.name}`):new Error(`Method name: ${t} in plugin: ${this.name} cannot be used in a plugin`);const i=e[t].bind(this);this.methodNames.push(t),this.methods[t]=i,this[t]=i}}applyToSystem(e){for(let t=0;t<this.propNames.length;t++){const i=this.propNames[t];if(e.$[i])throw new Error(`Cannot add plugin prop ${i} to system: ${e.name} because it was already defined`);Object.defineProperty(e.$,i,{get:()=>this._props[i],set:()=>{throw new Error(`System ${e.name} cannot set plugin prop: ${i}, only the plugin ${this.name} can mutate the prop.`)}})}for(let t=0;t<this.methodNames.length;t++){const i=this.methodNames[t];if(e.$[i])throw new Error(`Cannot add plugin method ${i} to system: ${e.name} because it was already defined`);e.$[i]=this.methods[i]}this.systemPlugs.push(e.$)}},t.installPlugin=function(e,t){t.applyToSystem(e)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ClientMessageQueue=class{constructor(){this.engineSystemMessageGameSystemHooks={},this._systems={},this.systemNames=[],this._messages={},this._remoteMessages={}}get systems(){return this._systems}get messages(){return this._messages}get remoteMessages(){return this._remoteMessages}gameSystemHook(e,t){if(t){const i=t.length;for(let n=0;n<i;n++)this._messages[t[n]].push(e)}}addGameSystemMessageListener(e,t){t in this.engineSystemMessageGameSystemHooks||(this.engineSystemMessageGameSystemHooks[t]=[]);let i=this.engineSystemMessageGameSystemHooks[t];for(;i--;)if(this.engineSystemMessageGameSystemHooks[t][i]===e)throw new Error(`Duplicate message: ${t} listener for system: ${e} `);this.engineSystemMessageGameSystemHooks[t].push(e)}removeGameSystemMessageListener(e,t){if(t in this.engineSystemMessageGameSystemHooks){let i=this.engineSystemMessageGameSystemHooks[t].length;for(;i--;)if(this.engineSystemMessageGameSystemHooks[t][i]===e)return this.engineSystemMessageGameSystemHooks[t].splice(i,1),0===this.engineSystemMessageGameSystemHooks[t].length&&delete this.engineSystemMessageGameSystemHooks[t],!0;throw new Error(`Trying to remove message: ${t} listener from System: ${e} but the system never listened to it.`)}throw new Error(`Trying to remove a message listener: ${t} from system: ${e} but the message was never listened to by any system`)}removeSystem(e){for(let t in this.engineSystemMessageGameSystemHooks)try{this.removeGameSystemMessageListener(e,t)}catch(e){}this._messages[e].length=0,delete this._messages[e],delete this._systems[e];const t=this.systemNames.indexOf(e);t>=0&&this.systemNames.splice(t,1)}removeAllSystemsAndMessages(){for(let e in this._systems)delete this._systems[e],this._messages[e].length=0,delete this._messages[e],this.systemNames.length=0,this._remoteMessages[e].length=0,delete this._remoteMessages[e]}removeAllMessages(){for(let e in this._systems)this._messages[e].length=0}addSystem(e){this._systems[e.name]=e,this._messages[e.name]=[],this._remoteMessages[e.name]=[],this.systemNames.push(e.name)}add(e){for(let t=0;t<e.to.length;t++)e.to[t]in this._systems?this.messages[e.to[t]].push(e):console.error("trying to dispatch message",e.type,"to a nonexistent system name",e.to[t]);this.gameSystemHook(e,this.engineSystemMessageGameSystemHooks[e.type])}addAll(e){const t=this.systemNames.length;for(let i=0;i<t;i++)this.messages[this.systemNames[i]].push(e)}instantDispatch(e,t=!1){const i=e.to.length;if(t)for(let t=0;t<i;t++)e.to[t]in this._systems?this._systems[e.to[t]].onRemoteMessage(e):console.error("trying to dispatch message",e.type,"to a nonexistent system name",e.to[t]);else{for(let t=0;t<i;t++)e.to[t]in this._systems?this._systems[e.to[t]].onLocalMessage(e):console.error("trying to dispatch message",e.type,"to a nonexistent system name",e.to[t]);this.gameSystemHook(e,this.engineSystemMessageGameSystemHooks[e.type])}}instantDispatchAll(e,t,i){for(let n=0;n<this.systemNames.length;n++)this._systems[this.systemNames[n]].onLocalMessage({type:e,data:t,to:[this.systemNames[n]],from:i})}addRemote(e,t,i,n){for(let s=0;s<i.length;s++)i[s]in this._systems?this._remoteMessages[i[s]].push({type:e,data:t,to:i,from:n}):console.error("trying to dispatch message",e,"to a nonexistent system name",i)}dispatchPeerMessage(e,t,i,n,s){for(let r=0;r<n.length;r++)n[r]in this._systems?this._systems[n[r]].onPeerMessage(e,{type:t,data:i,from:s}):console.error("trying to add peer message",t,"to a nonexistent system name",n)}dispatch(e){let t,i,n;for(t=0;this._messages[e].length;t++)(n=this._messages[e][t])&&(i=this._systems[e])&&i.onLocalMessage(n),this._messages[e].splice(t,1),t--;for(t=0;this._remoteMessages[e].length;t++)(n=this._remoteMessages[e][t])&&(i=this._systems[e])&&i.onRemoteMessage(n),this._remoteMessages[e].splice(t,1),t--}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ServerMessageQueue=class{constructor(){this.engineSystemMessageGameSystemHooks={},this._systems={},this.systemNames=[],this._messages={},this._clientMessages={},this._areaMessages={}}get systems(){return this._systems}get messages(){return this._messages}get clientMessages(){return this._clientMessages}get areaMessages(){return this._areaMessages}gameSystemHook(e,t){if(t){const i=t.length;for(let n=0;n<i;n++)this._messages[t[n]].push(e)}}addGameSystemMessageListener(e,t){t in this.engineSystemMessageGameSystemHooks||(this.engineSystemMessageGameSystemHooks[t]=[]);let i=this.engineSystemMessageGameSystemHooks[t];for(;i--;)if(this.engineSystemMessageGameSystemHooks[t][i]===e)throw new Error(`Duplicate message: ${t} listener for system: ${e} `);this.engineSystemMessageGameSystemHooks[t].push(e)}removeGameSystemMessageListener(e,t){if(t in this.engineSystemMessageGameSystemHooks){let i=this.engineSystemMessageGameSystemHooks[t].length;for(;i--;)if(this.engineSystemMessageGameSystemHooks[t][i]===e)return this.engineSystemMessageGameSystemHooks[t].splice(i,1),0===this.engineSystemMessageGameSystemHooks[t].length&&delete this.engineSystemMessageGameSystemHooks[t],!0;throw new Error(`Trying to remove message: ${t} listener from System: ${e} but the system never listened to it.`)}throw new Error(`Trying to remove a message listener: ${t} from system: ${e} but the message was never listened to by any system`)}removeSystem(e){for(let t in this.engineSystemMessageGameSystemHooks)try{this.removeGameSystemMessageListener(e,t)}catch(e){}this._messages[e].length=0,delete this._messages[e],delete this._clientMessages[e],delete this._areaMessages[e],delete this._systems[e];const t=this.systemNames.indexOf(e);t>=0&&this.systemNames.splice(t,1)}removeAllSystemsAndMessages(){for(let e in this._systems)delete this._systems[e],this._messages[e].length=0,this._clientMessages[e].length=0,this._areaMessages[e].length=0,delete this._messages[e],delete this._areaMessages[e],delete this._clientMessages[e],this.systemNames.length=0}removeAllMessages(){for(let e in this._systems)this._messages[e].length=0}addSystem(e){this._systems[e.name]=e,this._messages[e.name]=[],this._clientMessages[e.name]=[],this._areaMessages[e.name]=[],this.systemNames.push(e.name)}add(e){for(let t=0;t<e.to.length;t++)e.to[t]in this._systems?this._messages[e.to[t]].push(e):console.error("trying to dispatch message",e.type,"to a nonexistent system name",e.to[t]);this.gameSystemHook(e,this.engineSystemMessageGameSystemHooks[e.type])}addClientMessage(e,t){for(let i=0;i<t.to.length;i++)t.to[i]in this._systems?this._clientMessages[t.to[i]].push([e,t]):console.error("trying to dispatch message",t.type,"to a nonexistent system name",t.to[i])}addAreaMessage(e,t){for(let i=0;i<t.to.length;i++)t.to[i]in this._systems?this._areaMessages[t.to[i]].push([e,t]):console.error("trying to dispatch message",t.type,"to a nonexistent system name",t.to[i])}addAll(e){const t=this.systemNames.length;for(let i=0;i<t;i++)this.messages[this.systemNames[i]].push(e)}instantClientDispatch(e,t){const i=t.to.length;for(let n=0;n<i;n++)t.to[n]in this._systems?this._systems[t.to[n]].onClientMessage(e,t):console.error("trying to dispatch message",t.type,"to a nonexistent system name",t.to[n])}instantAreaDispatch(e,t){const i=t.to.length;for(let n=0;n<i;n++)t.to[n]in this._systems?this._systems[t.to[n]].onAreaMessage(e,t):console.error("trying to dispatch message",t.type,"to a nonexistent system name",t.to[n])}instantDispatch(e){const t=e.to.length;for(let i=0;i<t;i++)e.to[i]in this._systems?this._systems[e.to[i]].onLocalMessage(e):console.error("trying to dispatch message",e.type,"to a nonexistent system name",e.to[i]);this.gameSystemHook(e,this.engineSystemMessageGameSystemHooks[e.type])}instantDispatchAll(e,t,i){for(let n=0;n<this.systemNames.length;n++)this._systems[this.systemNames[n]].onLocalMessage({type:e,data:t,to:[this.systemNames[n]],from:i})}addMasterMessage(e){for(let t=0;t<this.systemNames.length;t++){const i=this.systemNames[t];this._systems[i].onMasterMessage&&this._systems[i].onMasterMessage(e)}}dispatch(e){let t,i,n,s;for(t=0;this._messages[e].length;t++)(n=this._messages[e][t])&&(i=this._systems[e])&&i.onLocalMessage(n),this._messages[e].splice(t,1),t--;for(t=0;this._areaMessages[e].length;t++)(s=this._areaMessages[e][t])&&(i=this._systems[e])&&i.onAreaMessage(s[0],s[1]),this._areaMessages[e].splice(t,1),t--;for(t=0;this._clientMessages[e].length;t++)(s=this._clientMessages[e][t])&&(i=this._systems[e])&&i.onClientMessage(s[0],s[1]),this._clientMessages[e].splice(t,1),t--}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.server=function(e){const t=new Set,{messageQueue:i,entityManager:n,globals:s,addApi:r,$api:o}=e;return r=>{if(t.has(r.name))throw`Tried initializing duplicate system name: ${r.name} change of one of the instances.`;r.$api=o,r.addApi=e.addApi.bind(e,r),r.initialize(i,n,s)}},t.client=function(e){const t=new Set,{messageQueue:i,entityManager:n,globals:s,client:r,isNetworked:o,gottiId:a,clientId:h,addApi:l,$api:d}=e;return l=>{if(t.has(l.name))throw`Tried initializing duplicate system name: ${l.name} change of one of the instances.`;l.$api=d,l.addApi=e.addApi.bind(e,l),l.initialize(r,i,n,o,s,a,h)}}},function(e,t,i){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});let n=[];const s=function(){let e=0;return function(){return e++}}();function r(){var t=e.hrtime();return+t[0]*o+ +t[1]}const o=1e9,a=1/o,h=1e6;t.setGameLoop=function(e,t=1e3/30){let o=s();n.push(o);const l=t*h,d=Math.floor(t-1),c=d*h;let u=r(),p=r();const f=function(){0;const t=r();if(t>=p){const i=t-u;u=t,p=t+l,e(i*a)}-1!==n.indexOf(o)&&(p-r()>c?setTimeout(f,Math.max(d,16)):i(f))};return f(),o},t.clearGameLoop=function(e){n.splice(n.indexOf(e),1)}}).call(this,i(31),i(32).setImmediate)},function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var n,s,r,o,a,h=1,l={},d=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){f(e.data)},n=function(e){r.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(s=c.documentElement,n=function(e){var t=c.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):n=function(e){setTimeout(f,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&f(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(o+t,"*")}),u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var s={callback:e,args:t};return l[h]=s,n(h),h++},u.clearImmediate=p}function p(e){delete l[e]}function f(e){if(d)setTimeout(f,0,e);else{var t=l[e];if(t){d=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(i,n)}}(t)}finally{p(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(10),i(31))},function(e,t,i){"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0});const s="function"==typeof cancelAnimationFrame?cancelAnimationFrame.bind(window):clearTimeout,r={tickStart:()=>{},tick:()=>{},destroy:()=>{}};let o=r;t.clearGameLoop=function(){s(n),o&&(o.destroy(),o=r)},t.setGameLoop=function(e,t=1e3/30,i=!0){let s;var r,a,h;s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(window):(h=Date.now(),function(e){return r=Date.now(),a=Math.max(0,t-(r-h)),h=r+a,setTimeout((function(){e(h)}),a)});let l=0,d=0;const c=t/1e3,u=function(){const i=Date.now();if(i<d+t)n=s(u);else{l+=i-d,d=i;for(var r=0;l>=t;)if(e(c),l-=t,++r>=240){l=0;break}}},p=function(){u(),n=s(p)},f=function(){o.tickStart(),u(),o.tick(),n=s(f)};i?f():p()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(28);class s extends n.default{constructor(e){super(e)}setClientWrite(e,t,i){throw"clientManager.setClientWrite should be overidden in area initialization before use."}addClientListen(e,t,i){throw"clientManager.addClientListen should be overidden in area initialization before use."}removeClientListener(e,t){throw"removeClientListener should be overidden in area initialization before use."}}t.ClientManager=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(9);t.Entity=class extends n{constructor(e,t){return super(),this.componentNames=[],this.attributes={},this.attributeGetters=[],this.id=e,this.type=t,this.components={},this.methodsFromComponent={},this}addComponent(e){if(this.hasComponent(e.name))throw`Entity ${this.id} trying to add ${e.name} twice `;this.components[e.name]=e,this.methodsFromComponent[e.name]=e.componentMethods;for(var t=0;t<e.componentMethods.length;t++){let i=e.componentMethods[t];if(void 0!==this[i])throw`Duplicated property ${i} names in component ${e.name} attached to an entity. Component properties must be unique`;e[i]instanceof Function&&(this[i]=e[i].bind(e))}e.emit=this.emit.bind(this),e.setAttribute=this.setAttribute.bind(this),e.setAttributeGetter=this.setAttributeGetter.bind(this),e.removeAttribute=this.removeAttribute.bind(this),e.onAdded(this),e.entityId=this.id,this.componentNames.push(e.name)}removeAttribute(e){delete this.attributes[e];for(let t=0;t<this.attributeGetters.length;t++)if(this.attributeGetters[t][0]===e)return void this.attributeGetters.splice(t,1)}setAttribute(e,t){this.attributes[e]=t}setAttributeGetter(e,t){for(let t=0;t<this.attributeGetters.length;t++)if(this.attributeGetters[t][0]===e)throw new Error(`Trying to set multiple attribute getters for the same key ${e}`);this.attributeGetters.push([e,t])}getComponent(e){return this.components[e]}getAttributes(){const e=this.attributeGetters.length;for(let t=0;t<e;t++){const e=this.attributeGetters[t];this.attributes[e[0]]=e[1]()}return this.attributes}hasComponent(e){return void 0!==this.components[e]}removeComponent(e){const t=this.components[e];if(void 0===t)throw`Entity ${this.id} trying to remove non existening component ${e} `;delete this.components[e];for(var i=0;i<this.methodsFromComponent[e].length;i++)delete this[this.methodsFromComponent[e][i]];delete this.methodsFromComponent[e];const n=this.componentNames.indexOf(e);this.componentNames.splice(n,1),t.onRemoved(this)}destroy(){for(let e in this.components)this.removeComponent(e);this.removeAllListeners(),this.componentNames=[]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Component=class{constructor(e){if(this.componentMethods=[],this.setAttribute=()=>{},this.setAttributeGetter=()=>{},this.removeAttribute=()=>{},void 0===e)throw"Component: Invalid component name";let t=this.constructor.prototype;this.componentMethods=Object.getOwnPropertyNames(t).filter(e=>"constructor"!==e&&"prototype"!==e&&"onAdded"!==e&&"onRemoved"!==e),this.name=e}emit(e,t){}onAdded(e){}onRemoved(e){}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new i((function(t){t(e.value)})).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(18),r=i(59),o=i(0),a=i(19),h=i(61),l=i(9);function d(e,t,i,n){const s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/json"),t&&s.setRequestHeader("authorization",t),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?n(null,JSON.parse(s.responseText)):n(JSON.parse(s.responseText),null))},s.send(JSON.stringify(i))}t.Client=class extends l{constructor(e,t,i=!1,n,a){if(super(),this.runningProcess=null,this.processFactories={},this.inGate=!1,this.stateListeners={},this.systemStateHandlers={},this.processMessageHandlers={},this.onJoinGame=new s.Signal,this.authenticated=!1,this.gameTypes=[],this.gameRegions=[],this._messageQueue=null,this.joinedGame=!1,this.requestId=0,this.auth={},this.gate={},this.api={},this.webProtocol="http",this.webSocketProtocol="ws:",n&&(this.webProtocol=n),t)this.hostname=t;else{if(!window)throw new Error("No hostname provided or no window reference");this.hostname=window.location.hostname}if(a?this.port=a:window&&window.location&&window.location.port?this.port=window.location.port:this.port=80,this.port||(this.port=80),this.baseHttpUrl=80!=this.port?`${this.hostname}:${this.port}`:this.hostname,n){if("http"!==n&&"https"!==n)throw new Error("Web protocol must be http or https");this.webProtocol=n+":"}else window&&(this.webProtocol=window.location.protocol);"https:"===this.webProtocol&&(this.webSocketProtocol="wss:"),this.processManager=new r.ProcessManager(e,this),this.options={isWebRTCSupported:window.RTCPeerConnection&&window.navigator.userAgent.indexOf("Edge")<0&&!i},this.connector=new h.Connector,this.publicApi={clearGame:this.clearGame.bind(this),register:this.register.bind(this),getGames:this.getGames.bind(this),joinInitialArea:this.joinInitialArea.bind(this),joinGame:this.joinGame.bind(this),onProcessMessage:this.onProcessMessage.bind(this),removeProcessMessage:this.removeProcessMessage.bind(this),authenticate:this.authenticate.bind(this),auth:this.auth,authentication:this.auth,gate:this.gate,api:this.api,on:this.on.bind(this),once:this.once.bind(this),emit:this.emit.bind(this),off:this.off.bind(this),removeAllListeners:this.removeAllListeners.bind(this),startOfflineGame:this.startOfflineGame.bind(this)},o.setDefaultClientExport(this)}addAuthRoutes(e){e.forEach(e=>{if(e===a.GOTTI_HTTP_ROUTES.AUTHENTICATE||e===a.GOTTI_HTTP_ROUTES.REGISTER)throw new Error("auth route name in use");if(["data","id"].includes(e))throw new Error(`${e} is a reserved field on auth object. cannot have handler with the name ${e}`);this.auth[e]=t=>n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_AUTH}/${e}`,"",{[a.GOTTI_ROUTE_BODY_PAYLOAD]:t,[a.GOTTI_GATE_AUTH_ID]:this.authId},(e,t)=>{if(e)return n(e);{console.log("data was",t);const e=t[a.GOTTI_ROUTE_BODY_PAYLOAD],n=t[a.GOTTI_AUTH_KEY],s=t[a.GOTTI_GATE_AUTH_ID];return this.setAuthValues(n,s),i(e)}})})})),this.auth[e]=this.auth[e].bind(this)}),this.auth.authenticate=this.authenticate.bind(this),this.auth.register=this.register.bind(this)}removeAuthValues(){this.authId=null,this.auth.id=null,this.auth.data=null}setAuthValues(e,t){e&&(this.auth.data=e,this.emit("auth-data",e)),t&&(this.authId=t,this.auth.id=t,this.emit("auth-id",t))}addGateRoutes(e){e.forEach(e=>{if(e===a.GOTTI_HTTP_ROUTES.GET_GAMES||e===a.GOTTI_HTTP_ROUTES.JOIN_GAME)throw new Error("gate route name in use");this.gate[e]=t=>n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_GATE}/${e}`,"",{[a.GOTTI_ROUTE_BODY_PAYLOAD]:t,[a.GOTTI_GATE_AUTH_ID]:this.authId},(e,t)=>{if(e)return n(e);{const e=t[a.GOTTI_ROUTE_BODY_PAYLOAD];return i(e)}})})})),this.gate[e]=this.gate[e].bind(this)}),this.gate.getGames=this.getGames.bind(this),this.gate.register=this.register.bind(this)}addApiRoutes(e){e.forEach(e=>{this.api[e]=t=>n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_PUBLIC_API}/${e}`,"",{[a.GOTTI_ROUTE_BODY_PAYLOAD]:t},(e,t)=>{if(e)return n(e);{const e=t[a.GOTTI_ROUTE_BODY_PAYLOAD];return i(e)}})})})),this.api[e]=this.api[e].bind(this)})}clearGame(){if(!this.runningProcess)throw new Error("no game has started to clear");this.processManager.clearAllProcesses(),this.connector.disconnect(),this.joinedGame=!1,this.connector=new h.Connector,this.onJoinGame.removeAll()}validateServerOpts(e){return e.gottiId&&e.hasOwnProperty("clientId")&&e.proxyId}updateServerGameData(e){if(!this.runningProcess)throw new Error("No process is running to update server game data.");this.runningProcess.serverGameData=e}authenticate(e,t){return n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_AUTH}${a.GOTTI_HTTP_ROUTES.AUTHENTICATE}`,t,{[a.GOTTI_AUTH_KEY]:e},(e,t)=>{if(e)return n(`Error requesting game ${e}`);{const e=t[a.GOTTI_AUTH_KEY],s=t[a.GOTTI_GATE_AUTH_ID];if(s)return this.setAuthValues(e,s),i(e);n("Error from authentication server")}})})}))}register(e,t){return n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_AUTH}${a.GOTTI_HTTP_ROUTES.REGISTER}`,t,{[a.GOTTI_AUTH_KEY]:e},(e,t)=>{if(e)return n(`Error requesting game ${e}`);{const e=t[a.GOTTI_AUTH_KEY],s=t[a.GOTTI_GATE_AUTH_ID];if(s)return this.setAuthValues(e,s),i(e);n("Error from authentication server")}})})}))}getGames(e,t){return n(this,void 0,void 0,(function*(){if(!this.authId)throw new Error("You are not authenticated");return new Promise((i,n)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_GATE}${a.GOTTI_HTTP_ROUTES.GET_GAMES}`,t,{[a.GOTTI_GATE_AUTH_ID]:this.authId,[a.GOTTI_GET_GAMES_OPTIONS]:e},(e,t)=>e?n(`Error getting gate data ${e}`):i(t))})}))}startOfflineGame(e,t,i){return n(this,void 0,void 0,(function*(){return this.runningProcess&&this.clearGame(),this.runningProcess=yield this.processManager.initializeGame(e,t,i),this.processManager.startCurrentGameSystems(),this.processManager.startProcess(),!0}))}joinGame(e,t){return n(this,void 0,void 0,(function*(){this.runningProcess&&this.clearGame();const i=this.processManager.gameProcessSetups.find(t=>t.type===e);if(!i)throw new Error(`couldnt find gameType ${e} make sure it was initialized in client constructor`);if(i.isNetworked){if(!this.authId)throw new Error("You are not authenticated to join a networked game");return new Promise((i,s)=>{d(`${this.webProtocol}//${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.BASE_GATE}${a.GOTTI_HTTP_ROUTES.JOIN_GAME}`,"",{gameType:e,[a.GOTTI_GET_GAMES_OPTIONS]:t,[a.GOTTI_GATE_AUTH_ID]:this.authId},(t,r)=>n(this,void 0,void 0,(function*(){if(t)return s(`Error requesting game ${t}`);{const{gottiId:t,clientId:n,proxyId:s,gameData:o,areaData:h}=r;this.runningProcess=yield this.processManager.initializeGame(e,o,h);const l=yield this.joinConnector(t,n,`${this.baseHttpUrl}${a.GOTTI_HTTP_ROUTES.CONNECTOR}/${s}`,h);return this.processManager.startCurrentGameSystems(),this.processManager.startProcess(),i({gameData:o,areaData:h,joinOptions:l})}})))})}throw new Error("The found game is not a networked game, start with joinOfflineGame(gameType, gameData, areaData)")}))}joinOnlineGame(e,t,i,n=6){}joinInitialArea(e){return n(this,void 0,void 0,(function*(){if(!this.runningProcess)throw new Error("There is no currently running networked process.");if(!this.runningProcess.isNetworked)throw new Error("The current running process is not networked, there is no area to write to.");if(!this.joinedGame)throw new Error("Make sure client.startGame's promise resolved when called with gotti credentials in parameters");return this.connector.joinInitialArea(e),new Promise((e,t)=>{this.connector.onInitialArea.add(({areaOptions:i,areaId:n,err:s})=>s?t(s):e({options:i,areaId:n}))})}))}onProcessMessage(e,t){this.processMessageHandlers[e]=t}removeProcessMessage(e){delete this.processMessageHandlers[e]}raiseMessage(e,t){this.processMessageHandlers[e]&&this.processMessageHandlers[e](t)}joinConnector(e,t,i,s){return n(this,void 0,void 0,(function*(){const n={gottiId:e,playerIndex:t,connectorURL:i},r=yield this.connector.connect(n,this.runningProcess,this.processManager,s,this.options,this.webSocketProtocol);return this.joinedGame=!0,r}))}close(){this.joinedGame=!1,this.connector.connection.close()}joinGate(e){}onMessage(e){}sendSystemMessage(e,t){this.connector.sendSystemMessage(e)}sendImmediateSystemMessage(e){this.connector.sendImmediateSystemMessage(e)}onServerSystemMessage(e){}addSystemPathListener(e,t){if(e.name in this.systemStateHandlers||this.initializeSystemStateHandler(e),this.systemStateHandlers[e.name].paths.indexOf(t)>-1)throw`Trying to listen to duplicate path ${t} for system ${e.name}`;t in this.stateListeners||(this.stateListeners[t]=[]),this.stateListeners[t].push[e.name]}removeSystemPathListener(e,t){const i=this.stateListeners[t];if(!i.length)throw`There was no listeners for path ${t} when trying to remove from ${e}`;const n=i.indexOf(e);if(n<0)throw`${e} was not listening to path ${t} could not remove a listener.`;i.splice(n,1),this.systemStateHandlers[e].paths.splice(this.systemStateHandlers[e].paths.indexOf(t),1)}removeSystemHandler(e){if(void 0!==this.systemStateHandlers[e]){let t=this.systemStateHandlers[e].paths;delete this.systemStateHandlers[e];for(let i=0;i<t.length;i++)this.removeSystemPathListener(e,t[i])}}initializeSystemStateHandler(e){this.systemStateHandlers[e.name]={handler:e.onStateUpdate.bind(e),paths:[]}}}},function(e,t,i){"use strict";var n,s=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.add=function(e){return this.registerListener(e)},t}(i(34).OnceSignal);t.Signal=r},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new i((function(t){t(e.value)})).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(60),r=i(0);t.ProcessManager=class{constructor(e,t){this.systemNamesByArea={},this.startedAreaSystemCount={},this.areaSystems={},this.gameSystemConstructors=[],this.startedAreaSystemConstructors=[],this.systemConstructorNameToPrototypeName={},this.validateGameProcessSetups(e),this.gameProcessSetups=e,this.client=t}validateGameProcessSetups(e){if(!Array.isArray(e))throw new Error("game process files need to be an array");const t={};e.forEach(e=>{if(!e.type)throw new Error(`game process ${e} needs a type string property`);if(e.globals&&"object"!=typeof e.globals&&"function"!=typeof e.globals)throw console.log("globals was",typeof e.globals),new Error(`gp.globals ${e.type} must be an object or function/async function`);if(t[e.type])throw new Error(`${e.type} already in use as a game type.`);if(!e.systems||!Array.isArray(e.systems))throw new Error(`game needs systems property to be array of ClientSystem instances for type: ${e.type}`);if(e.systems.forEach(e=>{if(!(e.prototype instanceof r.ClientSystem))throw new Error(`game type system ${e} does not inherit from ClientSystem, make sure your systems array contains system constructors/classes, not objects.`)}),e.areas&&!Array.isArray(e.areas))throw new Error(`game ${e.type} areas need to be an array if included`);if(e.areas){const i={};e.areas.forEach(n=>{if(!n.type)throw new Error(`game process ${e} area ${n} needs an type string property`);if(i[e.type])throw new Error(`${e.type} already in use as a game type in game ${e.type}.`);if(t[e.type]=!0,!n.systems||!Array.isArray(n.systems))throw`Area ${n.type} systems needs to be an array of systems`;n.systems.forEach(t=>{if(e.systems.includes(t))throw new Error(`Area ${n} is using a duplicate system as the game process ${e} if a game process uses a system, an area should not as well.`);if(!(t.prototype instanceof r.ClientSystem))throw new Error(`game type ${e.type} area ${n.type} system ${t} does not inherit from ClientSystem, make sure your systems array contains system constructors/classes, not objects.`)})})}})}removeAreaSystems(e){const t=this.systemNamesByArea[this.areaData[e].type];for(let e=0;e<t.length;e++){const i=t[e];this.startedAreaSystemCount[i]--,this.startedAreaSystemCount[i]||this.runningGameProcess.stopSystem(i)}}startAreaSystems(e){const t=this.systemNamesByArea[this.areaData[e].type];for(let e=0;e<t.length;e++)this.startedAreaSystemCount[t[e]]?this.runningGameProcess.restartSystem(t[e]):this.runningGameProcess.startSystem(t[e]),this.startedAreaSystemCount[t[e]]++}changeGameProcessSetup(e,t,i){return n(this,void 0,void 0,(function*(){return this.runningGameProcess&&this.clearAllProcesses(),yield this.initializeGame(e,t,i)}))}clearAllProcesses(){this.runningGameProcess.clearGame(),this.systemNamesByArea={},this.startedAreaSystemCount={},this.runningGameProcess=null,this.startedAreaSystemConstructors.length=0,this.currentArea=""}initializeGame(e,t,i){return n(this,void 0,void 0,(function*(){const n=this.gameProcessSetups.find(t=>t.type===e);if(!n)throw new Error(`Game ${e} was not found in processes.`);this.runningGameProcessSetup=n,this.areaData=i;let r={};n.globals&&(r="function"==typeof n.globals?yield n.globals(t,i,this.client):n.globals);const o=n.fps?n.fps:60;this.runningGameProcess=new s.ClientProcess(this.client,n.isNetworked,r,{fpsTickRate:o});const a=[];return n.systems.forEach(e=>{const{name:t}=this.runningGameProcess.addSystem(e);this.systemConstructorNameToPrototypeName[e.name]=t}),n.areas.forEach(e=>{this.systemNamesByArea[e.type]=[],e.systems.forEach(t=>{if(!a.includes(t)){a.push(t);const{name:e}=this.runningGameProcess.addSystem(t);this.systemConstructorNameToPrototypeName[t.name]=e}this.systemNamesByArea[e.type].push(this.systemConstructorNameToPrototypeName[t.name]),this.startedAreaSystemCount[this.systemConstructorNameToPrototypeName[t.name]]||(this.startedAreaSystemCount[this.systemConstructorNameToPrototypeName[t.name]]=0)})}),n.plugins&&Array.isArray(n.plugins)&&n.plugins.forEach(e=>{this.runningGameProcess.installPlugin(e)}),this.runningGameProcess}))}startProcess(){this.runningGameProcess.startLoop()}stopProcess(){this.runningGameProcess.stopLoop()}startCurrentGameSystems(){this.runningGameProcessSetup.systems.forEach(e=>{this.runningGameProcess.startSystem(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(33);t.ClientProcess=n.ClientProcess;var s=i(17);t.Process=s.Process,t.PROCESS_ENV=s.PROCESS_ENV;var r=i(30);t.ServerProcess=r.ServerProcess},function(e,t,i){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new i((function(t){t(e.value)})).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(66),r=i(18),o=i(67),a=i(70),h=i(20),l=i(73),d=i(19),c=i(77);var u;!function(e){e[e.NOT_IN=0]="NOT_IN",e[e.LISTEN=1]="LISTEN",e[e.WRITE=2]="WRITE"}(u=t.AreaStatus||(t.AreaStatus={}));t.Connector=class{constructor(){this.writeAreaId=null,this.clock=new s,this.remoteClock=new s,this.onJoinConnector=new r.Signal,this.onEnabledP2P=new r.Signal,this.onNewP2PConnection=new r.Signal,this.onRemovedP2PConnection=new r.Signal,this.onWrite=new r.Signal,this.onListen=new r.Signal,this.onRemoveListen=new r.Signal,this.onStateChange=new r.Signal,this.onMessage=new r.Signal,this.onError=new r.Signal,this.onLeave=new r.Signal,this.onOpen=new r.Signal,this.onInitialArea=new r.Signal,this.areas={},this.peerConnections={},this.pendingPeerRequests={},this.peerAckRequestTimeouts={},this.peerConnectedRequestTimeouts={},this.connectedPeerIndexes=[]}connect(e,t,i,s,r={},o){return n(this,void 0,void 0,(function*(){const{gottiId:n,playerIndex:a,connectorURL:h}=e;this.gottiId=n,this.areaData=s,this.playerIndex=a,this.processManager=i,this.process=t,this.messageQueue=t.messageQueue;let d=this.buildEndPoint(h,r,o);return this.connection=new l.Connection(d),this.connection.onopen=()=>{},this.connection.onmessage=this.onMessageCallback.bind(this),new Promise((e,t)=>{this.onJoinConnector.add(t=>e(t))})}))}handlePeerConnectionRequest(e,t,i,s){return n(this,void 0,void 0,(function*(){if(!this.peerConnections[e]){if(this.pendingPeerRequests[e])throw new Error("handle peer connection request error");{const t=yield this.process.onPeerConnectionRequest(e,i,s);if(!t)return void this.connection.send([113,e]);this.peerConnections[e]=new c.PeerConnection(this.connection,this.playerIndex,e),this.setupPeerConnection(this.peerConnections[e],e),this.peerConnections[e].acceptConnection(t)}}this.handleSignalData(e,t)}))}handleSignalData(e,t){const i=this.peerConnections[e];i?t.sdp?i.handleSDPSignal(t.sdp):t.candidate&&i.handleIceCandidateSignal(t.candidate):console.error("Attempting to handle signal data for non existent peer:",e)}requestPeerConnection(e,t,i,n,s,r){s=s||3e3,r=r||5e3;let o=this.peerConnections[e];if(o)throw new Error(`Already existing peer connection for peer:, ${e}`);o=new c.PeerConnection(this.connection,this.playerIndex,e),this.setupPeerConnection(o,e),o.requestConnection(t,i),this.peerConnections[e]=o,this.pendingPeerRequests[e]=n,this.peerAckRequestTimeouts[e]=setTimeout(()=>{o.onAck.removeAll(),delete this.peerAckRequestTimeouts[e],this.handlePeerFailure(e,null,"Peer connection timed out, never received an acknowledgement back from peer.")},s),o.onAck.addOnce(()=>{clearTimeout(this.peerAckRequestTimeouts[e]),delete this.peerAckRequestTimeouts[e],o.connected||(this.peerConnectedRequestTimeouts[e]=setTimeout(()=>{delete this.peerConnectedRequestTimeouts[e],this.handlePeerFailure(e,null,"Peer connection timed out on actual handshake of webRTC connection")},r))})}stopAllPeerConnections(){for(let e in this.peerConnections)this.peerConnections[e].destroy()}stopPeerConnection(e){this.peerConnections[e]&&this.peerConnections[e].destroy()}joinInitialArea(e){if(!this.connection)throw new Error("No connection, can not join an initial area");if(null!==this.writeAreaId)throw new Error("Player is already writing to an area.");this.connection.send([20,e])}disconnect(){this.removeAllListeners(),this.stopAllPeerConnections(),this.connection.close(),this.process=null,this.messageQueue=null}sendPeerMessage(e,t){this.peerConnections[e].send(h.encode(t.type,t.data,t.to,t.from))}sendAllPeersMessage(e){const t=this.connectedPeerIndexes.length,i=h.encode([e.type,e.data,e.to,e.from]);for(let e=0;e<t;e++)this.peerConnections[this.connectedPeerIndexes[e]].send(i)}sendPeersMessage(e,t){let i=e.length;const n=h.encode([t.type,t.data,t.to,t.from]);for(let t=0;t<i;t++)this.peerConnections[e[t]].send(n)}sendSystemMessage(e){this.connection.send([28,e.type,e.data,e.to,e.from])}sendImmediateSystemMessage(e){this.connection.send([29,e.type,e.data,e.to,e.from])}get hasJoined(){return void 0!==this.sessionId}removeAllListeners(){this.onJoinConnector.removeAll(),this.onStateChange.removeAll(),this.onMessage.removeAll(),this.onError.removeAll(),this.onLeave.removeAll()}onJoin(e){Object.keys(this.areaData).forEach(e=>{const{data:t,type:i}=this.areaData[e];this.areas[e]={_previousState:{},status:u.NOT_IN,state:new o.StateContainer({}),options:{},data:t,type:i}}),this.onJoinConnector.dispatch(e)}onMessageCallback(e){const t=h.decode(new Uint8Array(e.data)),i=t[0];if(10===i)this.onJoin(t[1]);else if(11===i)this.onError.dispatch(t[1]);else if(21===i){this.writeAreaId&&(this.areas[this.writeAreaId].status=u.LISTEN);const e=null===this.writeAreaId;this.writeAreaId=t[1],this.areas[t[1]].status!==u.LISTEN&&this.processManager.startAreaSystems(t[1]),this.areas[t[1]].status=u.WRITE,e&&this.onInitialArea.dispatch({areaId:t[1],areaOptions:t[2]}),this.process.dispatchOnAreaWrite(t[1],e,t[2])}else if(22===i){this.areas[t[1]].status=u.LISTEN,this.processManager.startAreaSystems(t[1]);const{responseOptions:e,encodedState:i}=t[2];this.process.dispatchOnAreaListen(t[1],i,e)}else if(23===i)this.areas[t[1]].status=u.NOT_IN,this.process.dispatchOnRemoveAreaListen(t[1],t[2]),this.processManager.removeAreaSystems(t[1]);else if(28===i)this.messageQueue.addRemote(t[1],t[2],t[3],t[4]);else if(29===i)this.messageQueue.instantDispatch({type:t[1],data:t[2],to:t[3],from:t[4]},!0);else if(27===i){const e=t[1];t[2];e===d.StateProtocol.SET?this.setState(t[1],t[2]):e===d.StateProtocol.PATCH&&this.patch(t[1],t[2])}else 114===i?this.handlePeerConnectionRequest(t[1],t[2],t[3],t[4]):112===i?(console.warn("Connector, GOT SIGNAL SUCCESS FROM PLAYER",t[1],"the signalData was",t[2]),this.peerConnections[t[1]]&&this.peerConnections[t[1]].checkAck(),this.handleSignalData(t[1],t[2])):109===i?this.messageQueue.dispatchPeerMessage(t[1],t[2],t[3],t[4],t[5]):113===i&&this.handlePeerFailure(t[1])}setState(e,t){const i=h.decode(t);this.areas[e].state.set(i),this._previousState=new Uint8Array(t),this.onStateChange.dispatch(i)}patch(t,i){const n=this.areas[t];n._previousState=e.from(a.apply(n._previousState,i)),n.state.set(h.decode(n._previousState)),this.onStateChange.dispatch(n.state)}buildEndPoint(e,t={},i){if("ws:"!==i&&"wss:"!==i&&"ws"!==i&&"wss"!==i)throw new Error("websocket protocol must be ws or wss");"ws"!==i&&"wss"!==i||(i+=":");const n=[`gottiId=${this.gottiId}`];for(const e in t)t.hasOwnProperty(e)&&n.push(`${e}=${t[e]}`);return`${i}//${e}/?${n.join("&")}`}handlePeerFailure(e,t,i){const n=this.peerConnections[e];n?n.onConnected.removeAll():console.error(`Peer failure for peerIndex ${e} did not have a correlated peer connection.`),this.pendingPeerRequests[e]&&(i=i||!0,this.pendingPeerRequests[e](i,null),delete this.pendingPeerRequests[e]),this.peerAckRequestTimeouts[e]&&(clearTimeout(this.peerAckRequestTimeouts[e]),delete this.peerAckRequestTimeouts[e]),this.peerConnectedRequestTimeouts[e]&&(clearTimeout(this.peerConnectedRequestTimeouts[e]),delete this.peerConnectedRequestTimeouts[e]);const s=this.connectedPeerIndexes.indexOf(e);s>-1&&(this.connectedPeerIndexes.splice(s,1),this.process&&(this.process.peers=this.connectedPeerIndexes,this.process.onPeerDisconnection(e,t))),delete this.peerConnections[e],n.destroy()}setupPeerConnection(e,t){e.onConnected.add(e=>{this.connectedPeerIndexes.includes(t)||(this.pendingPeerRequests[t]&&this.pendingPeerRequests[t](null,e),this.peerAckRequestTimeouts[t]&&(clearTimeout(this.peerAckRequestTimeouts[t]),delete this.peerAckRequestTimeouts[t]),this.peerConnectedRequestTimeouts[t]&&(clearTimeout(this.peerConnectedRequestTimeouts[t]),delete this.peerConnectedRequestTimeouts[t]),this.connectedPeerIndexes.push(t),this.process.peers=this.connectedPeerIndexes,this.process.onPeerConnection(t,e))}),e.onDisconnected.add(e=>{this.handlePeerFailure(t,e)}),e.onMessage.add(e=>{this.messageQueue.dispatchPeerMessage(t,e[0],e[1],e[2],e[3])}),e.onMissedPing.add(e=>{this.process.onPeerMissedPing(t,e)})}}}).call(this,i(62).Buffer)},function(e,t,i){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=i(63),s=i(64),r=i(65);function o(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,i){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return l(this,e,t,i)}function l(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=u(e,t);return e}(e,t,i,n):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!h.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(t,i),s=(e=a(e,n)).write(t,i);s!==n&&(e=e.slice(0,s));return e}(e,t,i):function(e,t){if(h.isBuffer(t)){var i=0|p(t.length);return 0===(e=a(e,i)).length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):u(e,t);if("Buffer"===t.type&&r(t.data))return u(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t){if(d(t),e=a(e,t<0?0:0|p(t)),!h.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function u(e,t){var i=t.length<0?0:0|p(t.length);e=a(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function f(e,t){if(h.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return H(e).length;default:if(n)return U(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,i);case"utf8":case"utf-8":return E(this,t,i);case"ascii":return k(this,t,i);case"latin1":case"binary":return P(this,t,i);case"base64":return x(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function y(e,t,i,n,s){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof t&&(t=h.from(t,n)),h.isBuffer(t))return 0===t.length?-1:v(e,t,i,n,s);if("number"==typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):v(e,[t],i,n,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,i,n,s){var r,o=1,a=e.length,h=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,h/=2,i/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){var d=-1;for(r=i;r<a;r++)if(l(e,r)===l(t,-1===d?0:r-d)){if(-1===d&&(d=r),r-d+1===h)return d*o}else-1!==d&&(r-=r-d),d=-1}else for(i+h>a&&(i=a-h),r=i;r>=0;r--){for(var c=!0,u=0;u<h;u++)if(l(e,r+u)!==l(t,u)){c=!1;break}if(c)return r}return-1}function C(e,t,i,n){i=Number(i)||0;var s=e.length-i;n?(n=Number(n))>s&&(n=s):n=s;var r=t.length;if(r%2!=0)throw new TypeError("Invalid hex string");n>r/2&&(n=r/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[i+o]=a}return o}function S(e,t,i,n){return $(U(t,e.length-i),e,i,n)}function w(e,t,i,n){return $(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function b(e,t,i,n){return w(e,t,i,n)}function T(e,t,i,n){return $(H(t),e,i,n)}function _(e,t,i,n){return $(function(e,t){for(var i,n,s,r=[],o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),n=i>>8,s=i%256,r.push(s),r.push(n);return r}(t,e.length-i),e,i,n)}function x(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function E(e,t,i){i=Math.min(e.length,i);for(var n=[],s=t;s<i;){var r,o,a,h,l=e[s],d=null,c=l>239?4:l>223?3:l>191?2:1;if(s+c<=i)switch(c){case 1:l<128&&(d=l);break;case 2:128==(192&(r=e[s+1]))&&(h=(31&l)<<6|63&r)>127&&(d=h);break;case 3:r=e[s+1],o=e[s+2],128==(192&r)&&128==(192&o)&&(h=(15&l)<<12|(63&r)<<6|63&o)>2047&&(h<55296||h>57343)&&(d=h);break;case 4:r=e[s+1],o=e[s+2],a=e[s+3],128==(192&r)&&128==(192&o)&&128==(192&a)&&(h=(15&l)<<18|(63&r)<<12|(63&o)<<6|63&a)>65535&&h<1114112&&(d=h)}null===d?(d=65533,c=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),s+=c}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var i="",n=0;for(;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=A));return i}(n)}t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,i){return l(null,e,t,i)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,i){return function(e,t,i,n){return d(t),t<=0?a(e,t):void 0!==i?"string"==typeof n?a(e,t).fill(i,n):a(e,t).fill(i):a(e,t)}(null,e,t,i)},h.allocUnsafe=function(e){return c(null,e)},h.allocUnsafeSlow=function(e){return c(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,s=0,r=Math.min(i,n);s<r;++s)if(e[s]!==t[s]){i=e[s],n=t[s];break}return i<n?-1:n<i?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!r(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=h.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){var o=e[i];if(!h.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,s),s+=o.length}return n},h.byteLength=f,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):m.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,i,n,s){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||i>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=i)return 0;if(n>=s)return-1;if(t>=i)return 1;if(this===e)return 0;for(var r=(s>>>=0)-(n>>>=0),o=(i>>>=0)-(t>>>=0),a=Math.min(r,o),l=this.slice(n,s),d=e.slice(t,i),c=0;c<a;++c)if(l[c]!==d[c]){r=l[c],o=d[c];break}return r<o?-1:o<r?1:0},h.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},h.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},h.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},h.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var s=this.length-t;if((void 0===i||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return C(this,e,t,i);case"utf8":case"utf-8":return S(this,e,t,i);case"ascii":return w(this,e,t,i);case"latin1":case"binary":return b(this,e,t,i);case"base64":return T(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,i);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function k(e,t,i){var n="";i=Math.min(e.length,i);for(var s=t;s<i;++s)n+=String.fromCharCode(127&e[s]);return n}function P(e,t,i){var n="";i=Math.min(e.length,i);for(var s=t;s<i;++s)n+=String.fromCharCode(e[s]);return n}function I(e,t,i){var n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var s="",r=t;r<i;++r)s+=G(e[r]);return s}function M(e,t,i){for(var n=e.slice(t,i),s="",r=0;r<n.length;r+=2)s+=String.fromCharCode(n[r]+256*n[r+1]);return s}function R(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,i,n,s,r){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<r)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function L(e,t,i,n){t<0&&(t=65535+t+1);for(var s=0,r=Math.min(e.length-i,2);s<r;++s)e[i+s]=(t&255<<8*(n?s:1-s))>>>8*(n?s:1-s)}function D(e,t,i,n){t<0&&(t=4294967295+t+1);for(var s=0,r=Math.min(e.length-i,4);s<r;++s)e[i+s]=t>>>8*(n?s:3-s)&255}function N(e,t,i,n,s,r){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function B(e,t,i,n,r){return r||N(e,0,i,4),s.write(e,t,i,n,23,4),i+4}function j(e,t,i,n,r){return r||N(e,0,i,8),s.write(e,t,i,n,52,8),i+8}h.prototype.slice=function(e,t){var i,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=h.prototype;else{var s=t-e;i=new h(s,void 0);for(var r=0;r<s;++r)i[r]=this[r+e]}return i},h.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var n=this[e],s=1,r=0;++r<t&&(s*=256);)n+=this[e+r]*s;return n},h.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n},h.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var n=this[e],s=1,r=0;++r<t&&(s*=256);)n+=this[e+r]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},h.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var n=t,s=1,r=this[e+--n];n>0&&(s*=256);)r+=this[e+--n]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*t)),r},h.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),s.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),s.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),s.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),s.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,i,n){(e=+e,t|=0,i|=0,n)||O(this,e,t,i,Math.pow(2,8*i)-1,0);var s=1,r=0;for(this[t]=255&e;++r<i&&(s*=256);)this[t+r]=e/s&255;return t+i},h.prototype.writeUIntBE=function(e,t,i,n){(e=+e,t|=0,i|=0,n)||O(this,e,t,i,Math.pow(2,8*i)-1,0);var s=i-1,r=1;for(this[t+s]=255&e;--s>=0&&(r*=256);)this[t+s]=e/r&255;return t+i},h.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t|=0,!n){var s=Math.pow(2,8*i-1);O(this,e,t,i,s-1,-s)}var r=0,o=1,a=0;for(this[t]=255&e;++r<i&&(o*=256);)e<0&&0===a&&0!==this[t+r-1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+i},h.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t|=0,!n){var s=Math.pow(2,8*i-1);O(this,e,t,i,s-1,-s)}var r=i-1,o=1,a=0;for(this[t+r]=255&e;--r>=0&&(o*=256);)e<0&&0===a&&0!==this[t+r+1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+i},h.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,i){return B(this,e,t,!0,i)},h.prototype.writeFloatBE=function(e,t,i){return B(this,e,t,!1,i)},h.prototype.writeDoubleLE=function(e,t,i){return j(this,e,t,!0,i)},h.prototype.writeDoubleBE=function(e,t,i){return j(this,e,t,!1,i)},h.prototype.copy=function(e,t,i,n){if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var s,r=n-i;if(this===e&&i<t&&t<n)for(s=r-1;s>=0;--s)e[s+t]=this[s+i];else if(r<1e3||!h.TYPED_ARRAY_SUPPORT)for(s=0;s<r;++s)e[s+t]=this[s+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+r),t);return r},h.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var r;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(r=t;r<i;++r)this[r]=e;else{var o=h.isBuffer(e)?e:U(new h(e,n).toString()),a=o.length;for(r=0;r<i-t;++r)this[r+t]=o[r%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var i;t=t||1/0;for(var n=e.length,s=null,r=[],o=0;o<n;++o){if((i=e.charCodeAt(o))>55295&&i<57344){if(!s){if(i>56319){(t-=3)>-1&&r.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&r.push(239,191,189);continue}s=i;continue}if(i<56320){(t-=3)>-1&&r.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(t-=3)>-1&&r.push(239,191,189);if(s=null,i<128){if((t-=1)<0)break;r.push(i)}else if(i<2048){if((t-=2)<0)break;r.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;r.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return r}function H(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,i,n){for(var s=0;s<n&&!(s+i>=t.length||s>=e.length);++s)t[s+i]=e[s];return s}}).call(this,i(10))},function(e,t,i){"use strict";t.byteLength=function(e){var t=l(e),i=t[0],n=t[1];return 3*(i+n)/4-n},t.toByteArray=function(e){var t,i,n=l(e),o=n[0],a=n[1],h=new r(function(e,t,i){return 3*(t+i)/4-i}(0,o,a)),d=0,c=a>0?o-4:o;for(i=0;i<c;i+=4)t=s[e.charCodeAt(i)]<<18|s[e.charCodeAt(i+1)]<<12|s[e.charCodeAt(i+2)]<<6|s[e.charCodeAt(i+3)],h[d++]=t>>16&255,h[d++]=t>>8&255,h[d++]=255&t;2===a&&(t=s[e.charCodeAt(i)]<<2|s[e.charCodeAt(i+1)]>>4,h[d++]=255&t);1===a&&(t=s[e.charCodeAt(i)]<<10|s[e.charCodeAt(i+1)]<<4|s[e.charCodeAt(i+2)]>>2,h[d++]=t>>8&255,h[d++]=255&t);return h},t.fromByteArray=function(e){for(var t,i=e.length,s=i%3,r=[],o=0,a=i-s;o<a;o+=16383)r.push(d(e,o,o+16383>a?a:o+16383));1===s?(t=e[i-1],r.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[i-2]<<8)+e[i-1],r.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return r.join("")};for(var n=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,h=o.length;a<h;++a)n[a]=o[a],s[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function d(e,t,i){for(var s,r,o=[],a=t;a<i;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(r=s)>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,n,s){var r,o,a=8*s-n-1,h=(1<<a)-1,l=h>>1,d=-7,c=i?s-1:0,u=i?-1:1,p=e[t+c];for(c+=u,r=p&(1<<-d)-1,p>>=-d,d+=a;d>0;r=256*r+e[t+c],c+=u,d-=8);for(o=r&(1<<-d)-1,r>>=-d,d+=n;d>0;o=256*o+e[t+c],c+=u,d-=8);if(0===r)r=1-l;else{if(r===h)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),r-=l}return(p?-1:1)*o*Math.pow(2,r-n)},t.write=function(e,t,i,n,s,r){var o,a,h,l=8*r-s-1,d=(1<<l)-1,c=d>>1,u=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:r-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),(t+=o+c>=1?u/h:u*Math.pow(2,1-c))*h>=2&&(o++,h/=2),o+c>=d?(a=0,o=d):o+c>=1?(a=(t*h-1)*Math.pow(2,s),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,s),o=0));s>=8;e[i+p]=255&a,p+=f,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[i+p]=255&o,p+=f,o/=256,l-=8);e[i+p-f]|=128*m}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";var n=function(){function e(e){void 0===e&&(e=!1),this.running=!1,this.now="undefined"!=typeof window&&window.performance&&window.performance.now&&window.performance.now.bind(window.performance)||Date.now,this.start(e)}return e.prototype.start=function(e){void 0===e&&(e=!1),this.deltaTime=0,this.currentTime=this.now(),this.elapsedTime=0,this.running=!0,e&&(this._interval=setInterval(this.tick.bind(this),1e3/60))},e.prototype.stop=function(){this.running=!1,this._interval&&clearInterval(this._interval)},e.prototype.tick=function(e){void 0===e&&(e=this.now()),this.deltaTime=e-this.currentTime,this.currentTime=e,this.elapsedTime+=this.deltaTime},e}();e.exports=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(68);t.StateContainer=n.StateContainer},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(69),s=function(){function e(e){this.listeners=[],this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/},this.state=e,this.reset()}return e.prototype.set=function(e){var t=n.compare(this.state,e);return this.state=e,this.checkPatches(t,this.listeners,this.defaultListener),t},e.prototype.registerPlaceholder=function(e,t){this.matcherPlaceholders[e]=t},e.prototype.listen=function(e,t,i){var s,r=this;"function"==typeof e?(s=[],t=e):s=e.split("/"),t.length>1&&console.warn(".listen() accepts only one parameter.");var o={callback:t,rawRules:s,rules:s.map((function(e){return"string"==typeof e?0===e.indexOf(":")?r.matcherPlaceholders[e]||r.matcherPlaceholders[":*"]:new RegExp("^"+e+"$"):e}))};return 0===s.length?this.defaultListener=o:this.listeners.push(o),i&&this.checkPatches(n.compare({},this.state),[o]),o},e.prototype.removeListener=function(e){for(var t=this.listeners.length-1;t>=0;t--)this.listeners[t]===e&&this.listeners.splice(t,1)},e.prototype.removeAllListeners=function(){this.reset()},e.prototype.checkPatches=function(e,t,i){for(var n=0,s=t.length;n<s;n++)for(var r=t[n],o=e.length-1;o>=0;o--){var a=r&&this.getPathVariables(e[o],r);a&&(r.callback({path:a,rawPath:e[o].path,operation:e[o].operation,value:e[o].value}),e[o].matched=!0)}if(i)for(o=e.length-1;o>=0;o--)e[o].matched||i.callback(e[o])},e.prototype.getPathVariables=function(e,t){if(e.path.length!==t.rules.length)return!1;for(var i={},n=0,s=t.rules.length;n<s;n++){var r=e.path[n].match(t.rules[n]);if(!r||0===r.length||r.length>2)return!1;":"===t.rawRules[n].substr(0,1)&&(i[t.rawRules[n].substr(1)]=r[1])}return i},e.prototype.reset=function(){this.listeners=[]},e}();t.StateContainer=s},function(e,t,i){"use strict";function n(e,t){var i=e.slice();return i.push(t),i}function s(e){if(Array.isArray(e)){for(var t=new Array(e.length),i=0;i<t.length;i++)t[i]=""+i;return t}if(Object.keys)return Object.keys(e);var n=[];for(var s in e)e.hasOwnProperty(s)&&n.push(s);return n}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=function(e,t){var i=[];return function e(t,i,r,o){for(var a=s(i),h=s(t),l=!1,d=h.length-1;d>=0;d--){var c=h[d],u=t[c];if(!i.hasOwnProperty(c)||void 0===i[c]&&void 0!==u&&!1===Array.isArray(i))r.push({operation:"remove",path:n(o,c)}),l=!0;else{var p=i[c];"object"==typeof u&&null!=u&&"object"==typeof p&&null!=p?e(u,p,r,n(o,c)):u!==p&&r.push({operation:"replace",path:n(o,c),value:p,previousValue:u})}}if(!l&&a.length==h.length)return;for(d=a.length-1;d>=0;d--){c=a[d];if(!t.hasOwnProperty(c)&&void 0!==i[c]){p=i[c];var f=n(o,c);"object"==typeof p&&null!=p&&e({},p,r,f),r.push({operation:"add",path:f,value:p})}}}(e,t,i,[]),i}},function(e,t,i){var n,s;n=this,s=function(){"use strict";var e={},t=16;function i(){this.a=0,this.b=0,this.i=0,this.z=new Array(t)}i.prototype.init=function(e,i){var n,s,r=0,o=0;for(n=0;n<t;n++)r=r+(s=e[i+n])&65535,o=o+(t-n)*s&65535,this.z[n]=s;this.a=65535&r,this.b=65535&o,this.i=0},i.prototype.next=function(e){var i=this.z[this.i];this.z[this.i]=e,this.i=this.i+1&t-1,this.a=this.a-i+e&65535,this.b=this.b-t*i+this.a&65535},i.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map((function(e){return e.charCodeAt(0)})),s=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];function r(e){this.a=e,this.pos=0}function o(){this.a=[]}function a(e){var t,i;for(t=1,i=64;e>=i;t++,i<<=6);return t}function h(e){for(var t=0,i=0,n=0,s=0,r=0,o=e.length;o>=16;)t=t+e[r+0]|0,i=i+e[r+1]|0,n=n+e[r+2]|0,s=s+e[r+3]|0,t=t+e[r+4]|0,i=i+e[r+5]|0,n=n+e[r+6]|0,s=s+e[r+7]|0,t=t+e[r+8]|0,i=i+e[r+9]|0,n=n+e[r+10]|0,s=s+e[r+11]|0,t=t+e[r+12]|0,i=i+e[r+13]|0,n=n+e[r+14]|0,s=s+e[r+15]|0,r+=16,o-=16;for(;o>=4;)t=t+e[r+0]|0,i=i+e[r+1]|0,n=n+e[r+2]|0,s=s+e[r+3]|0,r+=4,o-=4;switch(s=((s+(n<<8)|0)+(i<<16)|0)+(t<<24)|0,o){case 3:s=s+(e[r+2]<<8)|0;case 2:s=s+(e[r+1]<<16)|0;case 1:s=s+(e[r+0]<<24)|0}return s>>>0}return r.prototype.haveBytes=function(){return this.pos<this.a.length},r.prototype.getByte=function(){var e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e},r.prototype.getChar=function(){return String.fromCharCode(this.getByte())},r.prototype.getInt=function(){for(var e,t=0;this.haveBytes()&&(e=s[127&this.getByte()])>=0;)t=(t<<6)+e;return this.pos--,t>>>0},o.prototype.toArray=function(){return this.a},o.prototype.putByte=function(e){this.a.push(255&e)},o.prototype.putChar=function(e){this.putByte(e.charCodeAt(0))},o.prototype.putInt=function(e){var t,i,s=[];if(0!==e){for(t=0;e>0;t++,e>>>=6)s.push(n[63&e]);for(i=t-1;i>=0;i--)this.putByte(s[i])}else this.putChar("0")},o.prototype.putArray=function(e,t,i){for(var n=t;n<i;n++)this.a.push(e[n])},e.create=function(e,n){var s,r=new o,l=n.length,d=e.length,c=-1;if(r.putInt(l),r.putChar("\n"),d<=t)return r.putInt(l),r.putChar(":"),r.putArray(n,0,l),r.putInt(h(n)),r.putChar(";"),r.toArray();var u=Math.ceil(d/t),p=new Array(u),f=new Array(u);for(s=0;s<p.length;s++)p[s]=-1;for(s=0;s<f.length;s++)f[s]=-1;var m,g=new i;for(s=0;s<d-t;s+=t)g.init(e,s),m=g.value()%u,p[s/t]=f[m],f[m]=s/t;for(var y,v,C,S,w,b=0;b+t<l;)for(S=0,w=0,g.init(n,b),s=0,C=0;;){var T=250;for(v=f[m=g.value()%u];v>=0&&T-- >0;){var _,x,E,A,k,P,I;for(A=0,P=y=v*t,I=b+s;P<d&&I<l&&e[P]===n[I];A++,P++,I++);for(A--,k=1;k<y&&k<=s&&e[y-k]===n[b+s-k];k++);x=y- --k,E=s-k,(_=A+k+1)>=a(s-k)+a(_)+a(x)+3&&_>C&&(C=_,S=y-k,w=E),v=p[v]}if(C>0){w>0&&(r.putInt(w),r.putChar(":"),r.putArray(n,b,b+w),b+=w),b+=C,r.putInt(C),r.putChar("@"),r.putInt(S),r.putChar(","),S+C-1>c&&(c=S+C-1),C=0;break}if(b+s+t>=l){r.putInt(l-b),r.putChar(":"),r.putArray(n,b,b+l-b),b=l;break}g.next(n[b+s+t]),s++}return b<l&&(r.putInt(l-b),r.putChar(":"),r.putArray(n,b,b+l-b)),r.putInt(h(n)),r.putChar(";"),r.toArray()},e.outputSize=function(e){var t=new r(e),i=t.getInt();if("\n"!==t.getChar())throw new Error("size integer not terminated by '\\n'");return i},e.apply=function(e,t,i){var n,s=0,a=new r(t),l=e.length,d=t.length;if(n=a.getInt(),"\n"!==a.getChar())throw new Error("size integer not terminated by '\\n'");for(var c=new o;a.haveBytes();){var u,p;switch(u=a.getInt(),a.getChar()){case"@":if(p=a.getInt(),a.haveBytes()&&","!==a.getChar())throw new Error("copy command not terminated by ','");if((s+=u)>n)throw new Error("copy exceeds output file size");if(p+u>l)throw new Error("copy extends past end of input");c.putArray(e,p,p+u);break;case":":if((s+=u)>n)throw new Error("insert command gives an output larger than predicted");if(u>d)throw new Error("insert count exceeds size of delta");c.putArray(a.a,a.pos,a.pos+u),a.pos+=u;break;case";":var f=c.toArray();if((!i||!1!==i.verifyChecksum)&&u!==h(f))throw new Error("bad checksum");if(s!==n)throw new Error("generated size does not match predicted size");return f;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},e},e.exports?e.exports=s():n.fossilDelta=s()},function(e,t,i){"use strict";function n(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}n.prototype._array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this._parse();return t},n.prototype._map=function(e){for(var t={},i=0;i<e;i++)t[this._parse()]=this._parse();return t},n.prototype._str=function(e){var t=function(e,t,i){for(var n="",s=0,r=t,o=t+i;r<o;r++){var a=e.getUint8(r);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(s=(7&a)<<18|(63&e.getUint8(++r))<<12|(63&e.getUint8(++r))<<6|(63&e.getUint8(++r))<<0)>=65536?(s-=65536,n+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):n+=String.fromCharCode(s)}else n+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++r))<<6|(63&e.getUint8(++r))<<0);else n+=String.fromCharCode((31&a)<<6|63&e.getUint8(++r));else n+=String.fromCharCode(a)}return n}(this._view,this._offset,e);return this._offset+=e,t},n.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},n.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),i=0,n=0,s=0,r=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,[n,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(i)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return s=this._view.getUint32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,s+r;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return s=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,s+r;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(s=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(s+r)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},e.exports=function(e){var t=new n(e),i=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return i}},function(e,t,i){"use strict";function n(e,t,i){for(var n=0,s=0,r=i.length;s<r;s++)(n=i.charCodeAt(s))<128?e.setUint8(t++,n):n<2048?(e.setUint8(t++,192|n>>6),e.setUint8(t++,128|63&n)):n<55296||n>=57344?(e.setUint8(t++,224|n>>12),e.setUint8(t++,128|n>>6&63),e.setUint8(t++,128|63&n)):(s++,n=65536+((1023&n)<<10|1023&i.charCodeAt(s)),e.setUint8(t++,240|n>>18),e.setUint8(t++,128|n>>12&63),e.setUint8(t++,128|n>>6&63),e.setUint8(t++,128|63&n))}e.exports=function(e){var t=[],i=[],s=function e(t,i,n){var s=typeof n,r=0,o=0,a=0,h=0,l=0,d=0;if("string"===s){if((l=function(e){for(var t=0,i=0,n=0,s=e.length;n<s;n++)(t=e.charCodeAt(n))<128?i+=1:t<2048?i+=2:t<55296||t>=57344?i+=3:(n++,i+=4);return i}(n))<32)t.push(160|l),d=1;else if(l<256)t.push(217,l),d=2;else if(l<65536)t.push(218,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("String too long");t.push(219,l>>24,l>>16,l>>8,l),d=5}return i.push({_str:n,_length:l,_offset:t.length}),d+l}if("number"===s)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(t.push(n),1):n<256?(t.push(204,n),2):n<65536?(t.push(205,n>>8,n),3):n<4294967296?(t.push(206,n>>24,n>>16,n>>8,n),5):(a=n/Math.pow(2,32)>>0,h=n>>>0,t.push(207,a>>24,a>>16,a>>8,a,h>>24,h>>16,h>>8,h),9):n>=-32?(t.push(n),1):n>=-128?(t.push(208,n),2):n>=-32768?(t.push(209,n>>8,n),3):n>=-2147483648?(t.push(210,n>>24,n>>16,n>>8,n),5):(a=Math.floor(n/Math.pow(2,32)),h=n>>>0,t.push(211,a>>24,a>>16,a>>8,a,h>>24,h>>16,h>>8,h),9):(t.push(203),i.push({_float:n,_length:8,_offset:t.length}),9);if("object"===s){if(null===n)return t.push(192),1;if(Array.isArray(n)){if((l=n.length)<16)t.push(144|l),d=1;else if(l<65536)t.push(220,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Array too large");t.push(221,l>>24,l>>16,l>>8,l),d=5}for(r=0;r<l;r++)d+=e(t,i,n[r]);return d}if(n instanceof Date){var c=n.getTime();return a=Math.floor(c/Math.pow(2,32)),h=c>>>0,t.push(215,0,a>>24,a>>16,a>>8,a,h>>24,h>>16,h>>8,h),10}if(n instanceof ArrayBuffer){if((l=n.byteLength)<256)t.push(196,l),d=2;else if(l<65536)t.push(197,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Buffer too large");t.push(198,l>>24,l>>16,l>>8,l),d=5}return i.push({_bin:n,_length:l,_offset:t.length}),d+l}if("function"==typeof n.toJSON)return e(t,i,n.toJSON());var u=[],p="",f=Object.keys(n);for(r=0,o=f.length;r<o;r++)"function"!=typeof n[p=f[r]]&&u.push(p);if((l=u.length)<16)t.push(128|l),d=1;else if(l<65536)t.push(222,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Object too large");t.push(223,l>>24,l>>16,l>>8,l),d=5}for(r=0;r<l;r++)d+=e(t,i,p=u[r]),d+=e(t,i,n[p]);return d}if("boolean"===s)return t.push(n?195:194),1;if("undefined"===s)return t.push(212,0,0),3;throw new Error("Could not encode")}(t,i,e),r=new ArrayBuffer(s),o=new DataView(r),a=0,h=0,l=-1;i.length>0&&(l=i[0]._offset);for(var d,c=0,u=0,p=0,f=t.length;p<f;p++)if(o.setUint8(h+p,t[p]),p+1===l){if(c=(d=i[a])._length,u=h+l,d._bin)for(var m=new Uint8Array(d._bin),g=0;g<c;g++)o.setUint8(u+g,m[g]);else d._str?n(o,u,d._str):void 0!==d._float&&o.setFloat64(u,d._float);h+=c,i[++a]&&(l=i[a]._offset)}return r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(74),s=i(20);class r extends n.default{constructor(e,t=!0){super(e,void 0,{connect:t}),this._enqueuedCalls=[]}onOpenCallback(e){if(super.onOpenCallback(),this.binaryType="arraybuffer",this._enqueuedCalls.length>0){for(const[e,t]of this._enqueuedCalls)this[e].apply(this,t);this._enqueuedCalls=[]}}send(e){if(this.ws.readyState===n.default.OPEN)return super.send(s.encode(e));this._enqueuedCalls.push(["send",[e]])}}t.Connection=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var s=i(75).createBackoff,r="undefined"!=typeof WebSocket?WebSocket:i(76),o=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.protocols=i,this.reconnectEnabled=!0,this.listeners={},this.backoff=s(n.backoff||"exponential",n),this.backoff.onReady=this.onBackoffReady.bind(this),(void 0===n.connect||n.connect)&&this.open()}return n(e,[{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isReconnect=e;var t=this.ws&&this.ws.binaryType;this.ws=new r(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),t&&(this.ws.binaryType=t)}},{key:"onBackoffReady",value:function(e,t){this.open(!0)}},{key:"onCloseCallback",value:function(e){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&e.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}},{key:"onMessageCallback",value:function(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}},{key:"onOpenCallback",value:function(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}},{key:"close",value:function(e,t){void 0===e&&(e=1e3),this.reconnectEnabled=!1,this.ws.close(e,t)}},{key:"send",value:function(e){this.ws.send(e)}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e}},{key:"extensions",get:function(){return this.ws.extensions},set:function(e){this.ws.extensions=e}},{key:"protocol",get:function(){return this.ws.protocol},set:function(e){this.ws.protocol=e}},{key:"onclose",set:function(e){this.listeners.onclose=e},get:function(){return this.listeners.onclose}},{key:"onerror",set:function(e){this.listeners.onerror=e},get:function(){return this.listeners.onerror}},{key:"onmessage",set:function(e){this.listeners.onmessage=e},get:function(){return this.listeners.onmessage}},{key:"onopen",set:function(e){this.listeners.onopen=e},get:function(){return this.listeners.onopen}},{key:"onreconnect",set:function(e){this.listeners.onreconnect=e},get:function(){return this.listeners.onreconnect}}]),e}();o.CONNECTING=r.CONNECTING,o.OPEN=r.OPEN,o.CLOSING=r.CLOSING,o.CLOSED=r.CLOSED,t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBackoff=function(e,t){return new s(n[e],t)};var n={exponential:function(e,t){return Math.floor(Math.random()*Math.pow(2,e)*t)},fibonacci:function(e,t){if(e>(n=1))for(var i=1,n=2,s=2;s<e;s++){var r=i+n;i=n,n=r}return Math.floor(Math.random()*n*t)}};function s(e,t){this.func=e,this.attempts=0,this.delay=void 0!==t.initialDelay?t.initialDelay:100}s.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(19),s=i(20),r=i(18);var o;"undefined"!=typeof window&&Promise.resolve().then(()=>i(163)),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP"}(o=t.SocketType||(t.SocketType={}));const a={iceServers:[{urls:["stun:stun.l.google.com:19302"]}],socketType:o.UDP,timeout:3e3,retries:3,retryTimeout:1e3};t.PeerConnection=class{constructor(e,t,i,n){this.config=a,this.queuedIceCandidates=[],this.last5Pings=[],this.pingInterval=null,this.onAck=new r.Signal,this.onConnected=new r.Signal,this.onDisconnected=new r.Signal,this.onMessage=new r.Signal,this.onMissedPing=new r.Signal,this.connected=!1,this.ping=0,this.remoteDescriptionSet=!1,this.missedPings=0,this.seq=0,this.gotAck=!1,this.peerPlayerIndex=i,this.clientPlayerIndex=t,n&&Object.keys(n).forEach(e=>{this.config.hasOwnProperty(e)&&(this.config[e]=n[e])}),this.channelId=[i,t].sort().join("-"),console.warn("the channel id was",this.channelId),this.connection=e}onDataChannelOpen(){this.connected||(console.warn("onDataChannelOpen"),this.connected=!0,this.pingInterval||this.startPinging(),this.onConnected.dispatch())}setupDataChannel(){console.warn("setupDataChannel"),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=this.onDataChannelOpen.bind(this),this.dataChannel.onclose=this.onConnectionClose.bind(this),this.dataChannel.onmessage=this.onPeerMessage.bind(this)}applyQueuedIceCandidates(){for(let e=0;e<this.queuedIceCandidates.length;e++)this.peerConnection.addIceCandidate(new RTCIceCandidate(this.queuedIceCandidates[e]));this.queuedIceCandidates.length=0}checkAck(){this.gotAck||(this.onAck.dispatch(!0),this.gotAck=!0)}handleSDPSignal(e){this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)).then(()=>{console.warn("GOT SDP SIGNAL"),"offer"===this.peerConnection.remoteDescription.type&&(console.warn("handleSDPSignal creating answer in handleSDPSignal"),this.peerConnection.createAnswer().then(e=>{this.handleLocalDescription(e)})),this.remoteDescriptionSet=!0,this.applyQueuedIceCandidates()})}handleIceCandidateSignal(e){this.remoteDescriptionSet?(console.warn("applying ice candidate cuz we rdy"),this.peerConnection.addIceCandidate(new RTCIceCandidate(e))):(console.warn("received ice candidate but adding to queue"),this.queuedIceCandidates.push(e))}handleLocalDescription(e){this.peerConnection.setLocalDescription(e).then(()=>{console.warn("handleLocalDescription sending local description"),this.connection.send([111,this.peerPlayerIndex,{sdp:this.peerConnection.localDescription}])}).catch(e=>{console.error(e)})}handleInitialLocalDescription(e,t,i){this.peerConnection.setLocalDescription(e).then(()=>{console.warn("handleInitialLocalDescription sending initial local description which was",this.peerConnection.localDescription,"the request options was",i),this.connection.send([114,this.peerPlayerIndex,{sdp:this.peerConnection.localDescription},t,i])}).catch(e=>{console.error(e)})}logError(e){throw new Error(e)}onIceCandidate(e){const t=e.candidate;return null!==t&&(this.connection.send([111,this.peerPlayerIndex,{candidate:t}]),!0)}requestConnection(e,t){console.warn("requestConnection requesting connection from system:",e),this.initiator=!0;const i={iceServers:this.config.iceServers};this.peerConnection=new RTCPeerConnection(i),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate.bind(this)),this.peerConnection.onnegotiationneeded=()=>{console.warn("onnegotationneeded"),this.peerConnection.createOffer().then(i=>{this.handleInitialLocalDescription(i,e,t)}).catch(e=>{this.logError(e)})},this.dataChannel=this.peerConnection.createDataChannel(this.channelId,{ordered:this.config.socketType===o.TCP}),this.setupDataChannel()}acceptConnection(e){console.warn("acceptConnection requesting connection from system:"),this.initiator=!1,this.peerConnection=new RTCPeerConnection({iceServers:this.config.iceServers}),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate.bind(this)),this.peerConnection.ondatachannel=e=>{this.dataChannel=e.channel,this.setupDataChannel()}}onConnectionClose(){this.connected&&(this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),console.error("on connection close being fired :]"),this.connected=!1,this.onDisconnected.dispatch())}startPinging(){let e=this.seq;this.sentPingAt=Date.now(),this.send(s.encode([n.PEER_TO_PEER_PROTOCOLS.PING,this.seq])),this.pingInterval=setInterval(()=>{e!==this.seq-1?(this.missedPings++,this.seq=0,e=0,this.onMissedPing.dispatch(this.missedPings)):(this.missedPings=0,e++),this.sentPingAt=Date.now(),this.send(s.encode([n.PEER_TO_PEER_PROTOCOLS.PING,this.seq]))},this.config.timeout)}send(e){"open"===this.dataChannel.readyState&&this.dataChannel.send(e)}handlePong(e){let t=Date.now()-this.sentPingAt;if(e!==this.seq)throw new Error(`INVALID SEQUENCE ${e} SENT BACK WHEN WE EXPECTED ${this.seq}`);if(this.seq++,this.last5Pings.length>4)this.last5Pings[5]=this.last5Pings[4],this.last5Pings[4]=this.last5Pings[3],this.last5Pings[3]=this.last5Pings[2],this.last5Pings[2]=this.last5Pings[1],this.last5Pings[1]=this.last5Pings[0],this.last5Pings[0]=t,this.ping=(this.last5Pings[0]+this.last5Pings[1]+this.last5Pings[2]+this.last5Pings[3]+this.last5Pings[4])/5;else{this.last5Pings.push(t);const e=this.last5Pings.reduce((e,t)=>e+t,0);this.ping=e/this.last5Pings.length}}onPeerMessage(e){const t=s.decode(e.data);t.length<3?t[0]===n.PEER_TO_PEER_PROTOCOLS.PING?this.send(s.encode([n.PEER_TO_PEER_PROTOCOLS.PONG,t[1]])):t[0]===n.PEER_TO_PEER_PROTOCOLS.PONG&&this.handlePong(t[1]):this.onMessage.dispatch(t)}destroy(){this.peerConnection.close()}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3);PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;const r=i(79),o=i(80);r.use(o.default);const a=i(37),h=i(88),l={dynamicResolution:!0,maxView:{w:550,h:350}},d=i(106),c=i(107),u=i(108),p=i(109),f=i(110),m=i(119),g=i(120),y=i(122),v=i(125),C=i(126),S=i(127),w=i(129),b=i(130),T=i(131),_=i(132),x=i(133),E=i(134),A=i(138),k=i(139),P=i(143),I=i(0),M=i(6),R=i(144);t.default={isNetworked:!1,type:"island",systems:[T.GameStateSystem,C.InventorySystem,d.KeyboardInputSystem,v.LevelSystem,m.PlayerActionSystem,f.PlayerManagerSystem,c.PathfindingSystem,u.PlayerAnimationSystem,p.PlayerMovementSystem,g.TimerSystem,y.TreeSystem,b.NPCMovementSystem,S.ItemDropSystem,w.DialogueSystem,_.BugCatchSystem,x.BugMovementSystem,E.BugSpawnSystem,A.BeeKeepSystem,k.FlowerSystem,P.DigSystem],plugins:[],areas:[],globals(e,t,i){return n(this,void 0,void 0,(function*(){const e=new R.default({keyboard:{moveDown:["KeyS","ArrowDown"],moveUp:["KeyW","ArrowUp"],moveLeft:["KeyA","ArrowLeft"],moveRight:["KeyD","ArrowRight"],inventory:["KeyQ","KeyShift"],grab:["Space","KeyG","Enter"],cancel:["Backspace","Delete"],pause:["Escape"]},controller:{default:{buttons:{north:"inventory",east:"cancel",south:"grab",select:"inventory",start:"pause"},dpad:{south:"moveDown",west:"moveLeft",east:"moveRight",north:"moveUp"},sticks:{left:{moveLeft:{min:202.5,max:337.5},moveRight:{min:22.5,max:157.5},moveDown:{min:112.5,max:247.5},moveUp:[{min:292.5,max:360},{min:0,max:67.5}]},right:{moveLeft:{min:202.5,max:337.5},moveRight:{min:22.5,max:157.5},moveDown:{min:112.5,max:247.5},moveUp:[{min:292.5,max:360},{min:0,max:67.5}]}}}}});let t;I.default.emit("game-input",e);const i=document.getElementById("game-canvas");i.style.opacity="1";const o=()=>n(this,void 0,void 0,(function*(){return i.style.opacity=`${Math.min(parseFloat(i.style.opacity)+.01,1)}`,!(parseFloat(i.style.opacity)<1)||new Promise((e,t)=>{setTimeout(()=>e(o()),1e3/60)})}));const d=(e=.01)=>n(this,void 0,void 0,(function*(){return i.style.opacity=`${Math.max(parseFloat(i.style.opacity)-e,0)}`,!(parseFloat(i.style.opacity)>0)||new Promise((e,t)=>{setTimeout(()=>e(d()),1e3/60)})})),c=function(){const e=document.getElementById("game-canvas");if(!e)throw new Error("Could not find canvas element with css selector id game-canvas");const t=PIXI.autoDetectRenderer({antialias:!1,forceCanvas:!1,roundPixels:!1,autoResize:!1,view:e});"undefined"!=typeof CSS&&(CSS.supports("(image-rendering: pixelated)")?e.style.imageRendering="pixelated":CSS.supports("(image-rendering: crisp-edges)")?e.style.imageRendering="crisp-edges":CSS.supports("(image-rendering: -webkit-crisp-edges)")?e.style.imageRendering="-webkit-crisp-edges":CSS.supports("(image-rendering: -moz-crisp-edges)")&&(e.style.imageRendering="-moz-crisp-edges"));return t}(),u=yield r.init("Assets/ac",c,{resolutionSettings:l});yield u.loadMap("island"),setTimeout(()=>{I.default.emit("initial-map-load",!0)},200),u.resolutionManager.calculate();let p={x:984,y:1020,level:"island"};try{p=Object.assign(Object.assign({},u.getCollidersWithTags("start")[0].shapeData),{level:"island"})}catch(e){console.error(`Error trying to get the collider for starting spawn: ${e}`)}const f=M.getRandomNumber(900,1100),m={x:f,y:f};u.bindCameraCenter(m),u.update(1);const g=yield a.Gottimation.Init("Assets/acsnes",{lazyLoadTextures:!0,renderer:c,preloadAtlasDefaults:!0},u.loader),y=new h.GridPathFinder,v=yield O();y.create(16,64,64);const C=v.actextures.textures,S={background:C["inventory_background.png"],contextMenu:{background:C["context_menu_background.png"],selectedBackground:C["context_menu_selected_option_background.png"],pointer:C["context_menu_pointer.png"]},item:{emptyBackground:C["unselected_inventory_icon.png"],pointer:C["inventory_pointer.png"],selectedBackground:C["selected_inventory_icon.png"]}},w={honey:C["honey_icon.png"],dialogue:{npc:{nameLabel:C["dialogue_name_background.png"],diaglogueBackground:C["dialogue_background.png"],continueIndicator:C["dialogue_name_background.png"]},response:{background:C["context_menu_background.png"],selectedOptionBackground:C["context_menu_selected_option_background.png"],pointer:C["context_menu_pointer.png"]}},inventory:S,items:{icons:{hole:C["hole_dug_up.png"],tree:C["tree.png"],seeds1:C["item0_seeds1.png"],seeds2:C["item0_seeds2.png"],seeds3:C["item0_seeds3.png"],seeds4:C["item0_seeds4.png"],seeds5:C["item0_seeds5.png"],pedals1:C["pedal1.png"],pedals2:C["pedal2.png"],pedals3:C["pedal3.png"],pedals4:C["pedal4.png"],pedals5:C["pedal5.png"],flower1:C["pedal1.png"],flower2:C["pedal2.png"],flower3:C["pedal3.png"],flower4:C["pedal3.png"],flower5:C["pedal5.png"],beehive:C["beehive.png"],bee:C["bee.png"],red_bed:C["items5_bed1.png"],green_bed:C["items6_bed2.png"],blue_bed:C["items7_bed3.png"]},placed:{hole:C["hole_dug_up.png"],tree:C["tree.png"],seeds1:C["item0_seeds1.png"],seeds2:C["item0_seeds2.png"],seeds3:C["item0_seeds3.png"],seeds4:C["item0_seeds4.png"],seeds5:C["item0_seeds5.png"],pedals1:C["pedal1.png"],pedals2:C["pedal1.png"],pedals3:C["pedal1.png"],pedals4:C["pedal1.png"],pedals5:C["pedal1.png"],flower1:C["pedal1.png"],flower2:C["pedal2.png"],flower3:C["pedal3.png"],flower4:C["pedal3.png"],flower5:C["pedal5.png"],beehive:C["beehive.png"],bee:C["bee.png"],red_bed:C["placeable_bed1.png"],green_bed:C["placeable_bed2.png"],blue_bed:C["placeable_bed3.png"]}}};let b=!0,T=!0,_=0;const x=()=>{_=_||Date.now();const e=Date.now(),t=(e-_)/1e3;_=e,b?(m.x+=30*t,m.x>1600&&(b=!1)):(m.x-=30*t,m.x<350&&(b=!0)),T?(m.y+=30*t,m.x>1600&&(T=!1)):(m.y-=30*t,m.y<350&&(T=!0)),m.x=Math.round(m.x),m.y=Math.round(m.y),u.update(t),E=requestAnimationFrame(x)};let E=requestAnimationFrame(x);const A={startingSpawn:p};return I.default.emit("initial-map-load",A),new Promise((i,r)=>{I.default.once("player-enter",r=>n(this,void 0,void 0,(function*(){let n;return yield d(.005),cancelAnimationFrame(E),"main"!==(n=r.isNew?s.defaultGameData(r.data,A.startingSpawn):r.data).level&&(yield u.loadMap(n.level),u.bindCameraCenter(n.position),u.update(1)),i({gameInput:e,gameTextures:w,fadeIn:o,fadeOut:d,gameStateData:n,song:t,playerCharacter:"",spouseCharacter:"",renderer:c,gottimation:g,tileWorld:u,pathfinder:y})})))})}))}};const O=()=>n(void 0,void 0,void 0,(function*(){const e=PIXI.loader;return e.reset(),[{name:"ns-small",url:"Assets/fonts/ns-small.fnt"},{name:"stroke-small",url:"Assets/fonts/stroke-small.fnt"}].forEach(t=>{e.add(t.name,t.url)}),e.add("actextures","Assets/sprites/actextures.json"),new Promise((t,i)=>{e.load((e,i)=>t(i))})}))},function(e,t,i){window,e.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=12)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MASSIVE=0]="MASSIVE",e[e.LARGE=1]="LARGE",e[e.MEDIUM=2]="MEDIUM",e[e.SMALL=3]="SMALL"}(t.MapSizes||(t.MapSizes={})),function(e){e[e.RECT=0]="RECT",e[e.POLYGON=1]="POLYGON",e[e.POINT=2]="POINT",e[e.CIRCLE=3]="CIRCLE",e[e.LINE=4]="LINE",e[e.ELIPSE=5]="ELIPSE"}(t.RuntimeColliderShape||(t.RuntimeColliderShape={})),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(t.MapSize||(t.MapSize={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);function r(e){return btoa(new Uint8Array(e).reduce((e,t)=>e+String.fromCharCode(t),""))}function o(e){return n(this,void 0,void 0,(function*(){const t=window.URL||window.webkitURL;let i,n=!0;try{i=t.createObjectURL(e)}catch(t){n=!1;const s=r(e);i="data:image/png;base64,"+s}const s=new Image;return new Promise((e,r)=>{s.src=i,s.addEventListener("load",r=>(n&&t.revokeObjectURL(i),e(new PIXI.Texture(new PIXI.BaseTexture(s)))))})}))}function a(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),s=n.length,r=new Uint8Array(s);for(;s--;)r[s]=n.charCodeAt(s);return new Blob([r],{type:i})}t.httpGetAsync=function(e,t=!0){return n(this,void 0,void 0,(function*(){const i=new XMLHttpRequest;return t||(i.responseType="arraybuffer"),i.open("GET",e,!0),i.send(null),new Promise((e,n)=>{i.onreadystatechange=()=>{if(4==i.readyState){if(200==i.status)return e(t?JSON.parse(i.responseText):i.response);try{return n(t?JSON.parse(i.responseText):i.response)}catch(e){return console.error("Error parsing http error response",i),n(e)}}}})}))},t.resolveMapSize=function(e,t){return e<=1028&&t<=1028?s.MapSize.SMALL:s.MapSize.LARGE},t.bufferToBase64=r,t.getTextureFromBlob=o,t.getTextureFromDataUrl=function(e){return n(this,void 0,void 0,(function*(){window.URL||window.webkitURL;const t=new Image;return new Promise((i,n)=>{t.src=e,t.addEventListener("load",e=>i(new PIXI.Texture(new PIXI.BaseTexture(t))))})}))},t.dataUrlToTexture=function(e){return n(this,void 0,void 0,(function*(){return o(a(e))}))},t.dataURLtoBlob=a,t.rotateColliders=function(e,t){},t.removeFileExtension=function(e){return e.replace(/\.[^/.]+$/,"")},t.indexedDB_enabled=function(){return!!(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB)},t.resolveMaxTextureSize=function(e){if(1==e.type){const t=e.gl.MAX_TEXTURE_SIZE;let i;return i=t>=4096?t-t%4096:t>=2048?t-t%2048:t>=1024?t-t%1024:t>=512?t-t%512:256}return 2048},t.computedSectionLength=function(e,t,i){let n,s=1;if(e<t)n=e;else{for(s=2;e/s>t;)s*=2;n=e/s}let r=i-n%i;return{mainLength:n+r,offsetLength:Math.abs(n-r*(s-1))}},t.mergeOptions=function(e,t,i=[]){const n=t;for(let t in n)e[t]&&(n[t]=e[t]);const s=[],r=[],o=[];for(let e=0;e<i.length;e++){const t=i[e];t in n||s.push(t),null===n[t]&&o.push(t),void 0===n[t]&&r.push(t)}let a="";if(a=s.length?a.concat("Missing param found for required params:"+s.join(", ")):a,a=o.length?a.concat("null param found for required params:"+o.join(", ")):a,a=s.length?a.concat("undefined param found for required params:"+r.join(", ")):a)throw a;return n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(5),r=i(6);t.Collider=class{constructor(e,t,i,o,a,h,l,d,c,u){if(this.active=!1,this.props={},this.updatePosition=()=>{throw new Error("Static collider can not set position.")},this.updateRotation=()=>{throw new Error("Static collider can not set rotation.")},this._rotation=0,this._scaleX=0,this._scaleY=0,h)this.collisionManager=h,this.tagManager=h,s.TagMixin.ApplyMixin(this),r.TransformEventMixin.ApplyMixin(this);else{if(!u)throw new Error("No parent found on collider without ref to manager.");this.parent=u}this.props=l||{},this.gameObject=d,this.shapeType=t,this.layer=e,this.shapeData=i,this.transformedShapeData=i,this.data=c,this.tags=o,this.active=!0,this.dynamic=a,t===n.RuntimeColliderShape.POLYGON?this.isPolygon=!0:t===n.RuntimeColliderShape.LINE?(this.updateAdjustedShapeData=this.updateAdjustedShapeDataLine.bind(this),this.isLine=!0):t===n.RuntimeColliderShape.CIRCLE?(this.updateAdjustedShapeData=this.updateAdjustedShapeDataCircle.bind(this),this.isCircle=!0):t===n.RuntimeColliderShape.RECT?(this.updateAdjustedShapeData=this.updateAdjustedShapeDataRect.bind(this),this.isRect=!0):t===n.RuntimeColliderShape.POINT?(this.updateAdjustedShapeData=this.updateAdjustedShapeDataPoint.bind(this),this.isPoint=!0):t===n.RuntimeColliderShape.ELIPSE&&(this.updateAdjustedShapeData=this.updateAdjustedShapeDataElipse.bind(this)),a&&(this.rebindPositionUpdate(),this.rebindRotationUpdate());const{x:p,y:f}=this.getMins();this.minX=p,this.minY=f}setDefaultPivot(){this.isRect?this.setPivot(this.shapeData.w/2,this.shapeData.h/2):this.isCircle?this.setPivot(this.shapeData.r,this.shapeData.r):this.isPoint?this.setPivot(this.shapeData[0].x-this.shapeData[1].x/2,this.shapeData[0].y-this.shapeData[1].y/2):this.shapeType===n.RuntimeColliderShape.POINT&&this.setPivot(0,0)}pivotPointInPlace(e,t,i){const n=t.x,s=t.y,r=Math.cos(e),o=Math.sin(e);t.x=r*(n-i.x)-o*(s-i.y)+i.x,t.x=o*(n-i.x)+r*(s-i.y)+i.y}doScale(e,t){}updateTransformedShapeData(){throw new Error("Unimplmented, supposed to be rebound in constructor.")}updateAdjustedShapeDataRect(){}updateAdjustedShapeDataCircle(){}updateAdjustedShapeDataElipse(){}updateAdjustedShapeDataPoint(){}updateAdjustedShapeDataLine(){}updateAdjustedShapeData(){}doRotation(e,t){this.shapeType===n.RuntimeColliderShape.RECT||(this.shapeType===n.RuntimeColliderShape.LINE?(this.pivotPointInPlace(e,this.shapeData[0],t),this.pivotPointInPlace(e,this.shapeData[1],t)):this.pivotPointInPlace(e,this.shapeData,t))}onGetPivotPoint(e){this.defaultPivotPoint=e}updateRotationWithListeners(e,t){this._rotation+=e,this.doRotation(e,t);for(let i=0;i<this.onRotationUpdates.length;i++)this.onRotationUpdates[i](e,t)}updateRotationWithOutListeners(e,t){if(!t)throw new Error("Need pivot point for rotation.");this._rotation+=e,this.doRotation(e,t)}setScale(e,t){}setTransformData(e){e.pivotX&&(this._pivotX=e.pivotX),e.pivotX&&(this._pivotY=e.pivotY),e.scaleX&&(this._scaleX=e.pivotY),e.scaleY&&(this._scaleY=e.scaleY),e.rotation&&(this._rotation=e.rotation),this.updateTransformedShapeData()}getMins(){let e,t;if(this.shapeType===n.RuntimeColliderShape.POLYGON){e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER;for(let i=0;i<this.shapeData.length;i++)e=Math.min(e,this.shapeData[i].x),t=Math.min(t,this.shapeData[i].y);return{x:e,y:t}}return this.shapeType===n.RuntimeColliderShape.LINE?{x:Math.min(this.shapeData[0].x,this.shapeData[1].x),y:Math.min(this.shapeData[0].y,this.shapeData[1].y)}:this.shapeType===n.RuntimeColliderShape.CIRCLE?{x:this.shapeData.x-this.shapeData.r,y:this.shapeData.y-this.shapeData.r}:{x:e=this.shapeData.x,y:t=this.shapeData.y}}setPivot(e,t){this._pivotX=e,this._pivotY=t}updateShapeData(e){}updateRotationDegrees(e,t){this.updateRotation(e*Math.PI/180,t)}defaultPivotPoint(){const{x:e,y:t}=this.getMins();return{x:this.pivotX+e,y:this.pivotY+t}}rebindRotationUpdate(){this.updateRotation=this.updateRotationWithOutListeners.bind(this),this.onRotationUpdates&&(this.updateRotation=this.updateRotationWithListeners.bind(this))}rebindPositionUpdate(){this.onPositionUpdates?(this.updatePosition=this.updatePositionWithListeners.bind(this),this.shapeType!==n.RuntimeColliderShape.LINE&&this.shapeType!==n.RuntimeColliderShape.POLYGON||(this.updatePosition=this.updateArrayWithListeners.bind(this))):(this.updatePosition=this.updatePositionWithoutListeners.bind(this),this.shapeType!==n.RuntimeColliderShape.LINE&&this.shapeType!==n.RuntimeColliderShape.POLYGON||(this.updatePosition=this.updateArrayWithoutListeners.bind(this)))}get rotation(){return this._rotation}setRotation(e,t){this.updateRotation(e-this._rotation,t)}setRotationDegrees(e,t){this.updateRotation(e*Math.PI/180-this._rotation,t)}updateArrayWithoutListeners(e,t){for(let i=0;i<this.shapeData.length;i++)this.shapeData[i].x+=e,this.shapeData[i].y+=t}updateArrayWithListeners(e,t){for(let i=0;i<this.shapeData.length;i++)this.shapeData[i].x+=e,this.shapeData[i].y+=t;for(let i=0;i<this.onPositionUpdates.length;i++)this.onPositionUpdates[i](e,t)}updatePositionWithoutListeners(e,t){this.shapeData.x+=e,this.shapeData.y+=t}updatePositionWithListeners(e,t){if(this.shapeData.x+=e,this.shapeData.y+=t,this.onPositionUpdates)for(let i=0;i<this.onPositionUpdates.length;i++)this.onPositionUpdates[i](e,t)}deactivate(){delete this.data,delete this.tags,delete this.shapeData,delete this.layer,delete this.gameObject,this.active=!1,this.clearListeners(),this.rebindPositionUpdate()}onCollisionStart(e){return this.startListeners?this.startListeners.push(e):this.startListeners=[e],this.startListeners.length-1}onCollision(e){return this.onListeners?this.onListeners.push(e):this.onListeners=[e],this.onListeners.length-1}onCollisionEnd(e){return this.endListeners?this.endListeners.push(e):this.endListeners=[e],this.endListeners.length-1}offCollision(e){this.onListeners=this.removeFromListeners(e,this.onListeners),this.onListeners||delete this.onListeners}offCollisionEnd(e){this.endListeners=this.removeFromListeners(e,this.endListeners),this.endListeners||delete this.endListeners}offCollisionStart(e){this.startListeners=this.removeFromListeners(e,this.startListeners),this.startListeners||delete this.startListeners}clearListeners(){this.parent||(this.clearTagListeners(),this.clearTransformListeners()),this.onListeners&&(this.onListeners.length=0,delete this.onListeners),this.endListeners&&(this.endListeners.length=0,delete this.endListeners),this.startListeners&&(this.startListeners.length=0,delete this.startListeners)}removeFromListeners(e,t){const i=new Array(t.length-1);let n=-1;for(let s=0;s<t.length;s++){if(t[s]===e){n=s;break}i[s]=t[s]}for(let e=n+1;e<t.length;e++)i[e-1]=t[e];return i.length?i:null}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NEGATIVE_NUMBER=1073741824]="NEGATIVE_NUMBER",e[e.IMAGE_AND_STRING_SEPERATOR=1118481]="IMAGE_AND_STRING_SEPERATOR",e[e.EMPTY_SECTION_FLAG=1118482]="EMPTY_SECTION_FLAG",e[e.BLOB_SEPARATOR=1118483]="BLOB_SEPARATOR",e[e.CHUNK_SEPERATOR=1118484]="CHUNK_SEPERATOR",e[e.TILE_=1118485]="TILE_"}(t.RESERVED_FLAGS||(t.RESERVED_FLAGS={})),t.RUNTIME_TILE_LAYER_SECTION_SIZE=128,t.EDITOR_TILE_LAYER_SECTION_SIZE=256,function(e){e.RECT="rects",e.POLYGON="polygons",e.POINT="points"}(t.ColliderShape||(t.ColliderShape={})),t.ObjectType=class{}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(2),r=i(7),o=i(8),a=i(5),h=i(6);PIXI.Sprite;class l extends PIXI.Sprite{constructor(e,t,i,n){super(),this.worldX=0,this.worldY=0,this.chunkCount=0,this.pool=[],this.sortByY=!1,this.gameStage=i,this.collisionManager=t,this.pool=e,this.tagManager=n,a.TagMixin.ApplyMixin(this),h.TransformEventMixin.ApplyMixin(this)}get sprite(){return this.delegatedSprite?this.delegatedSprite:this}updatePosition(e,t){if(e||t){if(this.worldX+=e,this.worldY+=t,this.position.x=Math.round(this.worldX),this.position.y=Math.round(this.worldY),this.delegatedSprite&&(this.delegatedSprite.position.x=Math.round(this.worldX),this.delegatedSprite.position.y=Math.round(this.worldY)),this.colliders)for(let i=0;i<this.colliders.length;i++)this.colliders[i].updatePosition(e,t);if(this.onPositionUpdates)for(let i=0;i<this.onPositionUpdates.length;i++)this.onPositionUpdates[i](e,t)}}updateRotation(e){if(this.rotation+=e,this.delegatedSprite&&(this.delegatedSprite.rotation+=e),this.colliders)for(let e=0;e<this.colliders.length;e++)this.colliders[e].minX,this.x,this.pivot.x,this.colliders[e].minY,this.y,this.pivot.y,this.colliders[e].setRotation(this.rotation,this.pivot);if(this.onRotationUpdates)for(let t=0;t<this.onRotationUpdates.length;t++)this.onRotationUpdates[t](e)}setPosition(e,t){if(e===this.worldX&&t===this.worldY)return;const i=e-this.worldX,n=t-this.worldY;if(this.worldX+=i,this.worldY+=n,this.position.x=Math.round(this.worldX),this.position.y=Math.round(this.worldY),this.delegatedSprite&&(this.delegatedSprite.position.x=this.position.x,this.delegatedSprite.position.y=this.position.y),this.colliders)for(let e=0;e<this.colliders.length;e++)this.colliders[e].updatePosition(i,n);if(this.onPositionUpdates)for(let e=0;e<this.onPositionUpdates.length;e++)this.onPositionUpdates[e](i,n)}changeLayer(e){var t;if(e!==this.layerIndex){const i=this.layerIndex;null===(t=this.layerParent)||void 0===t||t.removeMapSprite(this,!0);const n=this.gameStage.children[e];if(!n)throw new Error(`Layer index: ${e} is out of range for current map.`);if(this.layerIndex=e,this.layerParent=n,n.addMapSprite(this),this.delegatedSprite&&n.objectContainer.addChild(this.delegatedSprite),this.onLayerChangeListeners&&null!=i)for(let t=0;t<this.onLayerChangeListeners.length;t++)this.onLayerChangeListeners[t](e,i)}}addPolygonCollider(e,t,i,n,s){return e=e.map(e=>({x:e.x+this.worldX,y:e.y+this.worldY})),this._addCollider(new o.PolygonCollider(this.layerIndex,e,t,i,this.collisionManager,n,this,s))}addLineCollider(e,t,i,r,o){return e[0].x+=this.worldX,e[0].y+=this.worldY,e[1].x+=this.worldX,e[1].y+=this.worldY,this._addCollider(new s.Collider(this.layerIndex,n.RuntimeColliderShape.LINE,e,t,i,this.collisionManager,r,this,o))}addRectCollider(e,t,i,r,o,a,h,l){return e+=this.worldX,t+=this.worldY,this._addCollider(new s.Collider(this.layerIndex,n.RuntimeColliderShape.RECT,{x:e,y:t,w:i,h:r},o,a,this.collisionManager,h,this,l))}addCircleCollider(e,t,i,r,o,a,h){return e+=this.worldX,t+=this.worldY,this._addCollider(new s.Collider(this.layerIndex,n.RuntimeColliderShape.CIRCLE,{x:e,y:t,r:i},r,o,this.collisionManager,a,this,h))}addPointCollider(e,t,i,r,o,a){return e+=this.worldX,t+=this.worldY,this._addCollider(new s.Collider(this.layerIndex,n.RuntimeColliderShape.POINT,{x:e,y:t},i,r,this.collisionManager,o,this,a))}_addCollider(e){return this.colliders?this.colliders.push(e):this.colliders=[e],this.collisionManager.initCollider(e),e}removeCollider(e){for(let t=0;t<this.colliders.length;t++)if(this.colliders[t]===e){this.colliders.splice(t,1),this.collisionManager.removeCollider(e),delete e.gameObject;break}this.colliders.length||delete this.colliders}init(e,t){if(this.visible=!0,e.data&&(this.data=e.data),this.zIndex=e.zIndex,null!==this.zIndex&&void 0!==this.zIndex||(this.zIndex=-1),this.sortByY=-1===this.zIndex,this.imageData=t,this._ySortPoint=this.imageData&&"ySortPoint"in this.imageData?this.imageData.ySortPoint:e&&"ySort"in e?e.ySort:this.texture.height,e.texture?this.texture=e.texture:e.sprite&&(this.delegatedSprite=e.sprite,this.delegatedSprite.ySortPoint=this._ySortPoint,this.delegatedSprite.sortByY=this.sortByY),e.position?(this.worldX=e.position.x,this.worldY=e.position.y):(this.worldX=0,this.worldY=0),this.x=this.worldX,this.y=this.worldY,isNaN(e.layer)||this.changeLayer(e.layer),e.tags&&(this.tags=e.tags),e.colliders&&this.addColliders(e.colliders),e.flips){const{flipDiag:t,flipHor:i,flipVert:n}=e.flips,s=i?-1:1,r=n?-1:1;let o=0,a=0;if((i||n)&&(this.setScale(s,r),i&&(o=-this.sprite.width),n&&(a=-this.sprite.height)),t){const e=o;o=this.sprite.height<0?0:this.sprite.height+a,a=this.sprite.width<0?Math.abs(this.sprite.width):e,n&&!i&&(a*=-1),i&&!n&&(o*=-1),i||n||(o*=-1,a*=-1),this.setRotation(Math.PI/180*90)}this.sprite.pivot.set(),this.sprite.x=this.worldX-o,this.sprite.y=this.worldY-a}}setScale(e,t){this.scaleX=e,this.scaleY=t,console.error("setting scales",{x:e,y:t}),this.sprite.scale.set(e,t),this.colliders=[];for(let i=0;i<this.colliders.length;i++)this.colliders[i].setScale(e,t)}clearColliders(){if(this.colliders){const e=[...this.colliders];for(let t=0;t<e.length;t++)this.removeCollider(e[t])}}addCollider(e){const t="shapeType"in e?e.shapeType:r.CollisionManager.ResolveColliderType(e);t===n.RuntimeColliderShape.RECT?this.addRectCollider(e.shapeData.x,e.shapeData.y,e.shapeData.w,e.shapeData.h,e.tags,!!e.dynamic,null,e.data):t===n.RuntimeColliderShape.CIRCLE?this.addCircleCollider(e.shapeData.x,e.shapeData.y,e.shapeData.r,e.tags,!!e.dynamic,null,e.data):t===n.RuntimeColliderShape.POLYGON?this.addPolygonCollider(e.shapeData,e.tags,!!e.dynamic,null,e.data):t===n.RuntimeColliderShape.POINT?this.addPointCollider(e.shapeData.x,e.shapeData.y,e.tags,!!e.dynamic,null,e.data):t===n.RuntimeColliderShape.LINE&&this.addLineCollider(e.shapeData,e.tags,!!e.dynamic,null,e.data)}addColliders(e){for(let t=0;t<e.length;t++)this.addCollider(e[t])}onRemovedFromMap(e){this.onRemovedFromMapListeners?this.onRemovedFromMapListeners.push(e):this.onRemovedFromMapListeners=[e]}offRemovedFromMap(e){for(let t=0;t<this.onRemovedFromMapListeners.length;t++)this.onRemovedFromMapListeners[t]===e&&(this.onRemovedFromMapListeners.splice(t,1),this.onRemovedFromMapListeners.length||delete this.onRemovedFromMapListeners)}onChangedLayers(e){this.onLayerChangeListeners?this.onLayerChangeListeners.push(e):this.onLayerChangeListeners=[e]}offChangedLayers(e){for(let t=0;t<this.onLayerChangeListeners.length;t++)this.onLayerChangeListeners[t]===e&&(this.onLayerChangeListeners.splice(t,1),this.onLayerChangeListeners.length||delete this.onLayerChangeListeners)}setRotation(e){this.updateRotation(e-this.rotation)}removeFromMap(){var e,t;if(this.layerParent)return this.layerParent.removeMapSprite(this,!1);if(null===(e=this.tags)||void 0===e||e.forEach(e=>{var t;return null===(t=this.tagManager.taggedGameObjectRemovedListeners[e])||void 0===t?void 0:t.forEach(e=>e(this))}),null===(t=this.tagManager.gameObjectRemovedListeners)||void 0===t||t.forEach(e=>e(this)),this.delegatedSprite&&(delete this.delegatedSprite.ySortPoint,delete this.delegatedSprite),this.clearTagListeners(),delete this.tags,this.worldX=0,this.worldY=0,this.colliders){for(let e=0;e<this.colliders.length;e++)this.collisionManager.removeCollider(this.colliders[e]);this.colliders.length=0,delete this.colliders}if(this.clearTransformListeners(),this.clearTagListeners(),delete this.layerIndex,this.visible=!1,this.imageData=null,this.alpha=1,this.texture=null,this.rotation=0,this.scale.set(1,1),this.scaleX=1,this.scaleY=1,this.anchor.set(0,0),this.pivot.set(0,0),this.onRemovedFromMapListeners){for(let e=0;e<this.onRemovedFromMapListeners.length;e++)this.onRemovedFromMapListeners[e]();this.onRemovedFromMapListeners.length=0,delete this.onRemovedFromMapListeners}this.onLayerChangeListeners&&(this.onLayerChangeListeners.length=0,delete this.onLayerChangeListeners),delete this.data,this.pool.push(this)}get ySortPoint(){return this.y+this._ySortPoint}}t.GameObject=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static ApplyMixin(e){e.clearTagListeners=n.prototype.clearTagListeners.bind(e),e.onTagAdded=n.prototype.onTagAdded.bind(e),e.offTagAdded=n.prototype.offTagAdded.bind(e),e.onTagRemoved=n.prototype.onTagRemoved.bind(e),e.offTagRemoved=n.prototype.offTagRemoved.bind(e),e.addTag=n.prototype.addTag.bind(e),e.removeTag=n.prototype.removeTag.bind(e)}clearTagListeners(){this.tagAddedListeners&&(Object.keys(this.tagAddedListeners).forEach(e=>{this.tagAddedListeners[e].length=0,delete this.tagAddedListeners[e]}),delete this.tagAddedListeners),this.anyTagAddedListeners&&(this.anyTagAddedListeners.length=0,delete this.anyTagAddedListeners),this.tagRemovedListeners&&(Object.keys(this.tagRemovedListeners).forEach(e=>{this.tagRemovedListeners[e].length=0,delete this.tagRemovedListeners[e]}),delete this.tagRemovedListeners),this.anyTagRemovedListeners&&(this.anyTagRemovedListeners.length=0,delete this.anyTagRemovedListeners)}onTagAdded(e,t){t?this.tagAddedListeners?this.tagAddedListeners[t]?this.tagAddedListeners[t].push(e):this.tagAddedListeners[t]=[e]:this.tagAddedListeners={[t]:[e]}:this.anyTagAddedListeners?this.anyTagAddedListeners.push(e):this.anyTagAddedListeners=[e]}offTagAdded(e,t){if(t){for(let i=0;i<this.tagAddedListeners[t].length;i++)if(this.tagAddedListeners[t][i]===e)return this.tagAddedListeners[t].splice(i,1),this.tagAddedListeners[t].length||(delete this.tagAddedListeners[t],Object.keys(this.tagAddedListeners).length||delete this.tagAddedListeners),!0;return!1}for(let t=0;t<this.anyTagAddedListeners.length;t++)if(this.anyTagAddedListeners[t]===e)return this.anyTagAddedListeners.splice(t,1),this.anyTagAddedListeners.length||delete this.anyTagAddedListeners,!0;return!1}onTagRemoved(e,t){t?this.tagRemovedListeners?this.tagRemovedListeners[t]?this.tagRemovedListeners[t].push(e):this.tagRemovedListeners[t]=[e]:this.tagRemovedListeners={[t]:[e]}:this.anyTagRemovedListeners?this.anyTagRemovedListeners.push(e):this.anyTagRemovedListeners=[e]}offTagRemoved(e,t){if(!t){for(let t=0;t<this.anyTagRemovedListeners.length;t++)if(this.anyTagRemovedListeners[t]===e)return this.anyTagRemovedListeners.splice(t,1),this.anyTagRemovedListeners.length||delete this.anyTagRemovedListeners,!0;return!1}for(let i=0;i<this.tagRemovedListeners[t].length;i++)if(this.tagRemovedListeners[t][i]===e)return this.tagRemovedListeners[t].splice(i,1),this.tagRemovedListeners[t].length||(delete this.tagRemovedListeners[t],Object.keys(this.tagRemovedListeners).length||delete this.tagRemovedListeners),!0;return!1}addTag(e,t=!0){if(t&&this.tags&&this.tags.includes(e))throw new Error(`Trying to add duplicate tag ${e} to collider.`);if(this.tags?this.tags.push(e):this.tags=[e],this.tagAddedListeners){const t=this.tagAddedListeners[e];if(t)for(let i=0;i<t.length;i++)t[i](e)}if(this.anyTagAddedListeners)for(let t=0;t<this.anyTagAddedListeners.length;t++)this.anyTagAddedListeners[t](e);this.tagManager._onAddedTag(this,e)}removeTag(e){for(let t=0;t<this.tags.length;t++)if(this.tags[t]===e){if(this.tags.splice(t,1),this.tags.length||delete this.tags,this.tagRemovedListeners){const t=this.tagRemovedListeners[e];if(t)for(let i=0;i<t.length;i++)t[i](e)}return this.tagManager._onRemovedTag(this,e),!0}if(this.anyTagRemovedListeners)for(let t=0;t<this.anyTagRemovedListeners.length;t++)this.anyTagRemovedListeners[t](e);return!1}}t.TagMixin=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static ApplyMixin(e){e.clearTransformListeners=n.prototype.clearTransformListeners.bind(e),e.onRotationUpdate=n.prototype.onRotationUpdate.bind(e),e.onPositionUpdate=n.prototype.onPositionUpdate.bind(e),e.offPositionUpdate=n.prototype.offPositionUpdate.bind(e),e.offPositionUpdate=n.prototype.offPositionUpdate.bind(e)}clearTransformListeners(){this.onRotationUpdates&&(this.onRotationUpdates.length=0,delete this.onRotationUpdates,this.rebindPositionUpdate&&this.rebindPositionUpdate()),this.onPositionUpdates&&(this.onPositionUpdates.length=0,delete this.onPositionUpdates,this.rebindRotationUpdate&&this.rebindRotationUpdate())}onPositionUpdate(e){this.onPositionUpdates?this.onPositionUpdates.push(e):(this.onPositionUpdates=[e],this.rebindPositionUpdate&&this.rebindPositionUpdate())}offPositionUpdate(e){for(let t=0;t<this.onPositionUpdates.length;t++)if(this.onPositionUpdates[t]===e&&(this.onPositionUpdates.splice(t,1),!this.onPositionUpdates.length))return delete this.onPositionUpdates,void(this.rebindPositionUpdate&&this.rebindPositionUpdate())}onRotationUpdate(e){this.onRotationUpdates?this.onRotationUpdates.push(e):(this.onRotationUpdates=[e],this.rebindRotationUpdate&&this.rebindRotationUpdate())}offRotationUpdate(e){for(let t=0;t<this.onRotationUpdates.length;t++)if(this.onRotationUpdates[t]===e)return this.onRotationUpdates.splice(t,1),this.onRotationUpdates.length||(delete this.onRotationUpdates,this.rebindRotationUpdate&&this.rebindRotationUpdate()),!0;return!1}}t.TransformEventMixin=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(2),s=i(0),r=i(8);class o{constructor(e){this.plugins=[],this.lastCollisions=[],this.collisionHandlersMap={},this.endCollisionHandlersMap={},this.startCollisionHandlersMap={},this.seqToTag={},this.rectLayerLookup=[],this.polygonLayerLookup=[],this.pointLayerLookup=[],this.circleLayerLookup=[],this.lineLayerLookup=[],this.chunkColliderLookup={},this.nextTagSeq=0,this.cachedTypeExecution={},this.cacheTypeOnNextRun={},this.cacheCount=0,e&&this.setCollisionSystem(e)}getCollidersWithTags(e){if(!this.collisionSystem)throw new Error("No collision system implemented to make query.");return this.collisionSystem.getCollidersWithTags(e)}onAfterCollisions(e){this.onAfterHandlers?this.onAfterHandlers.push(e):this.onAfterHandlers=[e]}onBeforeCollisions(e){this.onBeforeHandlers?this.onBeforeHandlers.push(e):this.onBeforeHandlers=[e]}offAfterCollisions(e){let t=this.onAfterHandlers.length;for(;t--;)if(this.onAfterHandlers[t]===e)return this.onAfterHandlers.splice(t,1),this.onAfterHandlers.length||delete this.onAfterHandlers,!0;return!1}offBeforeCollisions(e){let t=this.onBeforeHandlers.length;for(;t--;)if(this.onBeforeHandlers[t]===e)return this.onBeforeHandlers.splice(t,1),this.onBeforeHandlers.length||delete this.onBeforeHandlers,!0;return!1}onAddedCollider(e,t){if(t){this.addedTagHandlers||(this.addedTagHandlers={});for(let i=0;i<t.length;i++)this.addedTagHandlers[t[i]]?this.addedTagHandlers[t[i]].push(e):this.addedTagHandlers[t[i]]=[e]}else this.addedColliderHandlers?this.addedColliderHandlers.push(e):this.addedColliderHandlers=[e]}onRemovedCollider(e,t){if(t){this.removedTagHandlers||(this.removedTagHandlers={});for(let i=0;i<t.length;i++)this.removedTagHandlers[t[i]]?this.removedTagHandlers[t[i]].push(e):this.removedTagHandlers[t[i]]=[e]}else this.removedColliderHandlers?this.removedColliderHandlers.push(e):this.removedColliderHandlers=[e]}offAddedCollider(e,t){if(t){for(let i=0;i<t.length;i++){const n=this.addedTagHandlers[t[i]];let s=n.length;for(;s--;)n[s]===e&&this.addedTagHandlers[t[i]].splice(s,1);n.length||delete this.addedTagHandlers[t[i]]}Object.keys(this.addedTagHandlers).length||delete this.addedTagHandlers}else for(let t=0;t<this.addedColliderHandlers.length;t++)if(this.addedColliderHandlers[t]===e)return this.addedColliderHandlers.splice(t,1),this.addedColliderHandlers.length||delete this.addedColliderHandlers,!0;return!1}offRemovedCollider(e,t){if(t){for(let i=0;i<t.length;i++){const n=this.removedTagHandlers[t[i]];let s=n.length;for(;s--;)n[s]===e&&n.splice(s,1);n.length||delete this.removedTagHandlers[t[i]]}return Object.keys(this.removedTagHandlers).length||delete this.removedTagHandlers,!0}for(let t=0;t<this.removedColliderHandlers.length;t++)if(this.removedColliderHandlers[t]===e)return this.removedColliderHandlers.splice(t,1),this.removedColliderHandlers.length||delete this.removedColliderHandlers,!0;return!1}_onAddedTag(e,t){this.collisionSystem.onAddedTagToCollider(e,t)}_onRemovedTag(e,t){this.collisionSystem.onRemovedTagFromCollider(e,t)}addChunkColliders(e){for(let t=0;t<e.layers.length;t++){const i=e.layers[t];if(!i||!i.colliders)continue;const n=i.colliders;n.rects&&this.addCollidersToLookup(t,this.rectLayerLookup,n.rects),n.polygons&&this.addCollidersToLookup(t,this.polygonLayerLookup,n.polygons),n.points&&this.addCollidersToLookup(t,this.pointLayerLookup,n.points),n.circles&&this.addCollidersToLookup(t,this.circleLayerLookup,n.circles),n.lines&&this.addCollidersToLookup(t,this.lineLayerLookup,n.lines)}}addCollidersToLookup(e,t,i){let o=t[e];o||(o={},t[e]=o);for(let t=0;t<i.length;t++){const a=i[t];if(o[a.id])o[a.id]++;else{o[a.id]=1;const t=a.shapeType===s.RuntimeColliderShape.POLYGON?new r.PolygonCollider(e,a.shapeData,a.tags,a.dynamic,this,a.props):new n.Collider(e,a.shapeType,a.shapeData,a.tags,a.dynamic,this,a.props);this.initCollider(t),this.chunkColliderLookup[`${a.id}_${a.shapeType}_${e}`]=t}}}initCollider(e){if(e.dynamic?this.collisionSystem.onAddedDynamicCollider(e):this.collisionSystem.onAddedStaticCollider(e),e.parent){if(e.shapeType===s.RuntimeColliderShape.POLYGON)for(let t=0;t<e.lines.length;t++)this.initCollider(e.lines[t])}else{if(e.tags){const t=[],i=[],n=[],s=[];for(let r=0;r<e.tags.length;r++){const o=e.tags[r];this.pluginInitHandlers&&this.pluginInitHandlers[o]&&this.doTagHandlers(o,e,this.pluginInitHandlers,n),this.pluginTagAInitHandlers&&this.pluginTagAInitHandlers[o]&&this.doTagHandlers(o,e,this.pluginTagAInitHandlers,i),this.pluginTagBInitHandlers&&this.pluginTagBInitHandlers[o]&&this.doTagHandlers(o,e,this.pluginTagBInitHandlers,t),this.addedTagHandlers&&this.addedTagHandlers[o]&&this.doTagHandlers(o,e,this.addedTagHandlers,s)}}if(this.addedColliderHandlers)for(let t=0;t<this.addedColliderHandlers.length;t++)this.addedColliderHandlers[t](e)}}removeCollider(e){if(e.dynamic?this.collisionSystem.onRemovedDynamicCollider(e):this.collisionSystem.onRemovedStaticCollider(e),!e.parent){if(e.tags){const t=[],i=[],n=[],s=[];for(let r=0;r<e.tags.length;r++){const o=e.tags[r];this.pluginRemoveHandlers&&this.pluginRemoveHandlers[o]&&this.doTagHandlers(o,e,this.pluginRemoveHandlers,n),this.pluginTagARemoveHandlers&&this.pluginTagARemoveHandlers[o]&&this.doTagHandlers(o,e,this.pluginTagARemoveHandlers,i),this.pluginTagBRemoveHandlers&&this.pluginTagBRemoveHandlers[o]&&this.doTagHandlers(o,e,this.pluginTagBRemoveHandlers,t),this.removedTagHandlers&&this.removedTagHandlers[o]&&this.doTagHandlers(o,e,this.removedTagHandlers,s)}}if(this.removedColliderHandlers)for(let t=0;t<this.removedColliderHandlers.length;t++)this.removedColliderHandlers[t](e)}e.clearListeners()}static ResolveColliderType(e){if(Array.isArray(e.shapeData))return 2===e.shapeData.length?s.RuntimeColliderShape.LINE:s.RuntimeColliderShape.POLYGON;if(e.shapeData.hasOwnProperty("x"))return e.shapeData.hasOwnProperty("r")?s.RuntimeColliderShape.CIRCLE:e.shapeData.hasOwnProperty("w")?s.RuntimeColliderShape.RECT:s.RuntimeColliderShape.POINT;throw new Error(`Invalid shape data found on collider ${e}`)}doTagHandlers(e,t,i,n){const s=i[e];if(s)for(let e=0;e<s.length;e++)n.includes(s[e])||(n.push(s[e]),s[e](t))}removeChunkColliders(e){for(let t=0;t<e.layers.length;t++){const i=e.layers[t];if(!i||!i.colliders)continue;const n=i.colliders;n.rects&&this.removeColliderFromLookup(t,this.rectLayerLookup[t],n.rects),n.polygons&&this.removeColliderFromLookup(t,this.polygonLayerLookup[t],n.polygons),n.points&&this.removeColliderFromLookup(t,this.pointLayerLookup[t],n.points),n.circles&&this.removeColliderFromLookup(t,this.circleLayerLookup[t],n.circles),n.lines&&this.removeColliderFromLookup(t,this.lineLayerLookup[t],n.lines)}}removeColliderFromLookup(e,t,i){for(let n=0;n<i.length;n++){const s=i[n];if(!(s.id in t))throw new Error("The shape id should be in lookup at this point.");const r=`${s.id}_${s.shapeType}_${e}`;if(!--t[s.id]){const e=this.chunkColliderLookup[r];if(!e)throw new Error("Should have found collider");!e.parent&&this.removeCollider(e),delete t[s.id],delete this.chunkColliderLookup[r]}}}reset(){const e=this.collisionSystem.getAllColliders();for(let t=0;t<e.length;t++)e[t].parent||this.removeCollider(e[t]);this.collisionSystem.onClear()}initMap(e){this.collisionSystem.onInit(e.mapW,e.mapH);const t=e.layerTileLayerOrder.length;this.rectLayerLookup.length=t,this.pointLayerLookup.length=t,this.polygonLayerLookup.length=t,this.circleLayerLookup.length=t,this.lineLayerLookup.length=t;for(let e=0;e<t;e++)delete this.rectLayerLookup[e],delete this.polygonLayerLookup[e],delete this.pointLayerLookup[e],delete this.circleLayerLookup[e],delete this.lineLayerLookup[e]}init(e){let t=0;Object.keys(e).forEach(i=>{this.seqToTag[i]=e[i],t=Math.max(parseInt(i),t)}),this.nextTagSeq=t}setCollisionSystem(e){const t=this.collisionSystem;this.collisionSystem=e,e?(this.addColliderCouple=this.collisionSystem.onAddedColliderCouple.bind(this.collisionSystem),this.removeColliderCouple=this.collisionSystem.onRemovedColliderCouple.bind(this.collisionSystem)):t&&(this.addColliderCouple=o.prototype.addColliderCouple.bind(this),this.removeColliderCouple=o.prototype.removeColliderCouple.bind(this))}update(e){const t=[...this.lastCollisions];if(this.onBeforeHandlers)for(let e=0;e<this.onBeforeHandlers.length;e++)this.onBeforeHandlers[e](t);const i=this.collisionSystem.getCollisions(e);if(this.lastCollisions.length=0,i.length)for(let e=0;e<i.length;e+=2){const n=i[e],s=i[e+1];let r=!1;for(let e=0;e<t.length;e+=2)if(t[e]===n&&t[e+1]===s||t[e]===s&&t[e+1]===n){t.splice(e,2),r=!0;break}if(this.lastCollisions.push(n,s),r){if(this.doCollisionHandlerIteration(n,s,this.collisionHandlersMap),n.onListeners)for(let e=0;e<n.onListeners.length;e++)n.onListeners[e](s);if(s.onListeners)for(let e=0;e<s.onListeners.length;e++)s.onListeners[e](n)}else{if(this.doCollisionHandlerIteration(n,s,this.startCollisionHandlersMap),n.startListeners)for(let e=0;e<n.startListeners.length;e++)n.startListeners[e](s);if(s.startListeners)for(let e=0;e<s.startListeners.length;e++)s.startListeners[e](n)}}if(t.length)for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];if(this.doCollisionHandlerIteration(i,n,this.endCollisionHandlersMap),i.endListeners)for(let e=0;e<i.endListeners.length;e++)i.endListeners[e](n);if(n.endListeners)for(let e=0;e<n.endListeners.length;e++)n.endListeners[e](i)}if(this.onAfterHandlers)for(let e=0;e<this.onAfterHandlers.length;e++)this.onAfterHandlers[e](this.lastCollisions)}removePlugin(e){for(let t=0;t<this.plugins.length;t++)if(this.plugins[t]===e||this.plugins[t]._f&&this.plugins[t]._f===e){const e=this.plugins[t];if(this.plugins.splice(t,1),e.onBeforeCollisions&&this.offBeforeCollisions(e.onBeforeCollisions),e.onAfterCollisions&&this.offAfterCollisions(e.onAfterCollisions),this.plugins.length){const t=(t,i)=>{if(e.tagBs&&e.tagBs.length)for(let n=0;n<e.tagAs.length;n++){const s=e.tagAs[n],r=i[s].couples;for(let i=0;i<e.tagBs.length;i++){const n=r[e.tagBs[i]];for(let e=0;e<n.length;e++)if(n[e]===t){n.splice(e,1);break}n.length||delete r[e.tagBs[i]]}0===Object.keys(r).length&&(delete i[s].couples,i[s].singles||delete i[s])}else for(let n=0;n<e.tagAs.length;n++){const s=e.tagAs[n],r=i[s].singles;for(let e=0;e<r.length;e++)if(r[e]===t){r.splice(e,1);break}r.length||(delete i[s].singles,i[s].couples||delete i[s])}};e.onCollisionStart&&t(e.onCollisionStart,this.startCollisionHandlersMap),e.onCollision&&t(e.onCollision,this.collisionHandlersMap),e.onCollisionEnd&&t(e.onCollisionEnd,this.endCollisionHandlersMap);const i=(e,t,i)=>{let n=!1;return e.forEach(e=>{const s=i[e];for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}s.length||(n=!0,delete i[e])}),n?Object.keys(i).length:1};if(e.onAddedColliderWithTagA&&!i(e.tagAs,e.onAddedColliderWithTagA,this.pluginTagAInitHandlers)&&delete this.pluginTagAInitHandlers,e.onAddedColliderWithTagB&&!i(e.tagBs,e.onAddedColliderWithTagB,this.pluginTagBInitHandlers)&&delete this.pluginTagBInitHandlers,e.onColliderAddedTagA&&!i(e.tagAs,e.onAddedColliderWithTagA,this.pluginColliderAddedTagAHandlers)&&delete this.pluginColliderAddedTagAHandlers,e.onColliderAddedTagB&&!i(e.tagBs,e.onColliderAddedTagB,this.pluginColliderAddedTagBHandlers)&&delete this.pluginColliderAddedTagBHandlers,e.onColliderRemovedTagA&&!i(e.tagAs,e.onColliderRemovedTagA,this.pluginColliderRemovedTagAHandlers)&&delete this.pluginColliderRemovedTagAHandlers,e.onColliderRemovedTagB&&!i(e.tagBs,e.onColliderRemovedTagB,this.pluginColliderRemovedTagBHandlers)&&delete this.pluginColliderRemovedTagBHandlers,e.onAdded&&(e.tagAs&&e.tagAs.length?i(e.tagAs,e.onAdded,this.pluginInitHandlers)?e.tagBs&&(i(e.tagBs.filter(t=>!e.tagAs.includes(t)),e.onAdded,this.pluginInitHandlers)||delete this.pluginInitHandlers):delete this.pluginInitHandlers:this.offAddedCollider(e.onAdded)),e.onRemovedTagA&&!i(e.tagAs,e.onRemovedTagA,this.pluginTagARemoveHandlers)&&delete this.pluginTagARemoveHandlers,e.onRemovedTagB&&!i(e.tagBs,e.onRemovedTagB,this.pluginTagBRemoveHandlers)&&delete this.pluginTagBRemoveHandlers,e.onRemoved&&(e.tagAs&&e.tagAs.length?i(e.tagAs,e.onRemoved,this.pluginRemoveHandlers)?e.tagBs&&(i(e.tagBs.filter(t=>!e.tagAs.includes(t)),e.onRemoved,this.pluginRemoveHandlers)||delete this.pluginRemoveHandlers):delete this.pluginRemoveHandlers:this.offRemovedCollider(e.onRemoved)),e.tagAs&&e.tagBs)for(let t=0;t<e.tagAs.length;t++)for(let i=0;i<e.tagBs.length;i++)this.collisionSystem.onRemovedColliderCouple(e.tagAs[t],e.tagBs[i])}else{for(let e in this.startCollisionHandlersMap)this.startCollisionHandlersMap.hasOwnProperty(e)&&delete this.startCollisionHandlersMap[e];for(let e in this.collisionHandlersMap)this.collisionHandlersMap.hasOwnProperty(e)&&delete this.collisionHandlersMap[e];for(let e in this.endCollisionHandlersMap)this.endCollisionHandlersMap.hasOwnProperty(e)&&delete this.endCollisionHandlersMap[e]}return!0}return this.cacheTypeOnNextRun={},this.cachedTypeExecution={},this.reapplyPlugins(),!1}addColliderCouple(e,t){throw new Error("No collision system is being used.")}removeColliderCouple(e,t){throw new Error("No collision system is being used.")}addColliderCouples(e){for(let t=0;t<e.length;t++)this.addColliderCouple(e[t][0],e[t][1])}removeColliderCouples(e){for(let t=0;t<e.length;t++)this.removeColliderCouple(e[t][0],e[t][1])}addPlugin(e,t,i){if(!this.validatePlugin(e))return;e.init&&e.init(t,i),this.plugins.push(e),e.onCollisionStart&&this.addToPluginMap(e,e.onCollisionStart,this.startCollisionHandlersMap),e.onCollision&&this.addToPluginMap(e,e.onCollision,this.collisionHandlersMap),e.onCollisionEnd&&this.addToPluginMap(e,e.onCollisionEnd,this.endCollisionHandlersMap),e.onBeforeCollisions&&this.onBeforeCollisions(e.onBeforeCollisions),e.onAfterCollisions&&this.onAfterCollisions(e.onAfterCollisions);const n=(e,t,i)=>{e.forEach(e=>{i[e]?i[e].push(t):i[e]=[t]})};if(e.onColliderAddedTagA&&(this.pluginColliderAddedTagAHandlers||(this.pluginColliderAddedTagAHandlers={}),n(e.tagAs,e.onColliderAddedTagA,this.pluginColliderAddedTagAHandlers)),e.onColliderAddedTagB&&(this.pluginColliderAddedTagBHandlers||(this.pluginColliderAddedTagBHandlers={}),n(e.tagBs,e.onColliderAddedTagB,this.pluginColliderAddedTagBHandlers)),e.onColliderRemovedTagA&&(this.pluginColliderRemovedTagAHandlers||(this.pluginColliderRemovedTagAHandlers={}),n(e.tagAs,e.onColliderAddedTagA,this.pluginColliderRemovedTagAHandlers)),e.onColliderRemovedTagB&&(this.pluginColliderRemovedTagBHandlers||(this.pluginColliderRemovedTagBHandlers={}),n(e.tagBs,e.onColliderAddedTagB,this.pluginColliderRemovedTagBHandlers)),e.onAddedColliderWithTagA&&(this.pluginTagAInitHandlers||(this.pluginTagAInitHandlers={}),n(e.tagAs,e.onAddedColliderWithTagA,this.pluginTagAInitHandlers)),e.onAddedColliderWithTagB&&(this.pluginTagBInitHandlers||(this.pluginTagBInitHandlers={}),n(e.tagBs,e.onAddedColliderWithTagB,this.pluginTagBInitHandlers)),e.onAdded&&(e.tagAs&&e.tagAs.length?(this.pluginInitHandlers||(this.pluginInitHandlers={}),n(e.tagAs&&e.tagBs?[...e.tagAs,...e.tagBs].filter((e,t,i)=>i.indexOf(e)===t):e.tagAs,e.onAdded,this.pluginInitHandlers)):this.onAddedCollider(e.onAdded)),e.onRemovedTagA&&(this.pluginTagARemoveHandlers||(this.pluginTagARemoveHandlers={}),n(e.tagAs,e.onRemovedTagA,this.pluginTagARemoveHandlers)),e.onRemovedTagB&&(this.pluginTagBRemoveHandlers||(this.pluginTagBRemoveHandlers={}),n(e.tagBs,e.onRemovedTagB,this.pluginTagBRemoveHandlers)),e.onRemoved&&(e.tagAs&&e.tagAs.length?(this.pluginRemoveHandlers||(this.pluginRemoveHandlers={}),n(e.tagAs&&e.tagBs?[...e.tagAs,...e.tagBs].filter((e,t,i)=>i.indexOf(e)===t):e.tagAs,e.onRemoved,this.pluginRemoveHandlers)):this.onRemovedCollider(e.onRemoved)),this.collisionSystem){if(e.tagAs&&e.tagBs)for(let t=0;t<e.tagAs.length;t++)for(let i=0;i<e.tagBs.length;i++)this.collisionSystem.onAddedColliderCouple(e.tagAs[t],e.tagBs[i]);this.reapplyPlugins()}}addToPluginMap(e,t,i){if(e.tagBs&&e.tagBs.length)for(let n=0;n<e.tagAs.length;n++){const s=e.tagAs[n];i[s]?i[s].couples||(i[s].couples={}):i[s]={couples:{}};for(let n=0;n<e.tagBs.length;n++){const r=e.tagBs[n];i[s].couples[r]?i[s].couples[r].push(t):i[s].couples[r]=[t]}}else for(let n=0;n<e.tagAs.length;n++){const s=e.tagAs[n];i[s]?i[s].singles?i[s].singles.push(t):i[s].singles=[t]:i[s]={singles:[t]}}}validatePlugin(e){if(this.plugins.includes(e))return console.error("plugin validation error, collision plugin:",e.name,"already exists."),!1;if(!(e.onCollision||e.onCollisionStart||e.onCollisionEnd||e.onAddedColliderWithTagB||e.onAddedColliderWithTagA||e.onRemovedTagA||e.onRemovedTagB||e.onRemoved||e.onAdded))return console.error("plugin validation error, collision plugin:",e.name,"does not implement any of the collision hooks: onCollision, onCollisionStart, onCollisionEnd, onAdded, onRemoved, onAddedColliderWithTagA, onAddedColliderWithTagB, onRemovedTagA, or onRemovedTabB"),!1;if(!e.tagAs||!e.tagAs.length){if(e.onAddedColliderWithTagA||e.onRemovedTagA)return console.error("plugin validation error, collision plugin:",e.name,'needs a "tagAs" property with an array of at least 1 tag since youre using onAddedColliderWithTagA/onRemovedTagA'),!1;if(e.onCollision||e.onCollisionStart||e.onCollisionEnd)return console.error("plugin validation error, collision plugin:",e.name,'needs at least "tagAs" property with an array of at least 1 tag since youre using onCollision, onCollisionStart, onCollisionEnd. The only method you can use without tags are "init", "onAdded", and "onRemoved"'),!1}if(!e.tagBs||!e.tagBs.length){if(e.onAddedColliderWithTagB)return console.error("plugin validation error, collision plugin:",e.name,'invalid onAddedColliderWithTagB handler, the plugin needs a "tagBs" property with an array of at least 1 tag'),!1;if(e.onRemovedTagB)return console.error("plugin validation error, collision plugin:",e.name,'invalid onRemovedTagB handler, the plugin needs a "tagBs" property with an array of at least 1 tag'),!1}return!0}reapplyPlugins(){this.plugins.length?this.doCollisionHandlerIteration=this.iterateCollisionTagHandlers.bind(this):this.doCollisionHandlerIteration=()=>{}}iterateCollisionTagHandlers(e,t,i){performance.now();const n=e.tags,s=t.tags;let r=[],o=[],a=[];for(let h=0;h<n.length;h++){const l=n[h],d=i[l];if(d){if(d.couples)for(let i=0;i<s.length;i++)d.couples[s[i]]&&d.couples[s[i]].forEach(i=>{o.includes(i)||(i(e,t),o.push(i))});if(d.singles)for(let i=0;i<d.singles.length;i++){s.includes(l)&&r.push(l);const n=d.singles[i];a.includes(n)||(n(e,t),a.push(n))}}}a.length=0,o.length=0;for(let h=0;h<s.length;h++){const l=s[h],d=i[l];if(d){if(d.couples)for(let i=0;i<n.length;i++)n[i]!==l&&d.couples[n[i]]&&d.couples[n[i]].forEach(i=>{o.includes(i)||(i(t,e),o.push(i))});if(d.singles&&!r.includes(l))for(let i=0;i<d.singles.length;i++){const n=d.singles[i];a.includes(n)||(n(t,e),a.push(n))}}}performance.now()}}t.CollisionManager=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(2),s=i(0);class r extends n.Collider{constructor(e,t,i,r,o,a,h,l,d){super(e,s.RuntimeColliderShape.POLYGON,t,i,r,o,a,h,l),this.lines=new Array(this.shapeData.length);for(let e=0;e<this.lines.length;e++){const t=this.shapeData[e],i=e===this.shapeData.length-1?this.shapeData[0]:this.shapeData[e+1];this.lines[e]=new n.Collider(this.layer,s.RuntimeColliderShape.LINE,[t,i],this.tags,this.dynamic,null,a,h,null,this)}}doRotation(e,t){for(let i=0;i<this.shapeData.length;i++){const n=this.shapeData[i].x,s=this.shapeData[i].y,r=e,o=Math.cos(r),a=Math.sin(r),h=o*(n-t.x)-a*(s-t.y)+t.x,l=a*(n-t.x)+o*(s-t.y)+t.y;this.shapeData[i].x=h,this.shapeData[i].y=l}}onLineCollisionStart(e){if(this.lineStartListeners)this.lineStartListeners.push(e);else{this.lineStartListeners=[e];for(let e=0;e<this.lines.length;e++){if(this.lines[e].startListeners)throw new Error("You can not have listeners on polygon children colliders and use the parent onLineCollision");this.lines[e].onCollisionStart(t=>{for(let i=0;i<this.lineStartListeners.length;i++)this.lineStartListeners[i](this.lines[e],t)})}}}onLineCollision(e){if(this.lineListeners)this.lineListeners.push(e);else{this.lineListeners=[e];for(let e=0;e<this.lines.length;e++){if(this.lines[e].onListeners)throw new Error("You can not have listeners on polygon children colliders and use the parent onLineCollision");this.lines[e].onCollision(t=>{for(let i=0;i<this.lineListeners.length;i++)this.lineListeners[i](this.lines[e],t)})}}}onLineCollisionEnd(e){if(this.lineEndListeners)this.lineEndListeners.push(e);else{this.lineEndListeners=[e];for(let e=0;e<this.lines.length;e++){if(this.lines[e].endListeners)throw new Error("You can not have listeners on polygon children colliders and use the parent onLineCollision");this.lines[e].onCollisionEnd(t=>{for(let i=0;i<this.lineEndListeners.length;i++)this.lineEndListeners[i](this.lines[e],t)})}}}clearListeners(){super.clearListeners(),this.lines.forEach(e=>{e.clearListeners()})}offLineCollision(e){this.lineListeners=this.removeFromArray(e,this.lineListeners),this.lineListeners||(this.lines.forEach(e=>{e.onListeners.length=0,delete e.onListeners}),delete this.lineListeners)}offLineCollisionEnd(e){this.lineEndListeners=this.removeFromArray(e,this.lineEndListeners),this.lineEndListeners||(this.lines.forEach(e=>{e.endListeners.length=0,delete e.endListeners}),delete this.lineEndListeners)}offLineCollisionStart(e){this.lineStartListeners=this.removeFromArray(e,this.lineStartListeners),this.lineStartListeners||(this.lines.forEach(e=>{e.startListeners.length=0,delete e.startListeners}),delete this.startListeners)}setDefaultPivot(){let e,t,i,n;for(let s=0;s<this.shapeData.length;s++)e=this.shapeData[s].x<e||null==e?this.shapeData[s].x:e,t=this.shapeData[s].x>t||null==t?this.shapeData[s].x:t,i=this.shapeData[s].y<i||null==i?this.shapeData[s].y:i,n=this.shapeData[s].y>n||null==n?this.shapeData[s].y:n;this.setPivot((e+t)/2-e,(i+n)/2-i)}defaultPivotPoint(){let e,t,i,n;for(let s=0;s<this.shapeData.length;s++)e=this.shapeData[s].x<e||null==e?this.shapeData[s].x:e,t=this.shapeData[s].x>t||null==t?this.shapeData[s].x:t,i=this.shapeData[s].y<i||null==i?this.shapeData[s].y:i,n=this.shapeData[s].y>n||null==n?this.shapeData[s].y:n;return{x:(e+t)/2,y:(i+n)/2}}}t.PolygonCollider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(20);t.AtlasFactory=(e,t)=>(e.type,new n.WebGlGameObjectAtlas(e,t))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTextureAtlas=class{constructor(e,t){this.lookup={},this.nextPositions=[],this.nextOpenRects=[],this.nextOpenPositions=[],this.nextPositionIndex=0,this.nextRectAtlasIndex=0,this.nextOpenIndex=0,this.atlasses=[],this.subChunkW=128,this.subChunkH=128,this.openRects=[],this.maxTextureSize=e>=2048?e-e%2048:e>=1024?e-e%1024:e>=512?e-e%512:256,this.renderer=t}initForMap(e,t,i){this.clear(),this.subChunkW=128|e,this.subChunkH=128|t,this.textureStartX=this.maxTextureSize-this.subChunkW,this.textureStartY=this.maxTextureSize-this.subChunkH,this.atlasses.push(PIXI.RenderTexture.create(this.maxTextureSize,this.maxTextureSize)),this.nextPositionIndex=0;for(let e=this.textureStartX;e>=0;e-=this.subChunkH)for(let t=this.textureStartX;t>=0;t-=this.subChunkW)this.nextPositions.push([t,e])}mergeAllLayerChunks(e){return new Array(e.length).fill(1).map((t,i)=>{if(e[i]&&e[i].length&&!e[i].every(e=>!e)){let t=0,n=0;const s=new PIXI.Container;e[i].forEach(e=>{e&&(t=Math.max(e.x+e.width,t),n=Math.max(e.y+e.height,n),s.addChild(e))});const r=PIXI.RenderTexture.create(t,n);return this.renderer.render(s,r),r}return null})}getMinTexturesForMap(e,t,i){const n=[];return Math.ceil(e/this.maxTextureSize),Math.ceil(t/this.maxTextureSize),i.forEach(e=>{n.push([]),e.forEach(e=>{})}),n}addOpenRect(e,t,i){}addOpenSpot(e,t,i,n,s){this.nextOpenRects.push({aIdx:e,x:t,y:i,w:n,h:s})}clear(){Object.keys(this.lookup).forEach(e=>{delete this.lookup[e]}),this.nextPositionIndex=0,this.nextOpenIndex=0,this.nextPositions.length=0,this.nextOpenPositions.length=0,this.nextOpenRects.length=0,this.atlasses.forEach(e=>{e.destroy(!0)}),this.atlasses.length=0}addParentChunkLayerGroup(e,t){}addTileToLayerGroup(e,t,i,n){}addSubChunkLayerGroup(e,t){if(e in this.lookup)return this.lookup[e].texture;const{x:i,y:n,w:s,h:r,aIdx:o}=this.getNextRect(t.width,t.height),a=new PIXI.Sprite(t);a.setTransform(i,n),this.renderer.render(a,this.atlasses[o],!1);const h=new PIXI.Texture(this.atlasses[o].baseTexture,new PIXI.Rectangle(i,n,s,r));return this.lookup[e]={texture:h,x:i,y:n,w:s,h:r,aIdx:o},h}renderSubChunkLayerGroup(e,t,i=!1){if(e in this.lookup)return this.lookup[e].texture;i&&console.error("layer width/height:",{width:t.width,height:t.height});const{x:n,y:s}=t.getLocalBounds(),{x:r,y:o,w:a,h:h,aIdx:l}=this.getNextRect(t.width,t.height);t.setTransform(r-n,o-s),this.renderer.render(t,this.atlasses[l],!1,null,!1);const d=new PIXI.Texture(this.atlasses[l].baseTexture,new PIXI.Rectangle(r,o,a,h));return this.lookup[e]={texture:d,x:r,y:o,w:a,h:h,aIdx:l},d}getNextRect(e,t){let i=this.nextOpenRects[0],n=0;for(;i&&(i.w<e||i.h<t);)i=this.nextOpenRects[++n];const s=i=>{const n=i.aIdx,s=i.w-e,r=i.h-t;s>=this.subChunkW&&this.nextOpenRects.push({aIdx:n,x:i.x+e,y:i.y,w:s,h:t}),r>=this.subChunkH&&this.nextOpenRects.push({aIdx:n,x:i.x,y:i.y+t,w:e,h:r}),s>=this.subChunkW&&r>=this.subChunkH&&this.nextOpenRects.push({aIdx:n,x:i.x+e,y:i.y+t,w:s,h:r})};if(i)return this.nextOpenRects.splice(n,1),s(i),{aIdx:i.aIdx,x:i.x,y:i.y,w:e,h:t};this.atlasses.push(PIXI.RenderTexture.create(this.maxTextureSize,this.maxTextureSize));const r=this.atlasses.length-1;return s({x:0,y:0,w:this.maxTextureSize,h:this.maxTextureSize,aIdx:r}),{aIdx:r,x:0,y:0,w:e,h:t}}getNextPosition(){let e=this.nextPositions.pop(),t=this.nextPositionIndex;if(e)return[...e,t];if(e=this.nextOpenPositions.pop())return e;this.atlasses.push(PIXI.RenderTexture.create(this.maxTextureSize,this.maxTextureSize)),this.nextPositionIndex=this.atlasses.length-1;for(let e=this.textureStartX;e>=0;e-=this.subChunkH)for(let t=this.textureStartX;t>=0;t-=this.subChunkW)this.nextPositions.push([t,e]);return[...this.nextPositions.pop(),this.nextPositionIndex]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.GET_SECTION_DATA=0]="GET_SECTION_DATA",e[e.REQUEST_AND_SAVE_MAP_CHUNKS=1]="REQUEST_AND_SAVE_MAP_CHUNKS",e[e.REQUEST_AND_SAVE_SINGLE_MAP_CHUNK=2]="REQUEST_AND_SAVE_SINGLE_MAP_CHUNK",e[e.REQUEST_AND_SAVE_ALL_MAP_CHUNKS=3]="REQUEST_AND_SAVE_ALL_MAP_CHUNKS",e[e.INIT_LOADER=4]="INIT_LOADER",e[e.INIT_MAP=5]="INIT_MAP"}(t.Messages||(t.Messages={})),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR"}(t.ResultCodes||(t.ResultCodes={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(13);t.default=n.default},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(14),r=i(15),o=i(17),a=i(19),h=i(1),l=i(0),d=i(24),c=i(25),u=i(34),p=i(35),f=i(11),m=i(2);t.MapCollider=m.Collider;const g=i(7),y=i(37),v=i(4);t.GameObject=v.GameObject;const C=i(39),S=i(40);let w,b=.025,T=[],_=!1;class x{constructor(e){this.mapLoadCount=0,this.cachedMapMetaData={},this.awaitingCollisionEnd=[],this.mapsInitData=[],this.initialized=!1,this.chunkIteration=1,this.elapsed=0,this.elapsedCol=0,this.plugins=[],this.collisionPlugins=[],this.collisionHandlers=[],this.lastCollisions=[],this.seqToTag={},this.seqToProp={},this._isLoadingMap=!1,this._onMapCreatedListeners=[],this._onMapDestroyedListeners=[],this._onBeforeMapDestroyedListeners=[],this.bufferedObjects=[],this.ColliderShapes={RECT:l.RuntimeColliderShape.RECT,POLYGON:l.RuntimeColliderShape.POLYGON,POINT:l.RuntimeColliderShape.POINT,CIRCLE:l.RuntimeColliderShape.CIRCLE,LINE:l.RuntimeColliderShape.LINE,ELIPSE:l.RuntimeColliderShape.ELIPSE},this.basePath=e,this.mainStage=new PIXI.Container,this.gameStage=new PIXI.Container,this.interfaceStage=new PIXI.Container,this.mainStage.addChild(this.gameStage),this.mainStage.addChild(this.interfaceStage),this.plugins=[],this.collisionSystem=w||new y.SpatialGrid,this.collisionManager=new g.CollisionManager(this.collisionSystem),this.getCollidersWithTags=this.collisionManager.getCollidersWithTags.bind(this.collisionManager),this.updateCollisions=this.collisionManager.update.bind(this.collisionManager),this.onAddedCollider=this.collisionManager.onAddedCollider.bind(this.collisionManager),this.onRemovedCollider=this.collisionManager.onRemovedCollider.bind(this.collisionManager),this.offAddedCollider=this.collisionManager.onAddedCollider.bind(this.collisionManager),this.offRemovedCollider=this.collisionManager.onRemovedCollider.bind(this.collisionManager),this.addColliderCouple=this.collisionManager.addColliderCouple.bind(this.collisionManager),this.removeColliderCouple=this.collisionManager.removeColliderCouple.bind(this.collisionManager),this.addColliderCouples=this.collisionManager.addColliderCouples.bind(this.collisionManager),this.removeColliderCouples=this.collisionManager.removeColliderCouples.bind(this.collisionManager),this.onAfterCollisions=this.collisionManager.onAfterCollisions.bind(this.collisionManager),this.onBeforeCollisions=this.collisionManager.onBeforeCollisions.bind(this.collisionManager),this.offAfterCollisions=this.collisionManager.offAfterCollisions.bind(this.collisionManager),this.offBeforeCollisions=this.collisionManager.offBeforeCollisions.bind(this.collisionManager),this.gameObjectManager=new a.GameObjectManager(this.basePath,this.collisionManager),this.addGameObject=this.gameObjectManager.addGameObject.bind(this.gameObjectManager),this.getTexture=this.gameObjectManager.getTexture.bind(this.gameObjectManager),this.onTaggedGameObjectAdded=this.gameObjectManager.onTaggedGameObjectAdded.bind(this.gameObjectManager),this.onTaggedGameObjectRemoved=this.gameObjectManager.onTaggedGameObjectRemoved.bind(this.gameObjectManager),this.onGameObjectAdded=this.gameObjectManager.onGameObjectAdded.bind(this.gameObjectManager),this.onGameObjectRemoved=this.gameObjectManager.onGameObjectRemoved.bind(this.gameObjectManager),w=null}onMapDestroyed(e){this._onMapDestroyedListeners.push(e)}onBeforeMapDestroyed(e){this._onBeforeMapDestroyedListeners.push(e)}offBeforeMapDestroyed(e){this._onBeforeMapDestroyedListeners=this._onMapDestroyedListeners.filter(t=>t!==e)}onMapCreated(e){this._onMapCreatedListeners.push(e)}offMapCreated(e){this._onMapCreatedListeners=this._onMapCreatedListeners.filter(t=>t!==e)}offMapDestroyed(e){this._onMapDestroyedListeners=this._onMapDestroyedListeners.filter(t=>t!==e)}setCollisionSystem(e){this.collisionSystem=e}static useCollisionSystem(e){if(_)throw new Error("World was already initialized or initializing when we called use, to use a plugin with the static method, use world.setCollisionSystem if its already initialized.");w=e}static use(e,t){if(_)throw new Error("World was already initialized or initializing when we called use, to use a plugin with the static method, make sure to call World.use before you call World.init, otherwise use the returned world object's .use method and not the static one.");const i=x.ValidatePlugin(T,e);t&&(i.__opts=t),T.push(i)}use(e,t){switch(e=x.ValidatePlugin(this.plugins,e),this.plugins.push(e),e.type){case s.PluginTypes.Collision:this.collisionManager.addPlugin(e,this,t);break;case s.PluginTypes.GameObject:this.gameObjectManager.addPlugin(e,this,t);break;default:throw new Error(`Failed to install plugin: "${e.name}" All plugins need a type propety of 'collision', 'game_object', or 'map' but the type was set as: "${e.type}"`)}}static ValidatePlugin(e,t,i=!1){let n=i?1:0;const s="function"==typeof t?e.find(e=>e._f&&e._f===t):e.find(e=>e.type===t.type&&e.name===t.name);switch(s&&(n+=2),n){case 0:return"function"==typeof t?t():t;case 1:throw new Error(`Could not find plugin name ${t.name}`);case 2:throw new Error(`Already added plugin of type ${s.type} and name ${s.name}`);case 3:return s}}static addPlugin(e){x.use(e)}addPlugin(e){this.use(e)}static unusePlugin(e){if(_)throw new Error("Use the initialized World instance unusePlugin, not static methods.");{const t=T.indexOf(x.ValidatePlugin(T,e,!0));T.splice(t)}}unusePlugin(e){this.removePlugin(e)}removePlugin(e){(e=x.ValidatePlugin(this.plugins,e,!0)).type===s.PluginTypes.Collision?this.collisionManager.removePlugin(e):e.type===s.PluginTypes.GameObject&&this.gameObjectManager.removePlugin(e);const t=this.plugins.indexOf(e);if(t<0)throw new Error(`Could not find plugin ${e}`);this.plugins.splice(t,1),this.plugins.length}reapplyMapPlugins(){}static init(e,t,i){_=!0;const n={chunkVisibilityInterval:.1,camera:{},resolutionSettings:null};i=i?h.mergeOptions(i,n):n;const s=new x(e);for(let e=0;e<T.length;e++)s.use(T[e],T[e].__opts),delete T.opts;return T.length=0,"undefined"!=typeof window&&window.___plugins&&delete window.___plugins,s._init(e,t,i)}_init(e,t,i){return n(this,void 0,void 0,(function*(){if(this.collisionSystem!==this.collisionManager.collisionSystem&&this.collisionManager.setCollisionSystem(this.collisionSystem),this.renderer=t,i.chunkVisibilityInterval&&(b=i.chunkVisibilityInterval),this.flags={indexedDB:h.indexedDB_enabled(),localStorage:"undefined"!=typeof localStorage,webWorker:"undefined"!=typeof Worker,maxTextureSize:h.resolveMaxTextureSize(t),webGl:1===t.type},this.initialized)throw new Error("World already initialized.");const n=yield h.httpGetAsync(this.basePath+"/meta.json");this.worldMetaData=n;for(let e in n.propSeqToNameLookup)this.seqToProp[e]=n.propSeqToNameLookup[e];for(let e in n.colTags)this.seqToTag[n.colTags[e]]=e;if(this.collisionManager.reapplyPlugins(),this.reapplyMapPlugins(),this.collisionManager.init(this.seqToTag),this.mapsInitData=[],this.worldMetaData.maps.forEach((e,t)=>{e.forEach(e=>{this.mapsInitData.push(Object.assign(Object.assign({},e),{size:t}))})}),delete this.worldMetaData.maps,!n)throw new Error("Failed getting meta data on path"+this.basePath);if(this.flags.indexedDB&&(this.indexDbLoader=new d.Loader(`__ty__${n.world}`),yield this.indexDbLoader.initialize(),this.flags.webWorker)&&(this.chunkWorker=new p.ChunkLoaderWorker,(yield this.chunkWorker.initWorld(n.world,e+"/maps",n.tileSizeSeqLookup,this.seqToTag,this.seqToProp))!==f.ResultCodes.SUCCESS))throw new Error("didnt get success.");return this.interfaceManager=new S.InterfaceManager(this.interfaceStage,this.renderer,this.indexDbLoader),this.addTextureToInterfaceAtlas=this.interfaceManager.addTextureToInterfaceAtlas.bind(this.interfaceManager),this.loadInterfaceTexture=this.interfaceManager.loadTexture.bind(this.interfaceManager),this.addInterfaceItem=this.interfaceManager.addInterfaceItem.bind(this.interfaceManager),this.removeInterfaceItem=this.interfaceManager.removeInterfaceItem.bind(this.interfaceManager),this.clearInterface=this.interfaceManager.clearInterface.bind(this.interfaceManager),yield this.gameObjectManager.init(this.renderer,this.gameStage,this.worldMetaData,this.flags,this.indexDbLoader),this.offTaggedGameObjectAdded=this.gameObjectManager.offTaggedGameObjectAdded.bind(this.gameObjectManager),this.offTaggedGameObjectRemoved=this.gameObjectManager.offTaggedGameObjectRemoved.bind(this.gameObjectManager),this.offGameObjectAdded=this.gameObjectManager.offGameObjectAdded.bind(this.gameObjectManager),this.offGameObjectRemoved=this.gameObjectManager.offGameObjectRemoved.bind(this.gameObjectManager),this.tileManager=new o.TileManager(this.basePath+"/tilesets",n.tilesets,n.tileSizeSeqLookup,this.flags,this.indexDbLoader),yield this.tileManager.init(),this.playerCamera=new u.PlayerCamera(i.camera,this.gameStage,this.flags,this.renderer),this.bindCameraCenter=this.playerCamera.bindCameraCenter.bind(this.playerCamera),this.screenToWorld=this.playerCamera.screenToWorld.bind(this.playerCamera),this.worldToScreen=this.playerCamera.worldToScreen.bind(this.playerCamera),this.resolutionManager=new C.ResolutionManager(this.playerCamera,i.resolutionSettings),this.chunkManager=new c.ChunkManager(this.basePath,t,n,this.mapsInitData,this.seqToTag,this.collisionManager,this.gameObjectManager,this.tileManager,this.playerCamera,this.indexDbLoader,this.chunkWorker),yield this.chunkManager.init(),this.loadedMap=new r.default(this.gameStage,t,this.flags,this.tileManager,this.chunkManager),this.render=this.renderer.render.bind(this.renderer,this.mainStage),this.initialized=!0,this}))}updateMassive(e){this.elapsed+=e,this.elapsedCol+=e,this.elapsed>b&&(this.elapsed=0,this.chunkIteration%2?(this.chunkManager.updateAlmostVisibleChunks(e),this.chunkIteration++):(this.chunkManager.updateVisibleChunks(e),this.chunkIteration=1)),this.chunkManager.nextBatch(),this.playerCamera.updateStage()}updateNoop(e){}updateMedium(e){this.playerCamera.updateStage()}updateSmall(e){this.playerCamera.updateStage()}get isLoadingMap(){return this._isLoadingMap}get isReady(){return!this._isLoadingMap&&!!this.currentMap}loadMap(e,t){var i;return n(this,void 0,void 0,(function*(){if(this._isLoadingMap)throw new Error(`Can not load new map: ${e} until current map: ${this.currentMap} is finished loading`);if(e==this.currentMap)return!0;if(this.currentMap)for(let t=0;t<this._onBeforeMapDestroyedListeners.length;t++)this._onBeforeMapDestroyedListeners[t](this.currentMap,e);if(this.gameStage.visible=!1,this.mapLoadCount++,this._isLoadingMap=!0,this.currentMap=e,this.elapsed=0,this.chunkIteration=0,!this.initialized)throw new Error("Initialize world before loading maps.");this.updateChunks=this.updateNoop.bind(this);const n=this.mapsInitData.find(t=>t.id===e);if(!n)throw new Error(`Could not find init data for map ${e}`);let s=this.chunkManager.getMapMetaData(e,n.ts);if(!s&&(this.cachedMapMetaData[e]||(this.cachedMapMetaData[e]=yield this.chunkManager.requestMapMetaData(e)),s=this.cachedMapMetaData[e]))throw new Error(`could not find map meta data for ${e}`);const r=this.loadedMap.initialized;if(this.loadedMap.reset(),this.playerCamera.reset(),this.collisionManager.reset(),r)for(let e=0;e<this._onMapDestroyedListeners.length;e++)this._onMapDestroyedListeners[e]();this.collisionManager.initMap(s),yield this.loadedMap.initialize(s),this.resolutionManager.setMapLengths(s.mapW,s.mapH),this.playerCamera.updateMapSize(s.mapW,s.mapH),(null===(i=t)||void 0===i?void 0:i.cameraPosition)&&(this.playerCamera.boundCameraCenter&&(this.playerCamera.boundCameraCenter.x=t.cameraPosition.x,this.playerCamera.boundCameraCenter.y=t.cameraPosition.y),this.playerCamera.updateViewRect(t.cameraPosition.x,t.cameraPosition.y));const o=h.resolveMapSize(s.mapW,s.mapH);this.rebindUpdate(o),yield this.chunkManager.loadMap(n.id,s,this.mapLoadCount),this._isLoadingMap=!1;for(let e=0;e<this._onMapCreatedListeners.length;e++)this._onMapCreatedListeners[e](t);return this.gameStage.visible=!0,!0}))}update(e){this.updateChunks(e),this.updateCollisions(e),this.render()}rebindUpdate(e){switch(e){case l.MapSize.LARGE:case l.MapSize.MEDIUM:this.updateChunks=this.updateMassive.bind(this);break;case l.MapSize.SMALL:this.updateChunks=this.updateSmall.bind(this)}}_onCollision(e,t){}_onChangedMap(){}_onAddedColliders(){}_onAddedObject(){}_onRemovedColliders(){}_onRemovedObjects(){}_onShowChunk(){}_onInitializedChunk(){}_onHideChunk(){}_onDestroyChunk(){}static RadianAngleFromPositions(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static DegreeAngleFromPositions(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}}const E={RECT:l.RuntimeColliderShape.RECT,POLYGON:l.RuntimeColliderShape.POLYGON,POINT:l.RuntimeColliderShape.POINT,CIRCLE:l.RuntimeColliderShape.CIRCLE,LINE:l.RuntimeColliderShape.LINE,ELIPSE:l.RuntimeColliderShape.ELIPSE};t.ColliderShapes=E,x.ColliderShapes=E,t.default=x},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Collision="collision",e.Render="render",e.GameObject="game_object",e.Map="map"}(t.PluginTypes||(t.PluginTypes={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(16);t.default=class{constructor(e,t,i,n,s){this.managedPlugins=[],this.initialized=!1,this.panRight=!0,this.layerStages=[],this.stage=e,this.tileManager=n,this.chunkManager=s,this.flags=i,this.tileManager=n,this.initSectionManagerEventHandlers()}removeImageHandlersNoPlugins(e){for(let t=0;t<e.length;t++)if(e[t])for(let i=0;i<e[t].length;i++)e[t][i]&&this.layerStages[t].removeMapSprite(e[t][i])}addImageHandlersNoPlugins(e){for(let t=0;t<e.length;t++)if(e[t])for(let i=0;i<e[t].length;i++)e[t][i]&&(e[t][i].x=e[t][i].worldX,e[t][i].y=e[t][i].worldY,this.layerStages[t].addMapSprite(e[t][i]))}initSectionManagerEventHandlers(){this.chunkManager.on("add-subchunk-layer-sprite",({layerIndex:e,sprite:t})=>{this.layerStages[e].addSubChunk(t)}),this.chunkManager.on("remove-map-chunks",e=>{for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)e[t][i]&&this.layerStages[t].removeChild(e[t][i])}),this.chunkManager.on("add-map-sub-chunks",e=>{for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const t=this.layerStages[e],n=i[e];n&&n.parent!==t&&t.addSubChunk(n)}}}),this.chunkManager.on("add-map-chunk-layers",e=>{for(let t=0;t<e.length;t++)e[t]&&this.layerStages[t].addSubChunk(e[t])}),this.chunkManager.on("add-map-chunks",e=>{for(let t=0;t<e.length;t++)this.layerStages[t].addSubChunks(e[t])})}updateStages(){for(let e=0;e<this.metaData.layerTileLayerOrder.length;e++)this.panRight?(this.layerStages[e].x-=1,this.layerStages[e].y-=1,e===this.metaData.layerTileLayerOrder.length-1&&this.layerStages[e].x<=-250&&(this.panRight=!1)):(this.layerStages[e].x+=1,this.layerStages[e].y+=1,e===this.metaData.layerTileLayerOrder.length-1&&this.layerStages[e].x>=0&&(this.panRight=!0))}initialize(e){return n(this,void 0,void 0,(function*(){if(this.initialized)throw new Error("TileMap is already initialized, call either map.reset or map.destroy before initializing a new map.");this.metaData=e;for(let t=0;t<e.layerTileLayerOrder.length;t++)this.layerStages.push(new s.LayerContainer),this.stage.addChild(this.layerStages[t]);return this.initialized=!0,!0}))}setPlayerViewRect(e,t){}setPlayer(e){}addSprite(e){}removeSprite(e){}reset(){if(this.initialized){this.managedPlugins.forEach(e=>{}),this.initialized=!1,this.chunkManager.reset();for(let e=0;e<this.metaData.layerTileLayerOrder.length;e++)this.layerStages[e]&&this.layerStages[e].destroyLayer();this.layerStages.length=0,this.initialized=!1}}sleep(e){}removeColliderType(e){}addColliderType(e){}addColliderToSprite(e,t){}addCollider(e){}onBlockerDataAdded(e){this.onBlockerDataAddedHandler=e}onBlockerDataRemoved(e){this.onBlockerDataRemovedHandler=e}_onBlockerDataAdded(e,t){this.onBlockerDataAddedHandler&&this.onBlockerDataAddedHandler(e,t)}_onBlockerDataRemoved(e,t){this.onBlockerDataRemovedHandler&&this.onBlockerDataAddedHandler(e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends PIXI.Container{constructor(e){super(),this.subChunks=[],e&&(this.tags=e)}destroyLayer(){if(this.objectContainer){const e=Array.from(this.objectContainer.children);for(let t=0;t<e.length;t++)delete e[t].layerIndex,delete e[t].layerParent,this.objectContainer.removeChild(e[t]);this.destroyObjectContainer()}this.children&&Array.from(this.children).forEach(e=>{e.parent.removeChild(e),e.destroy()}),this.parent&&this.parent.removeChild(this),this.destroy()}addSubChunk(e){if(this.objectContainer){if(this.children.pop()!==this.objectContainer)throw new Error("Last child should always be object container.");this.addChild(e),this.addChild(this.objectContainer)}else this.addChild(e)}addSubChunks(e){if(this.objectContainer){if(this.children.pop()!==this.objectContainer)throw new Error("Last child should always be object container.");for(let t=0;t<e.length;t++)this.addChild(e[t]);this.addChild(this.objectContainer)}else for(let t=0;t<e.length;t++)this.addChild(e[t])}destroyObjectContainer(){this.removeChild(this.objectContainer),this.objectContainer.destroy(),delete this.objectContainer}removeMapSprite(e,t=!1){const i=e.delegatedSprite||e;if(i.parent!==this.objectContainer)throw console.error(e),new Error("Error removing sprite, it wasnt a child");if(delete e.layerParent,delete e.layerIndex,!t&&e.removeFromMap(),this.objectContainer.removeChild(i),!this.objectContainer.children.length)return this.destroyObjectContainer(),!0}addMapSprite(e){const t=e.delegatedSprite||e;this.objectContainer?e.zIndex<this.objectContainer.children[this.objectContainer.children.length-1].zIndex?(this.objectContainer.addChild(t),this.objectContainer.children.sort((e,t)=>e.sortByY&&t.sortByY?e.ySortPoint-t.ySortPoint:e.sortByY&&!t.sortByY?t.zIndex===Number.MAX_SAFE_INTEGER?-1:e.ySortPoint-t.ySortPoint:!e.sortByY&&t.sortByY?e.zIndex===Number.MAX_SAFE_INTEGER?1:e.ySortPoint-t.ySortPoint:e.zIndex-t.zIndex)):this.objectContainer.addChild(t):(this.objectContainer=new PIXI.Container,this.addChild(this.objectContainer),this.objectContainer.addChild(t))}}t.LayerContainer=n},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(18);t.TileManager=class{constructor(e,t,i,n,s){this.tilesetMetaDataToLoad={},this.tilesets=[],this.spritePool=[],this.cachedTileColliders={},this.tileSizeSeqLookup=[],this.baseUrl=e,this.tileSizeSeqLookup=i,this.tilesets=new Array(i.length/2).fill(1).map(()=>[]),this.indexedDbEnabled=n.indexedDB,this.flags=n,this.loader=new PIXI.loaders.Loader,this.tilesetMetaData=t,this.indexDbLoader=s}init(){return n(this,void 0,void 0,(function*(){for(let e=0;e<this.tilesetMetaData.length;e++){const t=this.tilesetMetaData[e];yield this.loadTileset(t)}return!0}))}removeTileset(e,t){}loadTileset(e){return n(this,void 0,void 0,(function*(){try{const t=new s.Tileset(e,this.loader,this.baseUrl,this.indexDbLoader);yield t.loadResources();let i=-1;for(let e=0;e<this.tileSizeSeqLookup.length;e+=2)if(this.tileSizeSeqLookup[e]===t.tilesetData.tileWidth&&this.tileSizeSeqLookup[e+1]===t.tilesetData.tileHeight){i=e/2;break}if(i<0)throw new Error("Could not find the correct seq for tileset: "+JSON.stringify(e));return this.tilesets[i].push(t),!0}catch(e){throw console.error(e),e}}))}getTile(e,t){let i,n;for(let s=0;s<this.tilesets[e].length;s++){const{startIndex:r,endIndex:o}=this.tilesets[e][s];t>=r&&t<o&&(i=this.tilesets[e][s].getTileTexture(t),n=this.tilesets[e][s].getColliders(t))}let s=this.spritePool.pop();return s||((s=new PIXI.Sprite).removeFromMap=e=>{delete s.colliders,s.visible=!1,s.parent&&s.parent.removeChild(s),s.texture=null,s.rotation=0,s.scale.set(1,1),s.anchor.set(0,0),this.spritePool.push(s)}),s.colliders=n,s.texture=i,s.visible=!0,s}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(1);t.Tileset=class{constructor(e,t,i,n){this.createdTexturesLookup={},this.spritePool={},this.tileColliderLookup={},this.loaded=!1,this.indexedDbLoader=n,this.baseUrl=i,this.tilesetId=e.id,this.jsonUrl=this.baseUrl+"/"+s.removeFileExtension(this.tilesetId)+".json",this.pngUrl=this.baseUrl+"/"+s.removeFileExtension(this.tilesetId)+".png",this.lastUpdateTsData=e.dataTs,this.lastUpdateTsImage=e.imageTs,this.loader=t||PIXI.loader}get tilesetTextureKey(){return`ts_${this.tilesetId}_texture`}get tilesetLastUpdateImageKey(){return`ts_${this.tilesetId}_last_update_image`}get tilesetLastUpdateDataKey(){return`ts_${this.tilesetId}_last_update_data`}destroy(){}makeTexture(e){let t=(e-=this.startIndex)%this.tilesetColumns*this.tileWidth,i=Math.floor(e/this.tilesetColumns)*this.tileHeight;return new PIXI.Texture(this.tilesetTexture.baseTexture,new PIXI.Rectangle(t,i,this.tileWidth,this.tileHeight))}loadTexture(){return n(this,void 0,void 0,(function*(){if("undefined"==typeof localStorage||!this.indexedDbLoader)return new Promise((e,t)=>{this.loader.load((t,i)=>(this.tilesetTexture=i[this.tilesetTextureKey].texture,e(!0)))});{const e=()=>n(this,void 0,void 0,(function*(){return this.loader.add(this.tilesetTextureKey,this.pngUrl),new Promise((e,t)=>{this.loader.load((t,i)=>{this.tilesetTexture||(this.tilesetTexture=i[this.tilesetTextureKey].texture),this.indexedDbLoader.saveTexture(this.pngUrl,i[this.tilesetTextureKey].texture).then(()=>(localStorage.setItem(this.tilesetLastUpdateImageKey,`${this.lastUpdateTsImage+1}`),e(!0)))})})})),t=localStorage.getItem(this.tilesetLastUpdateImageKey);if(t&&parseInt(t)>this.lastUpdateTsImage)return this.tilesetTexture=yield this.indexedDbLoader.loadTexture(this.pngUrl),this.tilesetTexture||(yield e()),!0;yield e()}}))}loadData(){return n(this,void 0,void 0,(function*(){if("undefined"!=typeof localStorage&&this.indexedDbLoader){const e=()=>n(this,void 0,void 0,(function*(){if(this.tilesetData=yield s.httpGetAsync(this.jsonUrl),!this.tilesetData)throw console.error(this),new Error("Can not load tileset data");yield this.indexedDbLoader.saveJson(this.jsonUrl,this.tilesetData),localStorage.setItem(this.tilesetLastUpdateDataKey,`${this.lastUpdateTsData+1}`)})),t=localStorage.getItem(this.tilesetLastUpdateDataKey);t&&parseInt(t)>this.lastUpdateTsData?(this.tilesetData=yield this.indexedDbLoader.loadJson(this.jsonUrl),this.tilesetData||(yield e()),this.lastCachedTs=t?parseInt(t):0):yield e()}else this.tilesetData=yield s.httpGetAsync(this.jsonUrl);return this.startIndex=this.tilesetData.startingIndex,!0}))}loadResources(){return n(this,void 0,void 0,(function*(){yield Promise.all([this.loadData(),this.loadTexture()]),this.loaded=!0,this.tileWidth=this.tilesetData.tileWidth,this.tileHeight=this.tilesetData.tileHeight,this.imageWidth=this.tilesetTexture.width,this.imageHeight=this.tilesetTexture.height,this.tilesetColumns=this.imageWidth/this.tileWidth;const e=Math.ceil(this.imageWidth/this.tileWidth)*Math.ceil(this.imageHeight/this.tileHeight);return this.endIndex=this.tilesetData.startingIndex+e,!0}))}getColliders(e){for(let t=0;t<this.tilesetData.tileData.length;t++){if(this.tilesetData.tileData[t].id==e)return this.tilesetData.tileData[t];if(this.tilesetData.tileData[t].id>e)return null}return null}getTileTexture(e){let t=this.createdTexturesLookup[e];return t||(t=this.makeTexture(e),this.createdTexturesLookup[e]=t),t}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),r=i(1),o=i(9),a=i(23);t.GameObjectManager=class{constructor(e,t){this.taggedGameObjectAddedListeners={},this.taggedGameObjectRemovedListeners={},this.cachedImageData={},this.pendingLoads={},this.lastTouchedTimestamps={},this.userGameObjectAtlasses=[],this.cachedImageTextures={},this.userTextures=[],this.userTextureCacheTimestampLookup={},this.textureAtlasses=[],this.gameObjPool=[],this.installedPlugins=[],this.baseUrl=e+"/images",this.loader=new PIXI.loaders.Loader,this.collisionManager=t,this.tagSeqToId=this.collisionManager.seqToTag}reinit(e){this.imageData=e,this.removeUntouched()}removePlugin(e){const t=this.installedPlugins.indexOf(e);if(t<0)throw new Error(`Trying to remove non installed plugin: ${e.name}`);if(e.onGameObjectAdded&&this.offGameObjectAdded(e.onGameObjectAdded),e.onGameObjectRemoved&&this.offGameObjectRemoved(e.onGameObjectRemoved),e.onTaggedGameObjectAdded)for(let t in e.onTaggedGameObjectAdded)this.offTaggedGameObjectAdded(t,e.onTaggedGameObjectAdded[t]);if(e.onTaggedGameObjectRemoved)for(let t in e.onTaggedGameObjectRemoved)this.offTaggedGameObjectRemoved(t,e.onTaggedGameObjectRemoved[t]);this.installedPlugins.splice(t,1)}addPlugin(e,t,i){if(this.installedPlugins.includes(e))throw new Error(`Already installed plugin: ${e.name}`);if(e.init&&e.init(t,i),e.onGameObjectAdded&&(e.onGameObjectAdded=e.onGameObjectAdded.bind(e),this.onGameObjectAdded(e.onGameObjectAdded)),e.onGameObjectRemoved&&(e.onGameObjectRemoved=e.onGameObjectRemoved.bind(e),this.onGameObjectRemoved(e.onGameObjectRemoved)),e.onTaggedGameObjectAdded)for(let t in e.onTaggedGameObjectAdded)e.onTaggedGameObjectAdded[t]=e.onTaggedGameObjectAdded[t].bind(e),this.onTaggedGameObjectAdded(t,e.onTaggedGameObjectAdded[t]);if(e.onTaggedGameObjectRemoved)for(let t in e.onTaggedGameObjectRemoved)e.onTaggedGameObjectRemoved[t]=e.onTaggedGameObjectRemoved[t].bind(e),this.onTaggedGameObjectRemoved(t,e.onTaggedGameObjectRemoved[t])}isAnimatingImage(e){return!1}addTextures(e){}getImageData(e){return n(this,void 0,void 0,(function*(){if(e in this.cachedImageData)return this.cachedImageData[e]?JSON.parse(this.cachedImageData[e]):null;const t=yield this.loadImageColliderData(e);return t?(this.cachedImageData[e]=JSON.stringify({colliders:t}),{colliders:t}):(this.cachedImageData[e]=null,null)}))}checkForImageInCache(e){return this.gameObjectImageAtlas.getTexture(e)||(this.cachedImageTextures[e]?this.cachedImageTextures[e]:null)}getMapImageTexture(e){return n(this,void 0,void 0,(function*(){const t=`${this.baseUrl}/i_${e}`,i=this.checkForImageInCache(t);if(i)return i;if(this.pendingLoads[e])return new Promise((t,i)=>{this.pendingLoads[e].push(e=>(console.error("Resolving!!!"),t(e)))});this.pendingLoads[e]=[];const n=yield this.loadImageTexture(t);if(delete this.pendingLoads[e],n){if(n.width<=this.flags.maxTextureSize&&n.height<=this.flags.maxTextureSize)return this.gameObjectImageAtlas.addTexture(t,n,null,!0);this.cachedImageTextures[t]=n}return this.cachedImageTextures[t]}))}reset(){this.gameObjPool.length>20&&(this.gameObjPool.length=20)}init(e,t,i,s,r){return n(this,void 0,void 0,(function*(){this.flags=s,this.gameStage=t,this.renderer=e,this.worldMetaData=i,this.indexedDbLoader=r,this.gameObjectImageAtlas=o.AtlasFactory(e,r),yield this.updateStorage()}))}parseColliderData(e){return Object.keys(e).forEach(t=>{e[t].forEach(e=>{e.tags&&e.tags.length&&(e.tags=e.tags.map(e=>{if(!this.tagSeqToId[e])throw new Error(`Could not find tag ${e}`);return this.tagSeqToId[e]}))})}),e}loadImagesHttp(e){return n(this,void 0,void 0,(function*(){const t=yield r.httpGetAsync(`${this.baseUrl}/atlas_data.json`),i={atlasData:t.atlasData,colliderData:t.colliderData?this.parseColliderData(t.colliderData):{},atlasImages:[]};return i.atlasImages=e?yield Promise.all(e.map(e=>n(this,void 0,void 0,(function*(){const t=yield r.httpGetAsync(`${this.baseUrl}/atlas_images/atlas_${e}.png`,!1),i=yield r.getTextureFromBlob(t);return{atlasIndex:e,texture:i}})))):yield Promise.all(i.atlasData.map(e=>n(this,void 0,void 0,(function*(){const t=yield r.httpGetAsync(`${this.baseUrl}/atlas_images/atlas_${e.aIdx}.png`,!1),i=yield r.getTextureFromBlob(t);return{atlasIndex:e.aIdx,texture:i}})))),i}))}splitAndSaveImage(e,t,i,s,r,o,a){return n(this,void 0,void 0,(function*(){const n=new PIXI.Texture(o,new PIXI.Rectangle(t,i,s,r)),h=new PIXI.Sprite(n),l=this.renderer.extract.base64(h);return a?yield this.indexedDbLoader.saveJson(`${this.baseUrl}/i_${e}.json`,a):yield this.indexedDbLoader.deleteItem(`${this.baseUrl}/i_${e}.json`),this.indexedDbLoader.saveImageData(`${this.baseUrl}/i_${e}`,l)}))}loadImageColliderData(e){return n(this,void 0,void 0,(function*(){let t=null;const i=`${this.baseUrl}/i_${e}.json`;if(this.flags.indexedDB)try{t=yield this.indexedDbLoader.loadJson(i)}catch(e){try{t=yield r.httpGetAsync(i)}catch(e){console.error(e)}}else try{t=yield r.httpGetAsync(i)}catch(e){console.error(e)}return t}))}getCachedUserTextureTimestamp(){return n(this,void 0,void 0,(function*(){const e=()=>{this.clearUserTextureCacheTimeout=setTimeout(()=>{this.clearUserTextureCacheTimeout=null,this.userTextureCacheNeedsResave&&(this.userTextureCacheNeedsResave=!1,this.indexedDbLoader.saveJson("_user_texture_cache_data",this.userTextureCacheTimestampLookup).then(()=>{delete this.userTextureCacheTimestampLookup})),delete this.userTextureCacheTimestampLookup},5e3)};return this.userTextureCacheTimestampLookup?(this.clearUserTextureCacheTimeout&&clearTimeout(this.clearUserTextureCacheTimeout),e(),this.userTextureCacheTimestampLookup):this.indexedDbLoader?(this.userTextureCacheTimestampLookup=yield this.indexedDbLoader.loadJson("_user_texture_cache_data"),this.userTextureCacheTimestampLookup||(this.userTextureCacheTimestampLookup={},yield this.indexedDbLoader.saveJson("_user_texture_cache_data",this.userTextureCacheTimestampLookup)),e(),this.userTextureCacheTimestampLookup):null}))}getTexture(e,t){return n(this,void 0,void 0,(function*(){t=t||{addToAtlas:!0};const i=this.checkForImageInCache(e);if(i)return i;if(t.cacheFor&&this.indexedDbLoader){const i=yield this.getCachedUserTextureTimestamp();if(i[e]&&i[e]<Date.now()){this.pendingLoads[e]=[];const t=yield this.loadImageTexture(e);return delete this.pendingLoads[e],t}{const i=yield r.httpGetAsync(e,!1);if(!i)throw new Error(`Could not find image texture at path: ${e}`);yield this.indexedDbLoader.saveImageData(e,i);const n=yield r.getTextureFromBlob(i);return(yield this.getCachedUserTextureTimestamp())[e]=Date.now()+t.cacheFor,this.userTextureCacheNeedsResave=!0,t.addToAtlas&&n.width<this.flags.maxTextureSize&&n.height<this.flags.maxTextureSize?this.gameObjectImageAtlas.addTexture(e,n,"runtime",!0):n}}{const i=yield r.httpGetAsync(e,!1);if(!i)throw new Error(`Could not find image texture at path: ${e}`);const n=yield r.getTextureFromBlob(i);return t.addToAtlas&&n.width<this.flags.maxTextureSize&&n.height<this.flags.maxTextureSize?this.gameObjectImageAtlas.addTexture(e,n,"runtime",!0):n}}))}loadImageTexture(e){var t;return n(this,void 0,void 0,(function*(){let i="";if(this.flags.indexedDB&&(i=yield this.indexedDbLoader.loadImageData(e)),i||(console.warn("Did not load image data ",e,"from indexddb, going to server."),i=yield r.httpGetAsync(e,!1)),!i)throw new Error(`Failed all method of getting image ${e}`);const n=yield r.getTextureFromDataUrl(i);return null===(t=this.pendingLoads[e])||void 0===t||t.forEach(e=>{e(n)}),delete this.pendingLoads[e],n}))}updateStorage(){return n(this,void 0,void 0,(function*(){const e=[],t=[];if(this.flags.localStorage&&this.flags.indexedDB){let i=localStorage.getItem(`${this.baseUrl}/update_timestamps`);const n=[];if(i){const s=JSON.parse(i);for(let i=0;i<s.length;i++){if(!this.worldMetaData.images[i]){t.push(i);continue}const s=this.worldMetaData.images[i];n.push(s),e.push(i)}const r=i.length-this.worldMetaData.images.length;if(r<0){const t=i.length+Math.abs(r);for(let s=i.length;s<t;s++)e.push(t),n.push(this.worldMetaData.images[s])}}else for(let t=0;t<this.worldMetaData.images.length;t++)n.push(this.worldMetaData.images[t]),e.push(t);if(e.length){localStorage.setItem(`${this.baseUrl}/update_timestamps`,JSON.stringify(n));const{atlasData:t,atlasImages:i,colliderData:s}=yield this.loadImagesHttp(e);yield Promise.all(i.map(({atlasIndex:e,texture:i})=>{const n=t.find(t=>t.aIdx==e);return!(!n||!n.images)&&n.images.map(({id:e,x:t,y:n,w:r,h:o})=>this.splitAndSaveImage(e,t,n,r,o,i.baseTexture,s[e]))}))}}}))}onGameObjectAdded(e){this.gameObjectAddedListeners?this.gameObjectAddedListeners.push(e):this.gameObjectAddedListeners=[e]}onGameObjectRemoved(e){this.gameObjectRemovedListeners?this.gameObjectRemovedListeners.push(e):this.gameObjectRemovedListeners=[e]}offGameObjectAdded(e){for(let t=0;t<this.gameObjectAddedListeners.length;t++)if(this.gameObjectAddedListeners[t]===e)return this.gameObjectAddedListeners.splice(t,1),this.gameObjectAddedListeners.length||delete this.gameObjectAddedListeners,!0;return!1}offGameObjectRemoved(e){for(let t=0;t<this.gameObjectRemovedListeners.length;t++)if(this.gameObjectRemovedListeners[t]===e)return this.gameObjectRemovedListeners.splice(t,1),this.gameObjectRemovedListeners.length||delete this.gameObjectRemovedListeners,!0;return!1}onTaggedGameObjectAdded(e,t){this.taggedGameObjectAddedListeners[e]?this.taggedGameObjectAddedListeners[e].push(t):this.taggedGameObjectAddedListeners[e]=[t]}offTaggedGameObjectAdded(e,t){const i=this.taggedGameObjectAddedListeners[e];if(!i)return!1;for(let n=0;n<i.length;n++)if(i[n]===t)return i.splice(n,1),i.length||delete this.taggedGameObjectAddedListeners[e],!0}onTaggedGameObjectRemoved(e,t){this.taggedGameObjectRemovedListeners[e]?this.taggedGameObjectRemovedListeners[e].push(t):this.taggedGameObjectRemovedListeners[e]=[t]}offTaggedGameObjectRemoved(e,t){const i=this.taggedGameObjectRemovedListeners[e];if(!i)return!1;for(let n=0;n<i.length;n++)if(i[n]===t)return i.splice(n,1),i.length||delete this.taggedGameObjectRemovedListeners[e],!0}addGameObject(e){var t,i,n;let r=this.gameObjPool.pop();return r||(r=new s.GameObject(this.gameObjPool,this.collisionManager,this.gameStage,this)),null===(t=this.gameObjectAddedListeners)||void 0===t||t.forEach(e=>e(r)),null===(n=null===(i=e)||void 0===i?void 0:i.tags)||void 0===n||n.forEach(e=>{var t;return null===(t=this.taggedGameObjectAddedListeners[e])||void 0===t?void 0:t.forEach(e=>e(r))}),r.init(e),r}_getMapImage(e,t,i,r,o){var h,l;return n(this,void 0,void 0,(function*(){const n=yield this.getMapImageTexture(e);let d;if(r>999999){const{id:e,flips:t}=a.decodeRotation(r);r=e,d=t}let c=yield this.getImageData(e);c?(c.layer=o,c.position={x:t,y:i},c.zIndex=r,c.flips=d):c={layer:o,position:{x:t,y:i},zIndex:r,flips:d},c.texture=n;let u=this.gameObjPool.pop();return u||(u=new s.GameObject(this.gameObjPool,this.collisionManager,this.gameStage,this)),u.init(c),null===(h=this.gameObjectAddedListeners)||void 0===h||h.forEach(e=>e(u)),null===(l=c.tags)||void 0===l||l.forEach(e=>{var t;return null===(t=this.taggedGameObjectAddedListeners[e])||void 0===t?void 0:t.forEach(e=>e(u))}),u}))}removeImage(e){}removeUntouched(e=3e4){const t=Object.keys(this.lastTouchedTimestamps),i=Date.now();for(let n=0;n<t.length;n++)i-this.lastTouchedTimestamps[t[n]]>=e&&this.removeImage(t[n])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(21);class s extends n.BaseGameObjectAtlas{constructor(e,t){super(2048,e)}removeTextureFromAtlas(e,t,i){if(!(e in this.cachedTextures))throw new Error(`Could not find id ${e}`);this.cachedTextures[e].destroy(!1),delete this.cachedTextures[e],this.renderer.bindRenderTexture(this.atlasses[i],null);const n=this.renderer.gl;n.enable(n.SCISSOR_TEST),n.scissor(t.x,t.y,t.w,t.h),this.renderer.clear(),this.renderer.bindRenderTexture()}}t.WebGlGameObjectAtlas=s},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(22);t.BaseGameObjectAtlas=class{constructor(e,t,i){this.nextOpenPositions=[],this.atlasses=[],this.cachedTextures={},this.loader=i,this.maxTextureSize=e>=4096?e-e%4096:e>=2048?e-e%2048:e>=1024?e-e%1024:e>=512?e-e%512:256,this.renderer=t,this.packer=new s.MaxRectsPacker(this.maxTextureSize,this.maxTextureSize,0,{smart:!0,pot:!0,allowRotation:!1,tag:!0})}getTexture(e){return this.cachedTextures[e]}addTexture(e,t,i,n=!1){if(e in this.cachedTextures)throw new Error("Trying to add texture twice.");const s={id:e,width:t.width,height:t.height};i&&(s.tag=i);const r=this.packer.add(s);let o=-1;for(let t=0;t<this.packer.bins.length;t++){for(let i=0;i<this.packer.bins[t].rects.length;i++)if(this.packer.bins[t].rects[i].id===e){o=t;break}if(o>-1)break}if(o<0)throw new Error(`No atlas index found for image after adding texture ${e}`);this.atlasses[o]||this.atlasses.push(PIXI.RenderTexture.create(this.maxTextureSize,this.maxTextureSize));const a=this.atlasses[o];if(!a)throw new Error("Should have texture atlas at this point");const h=new PIXI.Sprite(t);return h.setTransform(r.x,r.y),this.renderer.render(h,a,!1),this.cachedTextures[e]=new PIXI.Texture(a.baseTexture,new PIXI.Rectangle(r.x,r.y,r.width,r.height)),n&&h.destroy({texture:!0,baseTexture:!0}),this.cachedTextures[e]}loadSheet(e){return n(this,void 0,void 0,(function*(){if(!this.loader)throw new Error("Indexeddb is not supported.");return!1}))}saveSheet(e){return n(this,void 0,void 0,(function*(){if(!this.loader)throw new Error("Indexeddb is not supported.");return!1}))}}},function(e,t,i){"use strict";i.r(t),i.d(t,"Bin",(function(){return s})),i.d(t,"MaxRectsBin",(function(){return r})),i.d(t,"MaxRectsPacker",(function(){return l})),i.d(t,"OversizedElementBin",(function(){return o})),i.d(t,"PACKING_LOGIC",(function(){return h})),i.d(t,"Rectangle",(function(){return n}));class n{constructor(e=0,t=0,i=0,n=0,s=!1,r){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=t,this._x=i,this._y=n,this._data={},this._rot=s,this._allowRotation=r}static Collide(e,t){return e.collide(t)}static Contain(e,t){return e.contain(t)}area(){return this.width*this.height}collide(e){return e.x<this.x+this.width&&e.x+e.width>this.x&&e.y<this.y+this.height&&e.y+e.height>this.y}contain(e){return e.x>=this.x&&e.y>=this.y&&e.x+e.width<=this.x+this.width&&e.y+e.height<=this.y+this.height}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._dirty++)}get height(){return this._height}set height(e){e!==this._height&&(this._height=e,this._dirty++)}get x(){return this._x}set x(e){e!==this._x&&(this._x=e,this._dirty++)}get y(){return this._y}set y(e){e!==this._y&&(this._y=e,this._dirty++)}get rot(){return this._rot}set rot(e){if(!1!==this._allowRotation&&this._rot!==e){const t=this.width;this.width=this.height,this.height=t,this._rot=e,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(e){this._allowRotation!==e&&(this._allowRotation=e,this._dirty++)}get data(){return this._data}set data(e){null!==e&&e!==this._data&&(this._data=e,"object"==typeof e&&e.hasOwnProperty("allowRotation")&&(this._allowRotation=e.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(e=!0){this._dirty=e?this._dirty+1:0}}class s{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some(e=>e.dirty)}setDirty(e=!0){if(this._dirty=e?this._dirty+1:0,!e)for(let e of this.rects)e.setDirty&&e.setDirty(!1)}}class r extends s{constructor(e=a,t=a,i=0,s={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0,logic:h.MAX_EDGE}){super(),this.maxWidth=e,this.maxHeight=t,this.padding=i,this.options=s,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.width=this.options.smart?0:e,this.height=this.options.smart?0:t,this.border=this.options.border?this.options.border:0,this.freeRects.push(new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new n(this.width,this.height)}add(...e){let t,i;if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsBin.add(): Wrong parameters");let t=(i=e[0]).data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.tag!==t)return}else{if(t=e.length>2?e[2]:null,this.options.tag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}(i=new n(e[0],e[1])).data=t,i.setDirty(!1)}const s=this.place(i);return s&&this.rects.push(s),s}repack(){let e=[];this.reset(),this.rects.sort((e,t)=>{const i=Math.max(t.width,t.height)-Math.max(e.width,e.height);return 0===i&&e.hash&&t.hash?e.hash>t.hash?-1:1:i});for(let t of this.rects)this.place(t)||e.push(t);for(let t of e)this.rects.splice(this.rects.indexOf(t),1);return e.length>0?e:void 0}reset(e=!1,t=!1){e&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],t&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new n(this.width,this.height),this._dirty=0}place(e){let t,i,s=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(!this.options.tag||this.tag===s){if(i=e.hasOwnProperty("_allowRotation")&&void 0!==e.allowRotation?e.allowRotation:this.options.allowRotation,t=this.findNode(e.width+this.padding,e.height+this.padding,i)){this.updateBinSize(t);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],t)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,e.x=t.x,e.y=t.y,void 0===e.rot&&(e.rot=!1),e.rot=t.rot?!e.rot:e.rot,this._dirty++,e}if(this.verticalExpand){if(this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(e)}else if(this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(e)}}findNode(e,t,i){let s,r,o,a=Number.MAX_VALUE;for(let l in this.freeRects)(r=this.freeRects[l]).width>=e&&r.height>=t&&(s=this.options.logic===h.MAX_AREA?r.width*r.height-e*t:Math.min(r.width-e,r.height-t))<a&&(o=new n(e,t,r.x,r.y),a=s),i&&r.width>=t&&r.height>=e&&(s=this.options.logic===h.MAX_AREA?r.width*r.height-t*e:Math.min(r.height-e,r.width-t))<a&&(o=new n(t,e,r.x,r.y,!0),a=s);return o}splitNode(e,t){if(!e.collide(t))return!1;if(t.x<e.x+e.width&&t.x+t.width>e.x){if(t.y>e.y&&t.y<e.y+e.height){let i=new n(e.width,t.y-e.y,e.x,e.y);this.freeRects.push(i)}if(t.y+t.height<e.y+e.height){let i=new n(e.width,e.y+e.height-(t.y+t.height),e.x,t.y+t.height);this.freeRects.push(i)}}if(t.y<e.y+e.height&&t.y+t.height>e.y){if(t.x>e.x&&t.x<e.x+e.width){let i=new n(t.x-e.x,e.height,e.x,e.y);this.freeRects.push(i)}if(t.x+t.width<e.x+e.width){let i=new n(e.x+e.width-(t.x+t.width),e.height,t.x+t.width,e.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let e=0,t=0,i=this.freeRects.length;for(;e<i;){t=e+1;let n=this.freeRects[e];for(;t<i;){let s=this.freeRects[t];if(s.contain(n)){this.freeRects.splice(e,1),e--,i--;break}n.contain(s)&&(this.freeRects.splice(t,1),t--,i--),t++}e++}}updateBinSize(e){if(!this.options.smart)return!1;if(this.stage.contain(e))return!1;let t=Math.max(this.width,e.x+e.width-this.padding+this.border),i=Math.max(this.height,e.y+e.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,e.x+e.height-this.padding+this.border),s=Math.max(this.height,e.y+e.width-this.padding+this.border);n*s<t*i&&(t=n,i=s)}return this.options.pot&&(t=Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(t=i=Math.max(t,i)),!(t>this.maxWidth+this.padding||i>this.maxHeight+this.padding||(this.expandFreeRects(t+this.padding,i+this.padding),this.width=this.stage.width=t,this.height=this.stage.height=i,0))}expandFreeRects(e,t){this.freeRects.forEach((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,e)&&(i.width=e-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,t)&&(i.height=t-i.y-this.border)},this),this.freeRects.push(new n(e-this.width-this.padding,t-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new n(e-2*this.border,t-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter(e=>!(e.width<=0||e.height<=0||e.x<this.border||e.y<this.border)),this.pruneFreeList()}}class o extends s{constructor(...e){if(super(),this.rects=[],1===e.length){if("object"!=typeof e[0])throw new Error("OversizedElementBin: Wrong parameters");const t=e[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=e[0],this.height=e[1],this.data=e.length>2?e[2]:null;const t=new n(this.width,this.height);t.oversized=!0,t.data=this.data,this.rects.push(t)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(e=!1){}repack(){}}const a=4096;var h;!function(e){e[e.MAX_AREA=0]="MAX_AREA",e[e.MAX_EDGE=1]="MAX_EDGE"}(h||(h={}));class l{constructor(e=a,t=a,i=0,n={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,border:0,logic:h.MAX_EDGE}){this.width=e,this.height=t,this.padding=i,this.options=n,this._currentBinIndex=0,this.bins=[]}add(...e){if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=e[0];if(t.width>this.width||t.height>this.height)this.bins.push(new o(t));else if(!this.bins.slice(this._currentBinIndex).find(e=>void 0!==e.add(t))){let e=new r(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(e.tag=i),e.add(t),this.bins.push(e)}return t}{const t=new n(e[0],e[1]);if(e.length>2&&(t.data=e[2]),t.width>this.width||t.height>this.height)this.bins.push(new o(t));else if(!this.bins.slice(this._currentBinIndex).find(e=>void 0!==e.add(t))){let e=new r(this.width,this.height,this.padding,this.options);this.options.tag&&t.data.tag&&(e.tag=t.data.tag),e.add(t),this.bins.push(e)}return t}}addArray(e){this.sort(e,this.options.logic).forEach(e=>this.add(e))}reset(){this.bins=[],this._currentBinIndex=0}repack(e=!0){if(e){let e=[];for(let t of this.bins)if(t.dirty){let i=t.repack();i&&e.push(...i)}return void this.addArray(e)}if(!this.dirty)return;const t=this.rects;this.reset(),this.addArray(t)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(e){e.forEach((e,t)=>{if(e.maxWidth>this.width||e.maxHeight>this.height)this.bins.push(new o(e.width,e.height,{}));else{let i=new r(this.width,this.height,this.padding,e.options);i.freeRects.splice(0),e.freeRects.forEach((e,t)=>{i.freeRects.push(new n(e.width,e.height,e.x,e.y))}),i.width=e.width,i.height=e.height,e.tag&&(i.tag=e.tag),this.bins[t]=i}},this)}save(){let e=[];return this.bins.forEach(t=>{let i={width:t.width,height:t.height,maxWidth:t.maxWidth,maxHeight:t.maxHeight,freeRects:[],rects:[],options:t.options};t.tag&&(i=Object.assign(Object.assign({},i),{tag:t.tag})),t.freeRects.forEach(e=>{i.freeRects.push({x:e.x,y:e.y,width:e.width,height:e.height})}),e.push(i)}),e}sort(e,t=h.MAX_EDGE){return e.slice().sort((e,i)=>{const n=t===h.MAX_EDGE?Math.max(i.width,i.height)-Math.max(e.width,e.height):i.width*i.height-e.width*e.height;return 0===n&&e.hash&&i.hash?e.hash>i.hash?-1:1:n})}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some(e=>e.dirty)}get rects(){let e=[];for(let t of this.bins)e.push(...t.rects);return e}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};function s(e,t){return e.map(e=>{const i={x:e.x,y:e.y},n=Math.cos(t),s=Math.sin(t),r=i.x,o=i.y;return i.x=r*n-o*s,i.y=r*s+o*n,i})}function r(e){const{minX:t,minY:i,maxX:n,maxY:s}=e;return[{x:t,y:i},{x:n,y:i},{x:n,y:s},{x:t,y:s},{x:t,y:i}]}function o(e){if(e.length<=3)throw new Error("Not enough points in polygon.");let t=e[0].x,i=e[0].y,n=e[0].x,s=e[0].y;for(let r=1;r<e.length;r++){const{x:o,y:a}=e[r];n=Math.min(o,n),s=Math.min(a,s),t=Math.max(o,t),i=Math.max(a,i)}return{minX:n,minY:s,maxX:t,maxY:i}}function a(e){const{minX:t,maxX:i,minY:n,maxY:s}=e;return{x:t,y:n,width:i-t,height:s-n}}function h(e,t,i,n){i=i||0,n=n||t.length;const s=parseInt(i+(n-i)/2,10);return t[s]===e?s:n-i<=1?t[s]>e?s-1:s:t[s]<e?h(e,t,s,n):h(e,t,i,s)}function l(e,t=0){let{minX:i,maxX:n,minY:s,maxY:r}=e;const o=Math.round(i+(n-i)/2-t/2),a=Math.round(s+(r-s)/2-t/2);return[{x:i-=t,y:s-=t},{x:n,y:s},{x:n,y:r},{x:i,y:r},{x:i,y:a},{x:n,y:a},{x:o,y:s},{x:o,y:r}]}function d(e,t,i,n,r,o,a,h=0){let l,d,c=0,u=0;if(h>0){var p=(o+a)*h;p<o?c=o-p:u=a-(p-o)}const f=null!==r?s(t,r):t;for(let t=0;t<f.length;t++){l=f[t];const s=(d=t==f.length-1?f[0]:f[t+1]).x-l.x,r=d.y-l.y,h=Math.sqrt(s*s+r*r),p={x:s/h,y:r/h};let m=0;for(e.moveTo(i+l.x+u*p.x,n+l.y+u*p.y);m<=h;)m+=u,(m+=c>0?c:o)>h?(c=m-h,m=h):c=0,e.lineTo(i+l.x+m*p.x,n+l.y+m*p.y),(m+=a)>h&&0==c?u=m-h:(u=0,e.moveTo(i+l.x+m*p.x,n+l.y+m*p.y))}}function c(e){return n(this,void 0,void 0,(function*(){const t=URL.createObjectURL(e),i=new Image;return new Promise((e,n)=>{i.src=t,i.addEventListener("load",n=>(URL.revokeObjectURL(t),e(new PIXI.Texture(new PIXI.BaseTexture(i)))))})}))}function u(e){return btoa(new Uint8Array(e).reduce((e,t)=>e+String.fromCharCode(t),""))}function p(e,t=1){return n(this,void 0,void 0,(function*(){const i=URL.createObjectURL(e),n=new Image;return t=t||1,new Promise((e,s)=>{n.src=i,n.addEventListener("load",s=>{if(URL.revokeObjectURL(i),1===t)return e(new PIXI.Texture(new PIXI.BaseTexture(n)));{let i=[];for(let e=0;e<t;e++)i.push(new PIXI.Texture(new PIXI.BaseTexture(n)));return e(i)}})})}))}function f(e,t){return n(this,void 0,void 0,(function*(){return new Promise((i,n)=>{e.extract.canvas(t).toBlob(e=>i(e))})}))}function m(e,t){return n(this,void 0,void 0,(function*(){return f(e,new PIXI.Sprite(t))}))}function g(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),s=n.length,r=new Uint8Array(s);for(;s--;)r[s]=n.charCodeAt(s);return new Blob([r],{type:i})}function y(e){return n(this,void 0,void 0,(function*(){const t=new FileReader;return new Promise((i,n)=>{t.readAsDataURL(e),t.onload=e=>i(e.target.result)})}))}function v(e,t){var i=document.createElement("a");return document.body.append(i),i.download=t,i.href=URL.createObjectURL(e),i.click(),i.remove(),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.clearRenderTextureRects=function(e,t,i){if(i instanceof PIXI.WebGLRenderer){i.bindRenderTexture(t);const n=i.gl;n.enable(n.SCISSOR_TEST);for(let t=0;t<e.length;t++){const{x:s,y:r,width:o,height:a}=e[t];n.scissor(s,r,o,a),i.clear()}i.bindRenderTexture()}else for(let i=0;i<e.length;i++){const{x:n,y:s,width:r,height:o}=e[i];t.baseTexture._canvasRenderTarget.context.clearRect(n,s,r,o)}},t.flatten=function e(t,i=[]){for(let n=0,s=t.length;n<s;n++){const s=t[n];Array.isArray(s)?e(s,i):i.push(s)}return i},t.encodeTileId=function(e,t,i,n){if(!t&&!i&&!n)return e},t.decodeTileId=function(e){let t=!!(1073741824&e),i=!!(536870912&e),n=!!(268435456&e);return{tileId:e&=-1879048193,flipDiag:n,flipVer:i,flipHor:t}},t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{"constructor"!==i&&(e.prototype[i]=t.prototype[i])})})},t.mergeFlips=function(e,t){const i=e.flipDiag+t.flipDiag;if(2===i)return{flipDiag:!1,flipHor:e.flipVert===t.flipVert,flipVert:e.flipHor+t.flipHor};if(1===i){const i=e.flipDiag?e.flipVert:e.flipHor,n=e.flipDiag?e.flipHor:e.flipVert,s=t.flipDiag?t.flipVert:t.flipHor;return{flipDiag:!0,flipHor:(t.flipDiag?t.flipHor:t.flipVert)!==n,flipVert:i!==s}}return 0===i?{flipDiag:!1,flipVert:e.flipVert!==t.flipVert,flipHor:e.flipHor!==t.flipHor}:void 0},t.decodeRotation=function(e){let t=!!(1073741824&e),i=!!(536870912&e),n=!!(268435456&e);return{id:e&=-1879048193,flips:{flipDiag:n,flipVert:i,flipHor:t}}},t.rotateSprite=function(e,t,i,n,s=!1){if(e.rotation=0,e.scale.set(1,1),!t&&!i&&!n)return;const r=i?-1:1,o=n?-1:1,a=t?90:0;e.scale.set(r,o),e.rotation=a*(Math.PI/180)},t.getBoundingBoxAsTexture=function(e,t,i){const{x:n,y:s,width:r,height:o}=i,a=e.localTransform.clone(),h=PIXI.RenderTexture.create(r,o);return t.render(e,h,!0,a.translate(-n,-s)),h},t.getPolygonAsTexture=function(e,t,i){},t.copyTexture=function(e,t){return n(this,void 0,void 0,(function*(){const i=new PIXI.Sprite(e);return new Promise((e,n)=>{t.extract.canvas(i).toBlob(t=>{i.destroy();const n=URL.createObjectURL(t),s=new Image;s.addEventListener("load",t=>(URL.revokeObjectURL(n),e(new PIXI.Texture(new PIXI.BaseTexture(s))))),s.src=n})})}))},t.createGrid=function(e,t,i,n,s=0,r=1,o=.5){const a=new PIXI.Graphics;a.lineStyle(r,s,o);for(let t=0;t<=i;t+=e)0!==t?(a.moveTo(t,0),a.lineTo(t,n)):(a.moveTo(1,0),a.lineTo(1,n));for(let e=0;e<=n;e+=t)a.moveTo(0,e),a.lineTo(i,e);return a},t.recurseEmit=function e(t,i,n){t.emit(i,n),t instanceof PIXI.Container&&t.children&&t.children.forEach(t=>{e(t,i,n)})},t.rotatePoints=s,t.boundingBoxToPolygon=r,t.drawDashedBoundingBox=function(e,t,i,n,s,o,a,h=0){return d(e,r(t),i,n,s,o,a,h)},t.ceilPoint=function(e){return{x:Math.ceil(e.x),y:Math.ceil(e.y)}},t.boundingBoxFromPolygon=o,t.rectFromPolygon=function(e){return a(o(e))},t.boundingFromPositions=function(e,t){return{minX:Math.min(e.x,t.x),maxX:Math.max(e.x,t.x),minY:Math.min(e.y,t.y),maxY:Math.max(e.y,t.y)}},t.removeFileExtension=function(e){return e.replace(/\.[^/.]+$/,"")},t.pointsEqual=function(e,t){return e.x===t.x&&e.y===t.y},t.adjustTileData=function(e,t,i,n){const s=t+i-1,r=t+n-1,o=n-i;if(!o)throw new Error("Tile count difference should not be 0.");const a=Math.sign(o);if(a>0)for(let t=0;t<e.length;t++)e[t]>=s&&(e[t]+=o);else if(a<0)for(let i=0;i<e.length;i++){const n=e[i];n>=t&&n<=s&&n>r?e[i]=0:n>r&&(e[i]+=o)}},t.splitSizeKey=function(e){const[t,i]=e.split("-");if(null==t)throw new Error(`Failed to split width on key ${e}`);if(null==i)throw new Error(`Failed to split height on key ${e}`);return{width:parseInt(t),height:parseInt(i)}},t.makeSizeTileKey=function(e){return`${e.width}-${e.height}`},t.isTextureTransparent=function(e){const t=new PIXI.Sprite(e),i=(new PIXI.CanvasRenderer).extract.pixels(t);for(let e=3;e<i.length;e+=4)if(i[e])return t.destroy(!1),!1;return t.destroy(!1),!0},t.orderTileSizeContainers=function(e,t){e.children.sort((e,i)=>{try{const n=t.indexOf(e.sizeKey);if(n<0)throw new Error("Could not find index for sizeKey on a");const s=t.indexOf(i.sizeKey);if(s<0)throw new Error("Could not find index for sizeKey on b");return n-s}catch(n){throw console.error(n,"a was",e,"b was",i,"ordered keys was",t),n}})},t.rectFromBoundingBox=a,t.boundingBoxFromRect=function(e){const{x:t,y:i,width:n,height:s}=e;return{minX:t,minY:i,maxX:t+n,maxY:i+s}},t.swapElements=function(e,t,i){const n=e[t];e[t]=e[i],e[i]=n},t.insertToArray=function(e,t,i){e.splice(t,0,i)},t.moveArray=function(e,t,i){this.splice(i,0,e.splice(t,1)[0])},t.locationOf=h,t.insertSorted=function(e,t){return t.splice(h(e,t)+1,0,e),t},t.updateBoundingBox=function(e,t,i){e.minX=Math.min(t,e.minX),e.maxX=Math.min(t,e.maxX),e.minY=Math.min(i,e.minY),e.maxY=Math.min(i,e.maxY)},t.binarySearchIndex=function e(t,i,n,s){if(n>s)return-1;let r=Math.floor((n+s)/2);return t[r]===i?r:t[r]>i?e(t,i,n,r-1):e(t,i,r+1,s)},t.encodeFlipId=function(e,t){return 0==e?e:(t.flipHor&&(e+=1073741824),t.flipVert&&(e+=536870912),t.flipDiag&&(e+=268435456),e)},t.moveSmallArrayFast=function(e,t,i){let n,s;if(t!==i&&0<=t&&t<=e.length&&0<=i&&i<=e.length){if(s=e[t],t<i)for(n=t;n<i;n++)e[n]=e[n+1];else for(n=t;n>i;n--)e[n]=e[n-1];e[i]=s}},t.forEachItemAfterIndex=function(e,t,i){for(let n=e+1;n<t.length;n++)i(t[n],n)},t.getPointDeltas=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.roundPoint=function(e,t=!1){return t?(e.x=Math.round(e.x),e.y=Math.round(e.y),e):{x:Math.round(e.x),y:Math.round(e.y)}},t.floorPoint=function(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}},t.getVertexesFromBoundingBox=l,t.drawVertexes=function(e,t,i,n,r=2){const o=null!==i?s(l(t,n+r),i):l(t,n+r);e.lineStyle(r,0,1),e.beginFill(16777215,1),o.forEach(t=>{e.drawRect(t.x,t.y,n,n)}),e.endFill()},t.rectContainsPoint=function(e,t,i=0,n=0){let{x:s,y:r,width:o,height:a}=e;return r-=n/2,o+=i,a+=n,(s-=i/2)<=t.x&&t.x<=s+o&&r<=t.y&&t.y<=r+a},t.rectsCollide=function(e,t){return!(e.y+e.height<t.y||e.y>t.y+t.height||e.x+e.width<t.x||e.x>t.x+t.width)},t.drawDashedPolygon=d,t.chunkArray=function(e,t){const i=[];for(let n=0,s=e.length;n<s;n+=t)i.push(e.slice(n,n+t));return i},t.getSlope=function(e,t){return(t.y-e.y)/(t.x-e.x)},t.drawSelectionBox=function(e,t,i,n,s,r=3){e.clear(),e.moveTo(t,i);let o=t;for(let i=t;i<n;i+=r)i>=n&&e.lineTo,i%n==0&&e.lineTo(o,i)},t.getTextureFromBlob=c,t.bufferToBase64=u,t.getTextureFromBlob2=function(e){return n(this,void 0,void 0,(function*(){const t=window.URL||window.webkitURL;let i,n=!0;try{i=t.createObjectURL(e)}catch(t){n=!1;const s=u(e);i="data:image/png;base64,"+s}const s=new Image;return new Promise((e,r)=>{s.src=i,s.addEventListener("load",r=>(n&&t.revokeObjectURL(i),e(new PIXI.Texture(new PIXI.BaseTexture(s)))))})}))},t.getMultipleTexturesFromBlob=p,t.getBlobFromSprite=f,t.getBlobFromTexture=m,t.dataUrlToTexture=function(e){return n(this,void 0,void 0,(function*(){return c(g(e))}))},t.dataURLtoBlob=g,t.blobToDataURL=y,t.downloadBlobPng=v,t.downloadSpritePng=function(e,t,i){return n(this,void 0,void 0,(function*(){return t instanceof PIXI.RenderTexture||t instanceof PIXI.Sprite||(t=new PIXI.Sprite(t)),new Promise((n,s)=>{e.extract.canvas(t).toBlob(e=>n(v(e,i)),"image/png")})}))},t.asyncTimeout=function(e){return n(this,void 0,void 0,(function*(){return new Promise((t,i)=>{setTimeout(()=>t(),e)})}))},t.downloadJson=function(e,t){const i=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(i),s=document.createElement("a");document.body.append(s),s.download=`${t}.json`,s.href=n,s.click(),s.remove()},t.getMinMaxes=function(e,t){return{minX:Math.min(e.x,t.x),maxX:Math.max(e.x,t.x),minY:Math.min(e.y,t.y),maxY:Math.max(e.y,t.y)}},t.getDataURLFromTexture=function(e,t){return n(this,void 0,void 0,(function*(){return y(yield m(e,t))}))},t.getDataUrlsAndTexturesFromTextures=function(e,t){return n(this,void 0,void 0,(function*(){let i=[],n=[],s=[];if(Array.isArray(t))return i=yield Promise.all(t.map(t=>m(e,t))),{textures:n=yield Promise.all(i.map(c)),dataUrls:s=yield Promise.all(i.map(y))};{const r=Object.keys(t).map(e=>({texture:t[e],id:e}));i=yield Promise.all(r.map(t=>m(e,t.texture))),n=yield Promise.all(i.map(c)),s=yield Promise.all(i.map(y));const o={},a={};for(let e=0;e<i.length;e++)o[r[e].id]=n[e],a[r[e].id]=s[e];return console.log("returning textures",o),{textures:o,dataUrls:a}}}))},t.getTextureFromDataUrl=function(e,t=1){return n(this,void 0,void 0,(function*(){return p(g(e),t)}))};const C=(S=/^[^\\/:\*\?"<>\|]+$/,w=/^\./,b=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i,function(e){return S.test(e)&&!w.test(e)&&!b.test(e)});var S,w,b;t.validateFileName=function(e){return C(e)},t.getAverageRGB=function(e,t=1){let i=-(t-1),n=0,s=0,r=0,o=0;const a=e.data.length;for(;(i+=4*t)<a;)++n,0!==e.data[i+3]&&(s+=e.data[i],r+=e.data[i+1],o+=e.data[i+2]);return((s=~~(s/n))<<16)+((r=~~(r/n))<<8)+(o=~~(o/n))}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r="object"==typeof window?window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB:self.indexedDB||self.webkitIndexedDb;t.Loader=class{constructor(e,t){this.db=t,this.name=e}initialize(){return n(this,void 0,void 0,(function*(){if(this.db)return!0;const e=r.open(this.name,1);return new Promise((t,i)=>{e.onerror=function(e){console.error("Error creating/accessing IndexedDB database",e)},e.onsuccess=n=>(this.db=e.result,this.db.onerror=function(e){return console.error("Error creating/accessing IndexedDB database",e),i("Error creating/accessing IndexedDB database")},this.db.setVersion?1==this.db.version?(this.db.createObjectStore(this.name),t(!0)):void(this.db.setVersion(1).onsuccess=function(){return this.db.createObjectStore(this.name),t(!0)}):t(!0)),e.onupgradeneeded=e=>{this.db=e.target.result,this.db.createObjectStore(this.name)}})}))}deleteItem(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readwrite").objectStore(this.name).delete(e);return new Promise((i,n)=>{t.onsuccess=e=>i(!0),t.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}saveJson(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(JSON.stringify(t),e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}loadJson(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,n)=>{t.onsuccess=e=>e.target.result?i(JSON.parse(e.target.result)):i(null),t.onerror=t=>{throw new Error(`Error getting texture from indexedDB: ${e}`)}})}))}saveArrayBuffer(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(t,e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}loadArrayBuffer(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,n)=>{t.onsuccess=e=>i(e.target.result),t.onerror=t=>{throw new Error(`Error getting texture from indexedDB: ${e}`)}})}))}saveTexture(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite");let n;if(t.baseTexture.source){const e=document.createElement("canvas");e.width=t.baseTexture.width,e.height=t.baseTexture.height;const i=e.getContext("2d");console.log("the base texture was",t.baseTexture),i.drawImage(t.baseTexture.source,0,0),n=e.toDataURL("image/png")}if(!n)throw new Error("did not get a datasUrl from texture.");const s=i.objectStore(this.name).put(n,e);return new Promise((t,i)=>{s.onsuccess=e=>t(!0),s.onerror=t=>i(`Error saving texture to indexedDB: ${e}`)})}))}saveImageData(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(t,e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}loadImageData(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,n)=>{t.onsuccess=e=>{var t,n;const s=null===(n=null===(t=e)||void 0===t?void 0:t.target)||void 0===n?void 0:n.result;return i(s)},t.onerror=t=>n(new Error(`Error getting texture from indexedDB: ${e}`))})}))}loadTexture(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,r)=>{t.onsuccess=e=>n(this,void 0,void 0,(function*(){var t,n;const o=null===(n=null===(t=e)||void 0===t?void 0:t.target)||void 0===n?void 0:n.result;if(!o)return i(null);try{const e=yield s.dataUrlToTexture(o);return i(e)}catch(e){return r(e)}})),t.onerror=t=>(console.error("Error",t),r(new Error(`Error getting texture from indexedDB: ${e}`)))})}))}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(26),o=i(1),a=i(27),h=i(3),l=i(28),d=i(29),c=i(30),u=i(33);var p,f;!function(e){e[e.BATCH_SUB_SECTIONS_RENDER_TEXTURES=0]="BATCH_SUB_SECTIONS_RENDER_TEXTURES",e[e.BATCH_SUB_SECTIONS_CONTAINERS=1]="BATCH_SUB_SECTIONS_CONTAINERS",e[e.LAZY_INDEXED_DB_LOAD=2]="LAZY_INDEXED_DB_LOAD"}(p||(p={})),function(e){e.destroyed="destroyed",e.almost_visible="almost_visible",e.visible="visible"}(f=t.VisibilityStates||(t.VisibilityStates={})),t.ChunkManager=class extends u{constructor(e,t,i,n,s,r,o,a,l,d,c,u=!1){super(),this.curBatchIndex=0,this.curBatchChunkIndexes=[],this.almostVisibleChunkIndexes=[],this.visibleChunkIndexes=[],this.chunksInBatch={},this.initBatches={},this.initiailizedSprites=[],this.trackedChunkBatchIndexes=[],this.chunkTextureAtlasses=[],this.pendingChunkImageLoads={},this.interuptedChunkImages={},this.interuptedChunkData={},this.loadingChunkData={},this.loading={},this.loadedChunks={},this.cachedChunkTextures={},this.indexesToUpdate=[],this.cachedChunkData={},this.containerPool=[],this.showedChunkImages={},this.showedChunkColliders={},this.cachedSmallMapData={},this.addLayerSpritePayloadBatches=[],this.resetting=!1,this.tileSizeBySeqLookup=[],this.seqToTagString={},this.cachedMapChunksDatas={},this.collisionManager=r,this.chunkWidth=1024,this.chunkHeight=1024,this.halfChunkWidth=this.chunkWidth/2,this.halfChunkHeight=this.chunkHeight/2,this.subChunkW=h.RUNTIME_TILE_LAYER_SECTION_SIZE,this.subChunkH=h.RUNTIME_TILE_LAYER_SECTION_SIZE,this.imageManager=o,this.seqToTagString=s,this.worldInitData=i,this.mapsInitData=n,this.tileSizeBySeqLookup=[];for(let e=0;e<this.worldInitData.tileSizeSeqLookup.length;e+=2)this.tileSizeBySeqLookup.push({width:this.worldInitData.tileSizeSeqLookup[e],height:this.worldInitData.tileSizeSeqLookup[e+1]});this.chunkTextureAtlasFactory=t instanceof PIXI.WebGLRenderer?this.webGlAtlasFactory.bind(this,t):this.canvasAtlasFactory.bind(this,t),this.playerViewRect=l.playerViewRect,this.chunkLoaderWorker=c,this.baseUrl=e+"/maps",this.tileManager=a,this.renderer=t,this.useIndexedDbWorker=u,this.containerPool=[],this.indexedDbLoader=d}createWorldChunk(e,t=this.mapMetaData,i){return new a.WorldChunk(t,e,this.chunkTextureAtlasses,this.containerPool,this.tileManager)}_webWorkerInit(e){return n(this,void 0,void 0,(function*(){}))}_defaultInit(e){return n(this,void 0,void 0,(function*(){}))}initSmallMap(e){return n(this,void 0,void 0,(function*(){const t=new c.Decoder(this.tileSizeBySeqLookup,this.seqToTagString,this.worldInitData.propSeqToNameLookup),i=e.id,s=r.mapFileKey(this.baseUrl,i);this.getMapMetaData(i,e.ts);let a=0;{const h=yield o.httpGetAsync(s,!1),l=yield t.decodeMap(1024,1024,128,128,h);if(this.saveMapMetaData(i,l.metaData),1!==l.chunks.length)throw new Error("Small map should only have 1 chunk.");const d=this.mergeChunkLayersAsTextures(l.chunks[0],l.metaData);yield Promise.all(d.map((t,s)=>n(this,void 0,void 0,(function*(){if(!t)return;const n=r.mapFileKey(this.baseUrl,i,s);a++,localStorage.setItem(n,`${e.ts}`);const o=new PIXI.Sprite(t),h=this.renderer.extract.base64(o);yield this.indexedDbLoader.saveImageData(n,h),t.destroy(!0)})))),yield this.saveSmallMapImageAndColliderDataOnly(l.chunks[0],i)}yield this.deleteAllChunksGreaterThan(i,a-1,1)}))}saveSmallMapImageAndColliderDataOnly(e,t){return n(this,void 0,void 0,(function*(){e.layers.forEach(e=>{delete e.tileLayers}),yield this.indexedDbLoader.saveJson(`${t}_init`,e)}))}loadSmallMapImageAndColliderDataOnly(e){return n(this,void 0,void 0,(function*(){const t=this.cachedSmallMapData[e];return t?t.data:yield this.indexedDbLoader.loadJson(`${e}_init`)}))}addSmallMapDataToCache(e,t,i){this.cachedSmallMapData[i]?this.cachedSmallMapData[i].ts=Date.now():this.cachedSmallMapData[i]={textures:t,data:e,ts:Date.now()}}mergeChunkLayersAsTextures(e,t){const i=this.chunkTextureAtlasFactory(),n=this.createWorldChunk(e,t),s=n.initTileLayers(),r=i.mergeAllLayerChunks(s);return n.destroy(),r}saveMapMetaData(e,t,i){localStorage.setItem(r.mapFileKey(this.baseUrl,e),JSON.stringify({ts:i||Date.now(),data:t}))}getMapMetaData(e,t){const i=localStorage.getItem(r.mapFileKey(this.baseUrl,e));if(i){const e=JSON.parse(i);return e.ts<t?null:e.data}return null}requestMapMetaData(e){return n(this,void 0,void 0,(function*(){const t=new c.Decoder(this.tileSizeBySeqLookup,this.seqToTagString,this.worldInitData.propSeqToNameLookup),i=yield o.httpGetAsync(r.mapMetaPath(this.baseUrl,e),!1);return t.decodeMetaData(i)}))}initMassiveMap(e){return n(this,void 0,void 0,(function*(){const t=new c.Decoder(this.tileSizeBySeqLookup,this.seqToTagString,this.worldInitData.propSeqToNameLookup),i=e.id,s=r.mapFileKey(this.baseUrl,i);let a=this.getMapMetaData(i,e.ts);const h=e.chunksTs;if(this.emit("downloading-map",e),this.chunkLoaderWorker)a=yield this.chunkLoaderWorker.requestAndStoreAllMapChunks(e.id),this.saveMapMetaData(i,a,e.ts+1);else{const e=yield o.httpGetAsync(s,!1);let h=0;const{metaData:l}=yield t.decodeMap(1024,1024,128,128,e,(e,t)=>n(this,void 0,void 0,(function*(){const n=r.mapFileKey(this.baseUrl,i,t);h=t,yield this.indexedDbLoader.saveJson(n,e)})));a=l}this.saveMapMetaData(i,a,e.ts+1),h?yield this.deleteAllChunksGreaterThan(i,h.length-1,a.layerTileLayerOrder.length):console.warn("no chunk timestamps were found.. this is fine if im not getting this error probably a week after 7/14/20 cuz i changed some meta data stuffs in midst of a project... otherwise fuck.")}))}init(){return n(this,void 0,void 0,(function*(){const e=[this.initSmallMap.bind(this),this.initMassiveMap.bind(this),this.initMassiveMap.bind(this)];if(this.indexedDbLoader&&"undefined"!=typeof localStorage)for(let t=0;t<this.mapsInitData.length;t++){const i=this.mapsInitData[t];yield e[i.size](i),this.emit("finished-downloading")}}))}deleteAllChunksGreaterThan(e,t,i){return n(this,void 0,void 0,(function*(){let n=r.mapFileKey(this.baseUrl,e,++t),s=localStorage.getItem(n);const o=[];for(;null!==s;){if(localStorage.removeItem(n),o.push(this.indexedDbLoader.deleteItem(n)),i)for(let e=0;e<i;e++)o.push(this.indexedDbLoader.deleteItem(`${n}_${i[e]}`));n=r.mapFileKey(this.baseUrl,e,++t),s=localStorage.getItem(n)}return o.length&&(yield Promise.all(o)),!0}))}hideChunk(e,t){if(this.loading[e])return void(this.interuptedChunkData[e]=!0);const i=this.cachedChunkData[e];i||console.error("could not find index ",e,"in cached chunk data",this.cachedChunkData),this.loadedChunks[e].hidden?console.warn("trying to hide already hidden chunk.... need to check this out "):(this.loadedChunks[e].hide(),this.showedChunkColliders[e]&&this.collisionManager.removeChunkColliders(i),delete this.showedChunkColliders[e])}onChunkVisibilityStateChange(e,t,i){return n(this,void 0,void 0,(function*(){if(e===t)throw new Error("states shouldnt be the same");e===f.visible?t===f.almost_visible?this.hideChunk(i,this.curMapSeq):this.destroyChunk(i):e===f.almost_visible?t===f.destroyed?this.destroyChunk(i):this.showChunk(i,this.curMapSeq):e===f.destroyed&&(t===f.almost_visible?this.batchInitChunk(i,this.curMapSeq):yield this.showChunk(i,this.curMapSeq))}))}nextBatch(){if(this.curBatchChunkIndexes.length){let e=Date.now();this.initBatches[this.curBatchChunkIndexes[this.curBatchIndex]].pop()(),Date.now()-e>100&&console.error("found long batch"),++this.curBatchIndex>=this.curBatchChunkIndexes.length&&(this.curBatchIndex=0)}else if(this.addLayerSpritePayloadBatches.length){let e=this.addLayerSpritePayloadBatches.shift();e.sprite.transform?this.emit("add-subchunk-layer-sprite",e):this.nextBatch()}}batchInitChunk(e,t){return n(this,void 0,void 0,(function*(){if(this.resetting)return!1;if(this.initBatches[e])throw new Error("Already existed");const i=[];let s,r,o=!0;const a=e=>{t===this.curMapSeq&&this.addLayerSpritePayloadBatches.push(e)},h=()=>{this.resetting||t!==this.curMapSeq||(o?i.push(h):r.initBatchRender({x:this.playerViewRect.x+this.playerViewRect.width/2,y:this.playerViewRect.y+this.playerViewRect.height/2}))},l=()=>{if(o)throw new Error("how the fuck in the fuck did this happen.");r.nextBatch()?i.push(l):(delete r.showed_images,this.removeChunkFromBatch(e))};i.push(l,()=>n(this,void 0,void 0,(function*(){t==this.curMapSeq&&(yield this.forceShowChunkImages(s,t)),t==this.curMapSeq&&this.chunksInBatch[e]&&(this.chunksInBatch[e].showed_images=!0)})),h,()=>n(this,void 0,void 0,(function*(){if(t==this.curMapSeq){if(!(s=yield this.loadChunkData(e,t)))return;this.interuptedChunkData[e]||this.initBatches[e]&&(this.resetting||t!==this.curMapSeq||(o=!1,(r=this.createWorldChunk(s)).on("add-subchunk-layer-sprite",a),this.chunksInBatch[e]=r))}}))),this.initBatches[e]=i,this.curBatchChunkIndexes.push(e)}))}destroyChunkInBatch(e){this.chunksInBatch[e]?(this.chunksInBatch[e].showed_images&&this.removeChunkImages(this.cachedChunkData[e]),this.removeChunkFromBatch(e),this.loadedChunks[e].destroy(),delete this.loadedChunks[e]):this.spliceChunkBatch(e),delete this.showedChunkImages[e]}spliceChunkBatch(e){const t=this.curBatchChunkIndexes.indexOf(e);if(t<0)throw new Error(`couldnt find in ${e}`);this.curBatchChunkIndexes.splice(t,1),delete this.initBatches[e],this.curBatchIndex=0}removeChunkFromBatch(e){if(!this.initBatches[e])throw new Error("at this point chunk index should still be in init batches");this.chunksInBatch[e].removeAllListeners("add-subchunk-layer-sprite"),this.loadedChunks[e]||(this.loadedChunks[e]=this.chunksInBatch[e],this.loadedChunks[e].hidden=!0),delete this.chunksInBatch[e],this.spliceChunkBatch(e)}getVisibleSubChunks(e){const t=[],i=Math.max(0,Math.floor(e.x/this.subChunkW)),n=Math.max(0,Math.floor(e.y/this.subChunkH)),s=Math.min(Math.ceil((e.x+e.width)/this.subChunkW),this.subChunkCols),r=Math.min(Math.ceil((e.y+e.height)/this.subChunkH),this.subChunkRows);for(let e=i;e<s;e++)for(let i=n;i<r;i++){let n=e,s=i*this.subChunkCols+n;s>-1&&s<this.maxSubChunks&&t.push(s)}return t}getVisibleChunks(e){const t=[],i=Math.max(0,Math.floor(e.x/this.chunkWidth)),n=Math.max(0,Math.floor(e.y/this.chunkHeight)),s=Math.min(Math.ceil((e.x+e.width)/this.chunkWidth),this.chunkCols),r=Math.min(Math.ceil((e.y+e.height)/this.chunkHeight),this.chunkRows);for(let e=i;e<s;e++)for(let i=n;i<r;i++){let n=e,s=i*this.chunkCols+n;s>-1&&s<this.maxChunks&&t.push(s)}return t}updateAlmostVisibleChunks(e=0,t=0){const i=[...this.almostVisibleChunkIndexes],n=this.chunkWidth+this.subChunkW,s=this.chunkWidth+this.subChunkW,r=this.playerViewRect.x-n,o=this.playerViewRect.y-s;this.mapMetaData.mapW,this.playerViewRect.width,this.mapMetaData.mapH,this.playerViewRect.height;let a={x:r,y:o,width:this.playerViewRect.width+2*n,height:this.playerViewRect.height+2*s};r<0&&(a.x=0,a.width-=2*r),o<0&&(a.y=0,a.height-=2*o),this.almostVisibleChunkIndexes=this.getVisibleChunks(a).filter(e=>!this.visibleChunkIndexes.includes(e));for(let e=0;e<this.almostVisibleChunkIndexes.length;e++){const t=this.almostVisibleChunkIndexes[e],n=i.indexOf(t);n>-1?i.splice(n,1):this.onChunkVisibilityStateChange(f.destroyed,f.almost_visible,t)}for(let e=0;e<i.length;e++)this.onChunkVisibilityStateChange(f.almost_visible,f.destroyed,i[e])}updateVisibleChunks(e=0,t=0){return n(this,void 0,void 0,(function*(){const e=[...this.visibleChunkIndexes],t=this.subChunkW,i=this.subChunkH,n=this.playerViewRect.x-t,s=this.playerViewRect.y-i;let r={x:n,y:s,width:this.playerViewRect.width+2*t,height:this.playerViewRect.height+2*i};n<0&&(r.x=0,r.width-=2*n),s<0&&(r.y=0,r.height-=2*s),this.visibleChunkIndexes=this.getVisibleChunks(r);for(let t=0;t<this.visibleChunkIndexes.length;t++){const i=this.visibleChunkIndexes[t],n=e.indexOf(i);if(n>-1){e.splice(n,1);continue}const s=this.almostVisibleChunkIndexes.indexOf(this.visibleChunkIndexes[t]);s>-1?(this.almostVisibleChunkIndexes.splice(s,1),this.onChunkVisibilityStateChange(f.almost_visible,f.visible,i)):yield this.onChunkVisibilityStateChange(f.destroyed,f.visible,i)}for(let t=0;t<e.length;t++)this.almostVisibleChunkIndexes.push(e[t]),this.onChunkVisibilityStateChange(f.visible,f.almost_visible,e[t]);const o=this.getVisibleSubChunks({x:this.playerViewRect.x-256,y:this.playerViewRect.y-256,width:this.playerViewRect.width+512,height:this.playerViewRect.height+512});for(let e=0;e<this.visibleChunkIndexes.length;e++){const t=this.loadedChunks[this.visibleChunkIndexes[e]];t&&t.updateVisibleSubChunks(o)}}))}loadLargeMap(e,t){return n(this,void 0,void 0,(function*(){this.chunkLoaderWorker&&(yield this.chunkLoaderWorker.initMap({mapId:e,data:t}));const i=this.chunkTextureAtlasses.length-t.layerTileLayerOrder.length;if(i>0){const e=this.chunkTextureAtlasses.splice(this.chunkTextureAtlasses.length-i);for(let t=0;t<i;t++)e[t].clear()}else if(i<0)for(let e=this.chunkTextureAtlasses.length;e<Math.abs(i);e++)this.chunkTextureAtlasses.push(this.chunkTextureAtlasFactory());if(this.mapMetaData.layerTileLayerOrder.length!==this.chunkTextureAtlasses.length)throw new Error("should be the same.");for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)this.chunkTextureAtlasses[e].initForMap(this.subChunkW,this.subChunkH),this.initiailizedSprites.push([]);this.visibleChunkIndexes.length=0,this.almostVisibleChunkIndexes.length=0,this.chunkCols=Math.ceil(this.mapMetaData.mapW/this.chunkWidth),this.subChunkCols=Math.ceil(this.mapMetaData.mapW/this.subChunkW),this.chunkRows=Math.ceil(this.mapMetaData.mapH/this.chunkHeight),this.subChunkRows=Math.ceil(this.mapMetaData.mapW/this.subChunkH),this.maxChunks=this.chunkCols*this.chunkRows,this.maxSubChunks=this.subChunkCols*Math.ceil(this.mapMetaData.mapH/this.subChunkH),yield this.updateVisibleChunks(0,0),this.updateAlmostVisibleChunks(0,0),this.indexesToUpdate.length&&(this.renderMode,p.LAZY_INDEXED_DB_LOAD),this.initialized=!0}))}loadSmallMapTextures(e,t,i=!1){return n(this,void 0,void 0,(function*(){return e in this.cachedSmallMapData?this.cachedSmallMapData[e].textures:Promise.all(t.map((t,s)=>n(this,void 0,void 0,(function*(){const t=r.mapFileKey(this.baseUrl,e,s);i&&console.time(`texture_${t}`),i&&console.time(`texture_${t} index db load`);const n=yield this.indexedDbLoader.loadImageData(t);i&&console.timeEnd(`texture_${t} index db load`),i&&console.time(`texture_${t} make`);const o=PIXI.Texture.from(n);return i&&console.timeEnd(`texture_${t} make`),i&&console.timeEnd(`texture_${t}`),o}))))}))}loadSmallMap(e,t){return n(this,void 0,void 0,(function*(){for(let e=0;e<t.layerTileLayerOrder.length;e++)this.initiailizedSprites.push([]);let i,n;if(e in this.cachedSmallMapData)this.cachedSmallMapData[e].ts=Date.now(),({data:n,textures:i}=this.cachedSmallMapData[e]);else if(this.indexedDbLoader)i=yield this.loadSmallMapTextures(e,t.layerTileLayerOrder),n=yield this.loadSmallMapImageAndColliderDataOnly(e),this.addSmallMapDataToCache(n,i,e);else{const t=yield o.httpGetAsync(r.mapFileKey(this.baseUrl,e),!1),s=new c.Decoder(this.tileSizeBySeqLookup,this.seqToTagString,this.worldInitData.propSeqToNameLookup),a=yield s.decodeMap(1024,1024,128,128,t);if(this.saveMapMetaData(e,a.metaData),1!==a.chunks.length)throw new Error("Small map should only have 1 chunk.");i=this.mergeChunkLayersAsTextures(a.chunks[0],a.metaData),a.chunks[0].layers.forEach(e=>{delete e.tileLayers}),n=a.chunks[0],this.addSmallMapDataToCache(a.chunks[0],i,e)}this.collisionManager.addChunkColliders(n),yield this.forceShowChunkImages(n,this.curMapSeq);const s=i.map(e=>e?new PIXI.Sprite(e):null);this.emit("add-map-chunk-layers",s)}))}loadMap(e,t,i){return n(this,void 0,void 0,(function*(){this.curMapSeq=i,this.cachedMapChunksDatas[e]&&(clearTimeout(this.cachedMapChunksDatas[e].timeout),this.cachedChunkData=this.cachedMapChunksDatas[e].chunks,delete this.cachedMapChunksDatas[e]),this.mapMetaData=t,this.mapId=e;const n=o.resolveMapSize(this.mapMetaData.mapW,this.mapMetaData.mapH);this.curMapSize=n,n===s.MapSize.SMALL?yield this.loadSmallMap(e,t):yield this.loadLargeMap(e,t)}))}reset(){this.resetting=!0;const e=this.mapId;this.curMapSize!==s.MapSize.SMALL?this.cachedMapChunksDatas[e]={timeout:setTimeout(()=>{delete this.cachedMapChunksDatas[e]}),chunks:Object.assign({},this.cachedChunkData)}:this.cachedSmallMapData[e].ts=Date.now();for(let e=0;e<this.visibleChunkIndexes.length;e++)this.destroyChunk(this.visibleChunkIndexes[e]);for(let e=0;e<this.almostVisibleChunkIndexes.length;e++)this.destroyChunk(this.almostVisibleChunkIndexes[e]);Object.keys(this.loadedChunks).length,Object.keys(this.chunksInBatch).length,Object.keys(this.loadedChunks).forEach(e=>{this.destroyChunk(parseInt(e))}),Object.keys(this.chunksInBatch).forEach(e=>{this.destroyChunk(parseInt(e))});for(let e=0;e<this.chunkTextureAtlasses.length;e++)this.chunkTextureAtlasses[e].clear();this.curBatchChunkIndexes.length=0,this.chunkTextureAtlasses.length=0,this.visibleChunkIndexes.length=0,this.almostVisibleChunkIndexes.length=0,this.initBatches={},this.chunksInBatch={},this.loadedChunks={},this.cachedChunkTextures={},this.initiailizedSprites.length=0,this.imageManager.reset(),this.resetting=!1,this.interuptedChunkImages={},this.pendingChunkImageLoads={},this.loadingChunkData={},this.interuptedChunkData={},this.showedChunkImages={},this.loading={},this.showedChunkColliders={},this.addLayerSpritePayloadBatches.length=0}get renderMode(){return this.indexedDbLoader?p.LAZY_INDEXED_DB_LOAD:p.BATCH_SUB_SECTIONS_CONTAINERS}loadChunk(e,t){return n(this,void 0,void 0,(function*(){if(!this.initialized)throw new Error("Chunk manager not initialized.");const i=yield this.loadChunkData(e,t);if(console.log(";loaded",i),!i)return null;const n=this.cachedChunkTextures[e];return this.resetting||t!==this.curMapSeq?void 0:this.createWorldChunk(i,this.mapMetaData,n)}))}forceCompleteBatches(e,t){return n(this,void 0,void 0,(function*(){const i=this.curBatchChunkIndexes.indexOf(e);if(i<0)throw new Error(`couldnt find in ${e}`);const n=this.initBatches[this.curBatchChunkIndexes[i]];for(;n.length&&t===this.curMapSeq;)yield n.pop()();if(this.curMapSeq!==t)return;if(this.curBatchChunkIndexes.indexOf(e)>-1)throw new Error("Shouldnt have found the chunk index in the batches after forcing.");let s=this.addLayerSpritePayloadBatches.length;for(let t=0;t<s;t++)this.addLayerSpritePayloadBatches[t].chunkIndex==e&&(this.emit("add-subchunk-layer-sprite",this.addLayerSpritePayloadBatches[t]),this.addLayerSpritePayloadBatches.splice(t,1),t--,s--)}))}showChunk(e,t){return n(this,void 0,void 0,(function*(){let i=[];if(this.resetting)return!1;if(this.chunksInBatch[e]){const i=this.chunksInBatch[e];if(yield this.forceCompleteBatches(e,t),t!==this.curMapSeq)return;return this.loadedChunks[e]=i,this.collisionManager.addChunkColliders(this.cachedChunkData[e]),void(this.showedChunkColliders[e]=!0)}{let n;const s=this.loadedChunks[e];if(this.loading[e])return;if(s)i=s.show();else{this.loading[e]=!0;const s=yield this.loadChunkData(e,t);if(!s)return;if(this.interuptedChunkData[e]||this.resetting)return void(this.resetting||delete this.interuptedChunkData[e]);delete this.loading[e];let r=this.cachedChunkTextures[e];if(!r&&(this.renderMode,p.LAZY_INDEXED_DB_LOAD),this.resetting||this.interuptedChunkData[e])return;i=(n=this.createWorldChunk(s,this.mapMetaData,r)).show(),yield this.forceShowChunkImages(s,t),this.loadedChunks[e]=n}this.emit("add-map-sub-chunks",i)}this.showedChunkColliders[e]=!0,this.collisionManager.addChunkColliders(this.cachedChunkData[e])}))}removeChunkImages(e){if(this.showedChunkImages[e.index])for(let t=0;t<e.layers.length;t++){const i=e.layers[t].images;if(i&&(!this.resetting||!this.interuptedChunkImages[e.index]&&!this.pendingChunkImageLoads[e.index]))for(let e in i){const n=i[e];for(let e=0;e<n.length;e+=3){const i=n[e+2];this.initiailizedSprites[t][i]?--this.initiailizedSprites[t][i].chunkCount||(this.initiailizedSprites[t][i].removeFromMap(),delete this.initiailizedSprites[t][i]):this.resetting}}}}forceShowChunkImages(e,t){return n(this,void 0,void 0,(function*(){if(this.resetting)return!1;for(let i=0;i<e.layers.length;i++){2==i&&e.index;const n=e.layers[i].images;if(n)for(let s in n){const r=n[s];for(let n=0;n<r.length;n+=3){const o=r[n+2];if(this.initiailizedSprites[i])if(this.initiailizedSprites[i][o])this.initiailizedSprites[i][o].chunkCount++;else{this.pendingChunkImageLoads[e.index]=!0;const a=yield this.imageManager._getMapImage(parseInt(s),r[n],r[n+1],o,i);if(delete this.pendingChunkImageLoads[e.index],this.curMapSeq!==t)return;if(this.resetting)return this.interuptedChunkImages[e.index]=!0,!1;if(!this.initiailizedSprites[i])return;a.chunkCount=1,this.initiailizedSprites[i][o]=a}}}}this.showedChunkImages[e.index]=!0,e.index}))}destroyInitializedChunk(e){const t=this.cachedChunkData[e];this.showedChunkColliders[e]&&this.collisionManager.removeChunkColliders(t),this.showedChunkImages[e]&&this.removeChunkImages(t),this.loadedChunks[e].destroy(),delete this.loadedChunks[e]}destroyChunk(e){if(this.cachedChunkData[e],this.loadedChunks[e])this.destroyInitializedChunk(e);else if(this.initBatches[e])this.destroyChunkInBatch(e);else if(!this.interuptedChunkData[e]&&!this.loadingChunkData[e])throw console.error(this),new Error("Trying to destroy a chunk that was neither loaded nor in the batch queue. The chunk index was "+e);delete this.showedChunkColliders[e],delete this.showedChunkImages[e],delete this.cachedChunkData[e]}bakeAndSaveNeededChunks(){return n(this,void 0,void 0,(function*(){for(let e=0;e<this.indexesToUpdate.length;e++){const t=this.indexesToUpdate[e],i=(yield this.loadChunk(t,this.curMapSeq)).bake();yield this.saveChunkTextures(t,i),i.forEach(e=>{e.destroy(!0)})}}))}loadAllChunks(){return n(this,void 0,void 0,(function*(){return!0}))}loadChunkData(e,t){return n(this,void 0,void 0,(function*(){if(this.cachedChunkData[e])return this.cachedChunkData[e];if(this.resetting)throw new Error("no loading chunk data while resetting.");const i=this.mapId;let n;if(this.loadingChunkData[e]=!0,this.chunkLoaderWorker)n=yield this.chunkLoaderWorker.getChunkData(e);else{const t=r.mapFileKey(this.baseUrl,this.mapId,e);n=this.indexedDbLoader?yield this.indexedDbLoader.loadJson(t):yield o.httpGetAsync(t,!1)}return this.curMapSeq!==t?(i in this.cachedMapChunksDatas&&(this.cachedMapChunksDatas[i].chunks[e]=n),null):(delete this.loadingChunkData[e],n.index=e,this.resetting?(this.interuptedChunkData[e]=!0,i in this.cachedMapChunksDatas&&(this.cachedMapChunksDatas[i].chunks[e]=n)):this.cachedChunkData[e]=n,n)}))}loadChunkLocalStorage(e){return JSON.parse(localStorage.getItem(`${this.localStorageDataKey}_${e}`))}loadChunkWebWorker(e){return n(this,void 0,void 0,(function*(){return null}))}makeChunkLayerKey(e,t){return`${this.mapId}_${e}_${t}`}deleteChunkTextures(){}saveChunkTextures(e,t){return n(this,void 0,void 0,(function*(){for(let i=0;i<t.length;i++)yield this.indexedDbLoader.saveTexture(this.makeChunkLayerKey(e,i),t[i])}))}loadChunkTextures(e){return n(this,void 0,void 0,(function*(){const t=[],i=this.cachedChunkData[e];if(!i)throw new Error("no chunk data found");for(let n=0;n<i.layers.length;n++)t.push(this.indexedDbLoader.loadTexture(this.makeChunkLayerKey(e,n)));return Promise.all(t)}))}isVisibleWithBuffer(e,t,i){let{x:n,y:s,width:r,height:o}=this.playerViewRect;return n-=t/2,s-=i/2,r+=t,o+=i,e.x<n+r&&e.x+e.width>n&&e.y<s+o&&e.height+e.y>s}webGlAtlasFactory(e){return new d.WebGLTextureAtlas(e)}canvasAtlasFactory(e){return new l.CanvasTextureAtlas(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapFileKey=function(e,t,i){return null!=i?`${e}/${t}/s_${i}`:`${e}/${t}/map`},t.mapMetaPath=function(e,t){return`${e}/${t}/meta`}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(3);class s extends PIXI.utils.EventEmitter{constructor(e,t,i,s,r,o){super(),this.colliders=[],this.subChunkContainers=[],this.subChunkRenderedSprites=[],this.layerRenderedContainers=[],this.isBatching=!1,this.visibleChunks=[],this.spritePool=[],this.initBatches=[],this.initializedSubChunks=!1,this.usingBakedRenderTextures=!1,this.bakingOnTheGo=!1,this.hidden=!1,this.layerContainers=[],this.worldSubChunkIndexes={},this.localChunkIndexesArray=[],this.localToWorldSubChunkIndexes={},this.mapMetaData=e,this.textureAtlassesByLayerIndex=i;const a=e.subChunkW||n.RUNTIME_TILE_LAYER_SECTION_SIZE,h=e.subChunkH||n.RUNTIME_TILE_LAYER_SECTION_SIZE;this.subChunkW=a,this.subChunkH=h,this.subChunkColumns=Math.ceil(t.width/a),this.subChunkRows=Math.ceil(t.height/h),this.maxSubChunks=this.subChunkRows*this.subChunkColumns,this.chunkData=t;const l=Math.ceil(this.mapMetaData.mapW/a),d=Math.floor(this.chunkData.x/a),c=Math.floor(this.chunkData.y/h);this.parentStartingSubChunkIndex=c*l+d;for(let e=0;e<this.subChunkColumns;e++){let t=e+d;for(let i=0;i<this.subChunkRows;i++){const n=(i+c)*l+t,s=i*this.subChunkColumns+e;this.worldSubChunkIndexes[n]=s,this.localToWorldSubChunkIndexes[s]=n}}this.localChunkIndexesArray=Object.keys(this.localToWorldSubChunkIndexes).map(parseInt).sort((e,t)=>e-t),this.tileManager=r,this.containerPool=s}bake(e){const t=[],i=[];for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)i.push(new PIXI.Container);return i.forEach((i,n)=>{e.render(i,t[n])}),t}orderSubChunksByDistanceDescending(e){const t=new Array(this.maxSubChunks);for(let i=0;i<this.maxSubChunks;i++){const s=this.chunkData.x+i%this.subChunkColumns*n.RUNTIME_TILE_LAYER_SECTION_SIZE,r=this.chunkData.y+Math.floor(i/this.subChunkColumns)*n.RUNTIME_TILE_LAYER_SECTION_SIZE;t[i]={i:i,d:Math.sqrt(Math.pow(s-e.x,2)+Math.pow(r-e.y,2))}}return t.sort((e,t)=>e.d-t.d),t.map(e=>e.i)}interuptBatch(){const e=[];this.initBatches.length=0,this.isBatching=!1;for(let t=0;t<this.maxSubChunks;t++)this.subChunkRenderedSprites[t]?e[t]=this.subChunkRenderedSprites[t]:this.subChunkContainers[t]?e[t]=this.subChunkContainers[t]:(this.addTilesToSubChunkContainer(t),e[t]=this.subChunkContainers[t]);return e}initTileLayers(){for(let e=0;e<this.maxSubChunks;e++)this.addTilesToSubChunkContainer(e);const e=new Array(this.mapMetaData.layerTileLayerOrder.length);for(let t=0;t<this.mapMetaData.layerTileLayerOrder.length;t++){e[t]=new Array(this.maxSubChunks);for(let i=0;i<this.maxSubChunks;i++)this.subChunkContainers[i]&&(e[t][i]=this.subChunkContainers[i][t])}return e}initBatchRender(e){var t;const i=this.orderSubChunksByDistanceDescending(e);if(this.isBatching)throw new Error("Alreading batching...");this.isBatching=!0;for(let e=0;e<i.length;e++){const n=i[e];this.subChunkContainers[n]=new Array(this.mapMetaData.layerTileLayerOrder.length);for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)if(this.initBatches.push(this.renderSubChunkLayer.bind(this,n,e,null,null,!0)),null===(t=this.chunkData.layers[e])||void 0===t?void 0:t.tileLayers)for(let t=0;t<this.chunkData.layers[e].tileLayers.length;t++)this.chunkData.layers[e].tileLayers[t]&&this.chunkData.layers[e].tileLayers[t].subChunks[n]&&this.initBatches.push(this.addSizedTilesToSubChunkLayerContainer.bind(this,t,e,n,null,null,!0));this.initBatches.push(()=>{this.subChunkContainers[n]=new Array(this.mapMetaData.layerTileLayerOrder.length),this.subChunkRenderedSprites[n]=new Array(this.mapMetaData.layerTileLayerOrder.length);for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)this.subChunkContainers[n][e]=new PIXI.Container})}}forceBatches(){if(this.initBatches.length>0)for(let e=this.initBatches.length-1;e>=0;e--)this.initBatches[e]();this.initBatches.length=0,this.isBatching=!1}nextBatch(e=0){const t=this.initBatches.pop();if(t){const i=performance.now();return t(),!((e+=performance.now()-i)<2)||this.nextBatch(e)}return this.isBatching=!1,!1}destroy(){this.initBatches.length=0;for(let e=0;e<this.subChunkContainers.length;e++)for(let t=0;t<this.subChunkContainers[e].length;t++)if(this.subChunkRenderedSprites[e]&&this.subChunkRenderedSprites[e][t]){this.textureAtlassesByLayerIndex[t].removeChunkFromTexture(this.localToWorldSubChunkIndexes[e]);const i=this.subChunkRenderedSprites[e][t];i.parent&&i.parent.removeChild(i),i.texture.destroy(!1),i.destroy()}else this.subChunkContainers[e]&&this.subChunkContainers[e][t]&&(Array.from(this.subChunkContainers[e][t].children).forEach(e=>{e.removeFromMap()}),this.subChunkContainers[e][t].destroy());return this.subChunkContainers.length=0,this.subChunkRenderedSprites.length=0,!0}hide(){this.hidden=!0;for(let e=0;e<this.maxSubChunks;e++)for(let t=0;t<this.mapMetaData.layerTileLayerOrder.length;t++)this.subChunkContainers[e]&&this.subChunkContainers[e][t]&&(this.subChunkContainers[e][t].visible=!1),this.subChunkRenderedSprites[e]&&this.subChunkRenderedSprites[e][t]&&(this.subChunkRenderedSprites[e][t].visible=!1);return!0}show(e,t,i){if(this.hidden)for(let e=0;e<this.maxSubChunks;e++)for(let t=0;t<this.mapMetaData.layerTileLayerOrder.length;t++)this.subChunkContainers[e]&&this.subChunkContainers[e][t]&&(this.subChunkContainers[e][t].visible=!0),this.subChunkRenderedSprites[e]&&this.subChunkRenderedSprites[e][t]&&(this.subChunkRenderedSprites[e][t].visible=!0);else if(this.isBatching)this.forceBatches();else for(let e=0;e<this.maxSubChunks;e++)this.subChunkRenderedSprites[e]||this.renderSubChunk(e),this.isBatching=!1;return this.subChunkRenderedSprites}bakeSubChunk(e){return[]}updateVisibleSubChunks(e){const t={};for(let i=0;i<e.length;i++)if(e[i]in this.worldSubChunkIndexes){const n=this.worldSubChunkIndexes[e[i]];if(t[n]=!0,this.subChunkContainers[n])for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)this.subChunkContainers[n][e]&&(this.subChunkContainers[n][e].visible=!0);if(this.subChunkRenderedSprites[n])for(let e=0;e<this.mapMetaData.layerTileLayerOrder.length;e++)this.subChunkRenderedSprites[n][e]&&(this.subChunkRenderedSprites[n][e].visible=!0)}for(let e=0;e<this.localChunkIndexesArray.length;e++)if(!t[this.localChunkIndexesArray[e]]){if(this.subChunkContainers[this.localChunkIndexesArray[e]])for(let t=0;t<this.mapMetaData.layerTileLayerOrder.length;t++)this.subChunkContainers[this.localChunkIndexesArray[e]][t]&&(this.subChunkContainers[this.localChunkIndexesArray[e]][t].visible=!1);if(this.subChunkRenderedSprites[this.localChunkIndexesArray[e]])for(let t=0;t<this.mapMetaData.layerTileLayerOrder.length;t++)this.subChunkRenderedSprites[this.localChunkIndexesArray[e]][t]&&(this.subChunkRenderedSprites[this.localChunkIndexesArray[e]][t].visible=!1)}}renderSubChunkLayer(e,t,i,s,r=!1,o=!0){if(performance.now(),this.subChunkRenderedSprites[e][t]){const i=this.subChunkRenderedSprites[e][t];return this.emit("add-subchunk-layer-sprite",{chunkIndex:this.chunkData.index,layerIndex:t,sprite:i,subsectionIndex:e}),i}this.subChunkContainers[e][t]||this.addTilesToSubChunkLayerContainer(t,e,i,s);const a=this.subChunkContainers[e][t];if(!a||!a.children.length)return;const{x:h,y:l}=a.getLocalBounds();i=this.chunkData.x+e%this.subChunkColumns*n.RUNTIME_TILE_LAYER_SECTION_SIZE,s=this.chunkData.y+Math.floor(e/this.subChunkColumns)*n.RUNTIME_TILE_LAYER_SECTION_SIZE;const d=this.textureAtlassesByLayerIndex[t].renderSubChunkLayerGroup(this.localToWorldSubChunkIndexes[e],a),c=new PIXI.Sprite;return c.texture=d,this.subChunkRenderedSprites[e][t]=c,Array.from(a.children).forEach((e,t)=>{e.removeFromMap()}),a.destroy(!1),c.x=i+h,c.y=s+l,c.visible=!1,performance.now(),this.emit("add-subchunk-layer-sprite",{chunkIndex:this.chunkData.index,layerIndex:t,sprite:c,subsectionIndex:e}),c}renderSubChunk(e,t=!0){this.forceBatches();const i=this.chunkData.x+e%this.subChunkColumns*n.RUNTIME_TILE_LAYER_SECTION_SIZE,s=this.chunkData.y+Math.floor(e/this.subChunkColumns)*n.RUNTIME_TILE_LAYER_SECTION_SIZE;if(this.subChunkRenderedSprites[e]||(this.subChunkRenderedSprites[e]=new Array(this.mapMetaData.layerTileLayerOrder.length)),this.subChunkContainers[e])for(let n=0;n<this.mapMetaData.layerTileLayerOrder.length;n++)!this.subChunkRenderedSprites[e][n]&&this.renderSubChunkLayer(e,n,i,s,t);else{this.addTilesToSubChunkContainer(e);for(let n=0;n<this.mapMetaData.layerTileLayerOrder.length;n++)this.renderSubChunkLayer(e,n,i,s,t)}return this.subChunkRenderedSprites[e]}addSizedTilesToSubChunkLayerContainer(e,t,i,s,r,o=!1){const a=this.chunkData.layers,{layerId:h,colliders:l,tileLayers:d,images:c}=a[t];if(!d[e]||!d[e].subChunks[i])return;s=i%this.subChunkColumns*n.RUNTIME_TILE_LAYER_SECTION_SIZE,Math.floor(i/this.subChunkColumns),n.RUNTIME_TILE_LAYER_SECTION_SIZE;const u=this.subChunkContainers[i][t];if(!u)throw new Error("should have container at this point");const{tileWidth:p,tileHeight:f,tileSizeSeq:m,subChunks:g,maxTileId:y,startOffsets:v}=d[e],C=g[i];let S=C[0],w=C[1];for(let e=2;e<g[i].length;e++){let t=g[i][e],r=t;if(t){let e;if(t>y){let i=!!(1073741824&t),n=!!(536870912&t),s=!!(268435456&t);r&=-1879048193,e=this.tileManager.getTile(m,r);let o=0,a=0,h=1,l=1;n&&(l=-1,o=f),i&&(h=-1,a=p),s&&(e.rotation=Math.PI/180*90,i||(a=0),o=n?0:f),e.colliders}else e=this.tileManager.getTile(m,t);e.x=S,e.y=w,u.addChild(e)}((S+=p)>=n.RUNTIME_TILE_LAYER_SECTION_SIZE||S>=this.chunkData.x+this.chunkData.width-s)&&(S=C[0],w+=f)}}addTilesToSubChunkLayerContainer(e,t,i,n){var s;const r=this.chunkData.layers;if(0==e&&0==t&&this.parentStartingSubChunkIndex,this.subChunkContainers[t]||(this.subChunkContainers[t]=[]),!(null===(s=r[e])||void 0===s?void 0:s.tileLayers))return;const{layerId:o,colliders:a,tileLayers:h,images:l}=r[e];this.subChunkContainers[t][e]=new PIXI.Container;for(let s=0;s<h.length;s++)h[s]&&h[s].subChunks[t]&&(this.subChunkContainers[t][e].x=i,this.subChunkContainers[t][e].y=n,this.addSizedTilesToSubChunkLayerContainer(s,e,t,i,n))}addTilesToSubChunkContainer(e){if(this.subChunkContainers[e])return;const t=this.chunkData.layers,i=this.chunkData.x+e%this.subChunkColumns*n.RUNTIME_TILE_LAYER_SECTION_SIZE,s=this.chunkData.y+Math.floor(e/this.subChunkColumns)*n.RUNTIME_TILE_LAYER_SECTION_SIZE;this.subChunkContainers[e]=[];for(let n=0;n<t.length;n++)this.addTilesToSubChunkLayerContainer(n,e,i,s);this.initializedSubChunks=!0}getOffset(e,t){}getVisibleIndexes(e){const{x:t,y:i,width:n,height:s}=this.chunkData;return[]}}t.WorldChunk=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(10);class s extends n.AbstractTextureAtlas{constructor(e){super(2048,e),this.lookup={}}removeChunkFromTexture(e){if(!this.lookup[e])return;const{x:t,y:i,w:n,h:s,aIdx:r,texture:o}=this.lookup[e];delete this.lookup[e],this.addOpenSpot(r,t,i,n,s)}}t.CanvasTextureAtlas=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(10);class s extends n.AbstractTextureAtlas{constructor(e){super(e.gl.MAX_TEXTURE_SIZE,e),this.lookup={}}removeChunkFromTexture(e){if(!this.lookup[e])return;const{x:t,y:i,w:n,h:s,aIdx:r,texture:o}=this.lookup[e];this.renderer.bindRenderTexture(this.atlasses[r]);const a=this.renderer.gl;a.enable(a.SCISSOR_TEST),a.scissor(t,i,n,s),this.renderer.clear(),this.renderer.bindRenderTexture(),delete this.lookup[e],this.addOpenSpot(r,t,i,n,s)}}t.WebGLTextureAtlas=s},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(31),r=i(3),o=i(32),a=i(0);t.Decoder=class{constructor(e,t,i){this.propSeqToNameLookup={},this.tileIdToSizeLookup=[],this.tagSeqToStringLookup={},this.tileIdToSizeLookup=e,this.tagSeqToStringLookup=t,this.propSeqToNameLookup=i||{}}decodeMetaData(e){const t=e[0],i=e[1];let n=2,s=0;const o=[];let a,h=1;for(;;){if(e[n]===r.RESERVED_FLAGS.BLOB_SEPARATOR){if(2==++h){a=n+1;break}}else 1===h?(e[n]===r.RESERVED_FLAGS.EMPTY_SECTION_FLAG?o.push(null):o.push([e[n]]),s=o.length-1,h=0):o[s].push(e[n]);n++}return{mapW:t,mapH:i,startingChunkIndex:a,layerTileLayerOrder:o}}adjustNeg(e){return e.x>r.RESERVED_FLAGS.NEGATIVE_NUMBER&&(e.x&=~r.RESERVED_FLAGS.NEGATIVE_NUMBER,e.x*=-1),e.y>r.RESERVED_FLAGS.NEGATIVE_NUMBER&&(e.y&=~r.RESERVED_FLAGS.NEGATIVE_NUMBER,e.y*=-1),e}decodeString(e,t){let i="",n=t[e++];for(;n!=r.RESERVED_FLAGS.IMAGE_AND_STRING_SEPERATOR;)i+=String.fromCharCode(n),n=t[e++];return{decodedString:i,endIndex:e}}decodePropStrings(e,t){const i={};let n=null,s=t[e];for(;s!=r.RESERVED_FLAGS.BLOB_SEPARATOR;)if(s==r.RESERVED_FLAGS.IMAGE_AND_STRING_SEPERATOR)n=null,s=t[++e];else if(null===n){if(!(n=this.propSeqToNameLookup[s]))throw new Error("Expected prop");i[n]="",s=t[++e]}else i[n]+=String.fromCharCode(s),s=t[++e];return{endIndex:e+1,props:i}}decodePropNumbers(e,t){const i={};let n=t[e];for(;n!=r.RESERVED_FLAGS.BLOB_SEPARATOR;){const s=this.propSeqToNameLookup[t[e++]];if(!s)throw new Error("Did not find seq.");let o=t[e++];o>r.RESERVED_FLAGS.NEGATIVE_NUMBER&&(o&=~r.RESERVED_FLAGS.NEGATIVE_NUMBER,o*=-1),i[s]=o,n=t[e]}return{endIndex:e+1,props:i}}decodePropBooleans(e,t){const i={};let n=t[e];for(;n!=r.RESERVED_FLAGS.BLOB_SEPARATOR;){const s=this.propSeqToNameLookup[t[e++]];if(!s)throw new Error("Did not find seq.");let r=!!t[e++];i[s]=r,n=t[e]}return{endIndex:e+1,props:i}}decodePolygon(e,t){let i=e;const n=t[i++],s=t[i++];let r=[];const o=t[i++];for(;r.length<o;)r.push(this.adjustNeg({x:t[i++],y:t[i++]}));const h={colObj:{id:n,shapeType:a.RuntimeColliderShape.POLYGON,shapeData:r},endIndex:i};return this.decodeColliderTagsAndProps(h,s,t,i),h}decodeProps(e,t){let i,n={};return t[e]===r.RESERVED_FLAGS.EMPTY_SECTION_FLAG?{endAtIndex:e+1}:(({endIndex:e,props:i}=this.decodePropBooleans(e,t)),n=Object.assign(Object.assign({},n),i),({endIndex:e,props:i}=this.decodePropNumbers(e,t)),n=Object.assign(Object.assign({},n),i),({endIndex:e,props:i}=this.decodePropStrings(e,t)),{props:n=Object.assign(Object.assign({},n),i),endAtIndex:e})}mapTags(e){return e.map(e=>{if(!(e in this.tagSeqToStringLookup))throw new Error(`Could not find tag seq ${e} in lookup.`);return this.tagSeqToStringLookup[e]})}decodeRect(e,t){let i=e;const n=t[i++],s=t[i++],r=this.adjustNeg({x:t[i++],y:t[i++],w:t[i++],h:t[i++]}),o={colObj:{id:n,shapeType:a.RuntimeColliderShape.RECT,shapeData:r},endIndex:i};return this.decodeColliderTagsAndProps(o,s,t,i),o}decodeColliderTagsAndProps(e,t,i,n){const{tags:s,endAtIndex:r}=this.decodeTags(t,i,n);s&&(e.colObj.tags=s),e.endIndex=r;const{endAtIndex:o,props:a}=this.decodeProps(r,i);a&&(e.colObj.props=a),e.endIndex=o}decodeTags(e,t,i){let n;if(!e)return{endAtIndex:i};for(n=[];n.length<e;)n.push(t[i++]);return{tags:this.mapTags(n),endAtIndex:i}}decodePoint(e,t){let i=e;const n=t[i++],s=t[i++],r=this.adjustNeg({x:t[i++],y:t[i++]}),o={colObj:{id:n,shapeType:a.RuntimeColliderShape.POINT,shapeData:r},endIndex:i};return this.decodeColliderTagsAndProps(o,s,t,i),o}decodeCollider(e,t,i){switch(e){case"polygons":return this.decodePolygon(t,i);case"rects":return this.decodeRect(t,i);case"points":return this.decodePoint(t,i);default:throw new Error(`Unhandled type ${e}`)}}decodeColliders(e,t,i){const n=new Array(i);let s=!1,r=0;const o=["points","rects","polygons"];let a=e;for(;r<i;){let e=0;for(;e<o.length;){let i=0,h=t[a++];for(;i<h;){s=!0,n[r]||(n[r]={}),n[r][o[e]]||(n[r][o[e]]=new Array(h));const{endIndex:l,colObj:d}=this.decodeCollider(o[e],a,t);a=l,n[r][o[e]][i]=d,i++}e++}r++}return{decoded:s?n:null,endIndex:a}}splitChunkArrayLayers(e,t){const i=new Array(t.length),n=new Array(t.length);let s=0;for(let o=0;o<t.length;o++){n[o]=[];const a=t[o];if(a&&a.length){i[o]=[],a.forEach(()=>{i[o].push([])});let t=0;for(;t<a.length;)e[s]===r.RESERVED_FLAGS.BLOB_SEPARATOR?t++:i[o][t].push(e[s]),s++}else i[o]=null}let o,a=0,h=!1,l=!0,d=0,c=!0;for(;a<t.length;){5==e[s+1]&&e[s+2];const i=e[s];l?((o=i)||(n[a]=null),l=!1):i===r.RESERVED_FLAGS.BLOB_SEPARATOR?(c=!0,++a<t.length&&(l=!0)):i===r.RESERVED_FLAGS.IMAGE_AND_STRING_SEPERATOR?(c=!0,n[a].push(i)):(h=!0,++d==(c?4:3)&&(d=0,c=!1),n[a].push(i)),s++}const{endIndex:u,decoded:p}=this.decodeColliders(s,e,t.length);s=u;const f={tileArrays:i};return h&&(f.images=n),p&&(f.colliders=p),f}decodeChunk(e,t,i,n,r,a,h,l,d){d=Array.isArray(d)?d:s.default.uncompress(d);const c=Math.ceil(t/n),u=e%c*n,p=Math.floor(e/c)*r,{endX:f,endY:m}=o.calculateEndOfChunk(t,i,n,r,u,p),g={index:e,x:u,y:p,width:f-u,height:m-p,layers:new Array(l.length)},y=this.splitChunkArrayLayers(d,l),v=!!y.images,C=!!y.colliders;for(let e=0;e<l.length;e++){const s=l[e];g.layers[e]={layerId:e},s&&(g.layers[e].tileLayers=s.map((s,o)=>{const{width:l,height:d}=this.tileIdToSizeLookup[s],c=y.tileArrays[e][o];return{tileSizeSeq:s,maxTileId:1e4,tileWidth:l,tileHeight:d,subChunks:c?this.unmergeSubsectionTiles(l,d,a,h,n,r,u,p,t,i,c):null}})),v&&y.images[e]&&(g.layers[e].images=this.unmergeLayerImages(y.images[e])),C&&y.colliders[e]&&(g.layers[e].colliders=y.colliders[e])}return g}getCompressedChunksFromMap(e,t,i){const n=s.default.uncompress(i),{mapW:o,mapH:a,startingChunkIndex:h,layerTileLayerOrder:l}=this.decodeMetaData(n),d=Math.ceil(o/e)*Math.ceil(a/t);let c=0;const u=new Array(d);for(let e=0;e<d;e++)u[e]=[];for(let e=h;e<n.length;e++)if(n[e]!==r.RESERVED_FLAGS.CHUNK_SEPERATOR)u[c].push(n[e]);else{if(++c===d){if(e!==n.length-1)throw new Error("Should be on last element by the time it gets here.");break}u[c]=[]}return{metaData:{mapW:o,mapH:a,startingChunkIndex:h,layerTileLayerOrder:l},buffers:u.map(e=>s.default.compress(e))}}decodeMap(e,t,i,o,a,h){return n(this,void 0,void 0,(function*(){const n=Array.isArray(a)?a:s.default.uncompress(a),{mapW:l,mapH:d,startingChunkIndex:c,layerTileLayerOrder:u}=this.decodeMetaData(n),p=(u.length,Math.ceil(l/e)*Math.ceil(d/t)),f=new Array(p);f[0]=[];let m=0;for(let e=c;e<n.length;e++)if(n[e]!==r.RESERVED_FLAGS.CHUNK_SEPERATOR)f[m].push(n[e]);else{if(++m===p){if(e!==n.length-1)throw new Error("Should be on last element by the time it gets here.");break}f[m]=[]}const g=[];if(h)for(let n=0;n<f.length;n++){const s=this.decodeChunk(n,l,d,e,t,i,o,u,f[n]);g.push(s),yield h(s,n)}else for(let n=0;n<f.length;n++)g.push(this.decodeChunk(n,l,d,e,t,i,o,u,f[n]));return{metaData:{mapW:l,mapH:d,startingChunkIndex:c,layerTileLayerOrder:u},chunks:g}}))}unmergeLayerImages(e){const t={};let i=!0,n=0,s=null;for(let o=0;o<e.length;o++)if(e[o]!==r.RESERVED_FLAGS.IMAGE_AND_STRING_SEPERATOR)if(i)t[s=e[o]]=[],i=!1;else{let i=e[o];n<2&&i>r.RESERVED_FLAGS.NEGATIVE_NUMBER&&(i&=~r.RESERVED_FLAGS.NEGATIVE_NUMBER,i*=-1),t[s].push(i),3==++n&&(n=0)}else i=!0;return t}unmergeSubsectionTiles(e,t,i,n,s,a,h,l,d,c,u,p){let f,m;p?(f=p.x,m=p.y):({endX:f,endY:m}=o.calculateEndOfChunk(d,c,s,a,h,l));const g=o.calculateSubChunks(d,c,s,a,h,l,i,n),y=new Array(g).fill(-1);let v=0,C=h,S=l,{x:w,y:b}=o.getTopLeftPadding(e,t,d,c,i,n,C,S),T=w,_=b;const x=()=>{v++,T=0,_=0,(C+=i)>=f&&(C=h,S+=n),({x:w,y:b}=o.getTopLeftPadding(e,t,d,c,i,n,C,S)),T=w,_=b};for(let s=0;s<u.length;s++)if(u[s]===r.RESERVED_FLAGS.EMPTY_SECTION_FLAG){if(-1!==y[v])throw new Error("This sub chunk should have been -1 at this time");y[v]=null,x()}else-1===y[v]&&(y[v]=[w,b]),y[v].push(u[s]),(C+(T+=e)>=f||T>=i)&&(T=w,(S+(_+=t)>=m||_>=n)&&x());return y}}},function(e,t,i){"use strict";function n(){}function s(e){return e<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5}function r(e){return e+e^e>>31}function o(e){return e>>1^-(1&e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.computeCompressedSizeInBytes=function(e){for(var t=e.length,i=0,n=0;n<t;n++)i+=s(e[n]);return i},n.computeCompressedSizeInBytesSigned=function(e){for(var t=e.length,i=0,n=0;n<t;n++)i+=s(r(e[n]));return i},n.compress=function(e){for(var t=e.length,i=new ArrayBuffer(n.computeCompressedSizeInBytes(e)),s=new Int8Array(i),r=0,o=0;o<t;o++){var a=e[o];a<128?s[r++]=a:a<16384?(s[r++]=127&a|128,s[r++]=a>>>7):a<1<<21?(s[r++]=127&a|128,s[r++]=a>>>7&127|128,s[r++]=a>>>14):a<1<<28?(s[r++]=127&a|128,s[r++]=a>>>7&127|128,s[r++]=a>>>14&127|128,s[r++]=a>>>21):(s[r++]=127&a|128,s[r++]=a>>>7&127|128,s[r++]=a>>>14&127|128,s[r++]=a>>>21&127|128,s[r++]=a>>>28)}return i},n.computeHowManyIntegers=function(e){for(var t=new Int8Array(e).length,i=0,n=0;n<t;n++)i+=e[n]>>>7;return t-i},n.uncompress=function(e){for(var t=[],i=new Int8Array(e),n=i.length,s=0;n>s;){var r=i[s++],o=127&r;r>=0?t.push(o):(o|=(127&(r=i[s++]))<<7,r>=0?t.push(o):(o|=(127&(r=i[s++]))<<14,r>=0?t.push(o):(o|=(127&(r=i[s++]))<<21,r>=0?t.push(o):(o|=(r=i[s++])<<28,t.push(o)))))}return t},n.compressSigned=function(e){for(var t=e.length,i=new ArrayBuffer(n.computeCompressedSizeInBytesSigned(e)),s=new Int8Array(i),o=0,a=0;a<t;a++){var h=r(e[a]);h<128?s[o++]=h:h<16384?(s[o++]=127&h|128,s[o++]=h>>>7):h<1<<21?(s[o++]=127&h|128,s[o++]=h>>>7&127|128,s[o++]=h>>>14):h<1<<28?(s[o++]=127&h|128,s[o++]=h>>>7&127|128,s[o++]=h>>>14&127|128,s[o++]=h>>>21):(s[o++]=127&h|128,s[o++]=h>>>7&127|128,s[o++]=h>>>14&127|128,s[o++]=h>>>21&127|128,s[o++]=h>>>28)}return i},n.uncompressSigned=function(e){for(var t=[],i=new Int8Array(e),n=i.length,s=0;n>s;){var r=i[s++],a=127&r;r>=0?t.push(o(a)):(a|=(127&(r=i[s++]))<<7,r>=0?t.push(o(a)):(a|=(127&(r=i[s++]))<<14,r>=0?t.push(o(a)):(a|=(127&(r=i[s++]))<<21,r>=0?t.push(o(a)):(a|=(r=i[s++])<<28,t.push(o(a))))))}return t}},function(e,t,i){"use strict";function n(e,t,i,n,s,r,o,a){const h=e-s,l=t-r,d=Math.min(Math.ceil(i/o),Math.ceil(h/o));return{rows:Math.min(Math.ceil(n/a),Math.ceil(l/a)),columns:d}}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateEndOfChunk=function(e,t,i,n,s,r){const o=e-s,a=t-r;return{endX:s+(o>=i?i:o),endY:r+(a>=n?n:a)}},t.calculateSubChunks=function(e,t,i,s,r,o,a,h){const{rows:l,columns:d}=n(e,t,i,s,r,o,a,h);return l*d},t.calculateRowsAndColumns=n,t.getTopLeftPadding=function(e,t,i,n,s,r,o,a){const h={x:0,y:0},l=Math.floor(o/s),d=Math.floor(a/r);let c=(e-s%e)*l,u=Math.floor(c/e);return h.x=c-u*e,c=(t-r%t)*d,u=Math.floor(c/t),h.y=c-u*t,h},t.calculateOffsets=function(e,t,i,n,s,r,o,a){const h=Math.ceil(i/s),l=Math.ceil(n/r),d={x:0,y:0},c=Math.floor(o/s),u=Math.floor(a/r);let p=(e-s%e)*c,f=Math.floor(p/e);d.x=p-f*e,p=(t-r%t)*u,f=Math.floor(p/t),d.y=p-f*t;const m={x:0,y:0};return c<h-1&&(p=(e-s%e)*(c+1),f=Math.floor(p/e),m.x=p-f*e),u<l-1&&(p=(t-r%t)*(u+1),f=Math.floor(p/t),m.y=p-f*t),{bottomRightOverflow:m,topLeftPadding:d}}},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,r),h=s?s+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],a]:e._events[h].push(a):(e._events[h]=a,e._eventsCount++),e}function h(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function l(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),l.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},l.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},l.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},l.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var h,l,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,r),!0;case 6:return d.fn.call(d.context,t,i,n,r,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];d.fn.apply(d.context,h)}else{var u,p=d.length;for(l=0;l<p;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,i);break;case 4:d[l].fn.call(d[l].context,t,i,n);break;default:if(!h)for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];d[l].fn.apply(d[l].context,h)}}return!0},l.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},l.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},l.prototype.removeListener=function(e,t,i,n){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return h(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||h(this,r);else{for(var a=0,l=[],d=o.length;a<d;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=1===l.length?l[0]:l:h(this,r)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&h(this,t)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=s,l.EventEmitter=l,e.exports=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(1);var s;!function(e){e[e.INFINITE_SIZE=0]="INFINITE_SIZE",e[e.FIXED_VIEW=1]="FIXED_VIEW",e[e.MAX_SIZE=2]="MAX_SIZE"}(s=t.LevelCameraRenderMode||(t.LevelCameraRenderMode={}));class r{constructor(e={},t,i,r){this.focused=!1,this.viewRect={x:0,y:0,width:0,height:0},this.offsetViewRect={x:0,y:0,width:0,height:0},this.centeredScreenPosition={x:0,y:0},this.mapOffsetX=0,this.mapOffsetY=0,this.mapPaddingLeft=0,this.mapPaddingTop=0,this.resizeWithScreen=!0,this.stopCameraAtBoundaries=!0,this.isStopping=!1,this.staticSprites=[],this.dynamicSprites=[],this.playerViewRect={x:0,y:0,width:0,height:0},this.resolution=1,this.computedResolution=1,this.centeredScreenPosition={x:0,y:0},this.renderer=r,this.gameStage=t,this.flags=i,e=n.mergeOptions(e,{renderMode:s.INFINITE_SIZE,resolution:1,resizeWithScreen:!0,viewWidth:"undefined"!=typeof window?window.innerWidth:"undefined"!=typeof screen?screen.width:null,viewHeight:"undefined"!=typeof window?window.innerHeight:"undefined"!=typeof screen?screen.height:null,stopCameraAtBoundaries:!0},["resolution","viewWidth","viewHeight"]),this.resolution=e.resolution,this.renderMode=e.renderMode,this.resizeView(e.viewWidth,e.viewHeight),this.resizeWithScreen=!1!==e.resizeWithScreen,this.stopCameraAtBoundaries=e.stopCameraAtBoundaries,this.handleRemovedFocusedGameObject=this.handleRemovedFocusedGameObject.bind(this)}reset(){this.staticSprites.length=0,this.dynamicSprites.length=0,this.gameStage.x=0,this.gameStage.y=0}handleRemovedFocusedGameObject(){this.focusedGameObject.offRemovedFromMap(this.handleRemovedFocusedGameObject),this.focusedGameObject=null,this.focusOn({x:this.focusedGameObject.worldX,y:this.focusedGameObject.worldY})}focusOn(e,t=0,i=0){return this.preFocusBoundPoint=this.boundCameraCenter,this.bindCameraCenter(e)}removeSprite(e){if(Array.isArray(e))for(let t=0;t<e.length;t++){const i=e[t].isStatic?this.staticSprites:this.dynamicSprites;for(let n=0;n<i.length;n++)if(e[t]===i[n]){i.splice(n,1);break}}else{const t=e.isStatic?this.staticSprites:this.dynamicSprites;for(let i=0;i<t.length;i++)if(e===t[i])return void t.splice(i,1)}}addSingleStaticSprite(e){this.staticSprites.push(e)}addStaticSprites(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.staticSprites.push(e[t]);else this.staticSprites.push(e)}addDynamicSprite(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.dynamicSprites.push(e[t]);else this.dynamicSprites.push(e)}onUpdateCamera(e){const t=r.prototype;this.updateStage=()=>{e(t.updateStage.bind(this))}}updateStage(){this.boundCameraCenter?(this.boundPositionOffsets?this.updateViewRect(Math.round(this.boundCameraCenter.x)+this.boundPositionOffsets.x,Math.round(this.boundCameraCenter.y)+this.boundPositionOffsets.y):this.updateViewRect(Math.round(this.boundCameraCenter.x),Math.round(this.boundCameraCenter.y)),this.gameStage.x=-this.playerViewRect.x,this.gameStage.y=-this.playerViewRect.y):console.error("Call world.bindCameraCenter on an object with an x and y variable.")}bindCameraCenter(e,t){this.boundPositionOffsets=t,this.boundCameraCenter=e,this.playerViewRect.x=Math.max(0,Math.min(this.playerViewRect.x,this.levelWidthInPixels-this.playerViewRect.width)),this.playerViewRect.y=Math.max(0,Math.min(this.playerViewRect.y,this.levelHeightInPixels-this.playerViewRect.height)),this.gameStage.x=-this.playerViewRect.x,this.gameStage.y=-this.playerViewRect.y,this.lastX=this.boundCameraCenter.x,this.lastY=this.boundCameraCenter.y}updateMapSize(e,t){this.mapOffsetX=0,this.mapOffsetY=0,this.levelWidthInPixels=e,this.levelHeightInPixels=t,this.levelHeightResAdjusted=t*this.resolution,this.levelWidthResAdjusted=e*this.resolution,this.viewWidth*this.resolution>this.levelWidthResAdjusted&&(this.mapOffsetX=Math.floor((this.viewWidth*this.resolution-this.levelWidthResAdjusted)/2)),this.viewHeight*this.resolution>this.levelHeightResAdjusted&&(this.mapOffsetY=Math.floor((this.viewHeight*this.resolution-this.levelHeightResAdjusted)/2))}isOutOfMap(e){}isVisibleWithBuffer(e,t,i){let{x:n,y:s,width:r,height:o}=this.playerViewRect;const a=t/2,h=i/2;return n-=a,s-=h,r+=a,o+=h,e.x<n+r&&e.x+e.width>n&&e.y<s+o&&e.height+e.y>s}isVisible(e){const{x:t,y:i,width:n,height:s}=this.playerViewRect;return e.x<t+n&&e.x+e.width>t&&e.y<i+s&&e.height+e.y>i}worldToScreen(e,t){return e-=this.playerViewRect.x,t-=this.playerViewRect.y,e/=this.ratioW,t/=this.ratioH,{x:e+this.mapPaddingLeft,y:t+this.mapPaddingTop}}screenToWorld(e,t){return{x:(e-this.mapPaddingLeft)*this.ratioW+this.playerViewRect.x,y:(t-this.mapPaddingTop)*this.ratioH+this.playerViewRect.y}}focusedCameraUpdate(){const e=this.focusedPoint.x+this.focusOffsetX,t=this.focusedPoint.y+this.focusOffsetY;this.updateViewRect(e,t)}updateViewRect(e,t){this.playerViewRect.x=e-this.halfWidth,this.playerViewRect.y=t-this.halfHeight,this.offsetViewRect.x=this.playerViewRect.x+this.mapOffsetX,this.offsetViewRect.y=this.playerViewRect.y+this.mapOffsetY,this.centeredScreenPosition.x=e+this.mapOffsetX,this.centeredScreenPosition.y=t+this.mapOffsetY;const{x:i,y:n}=this.centeredScreenPosition;if(this.stopCameraAtBoundaries){const e=Math.floor(i-this.halfWidth),t=e+this.viewWidth,s=Math.floor(n-this.halfHeight),r=s+this.viewHeight;this.isStopping=!1,e<=this.mapOffsetX?(this.playerViewRect.x=0,this.offsetViewRect.x=this.mapOffsetX,this.isStopping=!0,this.centeredScreenPosition.x=this.halfWidth+this.mapOffsetX):t>=this.levelWidthInPixels+this.mapOffsetX&&(this.playerViewRect.x=Math.max(this.levelWidthInPixels-this.viewWidth,0),this.offsetViewRect.x=this.playerViewRect.x+this.mapOffsetX,this.isStopping=!0,this.centeredScreenPosition.x=Math.floor(this.levelWidthInPixels+this.mapOffsetX-this.halfWidth)),s<=this.mapOffsetY?(this.playerViewRect.y=0,this.offsetViewRect.y=this.mapOffsetY,this.isStopping=!0,this.centeredScreenPosition.y=this.halfHeight+this.mapOffsetY):r>this.levelHeightInPixels+this.mapOffsetY&&(this.playerViewRect.y=Math.max(this.levelHeightInPixels-this.viewHeight),this.offsetViewRect.y=this.playerViewRect.y+this.mapOffsetY,this.isStopping=!0,this.centeredScreenPosition.y=Math.floor(this.levelHeightInPixels+this.mapOffsetY-this.halfHeight))}}updatePlayerSprite(e,t){this.isStopping||this.focused?(this.playerSprite.x=e-this.playerViewRect.x+this.mapOffsetX,this.playerSprite.y=t-this.playerViewRect.y+this.mapOffsetY):(this.playerSprite.x=this.centeredScreenPosition.x-this.playerViewRect.x+this.mapOffsetX,this.playerSprite.y=this.centeredScreenPosition.y-this.playerViewRect.y+this.mapOffsetY)}updateLevelSprites(e){for(let e=0;e<this.staticSprites.length;e++){const t=this.staticSprites[e];t.visible&&(t.x=t.worldX-this.playerViewRect.x+this.mapOffsetX,t.y=t.worldY-this.playerViewRect.y+this.mapOffsetY)}}focusOff(){if(!this.preFocusBoundPoint)throw new Error("No point to focus off onto.");this.bindCameraCenter(this.preFocusBoundPoint),delete this.preFocusBoundPoint}centerViewRect(e,t){this.centeredScreenPosition.x=e+this.mapOffsetX,this.centeredScreenPosition.y=t+this.mapOffsetY,this.playerViewRect.x=Math.floor(e-this.viewWidth/2),this.playerViewRect.y=Math.floor(t-this.viewHeight/2),this.offsetViewRect.x=this.playerViewRect.x+this.mapOffsetX,this.offsetViewRect.y=this.playerViewRect.y+this.mapOffsetY;for(let e=0;e<this.staticSprites.length;e++){const t=this.worldToScreen(this.staticSprites[e].worldX,this.staticSprites[e].worldY);this.staticSprites[e].x=t.x,this.staticSprites[e].y=t.y}}onResolutionUpdate(e){const{resolution:t,viewWidth:i,viewHeight:n,offsetWidth:s,offsetHeight:r,canvasWidth:o,canvasHeight:a,fixedResolution:h}=e;if(this.renderer.autoResize=!1,this.computedResolution=t,this.flags.webGl){if(t>=1){this.resolution=1,this.renderer.screen.width=i,this.renderer.screen.height=n,this.renderer.view.style.width=`${i*t}px`,this.renderer.view.style.height=`${n*t}px`;const e=this.renderer.view.parentElement.clientWidth,o=this.renderer.view.parentElement.clientHeight,a=1===t?s:(e-i*t)/2,h=1===t?r:(o-n*t)/2;this.renderer.view.style.marginLeft=`${a}px`,this.renderer.view.style.marginTop=`${h}px`,this.mapPaddingLeft=a,this.mapPaddingTop=h,this.renderer.view.width=i,this.renderer.view.height=n,this.resizeView(i,n);const l=this.renderer.rootRenderTarget;l&&l.resize(i,n)}else{this.resolution=t,this.renderer.plugins.interaction.resolution=1/t,this.renderer.screen.width=i/t,this.renderer.screen.height=n/t,this.renderer.view.style.width=`${i}px`,this.renderer.view.style.height=`${n}px`,this.renderer.view.width=Math.round(i/t),this.renderer.view.height=Math.round(n/t),this.renderer.view.style.marginLeft=`${(o-i)/2}px`,this.renderer.view.style.marginTop=`${(a-n)/2}px`,this.mapPaddingLeft=(o-i)/2,this.mapPaddingTop=(a-n)/2,this.resizeView(i,n);const e=this.renderer.rootRenderTarget;e&&e.resize(i/t,n/t)}this.renderer._activeRenderTarget&&this.renderer._activeRenderTarget===this.renderer.rootRenderTarget&&(this.renderer.rootRenderTarget.activate(),this.renderer._activeShader&&(this.renderer._activeShader.uniforms.projectionMatrix=this.renderer.rootRenderTarget.projectionMatrix.toArray(!0))),this.ratioW=this.renderer.screen.width/this.renderer.view.clientWidth,this.ratioH=this.renderer.screen.height/this.renderer.view.clientHeight,this.mapPaddingLeft*=this.ratioW,this.mapPaddingTop*=this.ratioH}}resizeView(e,t){if(!e)throw new Error("Cannot determine screen width");if(!t)throw new Error("Cannot determine screen width");this.resizeViewHeight(t),this.resizeViewWidth(e)}resizeViewWidth(e){this.viewWidth=Math.floor(e/this.resolution),this.halfWidth=Math.floor(this.viewWidth/2),this.playerViewRect.width=this.viewWidth,this.viewWidth>Math.ceil(this.levelWidthResAdjusted/this.resolution)?this.mapOffsetX=Math.floor((this.viewWidth-this.levelWidthResAdjusted)/2):this.mapOffsetX=0,this.centeredScreenPosition.x=this.viewWidth/2+this.mapOffsetX}resizeViewHeight(e){this.viewHeight=Math.floor(e/this.resolution),this.halfHeight=Math.floor(this.viewHeight/2),this.playerViewRect.height=this.viewHeight,this.viewHeight>this.levelHeightResAdjusted?this.mapOffsetY=Math.floor((this.viewHeight-this.levelHeightResAdjusted)/2):this.mapOffsetY=0,this.centeredScreenPosition.y=Math.floor(this.viewHeight/2+this.mapOffsetY)}}t.PlayerCamera=r},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(11),r=i(36);t.ChunkLoaderWorker=class{constructor(){this.nextReq=0,this.pendingRequests={},this.worker=new r,this.worker.onmessage=e=>{this.pendingRequests[e.data[1]](e.data[0])}}initWorld(e,t,i,r,o){return n(this,void 0,void 0,(function*(){if(i.length&&i.length%2)throw new Error("the tile size seq lookup should have an even amount of elements since its a width, height flat array.");return this.awaitResponse(s.Messages.INIT_LOADER,JSON.stringify([e,t,i,r,o]))}))}initMap(e){return n(this,void 0,void 0,(function*(){return this.awaitResponse(s.Messages.INIT_MAP,JSON.stringify(e))}))}getChunkData(e){return n(this,void 0,void 0,(function*(){const t=yield this.awaitResponse(s.Messages.GET_SECTION_DATA,e);return JSON.parse(t)}))}requestAndStoreAllMapChunks(e){return n(this,void 0,void 0,(function*(){const t=yield this.awaitResponse(s.Messages.REQUEST_AND_SAVE_ALL_MAP_CHUNKS,e);if(t===s.ResultCodes.ERROR)throw new Error(`Error decoding map chunk in the worker for map id ${e}`);return JSON.parse(t)}))}requestAndStoreSingleMapChunk(e,t){return n(this,void 0,void 0,(function*(){return this.awaitResponse(s.Messages.REQUEST_AND_SAVE_SINGLE_MAP_CHUNK,[e,t])}))}requestAndStoreMapChunks(e,t){return n(this,void 0,void 0,(function*(){yield this.awaitResponse(s.Messages.REQUEST_AND_SAVE_MAP_CHUNKS,[e,t])}))}awaitResponse(e,t){return n(this,void 0,void 0,(function*(){const i=++this.nextReq>65535?0:this.nextReq;return this.worker.postMessage([t,e,i]),new Promise(e=>{this.pendingRequests[i]=t=>(delete this.pendingRequests[i],e(t))})}))}}},function(e,t,i){e.exports=function(){return new Worker(i.p+"82608f8a2e4dcfc7a29b.worker.js")}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(1),r=i(38),o={[n.RuntimeColliderShape.RECT]:"rects",[n.RuntimeColliderShape.POINT]:"points",[n.RuntimeColliderShape.POLYGON]:"polygons",[n.RuntimeColliderShape.CIRCLE]:"circles",[n.RuntimeColliderShape.LINE]:"lines"},a=new Array(4);a[n.RuntimeColliderShape.POINT]=(e,t)=>t,a[n.RuntimeColliderShape.RECT]=(e,t)=>({w:e.w,h:e.h,x:t.x,y:t.y}),a[n.RuntimeColliderShape.POLYGON]=(e,t)=>{const i=t.x-e[0].x,n=t.y-e[0].y;return e.map(e=>({x:e.x+=i,y:e.y+=n}))},a[n.RuntimeColliderShape.CIRCLE]=(e,t)=>({x:t.x,y:t.y,r:e.r}),t.SpatialGrid=class{constructor(){this.uidIdx=1,this.dynamicColliders=[],this.staticColliders=[],this.iteration=0,this.collidersByTag={},this.colliderTags=[],this.tagCouples=[],this.staticBuckets={},this.uidCheckedCollidedMap={},this.uidArray=[],this.checkedMap={},this.curSeq=1,this.resolvePointLine=function(e,t,i,n,s,r,o=.5){const a=Math.sqrt(Math.pow(e-i,2)+Math.pow(t-n,2)),h=Math.sqrt(Math.pow(e-s,2)+Math.pow(t-r,2)),l=Math.sqrt(Math.pow(s-i,2)+Math.pow(r-n,2));return a+h>=l-o&&a+h<=l+o},this.getCollidersWithTags=r.getCollidersWithTags.bind(this,this.collidersByTag),this.getBucketsLookup=new Array(5),this.getBucketsLookup[n.RuntimeColliderShape.RECT]=this.getBucketsForRect.bind(this),this.getBucketsLookup[n.RuntimeColliderShape.POLYGON]=this.getBucketsForPolygon.bind(this),this.getBucketsLookup[n.RuntimeColliderShape.POINT]=this.getBucketsForPoint.bind(this),this.getBucketsLookup[n.RuntimeColliderShape.CIRCLE]=this.getBucketsForCircle.bind(this),this.getBucketsLookup[n.RuntimeColliderShape.LINE]=this.getBucketsForLine.bind(this)}onInit(e,t){const i=s.resolveMapSize(e,t);switch(i){case n.MapSize.LARGE:this.cellSize=256;break;case n.MapSize.MEDIUM:this.cellSize=128;break;case n.MapSize.SMALL:this.cellSize=64;break;default:throw new Error(`Invalid map size. ${i}`)}this.rows=Math.ceil(t/this.cellSize),this.cols=Math.ceil(e/this.cellSize)}onClear(){this.checkedMap={},this.curSeq=1,this.uidIdx=1,this.dynamicColliders.length=0,this.staticColliders.length=0,this.staticBuckets={},this.cellSize=0}getAllColliders(){return[...this.dynamicColliders,...this.staticColliders]}onAddedTagToCollider(e,t){if(this.addColliderToType(e,[t],o[e.shapeType]),e.isPolygon){if(this.handleAddedTagToPolygon(e,t),!e.dynamic){const t=e._bcache||this.getBucketsLookup[e.shapeType](e.shapeData);t.length>8&&(e._bcache=t);for(let i=0;i<t.length;i++)this.staticBuckets[t[i]]?this.staticBuckets[t[i]].push(e):this.staticBuckets[t[i]]=[e];for(let t=0;t<e.lines.length;t++){const i=this.getBucketsForLine(e.lines[t]);for(let t=0;t<i.length;t++)this.staticBuckets[i[t]].push(e)}}}else if(this.updateCheckMapOnAdd(e._uid,e,t),!e.dynamic){const t=this.getBucketsLookup[e.shapeType](e.shapeData);for(let i=0;i<t.length;i++)this.staticBuckets[t[i]]?this.staticBuckets[t[i]].push(e):this.staticBuckets[t[i]]=[e]}}onRemovedTagFromCollider(e,t){if(e.isPolygon){if(this.removeColliderFromType(e,[t],"polygons"),this.updateCheckMapOnPolygonRemove(e._uid,e,t),!e.tags){this.removeStaticColliderFromBucket(e);for(let t=0;t<e.lines.length;t++)this.removeStaticColliderFromBucket(e.lines[t])}}else this.removeColliderFromType(e,[t],o[e.shapeType]),this.updateCheckMapOnRemove(e._uid,e,t),e.tags||this.removeStaticColliderFromBucket(e)}getTagCoupleArrayForTag(e){for(let t=0;t<this.tagCouples.length;t++)if(this.tagCouples[t][0]===e)return this.tagCouples[t];return 1}onAddedColliderCouple(e,t){let i,n;if(e===t)for(let s=0;s<this.tagCouples.length;s++){if(this.tagCouples[s][0]===e){i=this.tagCouples[s];for(let n=1;n<i.length;n++)if(i[n]===t)throw new Error(`Trying to add duplicate tag couple ${e} and ${t}`)}if(this.tagCouples[s][0]===t){n=this.tagCouples[s];for(let i=1;i<n.length;i++)if(n[i]===e)throw new Error(`Trying to add duplicate tag couple ${e} and ${t}`)}}else{let s=0;for(let r=0;r<this.tagCouples.length;r++)if(this.tagCouples[r][0]===e){s++,i=this.tagCouples[r];for(let n=1;n<i.length;n++)if(i[n]===t)throw new Error(`Trying to add duplicate tag couple ${e} and ${t}`);if(2===s)break}else if(this.tagCouples[r][0]===t){s++,n=this.tagCouples[r];for(let i=1;i<n.length;i++)if(n[i]===e)throw new Error(`Trying to add duplicate tag couple ${e} and ${t}`);if(2===s)break}}i?i.push(t):(i=[e,t],this.tagCouples.push(i)),n?n.push(e):(n=[t,e],this.tagCouples.push(n));const s=this.collidersByTag[e],r=this.collidersByTag[t];if(s&&r){if(s.rects)for(let t=0;t<s.rects.length;t++)this.updateCheckMapOnAdd(s.rects[t]._uid,s.rects[t],e,n);if(s.points)for(let t=0;t<s.points.length;t++)this.updateCheckMapOnAdd(s.points[t]._uid,s.points[t],e,n);if(s.circles)for(let t=0;t<s.circles.length;t++)this.updateCheckMapOnAdd(s.circles[t]._uid,s.circles[t],e,n);if(s.polygons)for(let t=0;t<s.polygons.length;t++){const i=s.polygons[t],r=[];if(this.updateCheckMapOnPolygonAdd(i._uid,i,e,n,r),r.length)for(let e=0;e<i.lines.length;e++){const t=i.lines[e].uid;for(let e=0;e<r.length;e++)this.checkedMap[t][r[e]]=1,this.checkedMap[r[e]][t]=1}}if(s.lines)for(let t=0;t<s.lines.length;t++)s.lines[t].parent||this.updateCheckMapOnAdd(s.circles[t]._uid,s.rects[t],e)}return!0}collidersShareInitializedCouple(e,t,i){for(let n=0;n<e.tags.length;n++){const s=e.tags[n];let r=i[s];if(r||(r=this.getTagCoupleArrayForTag(s),i[s]=r),1!==r)for(let e=1;e<r.length;e++)for(let i=0;i<t.tags.length;i++)if(r[e]===t.tags[i])return!0}for(let n=0;n<t.tags.length;n++){const s=t.tags[n];let r=i[s];if(r||(r=this.getTagCoupleArrayForTag(s),i[s]=r),1!==r)for(let t=1;t<r.length;t++)for(let i=0;i<e.tags.length;i++)if(r[t]===e.tags[i])return!0}}onRemovedColliderCouple(e,t){let i=-1,n=-1;for(let s=0;s<this.tagCouples.length;s++)if(this.tagCouples[s][0]===e){i=s;for(let e=1;e<this.tagCouples[s].length;e++)this.tagCouples[s][e]===t&&(n=e);break}i>-1&&n>-1&&(this.tagCouples[i].splice(n,1),1===this.tagCouples[i].length&&this.tagCouples.splice(i,1));let s=-1,r=-1;for(let i=0;i<this.tagCouples.length;i++)if(this.tagCouples[i][0]===t){s=i;for(let t=1;t<this.tagCouples[i].length;t++)this.tagCouples[i][t]===e&&(r=t);break}s>-1&&r>-1&&(this.tagCouples[s].splice(r,1),1===this.tagCouples[s].length&&this.tagCouples.splice(s,1));const o={};this.forEachColliderWithTag(e,e=>{this.forEachColliderWithTag(t,t=>{t!==e&&(this.collidersShareInitializedCouple(e,t,o)||(delete this.checkedMap[e._uid][t._uid],delete this.checkedMap[t._uid][e._uid]))})})}onAddedStaticCollider(e){if(e._uid=this.uidIdx++,this.staticColliders.push(e),e.tags)if(this.addColliderToType(e,e.tags,o[e.shapeType]),this._onAddedColliderWithTags(e),e.isPolygon){e.lines.forEach(e=>{this.onAddedStaticCollider(e)}),delete e._cached_uids;const t=this.getBucketsLookup[e.shapeType](e.shapeData);t.length>8&&(e._bcache=t);for(let i=0;i<t.length;i++)this.staticBuckets[t[i]]?this.staticBuckets[t[i]].push(e):this.staticBuckets[t[i]]=[e]}else{const t=this.getBucketsLookup[e.shapeType](e.shapeData);for(let i=0;i<t.length;i++)this.staticBuckets[t[i]]?this.staticBuckets[t[i]].push(e):this.staticBuckets[t[i]]=[e]}}onAddedDynamicCollider(e){e._uid=this.uidIdx++,this.dynamicColliders.push(e),e.tags&&(this.addColliderToType(e,e.tags,o[e.shapeType]),this._onAddedColliderWithTags(e)),e.shapeType===n.RuntimeColliderShape.POLYGON&&(e.lines.forEach(e=>{this.onAddedDynamicCollider(e)}),delete e._cached_uids)}_onAddedColliderWithTags(e){performance.now();const t=e._uid;if(this.checkedMap[t]={},e.parent)for(let i=0;i<e.parent._cached_uids.length;i++){const n=e.parent._cached_uids[i];this.checkedMap[t][n]=1,this.checkedMap[n][t]=1}else e.isPolygon?(e._cached_uids=[],e.tags.forEach(i=>{this.updateCheckMapOnPolygonAdd(t,e,i,e._cached_uids)})):e.tags.forEach(i=>{this.updateCheckMapOnAdd(t,e,i)})}onRemovedDynamicCollider(e){for(let t=0;t<this.dynamicColliders.length;t++)if(this.dynamicColliders[t]===e){this.dynamicColliders.splice(t,1);break}e.tags&&(this.removeColliderFromType(e,e.tags,o[e.shapeType]),e.parent||this._onRemovedColliderWithTags(e))}_onRemovedColliderWithTags(e){if(e.isPolygon){for(let t=0;t<e.lines.length;t++)delete this.checkedMap[e.lines[t]];Object.keys(this.checkedMap[e._uid]).forEach(t=>{for(let i=0;i<e.lines.length;i++)delete this.checkedMap[t][e.lines[i]._uid];delete this.checkedMap[t][e._uid]})}else Object.keys(this.checkedMap[e._uid]).forEach(t=>{delete this.checkedMap[t][e._uid]});delete this.checkedMap[e._uid]}handleAddedTagToPolygon(e,t){const i=[];if(this.updateCheckMapOnPolygonAdd(e._uid,e,t,i),this.collidersByTag[t].lines?this.collidersByTag[t].lines.push(...e.lines):this.collidersByTag[t].lines=[...e.lines],i.length)for(let t=0;t<e.lines.length;t++)for(let n=0;n<i.length;n++)this.checkedMap[e.lines[t]._uid][i[n]]=1,this.checkedMap[i[n]][e.lines[t]._uid]=1}forEachColliderWithTag(e,t){if(!this.collidersByTag[e])return;const i=this.collidersByTag[e];if(i.rects)for(let e=0;e<i.rects.length;e++)t(i.rects[e]);if(i.polygons)for(let e=0;e<i.polygons.length;e++)t(i.polygons[e]);if(i.lines)for(let e=0;e<i.lines.length;e++)t(i.lines[e]);if(i.circles)for(let e=0;e<i.circles.length;e++)t(i.circles[e]);if(i.points)for(let e=0;e<i.points.length;e++)t(i.points[e])}updateCheckMapOnPolygonRemove(e,t,i){const n=e=>{if(t.tags)for(let i=0;i<t.tags.length;i++)for(let n=0;n<e.tags.length;n++)if(t.tags[i]===e.tags[n])return!0;return!1};if(this.collidersByTag[i]){const s=this.collidersByTag[i];if(s.rects)for(let i=0;i<s.rects.length;i++){const r=s.rects[i];n(r)||(delete this.checkedMap[e][r._uid],delete this.checkedMap[r._uid][e],t.lines.forEach(e=>{delete this.checkedMap[e._uid][r._uid],delete this.checkedMap[r._uid][e._uid]}))}if(s.polygons)for(let i=0;i<s.polygons.length;i++){const r=s.polygons[i];n(r)||(delete this.checkedMap[e][r._uid],delete this.checkedMap[r._uid][e],t.lines.forEach(e=>{delete this.checkedMap[e._uid][r._uid],delete this.checkedMap[r._uid][e._uid]}),r.lines.forEach(i=>{delete this.checkedMap[e][i._uid],delete this.checkedMap[i._uid][e],t.lines.forEach(e=>{delete this.checkedMap[i._uid][e._uid],delete this.checkedMap[e._uid][i._uid]})}))}if(s.circles)for(let i=0;i<s.circles.length;i++){const r=s.circles[i];n(r)||(delete this.checkedMap[e][r._uid],delete this.checkedMap[r._uid][e],t.lines.forEach(e=>{delete this.checkedMap[e._uid][r._uid],delete this.checkedMap[r._uid][e._uid]}))}if(s.lines)for(let i=0;i<s.lines.length;i++){const r=s.lines[i];n(r)||(delete this.checkedMap[e][r._uid],delete this.checkedMap[r._uid][e],t.lines.forEach(e=>{delete this.checkedMap[e._uid][r._uid],delete this.checkedMap[r._uid][e._uid]}))}if(s.points)for(let i=0;i<s.points.length;i++){const r=s.points[i];n(r)||(delete this.checkedMap[e][r._uid],delete this.checkedMap[r._uid][e],t.lines.forEach(e=>{delete this.checkedMap[e._uid][r._uid],delete this.checkedMap[r._uid][e._uid]}))}}}updateCheckMapOnRemove(e,t,i){const n=e=>{if(t.tags)for(let i=0;i<t.tags.length;i++)for(let n=0;n<e.tags.length;n++)if(t.tags[i]===e.tags[n])return!0;return!1};if(this.collidersByTag[i]){const t=this.collidersByTag[i];if(t.rects)for(let i=0;i<t.rects.length;i++){const s=t.rects[i];n(s)||(delete this.checkedMap[e][s._uid],delete this.checkedMap[s._uid][e])}if(t.polygons)for(let i=0;i<t.polygons.length;i++){const s=t.polygons[i];n(s)||(delete this.checkedMap[e][s._uid],delete this.checkedMap[s._uid][e],s.lines.forEach(t=>{delete this.checkedMap[e][t._uid],delete this.checkedMap[t._uid][e]}))}if(t.circles)for(let i=0;i<t.circles.length;i++){const s=t.circles[i];n(s)||(delete this.checkedMap[e][s._uid],delete this.checkedMap[s._uid][e])}if(t.lines)for(let i=0;i<t.lines.length;i++){const s=t.lines[i];n(s)||(delete this.checkedMap[e][s._uid],delete this.checkedMap[s._uid][e])}if(t.points)for(let i=0;i<t.points.length;i++){const s=t.points[i];n(s)||(delete this.checkedMap[e][s._uid],delete this.checkedMap[s._uid][e])}}}updateCheckMapOnPolygonAdd(e,t,i,n,s){if(1!=(s=s||this.getTagCoupleArrayForTag(i)))for(let i=1;i<s.length;i++){const r=this.collidersByTag[s[i]];if(r){if(r.rects)for(let t=0;t<r.rects.length;t++){const i=r.rects[t];this.checkedMap[e][i._uid]||(n.push(i._uid),this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1)}if(r.points)for(let t=0;t<r.points.length;t++){const i=r.points[t];this.checkedMap[e][i._uid]||(n.push(i._uid),this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1)}if(r.polygons)for(let t=0;t<r.polygons.length;t++){const i=r.polygons[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(n.push(i._uid),this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}if(r.circles)for(let t=0;t<r.circles.length;t++){const i=r.circles[t];this.checkedMap[e][i._uid]||(n.push(i._uid),this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1)}if(r.lines)for(let i=0;i<r.lines.length;i++){const s=r.lines[i];s.parent&&s.parent===t||this.checkedMap[e][s._uid]||(n.push(s._uid),this.checkedMap[e][s._uid]=1,this.checkedMap[s._uid][e]=1)}}}}updateCheckMapOnAdd(e,t,i,n){if(1!==(n=n||this.getTagCoupleArrayForTag(i)))for(let i=1;i<n.length;i++){const s=this.collidersByTag[n[i]];if(s){if(s.rects)for(let t=0;t<s.rects.length;t++){const i=s.rects[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}if(s.points)for(let t=0;t<s.points.length;t++){const i=s.points[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}if(s.polygons)for(let t=0;t<s.polygons.length;t++){const i=s.polygons[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}if(s.circles)for(let t=0;t<s.circles.length;t++){const i=s.circles[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}if(s.lines)if(t.parent)for(let i=0;i<s.lines.length;i++){const n=s.lines[i];e===n._uid||n.parent&&t.parent===n.parent||t.parent===n.parent||this.checkedMap[e][n._uid]||(this.checkedMap[e][n._uid]=1,this.checkedMap[n._uid][e]=1)}else for(let t=0;t<s.lines.length;t++){const i=s.lines[t];e!==i._uid&&(this.checkedMap[e][i._uid]||(this.checkedMap[e][i._uid]=1,this.checkedMap[i._uid][e]=1))}}}}onRemovedStaticCollider(e){for(let t=0;t<this.staticColliders.length;t++)if(this.staticColliders[t]===e){this.staticColliders.splice(t,1);break}e.tags&&(e.parent||this._onRemovedColliderWithTags(e),this.removeColliderFromType(e,e.tags,o[e.shapeType]),this.removeStaticColliderFromBucket(e))}removeStaticColliderFromBucket(e){const t=e._bcache?e._bcache:this.getBucketsLookup[e.shapeType](e.shapeData);for(let i=0;i<t.length;i++)for(let n=0;n<this.staticBuckets[t[i]].length;n++){const s=t[i];if(this.staticBuckets[s][n]===e){this.staticBuckets[s].splice(n,1),this.staticBuckets[s].length||delete this.staticBuckets[s];break}}}addColliderToType(e,t,i){for(let n=0;n<t.length;n++){const s=t[n];this.collidersByTag[s]||(this.collidersByTag[s]={}),this.collidersByTag[s][i]||(this.collidersByTag[s][i]=[]),this.collidersByTag[s][i].push(e)}}removeColliderFromType(e,t,i){for(let n=0;n<t.length;n++){const s=t[n],r=this.collidersByTag[s][i];for(let t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1),r.length||delete this.collidersByTag[s][i],Object.keys(this.collidersByTag[s]).length||delete this.collidersByTag[s];break}}if(e.isPolygon)for(let i=0;i<e.lines.length;i++)this.removeColliderFromType(e.lines[i],t,"lines")}getActiveBuckets(){const e={};for(let t=0;t<this.dynamicColliders.length;t++){const i=this.dynamicColliders[t];if(!i.tags)continue;const s=this.getBucketsLookup[i.shapeType](i.shapeData);i.shapeType,n.RuntimeColliderShape.LINE,this.iteration;for(let t=0;t<s.length;t++)e[s[t]]?e[s[t]].push(i):this.staticBuckets[s[t]]?e[s[t]]=[...this.staticBuckets[s[t]],i]:e[s[t]]=[i]}return e}getCollisions(e){this.curSeq++,this.iteration++,performance.now();const t=this.getActiveBuckets();performance.now(),this.iteration;const i=[];for(let e in t){const n=t[e];for(let e=0;e<n.length;e++){let t=n[e]._uid;for(let s=n.length-1;s>0&&s!==e;s--){let r=n[s]._uid;const o=this.checkedMap[t][r];o&&o!==this.curSeq&&(this.checkedMap[t][r]=this.curSeq,this.checkedMap[r][t]=this.curSeq,this.resolveCollision(n[e],n[s])&&(i.push(n[e]),i.push(n[s])))}}}return this.curSeq>6e4&&(this.curSeq=1),i}resolveCollision(e,t){const i=e.shapeData,s=t.shapeData;if(e.shapeType===n.RuntimeColliderShape.RECT){if(t.shapeType===n.RuntimeColliderShape.RECT)return i.x+i.w>=s.x&&i.x<=s.x+s.w&&i.y+i.h>=s.y&&i.y<=s.y+s.h;if(t.shapeType===n.RuntimeColliderShape.CIRCLE)return this.resolveRectCircle(i,s);if(t.shapeType===n.RuntimeColliderShape.POLYGON)return this.resolveRectPolygon(i,s);if(t.shapeType===n.RuntimeColliderShape.POINT)return s.x>=i.x&&s.x<=i.x+i.w&&s.y>=i.y&&s.y<=i.y+i.h;if(t.shapeType===n.RuntimeColliderShape.LINE)return this.resolveLineRect(s[0].x,s[1].x,s[0].y,s[1].y,i.x,i.y,i.w,i.h)}else if(e.shapeType===n.RuntimeColliderShape.CIRCLE){if(t.shapeType===n.RuntimeColliderShape.RECT)return this.resolveRectCircle(s,i);if(t.shapeType===n.RuntimeColliderShape.CIRCLE)return Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))<i.r+s.r;if(t.shapeType===n.RuntimeColliderShape.POLYGON)return this.resolvePolygonCircle(s,i);if(t.shapeType===n.RuntimeColliderShape.POINT)return Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2))<=i.r;if(t.shapeType===n.RuntimeColliderShape.LINE)return this.resolveLineCircle(s[0].x,s[1].x,s[0].y,s[1].y,i.x,i.y,i.r)}else if(e.shapeType===n.RuntimeColliderShape.POLYGON){if(t.shapeType===n.RuntimeColliderShape.RECT)return this.resolveRectPolygon(s,i);if(t.shapeType===n.RuntimeColliderShape.CIRCLE)return this.resolvePolygonCircle(i,s);if(t.shapeType===n.RuntimeColliderShape.POLYGON)return this.resolvePolygonPolygon(i,s);if(t.shapeType===n.RuntimeColliderShape.POINT)return this.resolvePolygonPoint(i,s);if(t.shapeType===n.RuntimeColliderShape.LINE)return this.resolveLinePoly(s[0].x,s[0].y,s[1].x,s[1].y,i)}else if(e.shapeType===n.RuntimeColliderShape.POINT){if(t.shapeType===n.RuntimeColliderShape.RECT)return i.x>=s.x&&i.x<=s.x+s.w&&i.y>=s.y&&i.y<=s.y+s.h;if(t.shapeType===n.RuntimeColliderShape.CIRCLE)return Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))<=s.r;if(t.shapeType===n.RuntimeColliderShape.POLYGON)return this.resolvePolygonPoint(s,i);if(t.shapeType===n.RuntimeColliderShape.POINT)return i.x===s.x&&i.y===s.y;if(t.shapeType===n.RuntimeColliderShape.LINE)return this.resolvePointLine(i.x,i.y,s[0].x,s[0].y,s[1].x,s[1])}else if(e.shapeType===n.RuntimeColliderShape.LINE){if(t.shapeType===n.RuntimeColliderShape.RECT)return this.resolveLineRect(i[0].x,i[1].x,i[0].y,i[1].y,s.x,s.y,s.w,s.h);if(t.shapeType===n.RuntimeColliderShape.CIRCLE)return this.resolveLineCircle(i[0].x,i[1].x,i[0].y,i[1].y,s.x,s.y,s.r);if(t.shapeType===n.RuntimeColliderShape.POLYGON)return this.resolveLinePoly(i[0].x,i[0].y,i[1].x,i[1].y,s);if(t.shapeType===n.RuntimeColliderShape.POINT)return this.resolvePointLine(s.x,s.y,i[0].x,i[0].y,i[1].x,i[1]);if(t.shapeType===n.RuntimeColliderShape.LINE)return this.resolveLineLine(i[0].x,i[0].y,i[1].x,i[1].y,s[0].x,s[0].y,s[1].x,s[1].y)}return!1}getEllipseFromScaledCircle(e,t,i,n,s){}getPolygonFromRotatedRect(e,t,i){return[]}resolveLineLineIntersectOnly(e,t,i,n,s,r,o,a){const h=((o-s)*(t-r)-(a-r)*(e-s))/((a-r)*(i-e)-(o-s)*(n-t)),l=((i-e)*(t-r)-(n-t)*(e-s))/((a-r)*(i-e)-(o-s)*(n-t));return h>=0&&h<=1&&l>=0&&l<=1}resolveLineLine(e,t,i,n,s,r,o,a,h=!1){const l=(a-r)*(i-e)-(o-s)*(n-t);if(0!=l){const h=((o-s)*(t-r)-(a-r)*(e-s))/l,d=((i-e)*(t-r)-(n-t)*(e-s))/l;return 0<=h&&h<=1&&0<=d&&d<=1}return!(Math.max(e,i)<Math.min(s,o))&&!(Math.max(s,o)<Math.min(e,i))&&!(Math.max(t,n)<Math.min(r,a))&&!(Math.max(r,a)<Math.min(t,n))&&(this.resolvePointLine(e,t,s,r,o,a,1)||this.resolvePointLine(i,n,s,r,o,a,1))}resolveLineRect(e,t,i,n,s,r,o,a){return!!this.resolveLineLine(e,i,t,n,s,r,s,r+a)||!!this.resolveLineLine(e,i,t,n,s+o,r,s+o,r+a)||!!this.resolveLineLine(e,i,t,n,s,r,s+o,r)||!!this.resolveLineLine(e,i,t,n,s,r+a,s+o,r+a)||void 0}resolvePointPoly(e,t,i){let n=!1,s=0;for(let r=0;r<i.length;r++){(s=r+1)===i.length&&(s=0);let o=i[r],a=i[s];(o.y>=t&&a.y<t||o.y<t&&a.y>=t)&&e<(a.x-o.x)*(t-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}resolveRectPolygon(e,t){for(let i=0;i<t.length;i++)if(this.resolvePointPoly(e.x,e.y,t))return!0}resolveRectCircle(e,t){const{x:i,y:n,w:s,h:r}=e,o=t.x,a=t.y;let h=o,l=a;return o<i?h=i:o>i+s&&(h=i+s),a<n?l=n:a>n+r&&(l=n+r),Math.sqrt(Math.pow(o-h,2)+Math.pow(a-l,2))<=t.r}resolveLineCircle(e,t,i,n,s,r,o){if(Math.sqrt(Math.pow(e-s,2)+Math.pow(i-r,2))<o)return!0;if(Math.sqrt(Math.pow(t-s,2)+Math.pow(n-r,2))<o)return!0;let a=e-t,h=i-n;const l=Math.sqrt(a*a+h*h),d=((s-e)*(t-e)+(r-i)*(n-i))/Math.pow(l,2),c=e+d*(t-e),u=i+d*(n-i);return!!this.resolvePointLine(c,u,e,i,t,n)&&(a=c-s,h=u-r,Math.sqrt(a*a+h*h)<=o)}resolvePolygonCircle(e,t){return this.resolvePolygonPoint(e,t)}resolvePolygonPoint(e,t){let i=!1,n=0;for(let s=0;s<e.length;s++){(n=s+1)===e.length&&(n=0);let r=e[s],o=e[n];(r.y>=t.y&&o.y<t.y||r.y<t.y&&o.y>=t.y)&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}resolveLinePoly(e,t,i,n,s){let r=0;for(let o=0;o<s.length;o++){(r=o+1)===s.length&&(r=0);const a=s[o].x,h=s[o].y,l=s[r].x,d=s[r].y;if(this.resolveLineLine(e,t,i,n,a,h,l,d))return!0}return!1}resolveCircleEllipse(e,t){}resolvePolygonPolygon(e,t){for(let i=0;i<e.length;i++){if(this.resolvePolygonPoint(e,t[0]))return!0;if(this.resolvePolygonPoint(t,e[0]))return!0}return!1}getBucketsForPolygon(e,t=[]){for(let t=0;t<e.length;t++);for(let i=0;i<e.length;i++){const n=e[i],s=i===e.length-1?e[0]:e[i+1],r=[];this.getBucketsForLine([n,s],r),this.getBucketsForLine([n,s],t)}return t}getBucketsForCircle(e,t=[]){const i=2*e.r;return this.getBucketsForRect({x:e.x-e.r,y:e.y-e.r,w:i,h:i},t)}getBucketsForRect(e,t=[]){const i=this.cellSize;let n=e.x,s=e.y;if(e.w>=i||e.h>=i){const r=Math.floor(n/i),o=Math.floor(s/i),a=Math.ceil((n+e.w)/i),h=Math.ceil((s+e.h)/i);for(let e=r;e<a;e++)for(let i=o;i<h;i++){const n=e,s=i*this.cols+n;t.includes(s)||t.push(s)}}else{let r=n+e.w,o=s+e.h;if(!(n/i>=this.cols||s/i>=this.rows||n<0||n<0)){let e=Math.floor(n/i)+Math.floor(s/i)*this.cols;t.includes(e)||t.push(e)}if(!(n/i>=this.cols||o/i>=this.rows||n<0||o<0)){let e=Math.floor(n/i)+Math.floor(o/i)*this.cols;t.includes(e)||t.push(e)}if(!(r/i>=this.cols||s/i>=this.rows||r<0||s<0)){let e=Math.floor(r/i)+Math.floor(s/i)*this.cols;t.includes(e)||t.push(e)}if(!(r/i>=this.cols||o/i>=this.rows||r<0||o<0)){let e=Math.floor(r/i)+Math.floor(o/i)*this.cols;t.includes(e)||t.push(e)}}return t}getBucketsForSmallRect(e,t,i,n,s=[]){const r=this.cellSize;if(!(e/r>=this.cols||t/r>=this.rows||e<0||e<0)){let i=Math.floor(e/r)+Math.floor(t/r)*this.cols;s.includes(i)||s.push(i)}if(!(e/r>=this.cols||n/r>=this.rows||e<0||n<0)){let t=Math.floor(e/r)+Math.floor(n/r)*this.cols;s.includes(t)||s.push(t)}if(!(i/r>=this.cols||t/r>=this.rows||i<0||t<0)){let e=Math.floor(i/r)+Math.floor(t/r)*this.cols;s.includes(e)||s.push(e)}if(!(i/r>=this.cols||n/r>=this.rows||i<0||n<0)){let e=Math.floor(i/r)+Math.floor(n/r)*this.cols;s.includes(e)||s.push(e)}}getBucketsForPoint(e,t=[]){const{x:i,y:n}=e;if(!(i/this.cellSize>=this.cols||n/this.cellSize>=this.rows||i<0||n<0)){let e=Math.floor(i/this.cellSize)+Math.floor(n/this.cellSize)*this.cols;t.includes(e)||t.push(e)}return t}getBucketsForLine(e,t=[]){const i=e[0],n=e[1];if(i.x===n.x||i.y===n.y)return this.getBucketsForRect({x:Math.min(i.x,n.x),y:Math.min(i.y,n.y),w:Math.max(1,Math.abs(i.x-n.x)),h:Math.max(1,Math.abs(i.y-n.y))},t);n.y,i.y,n.x,n.x;const s=n.y-i.y/n.x-i.x,r=i.y-i.x*s;let o=0;const a=i.x>n.x?-1:1,h=i.y>n.y?-1:1;let l=i.x,d=i.y,c=0;const u=[l,d,n.x,n.y];let p=!1;const f=(i.x+a)*s+r;Math.abs(f-i.y)<=1?(c=Math.abs(i.x-n.x),p=!0):c=Math.abs(i.y-n.y);let m=!0;for(;m;)p?(o+=a,d=(l+=a)*s+r):(o+=h,l=((d+=h)-r)/s),l>=0&&d>=0&&(u.push(l),u.push(d)),Math.abs(o)>=c&&(m=!1);for(let e=0;e<u.length;e+=2){const i=Math.floor(u[e]/this.cellSize)+Math.floor(u[e+1]/this.cellSize)*this.cols;t.includes(i)||t.push(i)}return t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCollidersWithTags=function(e,t){const i=[];if(1===e.length)return t[e[0]]||[];let n;for(let i=0;i<e.length;i++){const s=e[i];t[s]&&(!n||t[s].length<n.length)&&(n=t[s])}return n?(n.forEach(t=>{let n=!0;for(let i=0;i<e.length;i++){const s=e[i];if(!t.tags.includes(s)){n=!1;break}}n&&i.push(t)}),i):[]}},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.CHILD=1]="CHILD",e[e.FULL=2]="FULL"}(n=t.LayoutSetting||(t.LayoutSetting={})),t.ResolutionModes={};class s{constructor(e,t){var i;this._ratioCap=!1,this._viewCap=!1,this._sizeCap=!1,this._widthSizeCap=-1,this._heightSizeCap=-1,this.resolution=1,this.dynamicResolution=!1,this.calculate=this.calculate.bind(this),this.calculateWithTimeout=this.calculateWithTimeout.bind(this),this.camera=e,t=t||{},this._layoutMode=(null===(i=t)||void 0===i?void 0:i.layout)||n.FULL,window.addEventListener("resize",this.calculateWithTimeout,{passive:!0}),t.maxView&&(this._widthViewCap=t.maxView.w,this._heightViewCap=t.maxView.h,this._viewCap=!0),t.aspectRatio&&(this._widthRatioCap=t.aspectRatio.w,this._heightSizeCap=t.aspectRatio.h,this._ratioCap=!0),t.maxSize&&(this._widthSizeCap=t.maxSize.w,this._heightSizeCap=t.maxSize.h,this._sizeCap=!0),this.dynamicResolution=!!t.dynamicResolution&&t.dynamicResolution}setResolution(e){this.dynamicResolution&&(this.dynamicResolution=!1),this.resolution=e}unlimitResolution(e){this.dynamicResolution=!1}limitResolution(){this.dynamicResolution=!0}setMapLengths(e,t){this.mapWidth=e,this.mapHeight=t,this.calculate()}destroy(){window.removeEventListener("resize",this.calculateWithTimeout)}calculate(){var e,t,i,r,o,a,h,l;let d,c;this._layoutMode===n.FULL?(c=(null===(e=window)||void 0===e?void 0:e.innerWidth)||(null===(i=null===(t=document)||void 0===t?void 0:t.body)||void 0===i?void 0:i.clientWidth),d=(null===(r=window)||void 0===r?void 0:r.innerHeight)||(null===(a=null===(o=document)||void 0===o?void 0:o.body)||void 0===a?void 0:a.clientHeight)):this._layoutMode===n.CHILD?(c=(null===(h=this.camera.renderer.view.parentElement)||void 0===h?void 0:h.clientWidth)||this.camera.renderer.view.clientWidth,d=(null===(l=this.camera.renderer.view.parentElement)||void 0===l?void 0:l.clientHeight)||this.camera.renderer.view.clientHeight):(c=this.camera.renderer.view.width,d=this.camera.renderer.view.height);let u,p,f=0,m=0;if(this._sizeCap&&(this._widthSizeCap<c&&(f=c-this._widthSizeCap/2,c=this._widthSizeCap),this._heightSizeCap<d&&(m=d-this._heightSizeCap/2,d=this._heightSizeCap)),this._viewCap){if(u=this._widthViewCap,p=this._heightViewCap,this._ratioCap){const e=u/this._widthRatioCap,t=p/this._heightRatioHCap;e<t?p*=this._widthRatioCap/this._heightRatioHCap:t>e&&(u*=this._widthRatioCap/this._heightRatioHCap)}}else if(this._ratioCap){const e=c/this._widthRatioCap,t=d/this._heightRatioHCap;e<t?(u=c,p=d*(this._widthRatioCap/this._heightRatioHCap)):t>e&&(p=d,u=c*(this._widthRatioCap/this._heightRatioHCap))}else u=c,p=d;const g=s.calculateDynamicResolution(c,d,this.mapWidth,this.mapHeight,u,p);this.dynamicResolution?this.resolution=g.resolution:(g.resolution=this.resolution,g.fixedResolution=!0),f&&(g.offsetWidth+=f),m&&(g.offsetHeight+=m),this.camera.onResolutionUpdate(g)}calculateWithTimeout(){this.calculateTimeout&&clearTimeout(this.calculateTimeout),this.calculateTimeout=setTimeout(this.calculate,50)}static calculateDynamicResolution(e,t,i,n,s,r){const o=e/s,a=t/r;let h,l,d=a,c=0,u=0,p=!1,f=!1;o<a?(d=o,h=e>s?s:e,t>r?((u=(t-r)/2)%1&&(p=!0,u=Math.floor(u)),l=r):l=t-2*u,d<1&&(u+=u*d,l*=d)):a<o?(d=a,l=t>r?r:t,e>s?((c=Math.floor(e-s)/2)%1&&(f=!0,c=Math.floor(c)),h=s):l=e,d<1&&(c+=c*d,h*=d)):(l=Math.min(r,t),h=Math.min(s,e));const m=h+2*c,g=h+2*c;return m>i&&(c+=(f?Math.ceil:Math.floor)((m-i)/2)),g>n&&(u+=(p?Math.ceil:Math.floor)((g-n)/2)),{resolution:d,viewHeight:l,viewWidth:h,offsetWidth:c,offsetHeight:u,canvasWidth:e,canvasHeight:t}}}t.ResolutionManager=s},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(9),r=i(1);t.InterfaceManager=class{constructor(e,t,i){this.needsReRender=!1,this.indexedDbLoader=i,this.interfaceAtlas=s.AtlasFactory(t,i),this.renderer=t,this.interfaceStage=e}clearInterface(){this.interfaceStage.removeChildren(0)}loadTexture(e,t){return n(this,void 0,void 0,(function*(){let i;if(t=t||e,this.indexedDbLoader)try{if(!(i=yield this.indexedDbLoader.loadImageData(e)))throw new Error("couldnt get image from indexeddb.")}catch(t){i=yield r.httpGetAsync(e,!1)}else i=yield r.httpGetAsync(e,!1);if(!i)throw new Error(`Failed to load interface image from path ${e}`);const n=yield r.getTextureFromDataUrl(i);return this.interfaceAtlas.addTexture(t,n,null,!0)}))}addTextureToInterfaceAtlas(e,t,i=!0){return this.interfaceAtlas.addTexture(e,t,null,i)}getTexture(e){return this.interfaceAtlas.getTexture(e)}addInterfaceItem(e){this.interfaceStage.addChild(e)}removeInterfaceItem(e){this.interfaceStage.removeChild(e)}addChild(e){this.interfaceStage.addChild(e)}removeChild(e){this.interfaceStage.removeChild(e)}}}]).default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=0,s=1,r=2,o=3,a=4;t.default=()=>{let e,t,i,h=16711680,l=65280;const d={rect:{collide:h,noCollide:l},polygon:{collide:h,noCollide:l},circle:{collide:h,noCollide:l},point:{collide:h,noCollide:l},line:{collide:h,noCollide:l}},c="__debug_plugin_tagless",u="__debug_plugin_game_object",p=[];let f,m,g,y=!1;const v={},C=e=>{if(!e[u])throw console.error("collider without debug graphic:",e),new Error("Should have had plugin debug graphic value on collider");return e[u]},S=e=>{const t=C(e);t.visible=!y&&(e=>{if(!e.tags||!e.tags.length)return T[c]&&T[c].toggled;for(let t=0;t<e.tags.length;t++){const i=T[e.tags[t]];if(!i)throw new Error(`shoudl have found the lookup for tag ${e.tags[t]}`);if(i.toggled)return!0}return!1})(e)},w=t=>{const{shapeType:i,shapeData:h,tags:l}=t;let c=null;if(l&&l.length){const e=l.find(e=>e in g);null!=e&&(c=g[e])}let u="";if(null===c){let e=999999999,l=999999999;switch(i){case n:u=`r${h.w}_${h.h}`,c=d.rect;break;case s:h.forEach(t=>{e=Math.min(t.x,e),l=Math.min(t.y,l)});const i=h.map(t=>new PIXI.Point(t.x-e,t.y-l));u=`pol${i.map(e=>`${e.x}_${e.y}`).join("_")}`,c=d.polygon;break;case r:u="p",c=d.point;break;case o:u=`c${t.shapeData.r}`,c=d.circle;break;case a:h.forEach(t=>{e=Math.min(t.x,e),l=Math.min(t.y,l)}),u=`l${t.shapeData.map(t=>`${t.x-e}_${t.y-l}`).join("_")}`,c=d.line;break;default:throw new Error("Collider had invalid shapeType on it.")}}const p=(i,h)=>{let l=`${u}_${c[i]}`;if(l in v)h[i]=v[l];else{const d=((e,t)=>{const i=new PIXI.Graphics;i.beginFill(t,1);let h=999999999,l=999999999;const{shapeType:d,shapeData:c}=e;switch(d){case a:i.lineStyle(2,t),c.forEach(e=>{h=Math.min(e.x,h),l=Math.min(e.y,l)});const e=c.map(e=>new PIXI.Point(e.x-h,e.y-l));i.moveTo(e[0].x,e[0].y),i.lineTo(e[1].x,e[1].y);break;case n:i.drawRect(0,0,c.w,c.h);break;case s:c.forEach(e=>{h=Math.min(e.x,h),l=Math.min(e.y,l)});const d=c.map(e=>new PIXI.Point(e.x-h,e.y-l));d.push(d[0]),i.drawPolygon(d);break;case r:i.drawCircle(f,f,f);break;case o:i.drawCircle(c.r,c.r,c.r);break;default:throw new Error("Collider had invalid shapeType on it.")}return i})(t,c[i]);h[i]=PIXI.RenderTexture.create(d.width,d.height),e.renderer.render(d,h[i]),v[l]=h[i]}},m={};return p("collide",m),p("noCollide",m),m},b=(e,t)=>{e[t]?isNaN(e[t])?("collide"in e[t]&&(d[t].collide=e[t].collide),"noCollide"in e[t]&&(d[t].noCollide=e[t].noCollide)):(d[t].collide=h,d[t].noCollide=e[t]):(d[t].collide=h,d[t].noCollide=l)},T=(new PIXI.Graphics,{}),_=[],x=e=>`debug-panel-tag-${e}`;let E=null;const A=e=>document.getElementById(x(e)),k=e=>{for(let t=0;t<e.length;t++)_.includes(e[t])||_.push(e[t]);E&&(clearTimeout(E),E=null);const t=Object.keys(T).sort((e,t)=>`${e}`.localeCompare(`${t}`));_.forEach(e=>{if(e in T){const n=A(e),s=(e=>{const t=e===c?"not tagged":e,{colliders:i,colliderColor:n,toggled:s}=T[e],r=document.createElement("DIV");r.innerText=t,r.style.display="flex",r.style.flexDirection="row",r.className="debug-panel-tag",r.id=x(e);const o=document.createElement("INPUT");o.setAttribute("type","checkbox"),o.checked=s,o.addEventListener("change",t=>{T[e].toggled=t.target.checked,y||T[e].colliders.forEach(e=>{S(e)})});const a=document.createElement("DIV");return a.innerText=`(${i.length})`,r.appendChild(o),r.appendChild(a),r})(e);if(n)n.insertAdjacentElement("afterEnd",s),n.parentElement.removeChild(n);else{const n=e===c?0:t.indexOf(e);i.insertBefore(s,i.children[n])}}else{const t=A(e);if(!t)throw new Error(`Should have found panel object for removing tag ${e}`);t.parentElement.removeChild(t)}}),_.length=0,E=null},P=(e,i,n)=>{(i=Array.isArray(i)?i:[i]).forEach(t=>{if(!T[t])throw new Error("Should have found tag lookup object.");const i=T[t].colliders.indexOf(e);if(i<0)throw new Error("Should have found collider.");T[t].colliders.splice(i,1),T[t].colliders.length||delete T[t]}),e.tags&&e.tags.length&&n&&(S(e),t&&k(i))},I=(e,i)=>{(i=Array.isArray(i)?i:[i]).forEach(t=>{T[t]||(T[t]={colliders:[],toggled:!0,color:g[t]}),T[t].colliders.push(e)}),S(e),t&&k(i)},M={collide:h,noCollide:l};return{type:"collision",name:"debug",init(n,s){e=n,"default"in(s=s||{panel:!0})&&(isNaN(s.default)?(h="collide"in s.default?s.default.collide:s.default,l="noCollide"in s.default?s.default.collide:s.default):l=s.default),M.noCollide=l,M.collide=h,f="pointRadius"in s?s.pointRadius:3,m="alpha"in s?s.alpha:.5,s.panel&&(e=>{var n,s;let r={css:{className:"",id:"collision-debug-panel"},panelWidth:"220px",panelHeight:"190px",corner:"bottom-right",useInline:!0};if(e="object"==typeof e?Object.assign(Object.assign({},r),e):r,"undefined"!=typeof document&&void 0!==document.body){(t=document.createElement("DIV")).style.zIndex=1e6,t.id=(null===(n=e.css)||void 0===n?void 0:n.id)||r.css.id,t.className=(null===(s=e.css)||void 0===s?void 0:s.className)||"";const o=document.createElement("DIV");o.id="collision-debug-panel--settings-wrapper",(i=document.createElement("DIV")).id="collision-debug-panel--tag-wrapper",t.appendChild(o),t.appendChild(i);const a=document.createElement("DIV");a.innerText="alpha:";const h=document.createElement("INPUT");h.className="collision-debug-panel--settings-option",h.setAttribute("type","number"),h.setAttribute("min",0),h.setAttribute("max",1),h.setAttribute("value",m),h.setAttribute("step",.1),h.addEventListener("input",e=>{m=e.target.value,p.forEach(e=>{C(e).alpha=m})});const l=document.createElement("DIV");l.innerText="hide all:";const d=document.createElement("INPUT");if(d.setAttribute("type","checkbox"),d.className="collision-debug-panel--settings-option",y=!1,d.checked=!1,d.addEventListener("change",e=>{y=e.target.checked,e.target.checked?p.forEach(e=>{C(e).visible=!1}):p.forEach(e=>{S(e)})}),o.appendChild(a),o.appendChild(h),o.appendChild(l),o.appendChild(d),e.useInline){const n="15px",s="15px";t.style.right=s,t.style.bottom=n,t.style.backgroundColor="rgba(128, 128, 128, .5)",t.style.borderRadius="5px",t.style.padding="10px",t.style.position="fixed",t.style.display="flex",t.style.flexDirection="column",t.style.minHeight=e.panelHeight,t.style.maxHeight=e.panelHeight,t.style.height=e.panelHeight,t.style.minWidth=e.panelWidth,t.style.maxWidth=e.panelWidth,t.style.width=e.panelWidth,o.style.display="flex",o.style.flexDirection="row",h.style.maxWidth="45px",h.style.marginRight="7px",i.style.display="flex",i.style.flexDirection="column",i.style.maxHeight=`${parseInt(e.panelHeight)-30}px`,i.style.minHeight=`${parseInt(e.panelHeight)-30}px`,i.style.height=`${parseInt(e.panelHeight)-30}px`,i.style.maxWidth="92%",i.style.minWidth="92%",i.style.width="92%",i.style.marginLeft="4%",i.style.marginTop="10px",i.style.overflow="auto"}document.body.prepend(t)}})(s.panel),b(s,"rect"),b(s,"polygon"),b(s,"circle"),b(s,"line"),b(s,"point"),g=s.tagColors?Object.assign({},s.tagColors):{},s.colorTags&&Object.keys(s.colorTags).forEach(e=>{s.colorTags[e].forEach(t=>{if(t in g)throw new Error(`Found multiple colors for tag ${t}`);g[t]=e})})},onAdded(t){if(p.includes(t))throw console.error(t),new Error("Trying to add collider twice.");t.debugid=Math.floor(100009*Math.random()),p.push(t);const{noCollide:i,collide:n}=w(t);let a;if(t.sprite)a=t.sprite.position;else{let e=9999999999,i=9999999999;Array.isArray(t.shapeData)?(t.shapeData.forEach(t=>{e=Math.min(t.x,e),i=Math.min(t.y,i)}),a={x:e,y:i}):a=Object.assign({},t.shapeData)}t.shapeType===o?(a.x=t.shapeData.x-t.shapeData.r,a.y=t.shapeData.y-t.shapeData.r):t.shapeType===r&&(a.x-=f,a.y-=f);const h=e.addGameObject({texture:i,position:a,layer:t.layer,zIndex:Number.MAX_SAFE_INTEGER});if(h.alpha=m,h.colliders)throw console.error(h,h.colliders),new Error("WHAT THE FUCFK");t[u]=h,t.tags&&t.tags.length?I(t,t.tags):I(t,c),S(t),t.onTagAdded(e=>{T[c]&&T[c].colliders.includes(t)&&P(t,c,!0),I(t,e)}),t.onTagRemoved(e=>{P(t,e),t.tags&&t.tags.length||I(_col,c)}),t.onCollisionStart(e=>{h.___collisions||(h.___collisions=0,h.texture=n),h.___collisions++}),t.onCollisionEnd(e=>{--h.___collisions||(h.texture=i,delete h.___collisions)}),t.dynamic&&(t.onPositionUpdate((e,t)=>{if(h.updatePosition(e,t),h.colliders)throw console.error(h),console.error(h.colliders),new Error("waht the fuck")}),t.onRotationUpdate((e,t)=>{h.updateRotation(e)})),t.shapeType===s&&(t.onLineCollisionStart((e,t)=>{h.___collisions||(h.___collisions=0,h.texture=n),h.___collisions++}),t.onLineCollisionEnd((e,t)=>{--h.___collisions||(h.texture=i,delete h.___collisions)}))},onRemoved(e){let t=!1;for(let i=0;i<p.length;i++)if(p[i]===e){p.splice(i,1),t=!0;break}if(!t)throw console.error("collider:",e),new Error("Collider was not tracked");e.tags?P(e,e.tags,!1):P(e,c,!0),e[u]&&(e[u].layerParent&&e[u].removeFromMap(),delete e[u])}}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Skeleton=t.SkeletonStateType=t.ColliderItemType=void 0;const s=i(38),r=i(21),o=i(39);!function(e){e[e.FREE_COLLIDER=0]="FREE_COLLIDER",e[e.BONE_COLLIDER=1]="BONE_COLLIDER",e[e.SLOT_BONE_COLLIDER=2]="SLOT_BONE_COLLIDER"}(t.ColliderItemType||(t.ColliderItemType={})),function(e){e[e.BASE_SETUP=0]="BASE_SETUP",e[e.ATTACHMENT_SETUP=1]="ATTACHMENT_SETUP",e[e.ATTACHMENT_SLOT_SETUP=2]="ATTACHMENT_SLOT_SETUP",e[e.PASSIVE_ANIMATION=3]="PASSIVE_ANIMATION",e[e.MAIN_ANIMATION=4]="MAIN_ANIMATION"}(t.SkeletonStateType||(t.SkeletonStateType={}));class a extends PIXI.Container{constructor(e,t,i,n){if(super(),this.nonSlotColliderLookup={},this.action="",this.childTracksImplicitlyPlayingCurrentAnimation=[],this.slotsByBone={},this.attachmentTracks=[],this.attachmentSlots={},this.attachments={},this.baseTrack=null,this.bones={},this.allActiveColliders={},this.colliderUpdates=[],this.allSlotColliderLookup={},this.activeSlotTextures={},o.TrackMixin.ApplyMixin(this),this.activeSlotTextures=i||{},this._direction=n||e.directions[0],this.skins={},this.bones={},this.data=e,this.atlasLoader=t,this.animationLookup=e.animations,this.baseTrack=new s.AnimationTrack(this,0,this.activeSlotTextures,this.bones,this.atlasLoader.slotIdToColliderLookup,this.animationLookup,this.data.setupData,!1),this.data.setupData){if(this.data.setupData.addedBoneIds)for(let e=0;e<this.data.setupData.addedBoneIds.length;e++){const t=this.data.setupData.addedBoneIds[e];this.bones[t]=new r.Bone(t,this),this.addChild(this.bones[t])}this.baseTrack.applySetupData(this.data.setupData,!0)}this.highestTrack=this.baseTrack,this.attachmentAnimationLookups=e.attachmentAnimations}clone(){return new a(this.data,this.atlasLoader,Object.assign({},this.activeSlotTextures))}getAllSlotCollidersWithTag(e){const t=[];for(let i in this.bones){const n=this.bones[i].slotColliderDatas;n&&t.push(...n.filter(t=>{var i;return null===(i=t.tags)||void 0===i?void 0:i.includes(e)}))}return t}getFirstSlotColliderWithTag(e){var t;for(let i in this.bones){const n=null===(t=this.bones[i].slotColliderDatas)||void 0===t?void 0:t.find(t=>{var i;return null===(i=t.tags)||void 0===i?void 0:i.includes(e)});if(n){const e=this.bones[i].applyTransformToCollider(n.shapeData);return Object.assign(Object.assign({},n),{shapeData:e})}}return null}stop(){this.baseTrack.stop(),this.data.setupData&&this.baseTrack.applySetupData(this.data.setupData,!0)}play(e,t,i){i=i||s.defaultPlayOptions,t&&t!==this._direction&&(this.direction=t),this.currentPlayOpts=i,this.action&&this.removeChildPassiveTracks(this.action),this.action=e,this.baseTrack.play(e,i),this.addNeededChildPassiveTracks(e,this.activeAttachmentTracks,i)}updateHighestTrack(){let e=this.baseTrack;this.activeAttachmentTracks&&this.activeAttachmentTracks.forEach(t=>{t.level>e.level&&(e=t)}),e!==this.highestTrack&&(this.highestTrack=e,e.applyLastBoneOrder())}update(e){if(this.colliderUpdates.length=0,this.baseTrack.update(e),this.activeAttachmentTracks)for(let t=0;t<this.activeAttachmentTracks.length;t++)this.activeAttachmentTracks[t].update(e);this.colliderUpdates.forEach(e=>{})}getCollider(e){return null}setSkin(e,t=!0){return n(this,void 0,void 0,(function*(){let i;i=e.skinTexture?this.atlasLoader.getSlotsForTexture(e.skinTexture,e.atlasName):e.skinUrl?yield this.atlasLoader.loadSkinSlotsByUrl(e.atlasName,e.skinUrl):yield this.atlasLoader.loadSkinSlots(e.atlasName,e.skinName),this.skins[e.atlasName]=e.skinName?e.skinName:e.skinUrl;for(let e in i)this.activeSlotTextures[e]=i[e];if(t)for(let e in this.bones)this.bones[e].determineNewTrackOverride()}))}setSkins(e){return n(this,void 0,void 0,(function*(){for(let t=0;t<e.length;t++){const i=e[t];i.atlasName&&(yield this.setSkin(i,!1))}for(let e in this.bones)this.bones[e].determineNewTrackOverride()}))}unmountAttachment(e){const t=this.attachmentSlots[e];if(!t)throw new Error(`Skeleton did not have any attachment in the slot: ${e} mounted.`);if(t!==this.attachments[t.attachment])throw new Error(`Found mis match of expected attachment slot: ${e} and attachment ${t.attachment}`);t.unmount(),t===this.highestTrack&&this.updateHighestTrack()}_removeAttachmentFromLookups(e,t){const i=this.attachmentSlots[e];if(!i)throw new Error(`Skeleton did not have any attachment in the slot: ${e} mounted.`);if(delete this.attachmentSlots[e],i!==this.attachments[t])throw new Error(`Found mis match of expected attachment slot: ${e} and attachment ${i.attachment}`);delete this.attachments[t];for(let e=0;e<this.activeAttachmentTracks.length;e++)if(this.activeAttachmentTracks[e]===i){this.activeAttachmentTracks.splice(e,1);break}i===this.highestTrack&&this.updateHighestTrack()}logBoneOrder(){console.error("child:",Array.from(this.children).map(e=>e.id))}mountAttachment(e,t,i,n){console.time(`mount ${e}`);const r=this.data.attachmentSlotData[e];if(!r)throw new Error(`No slot with the name ${e}`);const{level:o,attachmentData:a,parentAttachmentName:h}=r,l=a[t];if(!l)throw new Error(`Attachment: ${t} is not a valid attachment for the slot ${e}`);let d;if(h){if(!(d=this.attachments[h]))throw new Error(`Can not fill the attachment slot ${e} because it requires the attachment: ${h} be activated.`)}else d=this;const c=this.attachmentSlots[e];null==c||c.unmount(!0);const u=c||new s.AnimationTrack(this,o,this.activeSlotTextures,this.bones,this.atlasLoader.slotIdToColliderLookup);return u._updateAttachmentData(this.attachmentAnimationLookups[t],l,r),this.activeAttachmentTracks?(this.activeAttachmentTracks.push(u),u.level>this.highestTrack.level&&(this.highestTrack=u)):(this.activeAttachmentTracks=[u],this.highestTrack=u),this.attachments[t]=u,this.attachmentSlots[e]=u,u!==c&&u._mountToParent(d),i&&u.play(i,n),console.timeEnd(`mount ${e}`),this.action&&this.addNeededChildPassiveTracks(this.action,[u],this.currentPlayOpts),u}reapplyBoneSortSetups(e){const t=this.activeAttachmentTracks?[...this.activeAttachmentTracks]:[];[this.baseTrack,...t.sort((e,t)=>e.level-t.level)].forEach(t=>{var i,n,s,r,o,a,h,l;(null===(n=null===(i=t.setupData)||void 0===i?void 0:i.attachmentSlot)||void 0===n?void 0:n.boneOrder)&&t.applyBoneSort(t.setupData.attachmentSlot.boneOrder,Array.from(this.children));const d=null===(r=null===(s=t.setupData)||void 0===s?void 0:s.attachmentSlot)||void 0===r?void 0:r.frames;d&&d[e]&&d[e].boneOrder&&t.applyBoneSort(d[e].boneOrder,Array.from(this.children)),(null===(a=null===(o=t.setupData)||void 0===o?void 0:o.attachment)||void 0===a?void 0:a.boneOrder)&&t.applyBoneSort(t.setupData.attachment.boneOrder,Array.from(this.children));const c=null===(l=null===(h=t.setupData)||void 0===h?void 0:h.attachment)||void 0===l?void 0:l.frames;c&&c[e]&&c[e].boneOrder&&t.applyBoneSort(c[e].boneOrder,Array.from(this.children))})}set direction(e){if(e!=this._direction){if(this._direction=e,this.baseTrack.changeDirection(e),this.activeAttachmentTracks)for(let t=0;t<this.activeAttachmentTracks.length;t++)this.activeAttachmentTracks[t].changeDirection(e);this.reapplyBoneSortSetups(e)}}get direction(){return this._direction}}t.Skeleton=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatAttachmentData=t.formatSetupFrameData=t.formatAnimationData=t.formatSkeletonData=void 0;const n=i(4),s=e=>{const t=parseInt(`${e}`);return isNaN(t)?e:t};t.formatSkeletonData=e=>{const i={};let n={};e.skeletons.forEach(e=>{n=Object.assign(Object.assign({},n),e.actions)});const s=r(e.attachmentSlots,e.attachments,e.animations,n);return e.skeletons.forEach(n=>{let r={};const a=o(n.animationIds,e.animations,n.actions),h={},l={};n.attachmentSlotIds.forEach(t=>{const{name:i,boneNames:n}=e.attachmentSlots.find(e=>e.id==t),o=s[i];n&&(r=Object.assign(Object.assign({},r),n)),h[o.name]=o;for(let t in o.attachmentData){l[t]=o.attachmentData[t].animations;const i=e.attachments.find(e=>e.name==t);i.boneNames&&(r=Object.assign(Object.assign({},r),i.boneNames))}}),i[n.name]={directions:n.directions,animations:a,attachmentAnimations:l,id:n.id,name:n.name,attachmentSlotData:h},n.boneNames&&(r=Object.assign(Object.assign({},r),n.boneNames)),r&&Object.keys(r).length&&(i[n.name].boneNameLookup=r),n.setupData&&(i[n.name].setupData=t.formatSetupFrameData(n.setupData))}),i};t.formatAnimationData=e=>{const t=[],i=[];let s=null;for(let r=0;r<e.frameData.length;r++){const o=e.frameData[r];if(o.bones){const e=s;s=s?[...s]:[];let t=0,r=0;for(let e=0;e<o.bones.length;e++){const a=o.bones[e];if(a.rotation&&(a.rotation=n.deg2rad(a.rotation)),a.slotId||a.hide){i.includes(a.id)||i.push(a.id),r++;let e=-1;for(let t=0;t<s.length;t+=2)s[t]==a.id&&(e=t);e>-1?s[e+1]!=a.slotId&&(t++,s[e+1]=a.slotId):(t++,s.push(a.id,a.slotId))}}t||(s=e)}t.push(s)}return i.length&&(e.overriddenBones=i,e.overriddenBoneSlotsByFrame=t),e};const r=(e,i,n,r)=>{const o={};return e.forEach(h=>{var l;const d=a(h,e,i),{attachmentIds:c,id:u,name:p,boneNames:f,setupData:m}=h,g=null===(l=i.find(e=>{var t;return null===(t=e.attachmentSlotIds)||void 0===t?void 0:t.includes(u)}))||void 0===l?void 0:l.name;let y;f&&(y=Object.keys(f).map(s));const v=m?t.formatSetupFrameData(m):null,C={};c.forEach(e=>{const s=i.find(t=>t.id==e);C[s.name]=t.formatAttachmentData(s,n,r,v)}),o[p]={id:u,name:p,level:d,attachmentData:C},v&&(o[p].setupData=v),y&&y.length&&(o[p].setupData?o[p].setupData.addedBoneIds=y:o[p].setupData={addedBoneIds:y}),g&&(o[p].parentAttachmentName=g)}),o},o=(e,i,n)=>{const s={};return e.forEach(e=>{const r=i.find(t=>t.id==e),o=n[r.actionId];o in s||(s[o]={}),s[o][r.direction]=t.formatAnimationData(r)}),s};t.formatSetupFrameData=(e,t)=>{if(!e)return null;const i=e.bones?e.bones.map(e=>e.id).map(s):null,r={slots:{},parentBones:{}},o={},a=null==e?void 0:e.frames,h=a?Object.keys(e.frames):[],l={};e.addedColliders&&(l.addedColliders=e.addedColliders),e.adjustedColliders&&(l.adjustedColliders=e.adjustedColliders),e.bones&&(l.bones=e.bones),e.boneOrder&&(l.boneOrder=e.boneOrder),e.boneParentChanges&&(l.boneParentChanges=e.boneParentChanges),i&&i.length&&(l.addedBoneIds=i),a&&(l.frames={});for(let e=0;e<h.length;e++){const t=h[e];if(r.slots[t]={},r.parentBones[t]={},l.frames[t]=a[t],a[t].bones)for(let e=0;e<a[t].bones.length;e++){const{id:i,slotId:s,hide:h,parentBoneId:l}=a[t].bones[e];(s&&null!=s||h)&&(r.slots[t][i]=!0),o[i]=!0,a[t].bones[e].rotation&&(a[t].bones[e].rotation=n.deg2rad(a[t].bones[e].rotation)),l&&(r.parentBones[t][i]=l)}}const d=Object.keys(o);for(let e=0;e<d.length;e++){const t={slotOverrides:[],parentBoneOverrides:[]},{slotOverrides:i,parentBoneOverrides:n}=t,s=d[e];for(let e=0;e<h.length;e++){r.slots[h[e]][s]&&i.push(h[e]);const t=r.parentBones[h[e]][s];t&&n.push({direction:h[e],parentBoneId:t})}if(i.length===h.length)l.overriddenBones?l.overriddenBones.push(s):l.overriddenBones=[s];else for(let e=0;e<i.length;e++)l.frames[i[e]].overriddenBones?l.frames[i[e]].overriddenBones.push(s):l.frames[i[e]].overriddenBones=[s];if(n.length){let e=!0;if(n.length===h.length){const t=n[0].parentBoneId;for(let i=1;i<n.length;i++)if(n[i].parentBoneId!=t){e=!1;break}}else e=!1;if(e){const e={id:s,parentBoneId:n[0].parentBoneId};l.bones?l.bones.push(e):l.bones=[e],h.forEach(t=>{l.frames[t].bones=l.frames[t].bones.filter(t=>t.id!=e.id&&t.parentBoneId!=e.parentBoneId)})}}}if(t){l.overriddenBones&&(null==t?void 0:t.overriddenBones)&&(l.overriddenBones=l.overriddenBones.filter(e=>!t.overriddenBones.find(t=>t==e)),l.overriddenBones.length||delete l.overriddenBones),l.bones&&t.bones&&(l.bones=l.bones.filter(e=>!t.bones.find(t=>t.parentBoneId==e.parentBoneId&&e.id==t.id)));const e=(e,i,n)=>{l.frames[e][i]&&(t&&t[i]&&(l.frames[e][i]=l.frames[e][i].filter(e=>n(e,t[i]))),l.frames[e][i].length?(null==t?void 0:t.frames)&&t.frames[e]&&t.frames[e][i]&&(l.frames[e][i]=l.frames[e][i].filter(s=>n(s,t.frames[e][i])),l.frames[e][i].length||delete l.frames[e][i]):delete l.frames[e][i])},i=t=>{e(t,"overriddenBones",(e,t)=>!t.find(t=>t==e))},n=t=>{e(t,"bones",(e,t)=>!t.find(t=>t.parentBoneId==e.parentBoneId&&e.id==t.id))};for(let e in l.frames)i(e),n(e)}if(l.frames){const e=["overriddenBones","bones"];h.forEach(t=>{l.frames[t]&&(e.forEach(e=>{var i;l.frames[t]&&0===(null===(i=l.frames[t][e])||void 0===i?void 0:i.length)&&delete l.frames[t][e]}),Object.keys(l.frames[t]).length||delete l.frames[t])}),Object.keys(l.frames).length||delete l.frames}return Object.keys(l).length?l:null};t.formatAttachmentData=(e,i,n,s)=>{const r=[];for(let t in e.boneNames)r.push(t);const a=o(e.animationIds,i,n),h={id:e.id,name:e.name,atlasIds:e.atlasIds,animations:a};return e.setupData&&(h.setupData=t.formatSetupFrameData(e.setupData,s)),h};const a=(e,t,i)=>{let n=1,s=i.find(t=>{var i;return null===(i=t.attachmentSlotIds)||void 0===i?void 0:i.includes(e.id)});for(;s;)n++,e=t.find(e=>e.attachmentIds.includes(s.id)),s=i.find(t=>{var i;return null===(i=t.attachmentSlotIds)||void 0===i?void 0:i.includes(e.id)});return n}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LazyDynamicAtlasLoader=void 0;const s=i(84),r=i(86),o=i(4),a=i(37);t.LazyDynamicAtlasLoader=class{constructor(e,t,i,n,o){this.slotIdToRectLookup={},this.slotIdToColliderLookup={},this.slotIdToTagLookup={},this.atlasNameToSkinNameToSlotTextures={},this.atlasNameToSlots={},this.loadedSkins={},this.loader=t,this.projectPath=i,1==n.type?this.textureAtlas=new s.WebGlGameObjectAtlas(n):this.textureAtlas=new r.CanvasGameObjectAtlas(n);const a=[];e.forEach(e=>{this.atlasNameToSkinNameToSlotTextures[e.name]={},this.atlasNameToSlots[e.name]=Object.keys(e.slots).map(e=>isNaN(parseInt(e))?e:parseInt(e));for(let t in e.slots)if(e.slots[t].cuids&&(this.slotIdToColliderLookup[t]=e.slots[t].cuids.map(t=>e.colliders[t])),this.slotIdToRectLookup[t]=e.slots[t].rect,e.slots[t].tags){const i=e.slots[t].tags.sort().join(","),n=a.find(e=>e.hash==i);if(n)this.slotIdToTagLookup[t]=n.array;else{const n=[...e.slots[t].tags];a.push({hash:i,array:n}),this.slotIdToTagLookup[t]=n}}}),o&&o.forEach(({atlasName:e,texture:t,skinId:i})=>{this._getSkinFromTexture(e,t,i)})}updateAtlas(e){}removeAtlas(e){}removeSkin(e,t){}loadSheet(e){return Promise.resolve(void 0)}loadSkinTexture(e){return n(this,void 0,void 0,(function*(){let t=yield this.loader.loadImageData(e);return t||(t=yield o.httpGetAsync(e,!1))&&this.loader.saveImageData(e,t),t?yield o.getTextureFromBlob(t):null}))}addToAtlas(e){return e}getOpenBaseTexture(){return{baseTexture:null,x:0,y:0}}splitTextureAndAddToMap(e,t,i){const{texture:n,rect:s}=this.textureAtlas.addTexture(`${e}_${t}`,i,null,!0),r=this.atlasNameToSkinNameToSlotTextures[e];for(let i=0;i<this.atlasNameToSlots[e].length;i++){const o=this.atlasNameToSlots[e][i],a=this.slotIdToRectLookup[o];r[t][o]=new PIXI.Texture(n,new PIXI.Rectangle(s.x+a[0],s.y+a[1],a[2],a[3]))}return r[t]}_getSkinFromTexture(e,t,i){const n=this.atlasNameToSkinNameToSlotTextures[e];if(i in n)throw new Error(`Already had id ${i}`);return n[i]={},this.splitTextureAndAddToMap(e,i,t)}_getOrLoadSkinFromUrl(e,t,i){return n(this,void 0,void 0,(function*(){const n=this.atlasNameToSkinNameToSlotTextures[e];if((i=i||0===i||"0"===i?i:t)in n)return n[i];let s=yield this.loadSkinTexture(t);if(!s)throw new Error(`Could not load skin from url: ${t}`);return n[i]={},this.splitTextureAndAddToMap(e,i,s)}))}getSlotsForTexture(e,t,i){var n;const s={},r=e instanceof PIXI.BaseTexture?e:e.baseTexture;for(let e=0;e<this.atlasNameToSlots[t].length;e++){const o=this.atlasNameToSlots[t][e];if(!i||(null===(n=this.slotIdToTagLookup[o])||void 0===n?void 0:n.includes(i))){const e=this.slotIdToRectLookup[o];s[o]=new PIXI.Texture(r,new PIXI.Rectangle(e.x,e.y,e.w,e.h))}}return s}slotHasTag(e,t){return!!this.slotIdToTagLookup[e]&&this.slotIdToTagLookup[e].includes(t)}getSkinSlots(e,t){return this.atlasNameToSkinNameToSlotTextures[e][t]}getSkinSlot(e,t){return this.atlasNameToSlots[e][t]}loadSkinSlots(e,t){return n(this,void 0,void 0,(function*(){(t=t||a.DEFAULT_SKIN_ID).includes(".png")||(t+=".png");const i=`${this.projectPath}/atlases/${e}/skins/${t}`;return this._getOrLoadSkinFromUrl(e,i,t)}))}loadSkinSlotsByUrl(e,t){return n(this,void 0,void 0,(function*(){return this._getOrLoadSkinFromUrl(e,t)}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGlGameObjectAtlas=void 0;const n=i(40);class s extends n.BaseGameObjectAtlas{constructor(e){super(2048,e)}removeTextureFromAtlas(e){if(!(e in this.cachedTextureData))throw new Error(`Could not find id ${e}`);const[t,i,n,s,r]=this.cachedTextureData[e];delete this.cachedTextureData[e],this.renderer.bindRenderTexture(this.atlases[r],null);const o=this.renderer.gl;o.enable(o.SCISSOR_TEST),o.scissor(t,i,n,s),this.renderer.clear(),this.renderer.bindRenderTexture()}}t.WebGlGameObjectAtlas=s},function(e,t,i){"use strict";i.r(t),i.d(t,"Bin",(function(){return s})),i.d(t,"MaxRectsBin",(function(){return r})),i.d(t,"MaxRectsPacker",(function(){return l})),i.d(t,"OversizedElementBin",(function(){return o})),i.d(t,"PACKING_LOGIC",(function(){return h})),i.d(t,"Rectangle",(function(){return n}));class n{constructor(e=0,t=0,i=0,n=0,s=!1,r){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=t,this._x=i,this._y=n,this._data={},this._rot=s,this._allowRotation=r}static Collide(e,t){return e.collide(t)}static Contain(e,t){return e.contain(t)}area(){return this.width*this.height}collide(e){return e.x<this.x+this.width&&e.x+e.width>this.x&&e.y<this.y+this.height&&e.y+e.height>this.y}contain(e){return e.x>=this.x&&e.y>=this.y&&e.x+e.width<=this.x+this.width&&e.y+e.height<=this.y+this.height}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._dirty++)}get height(){return this._height}set height(e){e!==this._height&&(this._height=e,this._dirty++)}get x(){return this._x}set x(e){e!==this._x&&(this._x=e,this._dirty++)}get y(){return this._y}set y(e){e!==this._y&&(this._y=e,this._dirty++)}get rot(){return this._rot}set rot(e){if(!1!==this._allowRotation&&this._rot!==e){const t=this.width;this.width=this.height,this.height=t,this._rot=e,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(e){this._allowRotation!==e&&(this._allowRotation=e,this._dirty++)}get data(){return this._data}set data(e){null!==e&&e!==this._data&&(this._data=e,"object"==typeof e&&e.hasOwnProperty("allowRotation")&&(this._allowRotation=e.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(e=!0){this._dirty=e?this._dirty+1:0}}class s{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some(e=>e.dirty)}setDirty(e=!0){if(this._dirty=e?this._dirty+1:0,!e)for(let e of this.rects)e.setDirty&&e.setDirty(!1)}}class r extends s{constructor(e=a,t=a,i=0,s={}){super(),this.maxWidth=e,this.maxHeight=t,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:h.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),s),this.width=this.options.smart?0:e,this.height=this.options.smart?0:t,this.border=this.options.border?this.options.border:0,this.freeRects.push(new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new n(this.width,this.height)}add(...e){let t,i;if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsBin.add(): Wrong parameters");let t=(i=e[0]).data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==t)return}else{if(t=e.length>2?e[2]:null,this.options.tag&&this.options.exclusiveTag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}(i=new n(e[0],e[1])).data=t,i.setDirty(!1)}const s=this.place(i);return s&&this.rects.push(s),s}repack(){let e=[];this.reset(),this.rects.sort((e,t)=>{const i=Math.max(t.width,t.height)-Math.max(e.width,e.height);return 0===i&&e.hash&&t.hash?e.hash>t.hash?-1:1:i});for(let t of this.rects)this.place(t)||e.push(t);for(let t of e)this.rects.splice(this.rects.indexOf(t),1);return e.length>0?e:void 0}reset(e=!1,t=!1){e&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],t&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new n(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new n(this.width,this.height),this._dirty=0}clone(){let e=new r(this.maxWidth,this.maxHeight,this.padding,this.options);for(let t of this.rects)e.add(t);return e}place(e){let t,i,s=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===s){if(i=e.hasOwnProperty("_allowRotation")&&void 0!==e.allowRotation?e.allowRotation:this.options.allowRotation,t=this.findNode(e.width+this.padding,e.height+this.padding,i)){this.updateBinSize(t);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],t)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,e.x=t.x,e.y=t.y,void 0===e.rot&&(e.rot=!1),e.rot=t.rot?!e.rot:e.rot,this._dirty++,e}if(this.verticalExpand){if(this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(e)}else if(this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new n(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(e)}}findNode(e,t,i){let s,r,o,a=Number.MAX_VALUE;for(let l in this.freeRects)(r=this.freeRects[l]).width>=e&&r.height>=t&&(s=this.options.logic===h.MAX_AREA?r.width*r.height-e*t:Math.min(r.width-e,r.height-t))<a&&(o=new n(e,t,r.x,r.y),a=s),i&&r.width>=t&&r.height>=e&&(s=this.options.logic===h.MAX_AREA?r.width*r.height-t*e:Math.min(r.height-e,r.width-t))<a&&(o=new n(t,e,r.x,r.y,!0),a=s);return o}splitNode(e,t){if(!e.collide(t))return!1;if(t.x<e.x+e.width&&t.x+t.width>e.x){if(t.y>e.y&&t.y<e.y+e.height){let i=new n(e.width,t.y-e.y,e.x,e.y);this.freeRects.push(i)}if(t.y+t.height<e.y+e.height){let i=new n(e.width,e.y+e.height-(t.y+t.height),e.x,t.y+t.height);this.freeRects.push(i)}}if(t.y<e.y+e.height&&t.y+t.height>e.y){if(t.x>e.x&&t.x<e.x+e.width){let i=new n(t.x-e.x,e.height,e.x,e.y);this.freeRects.push(i)}if(t.x+t.width<e.x+e.width){let i=new n(e.x+e.width-(t.x+t.width),e.height,t.x+t.width,e.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let e=0,t=0,i=this.freeRects.length;for(;e<i;){t=e+1;let n=this.freeRects[e];for(;t<i;){let s=this.freeRects[t];if(s.contain(n)){this.freeRects.splice(e,1),e--,i--;break}n.contain(s)&&(this.freeRects.splice(t,1),t--,i--),t++}e++}}updateBinSize(e){if(!this.options.smart)return!1;if(this.stage.contain(e))return!1;let t=Math.max(this.width,e.x+e.width-this.padding+this.border),i=Math.max(this.height,e.y+e.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,e.x+e.height-this.padding+this.border),s=Math.max(this.height,e.y+e.width-this.padding+this.border);n*s<t*i&&(t=n,i=s)}return this.options.pot&&(t=Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(t=i=Math.max(t,i)),!(t>this.maxWidth+this.padding||i>this.maxHeight+this.padding)&&(this.expandFreeRects(t+this.padding,i+this.padding),this.width=this.stage.width=t,this.height=this.stage.height=i,!0)}expandFreeRects(e,t){this.freeRects.forEach((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,e)&&(i.width=e-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,t)&&(i.height=t-i.y-this.border)},this),this.freeRects.push(new n(e-this.width-this.padding,t-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new n(e-2*this.border,t-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter(e=>!(e.width<=0||e.height<=0||e.x<this.border||e.y<this.border)),this.pruneFreeList()}}class o extends s{constructor(...e){if(super(),this.rects=[],1===e.length){if("object"!=typeof e[0])throw new Error("OversizedElementBin: Wrong parameters");const t=e[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=e[0],this.height=e[1],this.data=e.length>2?e[2]:null;const t=new n(this.width,this.height);t.oversized=!0,t.data=this.data,this.rects.push(t)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(e=!1){}repack(){}clone(){return new o(this.rects[0])}}const a=4096;var h;!function(e){e[e.MAX_AREA=0]="MAX_AREA",e[e.MAX_EDGE=1]="MAX_EDGE"}(h||(h={}));class l{constructor(e=a,t=a,i=0,n={}){this.width=e,this.height=t,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:h.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),n)}add(...e){if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=e[0];if(t.width>this.width||t.height>this.height)this.bins.push(new o(t));else{if(!this.bins.slice(this._currentBinIndex).find(e=>void 0!==e.add(t))){let e=new r(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(e.tag=i),e.add(t),this.bins.push(e)}}return t}{const t=new n(e[0],e[1]);if(e.length>2&&(t.data=e[2]),t.width>this.width||t.height>this.height)this.bins.push(new o(t));else{if(!this.bins.slice(this._currentBinIndex).find(e=>void 0!==e.add(t))){let e=new r(this.width,this.height,this.padding,this.options);this.options.tag&&t.data.tag&&(e.tag=t.data.tag),e.add(t),this.bins.push(e)}}return t}}addArray(e){if(!this.options.tag||this.options.exclusiveTag)this.sort(e,this.options.logic).forEach(e=>this.add(e));else{if(0===e.length)return;let t;e.sort((e,t)=>{const i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0,n=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;return void 0===n?-1:void 0===i?1:n>i?-1:1});let i=0;if(!this.bins.slice(this._currentBinIndex).find(n=>{let s=n.clone();for(let r=i;r<e.length;r++){const o=e[r],a=o.data&&o.data.tag?o.data.tag:o.tag?o.tag:void 0;if(0===r&&(t=a),a!==t)return t=a,this.sort(e.slice(i,r),this.options.logic).forEach(e=>n.add(e)),i=r,this.addArray(e.slice(r)),!0;if(void 0===a)return this.sort(e.slice(r),this.options.logic).forEach(e=>this.add(e)),i=e.length,!0;if(void 0===s.add(o))return!1}return this.sort(e.slice(i),this.options.logic).forEach(e=>n.add(e)),!0})){const t=e[i],n=new r(this.width,this.height,this.padding,this.options),s=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&this.options.exclusiveTag&&s&&(n.tag=s),this.bins.push(n),this.addArray(e.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(e=!0){if(e){let e=[];for(let t of this.bins)if(t.dirty){let i=t.repack();i&&e.push(...i)}return void this.addArray(e)}if(!this.dirty)return;const t=this.rects;this.reset(),this.addArray(t)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(e){e.forEach((e,t)=>{if(e.maxWidth>this.width||e.maxHeight>this.height)this.bins.push(new o(e.width,e.height,{}));else{let i=new r(this.width,this.height,this.padding,e.options);i.freeRects.splice(0),e.freeRects.forEach((e,t)=>{i.freeRects.push(new n(e.width,e.height,e.x,e.y))}),i.width=e.width,i.height=e.height,e.tag&&(i.tag=e.tag),this.bins[t]=i}},this)}save(){let e=[];return this.bins.forEach(t=>{let i={width:t.width,height:t.height,maxWidth:t.maxWidth,maxHeight:t.maxHeight,freeRects:[],rects:[],options:t.options};t.tag&&(i=Object.assign(Object.assign({},i),{tag:t.tag})),t.freeRects.forEach(e=>{i.freeRects.push({x:e.x,y:e.y,width:e.width,height:e.height})}),e.push(i)}),e}sort(e,t=h.MAX_EDGE){return e.slice().sort((e,i)=>{const n=t===h.MAX_EDGE?Math.max(i.width,i.height)-Math.max(e.width,e.height):i.width*i.height-e.width*e.height;return 0===n&&e.hash&&i.hash?e.hash>i.hash?-1:1:n})}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some(e=>e.dirty)}get rects(){let e=[];for(let t of this.bins)e.push(...t.rects);return e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGameObjectAtlas=void 0;const n=i(40);class s extends n.BaseGameObjectAtlas{constructor(e){super(2048,e)}removeTextureFromAtlas(e,t,i){}}t.CanvasGameObjectAtlas=s},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;const s=i(4),r=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,o=(window.IDBTransaction||window.webkitIDBTransaction||window.OIDBTransaction||window.msIDBTransaction,1);t.Loader=class{constructor(e,t){this.db=t,this.name=e}initialize(){return n(this,void 0,void 0,(function*(){if(this.db)return!0;const e=r.open(this.name,o);return new Promise((t,i)=>{e.onerror=function(e){console.error("Error creating/accessing IndexedDB database",e)},e.onsuccess=n=>{if(this.db=e.result,this.db.onerror=function(e){return console.error("Error creating/accessing IndexedDB database",e),i("Error creating/accessing IndexedDB database")},!this.db.setVersion)return t(!0);if(this.db.version==o)return this.db.createObjectStore(this.name),t(!0);this.db.setVersion(o).onsuccess=function(){return this.db.createObjectStore(this.name),t(!0)}},e.onupgradeneeded=e=>{this.db=e.target.result,this.db.createObjectStore(this.name)}})}))}deleteItem(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readwrite").objectStore(this.name).delete(e);return new Promise((i,n)=>{t.onsuccess=e=>i(!0),t.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}saveBlob(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(t,e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving blob to indexedDB: ${e}`)})}))}loadBlob(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((n,s)=>{i.onsuccess=e=>{try{if(!t)return n(e.target.result);t(e.target.result).then(e=>n(e))}catch(e){return n(null)}},i.onerror=t=>s(Error(`Error getting texture from indexedDB: ${e}`))})}))}saveJson(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(JSON.stringify(t),e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}loadJson(e,t=!1){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((n,s)=>{i.onsuccess=e=>{try{const i=t?e.target.result:JSON.parse(e.target.result);return n(i)}catch(e){return n(null)}},i.onerror=t=>s(Error(`Error getting texture from indexedDB: ${e}`))})}))}saveTexture(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite"),n=document.createElement("canvas");n.width=t.baseTexture.width,n.height=t.baseTexture.height,n.getContext("2d").drawImage(t.baseTexture.source,0,0);const s=n.toDataURL("image/png"),r=i.objectStore(this.name).put(s,e);return new Promise((t,i)=>{r.onsuccess=e=>t(!0),r.onerror=t=>i(`Error saving texture to indexedDB: ${e}`)})}))}saveImageData(e,t){return n(this,void 0,void 0,(function*(){const i=this.db.transaction([this.name],"readwrite").objectStore(this.name).put(t,e);return new Promise((t,n)=>{i.onsuccess=e=>t(!0),i.onerror=t=>n(`Error saving texture to indexedDB: ${e}`)})}))}loadImageData(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,n)=>{t.onsuccess=e=>{const t=e.target.result;return i(t)},t.onerror=t=>{throw new Error(`Error getting texture from indexedDB: ${e}`)}})}))}loadTexture(e){return n(this,void 0,void 0,(function*(){const t=this.db.transaction([this.name],"readonly").objectStore(this.name).get(e);return new Promise((i,r)=>{t.onsuccess=e=>n(this,void 0,void 0,(function*(){const t=e.target.result,n=t?yield s.dataUrlToTexture(t):null;return i(n)})),t.onerror=t=>{throw new Error(`Error getting texture from indexedDB: ${e}`)}})}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridPathFinder=void 0;const n=i(89);t.GridPathFinder=class{constructor(){this.cachedAddedRects={},this.finder=new n.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0})}create(e,t,i,s){this.cellSize=e,this.rows=t,this.columns=i,this.grid=new n.Grid(i,t),(null==s?void 0:s.length)&&this.addBlockingCells(s)}removeBlockingCells(e,t){e.forEach(e=>{this.grid.setWalkableAt(Math.floor(e[0]/this.cellSize),Math.floor(e[1]/this.cellSize),!0)})}addBlockingCells(e){e.forEach(e=>{this.grid.setWalkableAt(Math.floor(e[0]/this.cellSize),Math.floor(e[1]/this.cellSize),!1)})}toggleBlockingLine(e,t){const{cellXys:i}=this.getCellsForLine(e);for(let e=0;e<i.length;e+=2)this.grid.setWalkableAt(i[e],i[e+1],!t)}toggleBlockingPolygon(e,t){const{cellXys:i}=this.getBucketsForPolygon(e);for(let e=0;e<i.length;e+=2)this.grid.setWalkableAt(i[e],i[e+1],!t)}toggleBlockingRect(e,t){const{cellXys:i}=this.getCellsForRect(e);for(let e=0;e<i.length;e+=2)this.grid.setWalkableAt(i[e],i[e+1],!t)}getPath(e,t,i,s){const r=this.grid.clone();e=Math.floor(e/this.cellSize),t=Math.floor(t/this.cellSize),i=Math.floor(i/this.cellSize),s=Math.floor(s/this.cellSize);const o=n.Util.compressPath(this.finder.findPath(e,t,i,s,this.grid));return this.grid=r,o}getCellsForLine(e,t){const i=e[0],n=e[1];if(i.x===n.x||i.y===n.y){const e=this.getCellsForRect({x:Math.min(i.x,n.x),y:Math.min(i.y,n.y),w:Math.max(1,Math.abs(i.x-n.x)),h:Math.max(1,Math.abs(i.y-n.y))});if(!t)return e;const s=[],r=[];return e.cellIds.forEach((i,n)=>{t.includes(i)||(s.push(i),r.push(e.cellXys[2*n],e.cellXys[2*n+1]))}),{cellIds:s,cellXys:r}}const s=[],r=[],o=n.y-i.y/n.x-i.x,a=i.y-i.x*o;let h=0;const l=i.x>n.x?-1:1,d=i.y>n.y?-1:1;let c=i.x,u=i.y;let p=0;const f=[c,u,n.x,n.y];let m=!1;const g=(i.x+l)*o+a;Math.abs(g-i.y)<=1?(p=Math.abs(i.x-n.x),m=!0):p=Math.abs(i.y-n.y);let y=!0;for(;y;)m?(h+=l,u=(c+=l)*o+a):(h+=d,c=((u+=d)-a)/o),c>=0&&u>=0&&(f.push(c),f.push(u)),Math.abs(h)>=p&&(y=!1);for(let e=0;e<f.length;e+=2){const i=Math.floor(f[e]/this.cellSize),n=Math.floor(f[e+1]/this.cellSize),o=i+n*this.columns;s.includes(o)||t&&t.includes(o)||(s.push(o),r.push(i,n))}return{cellIds:s,cellXys:r}}getCellsForRect({x:e,y:t,w:i,h:n}){const s=[],r=[];if(i>this.cellSize||n>this.cellSize){const o=Math.floor(e/this.cellSize),a=Math.floor(t/this.cellSize),h=Math.ceil((e+i)/this.cellSize),l=Math.ceil((t+n)/this.cellSize);for(let e=o;e<h;e++)for(let t=a;t<l;t++){let i=e,n=t*this.columns+i;s.includes(n)&&(s.push(n),r.push(e,t))}}else{const o=(e,i)=>{if(!(e/this.cellSize>=this.columns||t/this.cellSize>=this.rows||e<0||i<0)){const t=Math.floor(e/this.cellSize),n=Math.floor(i/this.cellSize);let o=t+n*this.columns;s.includes(o)||(s.push(o),r.push(t,n))}};let a=e+i,h=t+n;o(e,t),o(e,h),o(a,t),o(a,h)}return{cellIds:s,cellXys:r}}getBucketsForPolygon(e,t=[]){const i=[],n=[];for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1?e[0]:e[t+1],o=this.getCellsForLine([s,r],i);i.push(...o.cellIds),n.push(...o.cellXys)}return{cellIds:i,cellXys:n}}}},function(e,t,i){e.exports=i(90)},function(e,t,i){e.exports={Heap:i(11),Node:i(22),Grid:i(93),Util:i(5),DiagonalMovement:i(2),Heuristic:i(8),AStarFinder:i(23),BestFirstFinder:i(94),BreadthFirstFinder:i(95),DijkstraFinder:i(96),BiAStarFinder:i(24),BiBestFirstFinder:i(97),BiBreadthFirstFinder:i(98),BiDijkstraFinder:i(99),IDAStarFinder:i(100),JumpPointFinder:i(101)}},function(e,t,i){(function(e){(function(){var t,i,n,s,r,o,a,h,l,d,c,u,p,f,m;n=Math.floor,d=Math.min,i=function(e,t){return e<t?-1:e>t?1:0},l=function(e,t,s,r,o){var a;if(null==s&&(s=0),null==o&&(o=i),s<0)throw new Error("lo must be non-negative");for(null==r&&(r=e.length);s<r;)o(t,e[a=n((s+r)/2)])<0?r=a:s=a+1;return[].splice.apply(e,[s,s-s].concat(t)),t},o=function(e,t,n){return null==n&&(n=i),e.push(t),f(e,0,e.length-1,n)},r=function(e,t){var n,s;return null==t&&(t=i),n=e.pop(),e.length?(s=e[0],e[0]=n,m(e,0,t)):s=n,s},h=function(e,t,n){var s;return null==n&&(n=i),s=e[0],e[0]=t,m(e,0,n),s},a=function(e,t,n){var s;return null==n&&(n=i),e.length&&n(e[0],t)<0&&(t=(s=[e[0],t])[0],e[0]=s[1],m(e,0,n)),t},s=function(e,t){var s,r,o,a,h,l;for(null==t&&(t=i),h=[],r=0,o=(a=function(){l=[];for(var t=0,i=n(e.length/2);0<=i?t<i:t>i;0<=i?t++:t--)l.push(t);return l}.apply(this).reverse()).length;r<o;r++)s=a[r],h.push(m(e,s,t));return h},p=function(e,t,n){var s;if(null==n&&(n=i),-1!==(s=e.indexOf(t)))return f(e,0,s,n),m(e,s,n)},c=function(e,t,n){var r,o,h,l,d;if(null==n&&(n=i),!(o=e.slice(0,t)).length)return o;for(s(o,n),h=0,l=(d=e.slice(t)).length;h<l;h++)r=d[h],a(o,r,n);return o.sort(n).reverse()},u=function(e,t,n){var o,a,h,c,u,p,f,m,g;if(null==n&&(n=i),10*t<=e.length){if(!(h=e.slice(0,t).sort(n)).length)return h;for(a=h[h.length-1],c=0,p=(f=e.slice(t)).length;c<p;c++)n(o=f[c],a)<0&&(l(h,o,0,null,n),h.pop(),a=h[h.length-1]);return h}for(s(e,n),g=[],u=0,m=d(t,e.length);0<=m?u<m:u>m;0<=m?++u:--u)g.push(r(e,n));return g},f=function(e,t,n,s){var r,o,a;for(null==s&&(s=i),r=e[n];n>t&&s(r,o=e[a=n-1>>1])<0;)e[n]=o,n=a;return e[n]=r},m=function(e,t,n){var s,r,o,a,h;for(null==n&&(n=i),r=e.length,h=t,o=e[t],s=2*t+1;s<r;)(a=s+1)<r&&!(n(e[s],e[a])<0)&&(s=a),e[t]=e[s],s=2*(t=s)+1;return e[t]=o,f(e,h,t,n)},t=function(){function e(e){this.cmp=null!=e?e:i,this.nodes=[]}return e.push=o,e.pop=r,e.replace=h,e.pushpop=a,e.heapify=s,e.updateItem=p,e.nlargest=c,e.nsmallest=u,e.prototype.push=function(e){return o(this.nodes,e,this.cmp)},e.prototype.pop=function(){return r(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return h(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return a(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return s(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return p(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),(null!==e?e.exports:void 0)?e.exports=t:window.Heap=t}).call(this)}).call(this,i(92)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){var n=i(22),s=i(2);function r(e,t,i){var n;"object"!=typeof e?n=e:(t=e.length,n=e[0].length,i=e),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,i)}r.prototype._buildNodes=function(e,t,i){var s,r,o=new Array(t);for(s=0;s<t;++s)for(o[s]=new Array(e),r=0;r<e;++r)o[s][r]=new n(r,s);if(void 0===i)return o;if(i.length!==t||i[0].length!==e)throw new Error("Matrix size does not fit");for(s=0;s<t;++s)for(r=0;r<e;++r)i[s][r]&&(o[s][r].walkable=!1);return o},r.prototype.getNodeAt=function(e,t){return this.nodes[t][e]},r.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable},r.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height},r.prototype.setWalkableAt=function(e,t,i){this.nodes[t][e].walkable=i},r.prototype.getNeighbors=function(e,t){var i=e.x,n=e.y,r=[],o=!1,a=!1,h=!1,l=!1,d=!1,c=!1,u=!1,p=!1,f=this.nodes;if(this.isWalkableAt(i,n-1)&&(r.push(f[n-1][i]),o=!0),this.isWalkableAt(i+1,n)&&(r.push(f[n][i+1]),h=!0),this.isWalkableAt(i,n+1)&&(r.push(f[n+1][i]),d=!0),this.isWalkableAt(i-1,n)&&(r.push(f[n][i-1]),u=!0),t===s.Never)return r;if(t===s.OnlyWhenNoObstacles)a=u&&o,l=o&&h,c=h&&d,p=d&&u;else if(t===s.IfAtMostOneObstacle)a=u||o,l=o||h,c=h||d,p=d||u;else{if(t!==s.Always)throw new Error("Incorrect value of diagonalMovement");a=!0,l=!0,c=!0,p=!0}return a&&this.isWalkableAt(i-1,n-1)&&r.push(f[n-1][i-1]),l&&this.isWalkableAt(i+1,n-1)&&r.push(f[n-1][i+1]),c&&this.isWalkableAt(i+1,n+1)&&r.push(f[n+1][i+1]),p&&this.isWalkableAt(i-1,n+1)&&r.push(f[n+1][i-1]),r},r.prototype.clone=function(){var e,t,i=this.width,s=this.height,o=this.nodes,a=new r(i,s),h=new Array(s);for(e=0;e<s;++e)for(h[e]=new Array(i),t=0;t<i;++t)h[e][t]=new n(t,e,o[e][t].walkable);return a.nodes=h,a},e.exports=r},function(e,t,i){var n=i(23);function s(e){n.call(this,e);var t=this.heuristic;this.heuristic=function(e,i){return 1e6*t(e,i)}}s.prototype=new n,s.prototype.constructor=s,e.exports=s},function(e,t,i){var n=i(5),s=i(2);function r(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=s.OnlyWhenNoObstacles:this.diagonalMovement=s.IfAtMostOneObstacle:this.diagonalMovement=s.Never)}r.prototype.findPath=function(e,t,i,s,r){var o,a,h,l,d,c=[],u=this.diagonalMovement,p=r.getNodeAt(e,t),f=r.getNodeAt(i,s);for(c.push(p),p.opened=!0;c.length;){if((h=c.shift()).closed=!0,h===f)return n.backtrace(f);for(l=0,d=(o=r.getNeighbors(h,u)).length;l<d;++l)(a=o[l]).closed||a.opened||(c.push(a),a.opened=!0,a.parent=h)}return[]},e.exports=r},function(e,t,i){var n=i(23);function s(e){n.call(this,e),this.heuristic=function(e,t){return 0}}s.prototype=new n,s.prototype.constructor=s,e.exports=s},function(e,t,i){var n=i(24);function s(e){n.call(this,e);var t=this.heuristic;this.heuristic=function(e,i){return 1e6*t(e,i)}}s.prototype=new n,s.prototype.constructor=s,e.exports=s},function(e,t,i){var n=i(5),s=i(2);function r(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=s.OnlyWhenNoObstacles:this.diagonalMovement=s.IfAtMostOneObstacle:this.diagonalMovement=s.Never)}r.prototype.findPath=function(e,t,i,s,r){var o,a,h,l,d,c=r.getNodeAt(e,t),u=r.getNodeAt(i,s),p=[],f=[],m=this.diagonalMovement;for(p.push(c),c.opened=!0,c.by=0,f.push(u),u.opened=!0,u.by=1;p.length&&f.length;){for((h=p.shift()).closed=!0,l=0,d=(o=r.getNeighbors(h,m)).length;l<d;++l)if(!(a=o[l]).closed)if(a.opened){if(1===a.by)return n.biBacktrace(h,a)}else p.push(a),a.parent=h,a.opened=!0,a.by=0;for((h=f.shift()).closed=!0,l=0,d=(o=r.getNeighbors(h,m)).length;l<d;++l)if(!(a=o[l]).closed)if(a.opened){if(0===a.by)return n.biBacktrace(a,h)}else f.push(a),a.parent=h,a.opened=!0,a.by=1}return[]},e.exports=r},function(e,t,i){var n=i(24);function s(e){n.call(this,e),this.heuristic=function(e,t){return 0}}s.prototype=new n,s.prototype.constructor=s,e.exports=s},function(e,t,i){i(5);var n=i(8),s=i(22),r=i(2);function o(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||n.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=r.OnlyWhenNoObstacles:this.diagonalMovement=r.IfAtMostOneObstacle:this.diagonalMovement=r.Never),this.diagonalMovement===r.Never?this.heuristic=e.heuristic||n.manhattan:this.heuristic=e.heuristic||n.octile}o.prototype.findPath=function(e,t,i,n,r){var o,a,h,l=(new Date).getTime(),d=function(e,t){return this.heuristic(Math.abs(t.x-e.x),Math.abs(t.y-e.y))}.bind(this),c=function(e,t,i,n,o){if(this.timeLimit>0&&(new Date).getTime()-l>1e3*this.timeLimit)return 1/0;var a,h,u,f,m=t+d(e,p)*this.weight;if(m>i)return m;if(e==p)return n[o]=[e.x,e.y],e;var g,y,v=r.getNeighbors(e,this.diagonalMovement);for(u=0,a=1/0;f=v[u];++u){if(this.trackRecursion&&(f.retainCount=f.retainCount+1||1,!0!==f.tested&&(f.tested=!0)),(h=c(f,t+(y=f,(g=e).x===y.x||g.y===y.y?1:Math.SQRT2),i,n,o+1))instanceof s)return n[o]=[e.x,e.y],h;this.trackRecursion&&0==--f.retainCount&&(f.tested=!1),h<a&&(a=h)}return a}.bind(this),u=r.getNodeAt(e,t),p=r.getNodeAt(i,n),f=d(u,p);for(o=0;;++o){if((h=c(u,0,f,a=[],0))===1/0)return[];if(h instanceof s)return a;f=h}return[]},e.exports=o},function(e,t,i){var n=i(2),s=i(102),r=i(103),o=i(104),a=i(105);e.exports=function(e){return(e=e||{}).diagonalMovement===n.Never?new s(e):e.diagonalMovement===n.Always?new r(e):e.diagonalMovement===n.OnlyWhenNoObstacles?new o(e):new a(e)}},function(e,t,i){var n=i(12),s=i(2);function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,i,n){var s=this.grid,r=e-i,o=t-n;if(!s.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(s.getNodeAt(e,t).tested=!0),s.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r){if(s.isWalkableAt(e,t-1)&&!s.isWalkableAt(e-r,t-1)||s.isWalkableAt(e,t+1)&&!s.isWalkableAt(e-r,t+1))return[e,t]}else{if(0===o)throw new Error("Only horizontal and vertical movements are allowed");if(s.isWalkableAt(e-1,t)&&!s.isWalkableAt(e-1,t-o)||s.isWalkableAt(e+1,t)&&!s.isWalkableAt(e+1,t-o))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}return this._jump(e+r,t+o,e,t)},r.prototype._findNeighbors=function(e){var t,i,n,r,o,a,h,l,d=e.parent,c=e.x,u=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(c-t)/Math.max(Math.abs(c-t),1),r=(u-i)/Math.max(Math.abs(u-i),1),0!==n?(p.isWalkableAt(c,u-1)&&f.push([c,u-1]),p.isWalkableAt(c,u+1)&&f.push([c,u+1]),p.isWalkableAt(c+n,u)&&f.push([c+n,u])):0!==r&&(p.isWalkableAt(c-1,u)&&f.push([c-1,u]),p.isWalkableAt(c+1,u)&&f.push([c+1,u]),p.isWalkableAt(c,u+r)&&f.push([c,u+r]));else for(h=0,l=(o=p.getNeighbors(e,s.Never)).length;h<l;++h)a=o[h],f.push([a.x,a.y]);return f},e.exports=r},function(e,t,i){var n=i(12),s=i(2);function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,i,n){var s=this.grid,r=e-i,o=t-n;if(!s.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(s.getNodeAt(e,t).tested=!0),s.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(s.isWalkableAt(e-r,t+o)&&!s.isWalkableAt(e-r,t)||s.isWalkableAt(e+r,t-o)&&!s.isWalkableAt(e,t-o))return[e,t];if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(s.isWalkableAt(e+r,t+1)&&!s.isWalkableAt(e,t+1)||s.isWalkableAt(e+r,t-1)&&!s.isWalkableAt(e,t-1))return[e,t]}else if(s.isWalkableAt(e+1,t+o)&&!s.isWalkableAt(e+1,t)||s.isWalkableAt(e-1,t+o)&&!s.isWalkableAt(e-1,t))return[e,t];return this._jump(e+r,t+o,e,t)},r.prototype._findNeighbors=function(e){var t,i,n,r,o,a,h,l,d=e.parent,c=e.x,u=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(c-t)/Math.max(Math.abs(c-t),1),r=(u-i)/Math.max(Math.abs(u-i),1),0!==n&&0!==r?(p.isWalkableAt(c,u+r)&&f.push([c,u+r]),p.isWalkableAt(c+n,u)&&f.push([c+n,u]),p.isWalkableAt(c+n,u+r)&&f.push([c+n,u+r]),p.isWalkableAt(c-n,u)||f.push([c-n,u+r]),p.isWalkableAt(c,u-r)||f.push([c+n,u-r])):0===n?(p.isWalkableAt(c,u+r)&&f.push([c,u+r]),p.isWalkableAt(c+1,u)||f.push([c+1,u+r]),p.isWalkableAt(c-1,u)||f.push([c-1,u+r])):(p.isWalkableAt(c+n,u)&&f.push([c+n,u]),p.isWalkableAt(c,u+1)||f.push([c+n,u+1]),p.isWalkableAt(c,u-1)||f.push([c+n,u-1]));else for(h=0,l=(o=p.getNeighbors(e,s.Always)).length;h<l;++h)a=o[h],f.push([a.x,a.y]);return f},e.exports=r},function(e,t,i){var n=i(12),s=i(2);function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,i,n){var s=this.grid,r=e-i,o=t-n;if(!s.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(s.getNodeAt(e,t).tested=!0),s.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(s.isWalkableAt(e,t-1)&&!s.isWalkableAt(e-r,t-1)||s.isWalkableAt(e,t+1)&&!s.isWalkableAt(e-r,t+1))return[e,t]}else if(0!==o&&(s.isWalkableAt(e-1,t)&&!s.isWalkableAt(e-1,t-o)||s.isWalkableAt(e+1,t)&&!s.isWalkableAt(e+1,t-o)))return[e,t];return s.isWalkableAt(e+r,t)&&s.isWalkableAt(e,t+o)?this._jump(e+r,t+o,e,t):null},r.prototype._findNeighbors=function(e){var t,i,n,r,o,a,h,l,d,c=e.parent,u=e.x,p=e.y,f=this.grid,m=[];if(c){if(t=c.x,i=c.y,n=(u-t)/Math.max(Math.abs(u-t),1),r=(p-i)/Math.max(Math.abs(p-i),1),0!==n&&0!==r)f.isWalkableAt(u,p+r)&&m.push([u,p+r]),f.isWalkableAt(u+n,p)&&m.push([u+n,p]),f.isWalkableAt(u,p+r)&&f.isWalkableAt(u+n,p)&&m.push([u+n,p+r]);else if(0!==n){d=f.isWalkableAt(u+n,p);var g=f.isWalkableAt(u,p+1),y=f.isWalkableAt(u,p-1);d&&(m.push([u+n,p]),g&&m.push([u+n,p+1]),y&&m.push([u+n,p-1])),g&&m.push([u,p+1]),y&&m.push([u,p-1])}else if(0!==r){d=f.isWalkableAt(u,p+r);var v=f.isWalkableAt(u+1,p),C=f.isWalkableAt(u-1,p);d&&(m.push([u,p+r]),v&&m.push([u+1,p+r]),C&&m.push([u-1,p+r])),v&&m.push([u+1,p]),C&&m.push([u-1,p])}}else for(h=0,l=(o=f.getNeighbors(e,s.OnlyWhenNoObstacles)).length;h<l;++h)a=o[h],m.push([a.x,a.y]);return m},e.exports=r},function(e,t,i){var n=i(12),s=i(2);function r(e){n.call(this,e)}r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(e,t,i,n){var s=this.grid,r=e-i,o=t-n;if(!s.isWalkableAt(e,t))return null;if(!0===this.trackJumpRecursion&&(s.getNodeAt(e,t).tested=!0),s.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==r&&0!==o){if(s.isWalkableAt(e-r,t+o)&&!s.isWalkableAt(e-r,t)||s.isWalkableAt(e+r,t-o)&&!s.isWalkableAt(e,t-o))return[e,t];if(this._jump(e+r,t,e,t)||this._jump(e,t+o,e,t))return[e,t]}else if(0!==r){if(s.isWalkableAt(e+r,t+1)&&!s.isWalkableAt(e,t+1)||s.isWalkableAt(e+r,t-1)&&!s.isWalkableAt(e,t-1))return[e,t]}else if(s.isWalkableAt(e+1,t+o)&&!s.isWalkableAt(e+1,t)||s.isWalkableAt(e-1,t+o)&&!s.isWalkableAt(e-1,t))return[e,t];return s.isWalkableAt(e+r,t)||s.isWalkableAt(e,t+o)?this._jump(e+r,t+o,e,t):null},r.prototype._findNeighbors=function(e){var t,i,n,r,o,a,h,l,d=e.parent,c=e.x,u=e.y,p=this.grid,f=[];if(d)t=d.x,i=d.y,n=(c-t)/Math.max(Math.abs(c-t),1),r=(u-i)/Math.max(Math.abs(u-i),1),0!==n&&0!==r?(p.isWalkableAt(c,u+r)&&f.push([c,u+r]),p.isWalkableAt(c+n,u)&&f.push([c+n,u]),(p.isWalkableAt(c,u+r)||p.isWalkableAt(c+n,u))&&f.push([c+n,u+r]),!p.isWalkableAt(c-n,u)&&p.isWalkableAt(c,u+r)&&f.push([c-n,u+r]),!p.isWalkableAt(c,u-r)&&p.isWalkableAt(c+n,u)&&f.push([c+n,u-r])):0===n?p.isWalkableAt(c,u+r)&&(f.push([c,u+r]),p.isWalkableAt(c+1,u)||f.push([c+1,u+r]),p.isWalkableAt(c-1,u)||f.push([c-1,u+r])):p.isWalkableAt(c+n,u)&&(f.push([c+n,u]),p.isWalkableAt(c,u+1)||f.push([c+n,u+1]),p.isWalkableAt(c,u-1)||f.push([c+n,u-1]));else for(h=0,l=(o=p.getNeighbors(e,s.IfAtMostOneObstacle)).length;h<l;++h)a=o[h],f.push([a.x,a.y]);return f},e.exports=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardInputSystem=void 0;const n=i(1),s=i(0);class r extends s.ClientSystem{constructor(){super(n.SYSTEMS.INPUT),this.registeredInput=!1,this.trackedHotkeyIndexes=[],this.hotkeyArray=["Digit1","Digit2","Digit3","Digit4"],this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this)}onServerMessage(e){}onPeerMessage(e,t){}onLocalMessage(e){}iterateInput(e){const{state:t,changed:i}=e;for(let e in t)t[e]&&!this.clientInputComponent.playerInput[e]&&(this.clientInputComponent.playerInput[e]=t[e])}resetState(){["moveDown","moveUp","moveLeft","moveRight","inventory","grab","cancel","pause"].forEach(e=>{this.clientInputComponent.playerInput[e]=!1})}update(e){if(this.gameInput&&this.clientInputComponent){this.resetState();const{controller:e,keyboard:t}=this.gameInput.update();t&&this.iterateInput(t),e&&e[0]&&this.iterateInput(e[0])}}onClear(){throw new Error("Method not implemented.")}onInit(){this.gameInput=this.globals.gameInput}handleMouseMove(e){this.clientInputComponent.playerInput.mouseX=e.clientX,this.clientInputComponent.playerInput.mouseY=e.clientY}handleMouseDown(e){this.clientInputComponent.playerInput.mouseDown=!0}handleMouseUp(e){this.clientInputComponent.playerInput.mouseDown=!1}onEntityRemovedComponent(e,t){this.removeListeners()}removeListeners(){}onEntityAddedComponent(e,t){this.clientInputComponent=t,this.registerInputs()}registerInputs(){if(this.registeredInput)throw new Error("Already registered input.");let e;"undefined"!=typeof document&&null!==document?e=document:"undefined"!=typeof window&&null!==window&&(e=window),e.addEventListener("mousemove",this.handleMouseMove),e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("mouseup",this.handleMouseUp)}}t.KeyboardInputSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathfindingSystem=void 0;const n=i(1),s=i(0),r=i(4);class o extends s.ClientSystem{constructor(){super(n.SYSTEMS.PATHFINDING),this.isInitialized=!1,this.pathfindingPlugin={name:"pathfinding",type:"collision",tagAs:[n.COLLIDER_TAGS.blocking],onAddedColliderWithTagA:e=>{switch(r.resolveColliderType(e.shapeData)){case"polygon":this.globals.pathfinder.toggleBlockingPolygon(e.shapeData,!0);break;case"rect":this.globals.pathfinder.toggleBlockingRect(e.shapeData,!0)}}}}onEntityAddedComponent(e,t){}onInit(){this.globals.tileWorld.use(this.pathfindingPlugin)}onClear(){}onLocalMessage(e){}onPeerMessage(e,t){}onServerMessage(e){}update(e){}}t.PathfindingSystem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerAnimationSystem=t.DefaultPlayerColliders=void 0;const n=i(0),s=i(1),r=i(3);t.DefaultPlayerColliders=e=>[{layer:1,shapeData:{x:10,y:23,r:10},dynamic:!0,tags:e},{layer:1,shapeData:{x:-86,y:-86,w:192,h:192},tags:["sort"],dynamic:!0,data:{sortOffsetTop:15}}];class o extends n.ClientSystem{constructor(){super(s.SYSTEMS.PLAYER_ANIMATION),this.uninitComponents=[],this.readyEntities=[];const e=(e,t)=>{var i;if(e.gameObject.layerIndex===t.gameObject.layerIndex){const n=e.gameObject.delegatedSprite||e.gameObject,s=t.gameObject.delegatedSprite||t.gameObject,r=n.parent;if(r!==s.parent)throw new Error("Expected to be the same parents.");const o=r,a=o.children.indexOf(n),h=o.children.indexOf(s),l=(null===(i=e.data)||void 0===i?void 0:i.sortOffsetTop)||0;n.y+n.height/2+l>s.y+s.height?a<h&&r.setChildIndex(n,h):a>h&&r.setChildIndex(n,Math.max(h-1,0))}};this.sortCollisionPlugin={type:"collision",name:"sort",tagAs:[s.COLLIDER_TAGS.sort],tagBs:[s.COLLIDER_TAGS.tree_stump],onCollision(t,i){e(t,i)},onCollisionStart(t,i){e(t,i)}}}onClear(){}onLocalMessage(e){}onServerMessage(e){}onInit(){this.globals.tileWorld.use(this.sortCollisionPlugin)}onEntityAddedComponent(e,i){if(!e.hasComponent(s.SYSTEMS.PLAYER_MOVEMENT)&&!e.hasComponent(s.SYSTEMS.NPC_MOVEMENT))throw console.error(e),new Error("Expected entity to have a player movement component added before the player animation component.");this.uninitComponents.push(i),e.once("skeleton-ready",n=>{this.uninitComponents=this.uninitComponents.filter(e=>e!==i),this.readyEntities.push(e);const o=e.getComponent(s.SYSTEMS.POSITION).getPosition();n.x=o.x,n.y=o.y;const a=[];let h;e.type===r.EntityTypes.ClientPlayer?(a.push("client_player","player"),(h=t.DefaultPlayerColliders(a)).push({layer:1,shapeData:{x:10,y:18,r:40},dynamic:!0,tags:[s.COLLIDER_TAGS.client_player_bug_detector]})):e.type===r.EntityTypes.NPC&&(a.push(s.COLLIDER_TAGS.npc),h=t.DefaultPlayerColliders(a)),e.gameObject=this.globals.tileWorld.addGameObject({sprite:n,layer:1,colliders:h}),e.gameObject.entity=e,e.emit("gameobject-ready",e.gameObject)}),i.initSkeleton(this.globals.gottimation)}onEntityRemovedComponent(e,t){t.isReady()?(e.gameObject.removeFromMap(),delete e.gameObject.entity,delete e.gameObject,this.readyEntities=this.readyEntities.filter(t=>t!==e)):this.uninitComponents=this.uninitComponents.filter(e=>e!==t)}update(e){const t=1e3*e;for(let e=0;e<this.readyEntities.length;e++){const i=this.getSystemComponent(this.readyEntities[e]);if(this.readyEntities[e].hasComponent(s.SYSTEMS.PLAYER_MOVEMENT)){const n=this.readyEntities[e].getComponent(s.SYSTEMS.PLAYER_ACTION);i.updateAnimation(t,n)}else i.skeleton.update(t)}}onPeerMessage(e,t){}}t.PlayerAnimationSystem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerMovementSystem=void 0;const n=i(0),s=i(3),r=i(1),o={north:{x:0,y:0},south:{x:0,y:25},west:{x:-10,y:17},east:{x:10,y:17}};class a extends n.ClientSystem{constructor(){super(r.SYSTEMS.PLAYER_MOVEMENT),this.remotePlayers=[],this.npcPlayers=[]}onClear(){}onLocalMessage(e){}onServerMessage(e){}onEntityAddedComponent(e,t){if(!e.hasComponent(r.SYSTEMS.POSITION))throw new Error("Entities added with a player movement component should have a position component added first always.");if(e.type===s.EntityTypes.ClientPlayer){this.clientPlayer=e;const t=this.clientPlayer.getPosition();this.aheadOfPlayerGameObject=this.globals.tileWorld.addGameObject({texture:PIXI.Texture.EMPTY,position:Object.assign({},t),layer:1,colliders:[{layer:2,dynamic:!0,shapeData:{x:0,y:0,w:20,h:20},tags:[r.COLLIDER_TAGS.in_front_of_client_player]}]})}else if(e.type===s.EntityTypes.RemotePlayer)this.remotePlayers.push(e);else{if(e.type!==s.EntityTypes.NPC)throw console.error(e),new Error(`Unexpected entity: ${e.id} had a player movement entity`);this.npcPlayers.push(e)}}getAheadOfPlayerPosition(){const{x:e,y:t,w:i,h:n}=this.aheadOfPlayerGameObject.colliders[0].shapeData;return{x:e+i/2,y:t+n/2}}onEntityRemovedComponent(e,t){if(e.type===s.EntityTypes.ClientPlayer){if(this.clientPlayer&&e!==this.clientPlayer)throw new Error("Unexpected entity marked as client losing component.");this.clientPlayer=null}else if(e.type===s.EntityTypes.RemotePlayer)this.remotePlayers=this.remotePlayers.filter(t=>t!==e);else{if(e.type!==s.EntityTypes.NPC)throw console.error(e),new Error(`Unexpected entity: ${e.id} had a player movement entity`);this.npcPlayers=this.npcPlayers.filter(t=>t!==e)}}getVelocitiesFromInput(e,t){const i={x:0,y:0};return t.moveDown?(i.y+=e,i):t.moveUp?(i.y-=e,i):t.moveLeft?(i.x-=e,i):t.moveRight?(i.x+=e,i):i}onInit(){this.addApi(this.getAheadOfPlayerPosition)}update(e){var t;if(this.clientPlayer&&!this.$api.isInventoryOpen()&&!this.$api.isInDialogue()){const i=this.getSystemComponent(this.clientPlayer),n=this.clientPlayer.getComponent(r.SYSTEMS.PLAYER_ACTION);if(null==n?void 0:n.action)return void i.setVelocities(0,0);let s=i.speed;const{x:a,y:h}=this.getVelocitiesFromInput(s,this.clientPlayer.playerInput);i.setVelocities(a,h);const l=a*e,d=h*e,c=this.clientPlayer.getComponent(r.SYSTEMS.POSITION);let u,p=c.getPosition();if((a||h)&&(p=c.setPositionByDeltas(l,d)),null!==i.movingDirection)u=o[i.movingDirection];else{const e=(null===(t=this.clientPlayer.getComponent(r.SYSTEMS.PLAYER_ANIMATION).skeleton)||void 0===t?void 0:t.direction)||this.clientPlayer.getComponent(r.SYSTEMS.GAME_STATE).data.direction;u=o[e]}this.aheadOfPlayerGameObject.setPosition(p.x+u.x,p.y+u.y),console.log("the ahead of player game object position became",this.aheadOfPlayerGameObject.worldX,this.aheadOfPlayerGameObject.worldY)}for(let t=0;t<this.npcPlayers.length;t++){this.npcPlayers[t].getComponent(r.SYSTEMS.NPC_MOVEMENT).updateMovement(e)}}onPeerMessage(e,t){}}t.PlayerMovementSystem=a},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerManagerSystem=void 0;const s=i(0),r=i(1),o=i(111);class a extends s.ClientSystem{constructor(){super(r.SYSTEMS.PLAYER_MANAGER)}onClear(){}onStart(){return n(this,void 0,void 0,(function*(){this.createInitialClientPlayer()}))}createInitialClientPlayer(){this.globals.clientPlayer=this.initializeEntity(new o.ClientPlayer,this.globals.gameStateData),this.dispatchAllLocal({type:r.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED,data:this.globals.clientPlayer})}onLocalMessage(e){}onPeerMessage(e,t){}onServerMessage(e){}update(e){}}t.PlayerManagerSystem=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientPlayer=void 0;const n=i(0),s=i(3),r=i(112),o=i(113),a=i(13),h=i(114),l=i(115),d=i(116),c=i(117),u=i(118);class p extends n.Entity{constructor(){super(1,s.EntityTypes.ClientPlayer),this.action="idle",this.playerInput={action:!1,hotkeyIndex:-1,mouseX:0,mouseY:0,mouseDown:!1,aimAngle:0,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1,inventory:!1,grab:!1,sprint:!1,cancel:!1}}initialize(e){this.addComponent(new c.GameStateComponent(e)),this.addComponent(new r.InputComponent(this.playerInput)),this.addComponent(new a.Position(e.position.x,e.position.y)),this.addComponent(new o.PlayerMovementComponent(s.GameValues.PlayerSpeed)),this.addComponent(new h.PlayerAnimationComponent("player")),this.addComponent(new l.PlayerActionComponent),this.addComponent(new d.InventoryComponent),this.addComponent(new u.BugCatchComponent)}}t.ClientPlayer=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e){super(s.SYSTEMS.INPUT),this.playerInput=e}}t.InputComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerMovementComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e){super(s.SYSTEMS.PLAYER_MOVEMENT),this.lookingDirection="south",this.velocityX=0,this.velocityY=0,this.speed=e}onAdded(e){}get isSprinting(){return Math.abs(this.velocityX)>this.speed||Math.abs(this.velocityY)>this.speed}setVelocities(e,t){this.velocityX=e,this.velocityY=t}get movingDirection(){return 0!=this.velocityX?this.velocityX>0?"east":"west":0!=this.velocityY?this.velocityY>0?"south":"north":null}}t.PlayerMovementComponent=r},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{h(n.next(e))}catch(e){r(e)}}function a(e){try{h(n.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerAnimationComponent=void 0;const s=i(1),r=i(0),o=i(3);class a extends r.Component{constructor(e){super(s.SYSTEMS.PLAYER_ANIMATION),this.skeletonName=e||"default"}initSkeleton(e,t){return n(this,void 0,void 0,(function*(){return t=t||"south",this.skeleton=yield e.createSkeleton(this.skeletonName,{direction:t}),yield this.skeleton.setSkins([{atlasName:"player",skinName:"default.png"}]),setTimeout(()=>{},5e3),this.emit("skeleton-ready",this.skeleton),this.skeleton}))}resolveAniName(e,t){return t?`${e}_${t}`:e}canPlayActionAnimation(){return!!this.skeleton&&(this.skeleton.baseTrack.currentAction.includes("walk")||this.skeleton.baseTrack.currentAction.includes("idle"))}updateAnimation(e,t){const i=t.actionAttachment;if(t&&t.action)this.skeleton.direction=t.actionDirection||this.skeleton.direction;else if(null!==this.playerMovementComponent.movingDirection){this.skeleton.direction=this.playerMovementComponent.movingDirection;const e=this.resolveAniName("walk",i);(this.skeleton.baseTrack.currentAction!==e||this.skeleton.baseTrack.stopped)&&this.skeleton.play(e,null,{loop:!0})}else(this.skeleton.baseTrack.currentAction&&this.skeleton.baseTrack.currentAction.includes("walk")||!this.skeleton.baseTrack.stopped)&&this.skeleton.stop();this.skeleton.update(e)}isReady(){return!!this.skeleton}onAdded(e){if(this.entity=e,this.playerMovementComponent=e.getComponent(s.SYSTEMS.PLAYER_MOVEMENT),e.type==o.EntityTypes.ClientPlayer&&!this.playerMovementComponent)throw new Error("Expected a player movement componnet.")}}t.PlayerAnimationComponent=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerActionComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(){super(s.SYSTEMS.PLAYER_ACTION),this.repeatingAction=!1}startAction(e,t,i){console.error("starting action",e),this.action&&this.stopAction(),this.action=e,this.actionDirection=t,this.repeatingAction=!!i,this.emit("start-action",{action:e,direction:t})}stopAction(){const e=this.action,t=this.actionDirection;this.action=null,this.actionDirection=null,this.emit("stop-action",{action:e,direction:t})}}t.PlayerActionComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InventoryComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(){super(s.SYSTEMS.INVENTORY),this.itemsByName={}}addItem(e,t){return this.emit("added-item",{itemName:e,data:t}),e in this.itemsByName?this.itemsByName[e]++:this.itemsByName[e]=1,!0}}t.InventoryComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameStateComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e){super(s.SYSTEMS.GAME_STATE),this.data=e}save(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{this.saveTimeout=null,this.persistSave()},1500)}persistSave(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=null,"undefined"!=typeof localStorage&&localStorage.setItem("game-state",JSON.stringify(this.data))}onRemoved(e){this.persistSave()}}t.GameStateComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugCatchComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(){super(s.SYSTEMS.BUG_CATCH)}}t.BugCatchComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerActionSystem=void 0;const n=i(0),s=i(1);class r extends n.ClientSystem{constructor(){super(s.SYSTEMS.PLAYER_ACTION)}onInit(){}onClear(){}makeToolUi(){}repositionToolUI(){}onStart(){}onStop(){}onPeerMessage(e,t){}onServerMessage(e){}onEntityAddedComponent(e,t){this.clientPlayerComponent=t}update(e){this.globals.clientPlayer}handlePlayerEquipItem(e){this.clientPlayerComponent.actionAttachment="net"===e||"shovel"===e||"axe"===e?e:null}onLocalMessage(e){switch(e.type){case s.MESSAGES.USE_ITEM:this.handlePlayerEquipItem(e.data)}}}t.PlayerActionSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimerSystem=void 0;const n=i(0),s=i(121),r=i(1);class o extends n.ClientSystem{constructor(){super(r.SYSTEMS.TIMER),this.elapsedDaylightTime=0,this.fullDays=0,this.hoursPassed=0,this.secondsPerHour=s.CONFIG_CONSTANTS.SECONDS_PER_HOUR,this.nextHourTime=s.CONFIG_CONSTANTS.SECONDS_PER_HOUR,this.secondsPerDay=24*s.CONFIG_CONSTANTS.SECONDS_PER_HOUR,this.totalElapsedTime=null,this.isChecking=!1}onClear(){}onLocalMessage(e){switch(e.type){case r.MESSAGES.START_TIMERS:this.handleStartTimers(e.data)}}calculateGameTime(e){return{hours:1,days:1,seconds:1}}handleStartTimers(e){this.totalElapsedTime=e||0}onPeerMessage(e,t){}onServerMessage(e){}update(e){var t;(null===(t=this.globals.tileWorld.loadedMap)||void 0===t?void 0:t.initialized)&&!this.globals.tileWorld.isLoading&&null!==this.totalElapsedTime&&(this.totalElapsedTime+=e,this.elapsedDaylightTime+=1e3*e,this.elapsedDaylightTime>this.secondsPerDay?(this.fullDays++,this.hoursPassed=0,this.elapsedDaylightTime=0,this.nextHourTime=this.secondsPerHour,this.dispatchAllLocal({type:"day-ended",data:this.fullDays})):this.elapsedDaylightTime>this.nextHourTime&&(this.hoursPassed++,this.nextHourTime+=this.secondsPerHour,this.dispatchAllLocal({type:"hour-ended",data:this.hoursPassed})))}}t.TimerSystem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFIG_CONSTANTS=void 0,t.CONFIG_CONSTANTS={HUNGER_DECREASE_PER_HOUR:1,HUNGER_MAX:10,SECONDS_PER_HOUR:6}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSystem=void 0;const n=i(0),s=i(123),r=i(1),o=i(6),a=i(4);class h extends n.ClientSystem{constructor(){super(r.SYSTEMS.TREE),this.addedTrees=!1,this.treeSeq=0,this.treeColliders=[],this.trees=[],this.currentChoppingTrees=[],this.inPlayerRangeTrees=[],this.treeSpawnCollisionPlugin={name:"tree",type:"collision",tagAs:[r.COLLIDER_TAGS.tree],onAddedColliderWithTagA:e=>{this.treeColliders.push(e.shapeData)}},this.treeChopCollisionPlugin={name:"tree_chop",type:"collision",tagAs:[r.COLLIDER_TAGS.tree_stump],tagBs:[r.COLLIDER_TAGS.client_player],onCollisionStart:(e,t)=>{if(!e.data.entity)throw new Error("Expected an entity object in treeCollider.data");const i=e.data.entity;if(this.inPlayerRangeTrees.includes(i))throw new Error("Already included.");this.inPlayerRangeTrees.push(i)},onCollisionEnd:(e,t)=>{if(!e.data.entity)throw new Error("Expected an entity object in treeCollider.data");const i=e.data.entity;if(!this.inPlayerRangeTrees.includes(i))throw new Error("Should have been included.");this.inPlayerRangeTrees=this.inPlayerRangeTrees.filter(e=>e!==i)}}}onClear(){}onInit(){this.globals.tileWorld.use(this.treeSpawnCollisionPlugin),this.globals.tileWorld.use(this.treeChopCollisionPlugin),this.globals.tileWorld.onMapCreated(()=>{if(0===this.treeSeq)for(let e=0;e<50;e++)this.spawnRandomTree()})}getNextTreeSpawn(){const e=o.getRandomItemFromArray(this.treeColliders);let t;switch(a.resolveColliderType(e)){case"polygon":t=o.getRandomPositionFromPolygon(e);break;case"rect":t=o.getRandomPositionFromRect(e)}return t}spawnTree(e,t){const i=new s.Tree(++this.treeSeq);this.initializeEntity(i,{position:t,treeTypeIndex:e})}spawnRandomTree(){const e=this.getNextTreeSpawn(),t=new s.Tree(++this.treeSeq),i=o.getRandomNumber(0,this.globals.treeTextures.length-1);this.initializeEntity(t,{position:e,treeTypeIndex:i})}onLocalMessage(e){switch(e.type){case r.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED:this.globals.clientPlayer.on("start-action",({action:e,direction:t})=>{var i;if("swing"===e){const e=null===(i=this.inPlayerRangeTrees[0])||void 0===i?void 0:i.treeGameObject;if(e&&1===this.inPlayerRangeTrees.length&&(e.__tempchopcount?e.__tempchopcount++:e.__tempchopcount=1,3===e.__tempchopcount)){const t=e.delegatedSprite||e;if(t.visible){for(let t=0;t<5;t++)this.$api.dropItem("log",e.worldX+o.getRandomNumber(0,50),e.worldY+o.getRandomNumber(0,50));t.visible=!1}}}})}}onPeerMessage(e,t){}onEntityAddedComponent(e,t){this.trees.push(e);const i=this.globals.treeTextures[t.treeType];if(!i)throw new Error(`Invalid tree type: ${t.treeType}`);const n=e.getComponent(r.SYSTEMS.POSITION).getPosition();let s=0;s=i.shadow.width>i.tree.width?(i.shadow.width-i.tree.width)/2:(i.tree.width-i.shadow.width)/2;const o=i.tree.height-i.shadow.height/2,a=new PIXI.Container;a.x=n.x,a.y=n.y,a.treeContainer=!0;const h=new PIXI.Sprite(i.shadow);h.alpha=.5;const l=new PIXI.Sprite(i.tree);a.addChild(h),a.addChild(l),h.x=s,h.y=o,e.treeGameObject=this.globals.tileWorld.addGameObject({position:n,sprite:a,layer:1,colliders:[{dynamic:!1,layer:1,shapeData:{x:l.width/2-10,y:l.height-20,w:20,h:20},tags:["tree_stump","blocking"]}]});const d=e.treeGameObject.colliders[0];e.treeGameObject.entity=e,d.data=d.data||{},d.data.entity=e,this.addedTrees=!0,this.treeLayer||(this.treeLayer=a.parent)}onEntityRemovedComponent(e,t){var i;e.treeGameObject&&(null===(i=e.treeGameObject.colliders)||void 0===i||i.forEach(e=>{e.data&&delete e.data.entity}),e.treeGameObject.removeFromMap(),delete e.treeGameObject.entity),this.trees=this.trees.filter(t=>t!==e)}onServerMessage(e){}update(e){this.addedTrees&&(this.treeLayer.children.sort((e,t)=>e.treeContainer&&t.treeContainer?e.y+e.height-(t.y+t.height):0),this.addedTrees=!1)}}t.TreeSystem=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;const n=i(0),s=i(124),r=i(13);class o extends n.Entity{constructor(e){super(e,"tree")}initialize(e){this.addComponent(new r.Position(e.position.x,e.position.y)),this.addComponent(new s.TreeComponent(e.treeTypeIndex))}}t.Tree=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e){super(s.SYSTEMS.TREE),this.treeType=e}}t.TreeComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LevelSystem=void 0;const n=i(0),s=i(1),r=3,o=20;class a extends n.ClientSystem{constructor(){super(s.SYSTEMS.LEVEL)}onClear(){}onLocalMessage(e){switch(e.type){case s.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED:this.clientPositionComponent=this.globals.clientPlayer.getComponent(s.SYSTEMS.POSITION),this.globals.tileWorld.bindCameraCenter(this.clientPositionComponent.getPosition(),{x:r,y:o}),setTimeout(()=>{this.globals.fadeIn()},100)}}onServerMessage(e){}onStart(){}onEntityAddedComponent(e,t){}onEntityRemovedComponent(e,t){}update(e){var t;(null===(t=this.globals.tileWorld.loadedMap)||void 0===t?void 0:t.initialized)&&!this.globals.tileWorld.isLoading&&this.globals.tileWorld.update(e)}onPeerMessage(e,t){}}t.LevelSystem=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InventorySystem=void 0;const n=i(0),s=i(1),r=i(3);class o extends PIXI.Container{constructor(){super(),this.bg=new PIXI.Sprite(PIXI.Texture.EMPTY),this.itemSprite=new PIXI.Sprite(PIXI.Texture.EMPTY),this.quantityText=new PIXI.extras.BitmapText("",{font:"ns-small"}),this.itemName=null,this._quantity=0,this.addChild(this.bg),this.addChild(this.itemSprite),this.addChild(this.quantityText)}get quantity(){return this._quantity}set quantity(e){this.quantityText.text=e&&e>1?`${e}`:""}}const a=8,h=2;class l extends n.ClientSystem{constructor(){super(s.SYSTEMS.INVENTORY),this.inventoryContainer=new PIXI.Container,this.inventorySlots=[],this.curSelectedIndex=0,this.itemMenuContainer=new PIXI.Container,this.timeSinceInventoryToggled=1,this.timeSinceInventoryAction=1,this.inventoryPointer=new PIXI.Sprite,this.recenterInterface=this.recenterInterface.bind(this),this.inventoryContainer.visible=!1,this.itemMenuContainer.visible=!1}get isOpen(){return this.inventoryContainer.visible}isInventoryOpen(){return this.inventoryContainer.visible}get isItemMenuOpen(){return this.itemMenuContainer.visible}onClear(){}addItem(e,t){if(t<0)throw new Error("Use positive values for addItem api, if you want to remove items use removeItem, also with a positive value.");if(!this.clientPlayer)throw new Error("No player initialized.");let i=-1;for(let n=0;n<this.inventorySlots.length;n++)if(this.inventorySlots[n].itemName||(i=n),this.inventorySlots[n].itemName===e){const i=this.inventorySlots[n].quantity+t,r={type:"update",name:e,quantity:t};return this.updateInventorySlot(n,e,i),this.globals.clientPlayer.emit(s.PLAYER_EVENTS.INVENTORY_CHANGE,r),{success:!0}}if(i>-1){this.updateInventorySlot(i,e,t);const n={type:"add",name:e,quantity:t,index:i};this.globals.clientPlayer.emit(s.PLAYER_EVENTS.INVENTORY_CHANGE,n)}return{success:!1,error:"No room in inventory"}}removeItem(e,t){if(t<0)throw new Error("Use positive values for removeItem api.");if(!this.clientPlayer)throw new Error("No player initialized.");for(let i=0;i<this.inventorySlots.length;i++)if(this.inventorySlots[i].itemName===e){const n=this.inventorySlots[i].quantity-t;if(n<=0){this.removeInventorySlot(i);const n={type:"remove",name:e,index:i,quantity:t};return this.globals.clientPlayer.emit(s.PLAYER_EVENTS.INVENTORY_CHANGE,n),{success:!0}}{this.updateInventorySlot(i,e,n);const r={type:"update",name:e,index:i,quantity:-t};return this.globals.clientPlayer.emit(s.PLAYER_EVENTS.INVENTORY_CHANGE,r),{success:!0}}}return{success:!1,error:"No room in inventory"}}initInventoryFromGameState(e){e.inventory.forEach(({index:e,name:t,quantity:i})=>{this.updateInventorySlot(e,t,i)})}onLocalMessage(e){switch(e.type){case s.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED:this.clientPlayer=e.data,this.initInventoryFromGameState(this.clientPlayer.getComponent(s.SYSTEMS.GAME_STATE).data)}}onStart(){this.inventoryTextures=this.globals.gameTextures.inventory,this.itemIconTextures=this.globals.gameTextures.items.icons,this.inventoryPointer=new PIXI.Sprite,this.backgroundSprite=new PIXI.Sprite(this.inventoryTextures.background),this.inventoryContainer.addChild(this.backgroundSprite);const e=this.inventoryTextures.background.width/a,t=this.inventoryTextures.background.height/h;for(let i=0;i<h;i++)for(let n=0;n<a;n++){const s=new o;s.x=n*e,s.y=i*t,s.bg.texture=this.inventoryTextures.item.emptyBackground,this.inventoryContainer.addChild(s),this.inventorySlots.push(s)}[{name:"Drop",handler:(e,t)=>{this.removeItem(e,t)}}].forEach(({name:e,handler:t},i)=>{const n=new PIXI.Container;n.addChild(new PIXI.Sprite),n.addChild(new PIXI.extras.BitmapText(e,{font:"ns-small"})),n.handler=t,this.itemMenuContainer.addChild(n),n.y=i*this.inventoryTextures.contextMenu.selectedBackground.height}),this.inventoryContainer.addChild(this.itemMenuContainer),this.inventoryContainer.addChild(this.inventoryPointer),this.addApi(this.removeItem),this.addApi(this.addItem),this.addApi(this.isInventoryOpen),this.setSelectedItemSlot(0),this.globals.tileWorld.interfaceManager.addChild(this.inventoryContainer),this.recenterInterface(),"undefined"!=typeof window?window.addEventListener("resize",this.recenterInterface):"undefined"!=typeof document&&document.addEventListener("resize",this.recenterInterface)}removeInventorySlot(e){this.inventorySlots[e].itemName&&(this.inventorySlots[e].bg.texture=PIXI.Texture.EMPTY,this.inventorySlots[e].itemSprite.texture=PIXI.Texture.EMPTY,this.inventorySlots[e].quantity=0,this.inventorySlots[e].itemName=null)}updateInventorySlot(e,t,i){this.removeInventorySlot(e);const n=this.inventorySlots[e];n.itemName=t;const s=this.itemIconTextures[t];n.itemSprite.texture=s,n.quantity=i}setSelectedItemSlot(e){this.inventorySlots[this.curSelectedIndex].bg.texture=this.inventoryTextures.item.emptyBackground,this.isItemMenuOpen&&this.hideItemOptions(),this.curSelectedIndex=e,this.inventorySlots[e].bg.texture=this.inventoryTextures.item.selectedBackground,this.inventoryPointer.texture=this.inventoryTextures.item.pointer,this.inventoryPointer.x=this.inventorySlots[e].x;const t=this.inventoryTextures.background.height/h;this.inventoryPointer.y=this.inventorySlots[e].y+(t-2)}toggleInventory(e){this.inventoryContainer.visible=e,this.inventoryPointer.texture=this.inventoryTextures.item.pointer,this.inventoryPointer.visible=e,this.timeSinceInventoryToggled=0,e||(this.itemMenuContainer.visible=!1)}onEntityAddedComponent(e,t){if(e.type!==r.EntityTypes.ClientPlayer)throw new Error("Only expected inventory component to be added to client player.");e.on("added-item",({itemName:e,data:t})=>{console.log("HANDLING ADD ITEM TO INVENTORY ",e,t)})}onPeerMessage(e,t){}onServerMessage(e){}get inventoryToggleIsCoolingDown(){return this.timeSinceInventoryToggled<.3}get inventoryActionIsCoolingDown(){return this.timeSinceInventoryAction<.3}canDoInventoryInputAction(e){return!(this.inventoryToggleIsCoolingDown||this.inventoryActionIsCoolingDown&&this.previousInput[e])}getValidMoveTo(e){const{moveUp:t,moveDown:i,moveLeft:n,moveRight:s}=e;if(t||i||n||s){if(t&&this.canDoInventoryInputAction("moveUp")||i&&this.canDoInventoryInputAction("moveDown"))return this.curSelectedIndex<a?this.curSelectedIndex+a:this.curSelectedIndex-a;if(n&&this.canDoInventoryInputAction("moveLeft"))return this.curSelectedIndex%a==0?this.curSelectedIndex+(a-1):this.curSelectedIndex-1;if(s&&this.canDoInventoryInputAction("moveRight"))return(this.curSelectedIndex+1)%a==0?this.curSelectedIndex-(a-1):this.curSelectedIndex+1}return-1}get currentSelectedItemData(){const{itemName:e,quantity:t}=this.inventorySlots[this.curSelectedIndex];return e?{globalData:this.globals.itemData[e],inventoryData:{index:this.curSelectedIndex,name:e,quantity:t}}:null}showItemOptions(){return!!this.currentSelectedItemData&&(this.itemMenuContainer.visible=!0,this.setCurrentSelectedItemOption(0),!0)}hideItemOptions(){this.itemMenuContainer.visible=!1,this.setSelectedItemSlot(this.curSelectedIndex)}setCurrentSelectedItemOption(e){this.currentSelectedItemOptionIndex=e,this.itemMenuContainer.children.forEach((t,i)=>{i===e&&(this.inventoryPointer.texture=this.inventoryTextures.contextMenu.pointer,this.inventoryPointer.x=this.itemMenuContainer.x-this.inventoryPointer.width-2,t.children[0].texture=i===e?this.inventoryTextures.contextMenu.selectedBackground:null)})}get currentSelectedItemOptionText(){return this.itemMenuContainer.visible?this.itemMenuContainer.children[this.currentSelectedItemOptionIndex].children[1].text:null}recenterInterface(){const e=this.globals.renderer.screen.width,t=this.globals.renderer.screen.height;this.inventoryContainer.x=e/2-this.inventoryTextures.background.width/2,this.inventoryContainer.y=t/2-this.inventoryTextures.background.height/2}doMoveSelectedItemOption(e,t){t?this.currentSelectedItemOptionIndex===this.currentSelectedItemOptions.length-1?this.setCurrentSelectedItemOption(0):this.setCurrentSelectedItemOption(this.currentSelectedItemOptionIndex+1):e&&(0===this.currentSelectedItemOptionIndex?this.setCurrentSelectedItemOption(this.currentSelectedItemOptions.length-1):this.setCurrentSelectedItemOption(this.currentSelectedItemOptionIndex+1))}onStop(){"undefined"!=typeof window?window.removeEventListener("resize",this.recenterInterface):"undefined"!=typeof document&&document.removeEventListener("resize",this.recenterInterface)}doCurrentSelectedItemOption(){}update(e){if(!this.clientPlayer)return;const{inventory:t,grab:i,moveDown:n,moveUp:s,cancel:r,escape:o}=this.clientPlayer.playerInput;if(this.timeSinceInventoryToggled+=e,t&&!this.inventoryToggleIsCoolingDown&&this.toggleInventory(!this.isOpen),this.timeSinceInventoryAction+=e,this.isItemMenuOpen)i&&this.canDoInventoryInputAction("grab")?(this.doCurrentSelectedItemOption(),this.timeSinceInventoryAction=0):n&&this.canDoInventoryInputAction("moveDown")||s&&this.canDoInventoryInputAction("moveUp")?(this.doMoveSelectedItemOption(s&&this.canDoInventoryInputAction("moveUp"),n&&this.canDoInventoryInputAction("moveDown")),this.timeSinceInventoryAction=0):r&&this.canDoInventoryInputAction("cancel")&&(this.itemMenuContainer.visible=!1,this.timeSinceInventoryAction=0);else if(this.isOpen){const e=this.getValidMoveTo(this.clientPlayer.playerInput);if(e>-1)this.setSelectedItemSlot(e),this.timeSinceInventoryAction=0;else if(i&&this.canDoInventoryInputAction("grab")){this.showItemOptions()&&(this.timeSinceInventoryAction=0)}else r&&this.canDoInventoryInputAction("cancel")&&(this.toggleInventory(!1),this.timeSinceInventoryAction=0)}this.previousInput=Object.assign({},this.clientPlayer.playerInput)}}t.InventorySystem=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemDropSystem=void 0;const n=i(1),s=i(0),r=i(128);class o extends s.ClientSystem{constructor(){super(n.SYSTEMS.ITEM_DROP),this.droppedItemSeq=0,this.droppedItems=[],this.itemsToPickup=[];const e=(e,t)=>{if(e.gameObject.entity!==this.globals.clientPlayer)throw new Error("Expected colliderA's gameObject to have a entity prop link to the global client player.");const i=t.gameObject.entity;if(!i)throw new Error("Expected colBs gameObject data to have itemData on it.");if(!this.droppedItems.includes(i))throw new Error("Expected to be in array.");this.itemsToPickup.includes(i)||this.itemsToPickup.push(i)};this.droppedItemCollisionPlugin={type:"collision",name:"inventory",tagAs:[n.COLLIDER_TAGS.in_front_of_client_player],tagBs:[n.COLLIDER_TAGS.dropped_item],onCollisionStart:e,onCollision:e,onAfterCollisions:()=>{const e=this.itemsToPickup.pop();if(e&&this.globals.clientPlayer.playerInput.grab){const t=this.globals.clientPlayer.getComponent(n.SYSTEMS.INVENTORY),i=this.getSystemComponent(e);t.addItem(i.itemName,i.itemData)&&this.destroyEntity(e)}this.itemsToPickup.length=0}}}onClear(){}onLocalMessage(e){}onInit(){this.globals.tileWorld.use(this.droppedItemCollisionPlugin),this.addApi(this.dropItem)}dropItemFromPlayer(e){this.globals.clientPlayer.getPosition(),this.globals.clientPlayer.getComponent(n.SYSTEMS.PLAYER_ANIMATION).skeleton.direction}dropItem(e,t,i,s){const o=this.globals.gameTextures.items.placed[e];if(!o)throw new Error(`No texture found with item name: ${e}`);const a=this.globals.tileWorld.addGameObject({texture:o,position:{x:t,y:i},layer:1,colliders:[{dynamic:!0,layer:1,shapeData:{x:0,y:0,w:o.width,h:o.height},tags:[n.COLLIDER_TAGS.dropped_item]}]}),h=new r.DroppedItem(this.$api.getUid());h.gameObject=a,a.entity=h,this.dispatchLocal({to:[n.SYSTEMS.GAME_STATE],type:n.MESSAGES.DROP_ITEM,data:{level:"island",data:{uid:h.id,name:e,x:t,y:i}}}),this.initializeEntity(h,{gameObject:a,itemName:e}),s&&(h.destroyTimeout=setTimeout(()=>{delete h.destroyTimeout,this.destroyEntity(h)},s))}onEntityAddedComponent(e,t){this.droppedItems.push(e)}onEntityRemovedComponent(e,t){e.destroyTimeout&&(clearTimeout(e.destroyTimeout),delete e.destroyTimeout),e.gameObject&&(e.gameObject.removeFromMap(),delete e.gameObject.entity,delete e.gameObject),this.droppedItems=this.droppedItems.filter(t=>t!==e)}onPeerMessage(e,t){}onServerMessage(e){}update(e){}}t.ItemDropSystem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DroppedItem=void 0;const n=i(0),s=i(3),r=i(41);class o extends n.Entity{constructor(e){super(e,s.EntityTypes.DroppedItem)}initialize(e){this.gameObject=e.gameObject,this.gameObject.entity=this,this.addComponent(new r.ItemDropComponent(e.itemName))}}t.DroppedItem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialogueSystem=void 0;const n=i(1),s=i(0);class r extends s.ClientSystem{constructor(){super(n.SYSTEMS.DIALOGUE),this.container=new PIXI.Container,this.backgroundSprite=new PIXI.Sprite,this.responseContainer=new PIXI.Container,this.responsePointer=new PIXI.Sprite,this.responseBackground=new PIXI.Sprite,this.continueBtn=new PIXI.Graphics,this.curResponseOptions=[]}onClear(){}onLocalMessage(e){}onPeerMessage(e,t){}onInit(){this.addApi(this.isInDialogue)}playDialogue(e){this.container.visible=!0}onStart(){this.backgroundSprite.texture=this.globals.gameTextures.dialogue.npc.diaglogueBackground,this.container.addChild(this.backgroundSprite),this.container.visible=!1,this.responseBackground.texture=this.globals.gameTextures.dialogue.response.background,this.responsePointer.texture=this.globals.gameTextures.dialogue.response.pointer,this.responseContainer.addChild(this.responseBackground),this.dialogueText=new PIXI.extras.BitmapText("",{font:"ns-small"}),this.responseContainer.addChild(this.dialogueText),this.responseContainer.addChild(this.continueBtn),this.continueBtn.x=this.backgroundSprite.texture.width/2-this.continueBtn.width/2,this.continueBtn.y=this.backgroundSprite.texture.height-(this.continueBtn.height+1)}displayDialogue(e,t){this.container.visible=!0}clearResponse(){this.curResponseOptions.forEach(e=>{e.destroy(!1)}),this.curResponseOptions.length=0,this.responseContainer.visible=!1}setSelectedResponse(e){var t;null===(t=this.responsePointer.parent)||void 0===t||t.removeChild(this.responsePointer);let i=-1;this.curResponseOptions.forEach((t,n)=>{n===e?(i=this.curResponseOptions[e].y,t.children[0].texture=this.globals.gameTextures.dialogue.response.selectedOptionBackground):t.children[0].texture=PIXI.Texture.EMPTY}),this.responseContainer.addChild(this.responsePointer),i>-1&&(this.responsePointer.y=i,this.responsePointer.x=-this.responsePointer.width)}get currentSelectedResponseOptionIndex(){if(!this.curResponseOptions.length)return-1;for(let e=0;e<this.curResponseOptions.length;e++)if(this.curResponseOptions[e].children[0].texture===this.globals.gameTextures.dialogue.response.selectedOptionBackground)return e;return-1}displayResponse(e){this.clearResponse(),e.forEach((e,t)=>{const i=new PIXI.Sprite,n=new PIXI.extras.BitmapText(e,{font:"ns-small"}),s=new PIXI.Container;s.addChild(i),s.addChild(n),this.curResponseOptions.push(s),s.y=t*this.globals.gameTextures.dialogue.response.selectedOptionBackground.height,this.responseContainer.addChild(s)}),this.setSelectedResponse(0)}isInDialogue(){return!!this.container.visible}onServerMessage(e){}update(e){}}t.DialogueSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NPCMovementSystem=void 0;const n=i(1),s=i(0);class r extends s.ClientSystem{constructor(){super(n.SYSTEMS.NPC_MOVEMENT),this.movingNPCs=[]}moveBaddy(e,t,i){const n=this.getSystemComponent(this.$api.findBaddy(e));n&&n.moveTo(t,i)}onClear(){}onStart(){this.addApi(this.moveBaddy)}onStop(){}onLocalMessage(e){e.type}onPeerMessage(e,t){}onEntityAddedComponent(e,t){console.error("MADE ENTITY",e),e.$moveTo=t.moveTo.bind(t),this.movingNPCs.push(e)}onEntityRemovedComponent(e,t){for(let t=0;t<this.movingNPCs.length;t++)if(this.movingNPCs[t]===e)return void this.movingNPCs.splice(t,1)}update(e){for(let t=0;t<this.movingNPCs.length;t++){const i=this.movingNPCs[t],s=this.getSystemComponent(i);if(!s)throw console.error(i,this),new Error("Expected movement component");const r=i.getComponent(n.SYSTEMS.PLAYER_ANIMATION),o=s.updateMovement(e);r&&(o.hasOwnProperty("movingDirectionIndex")&&o.movingDirectionIndex>-1?(r.skeleton.direction=n.DIRECTION_INDEX_DATA.DIRECTIONS_NAMES[o.movingDirectionIndex],(r.skeleton&&r.skeleton.baseTrack.stopped||"walk"!==r.skeleton.baseTrack.currentAction)&&r.skeleton.play("walk",null,{loop:!0})):r.skeleton&&"idle"!==r.skeleton.baseTrack.currentAction&&"headchop"!==r.skeleton.baseTrack.currentAction&&r.skeleton.stop())}}onServerMessage(e){throw new Error("Method not implemented.")}}t.NPCMovementSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameStateSystem=void 0;const n=i(0),s=i(1);class r extends n.ClientSystem{constructor(){super(s.SYSTEMS.GAME_STATE),this.lastUid=0,this.handleInventoryChange=this.handleInventoryChange.bind(this)}onClear(){}onInit(){this.addApi(this.getUid)}onLocalMessage(e){switch(e.type){case s.MESSAGES.ADDED_HOLE:this.handleAddedHole(e.data.x,e.data.y,e.data.uid);break;case s.MESSAGES.REMOVED_HOLE:this.handleRemovedDrop({level:"island",uid:e.data});break;case s.MESSAGES.DROP_ITEM:this.handleDrop(e.data);break;case s.MESSAGES.REMOVE_DROPPED_ITEM:this.handleRemovedDrop(e.data)}}validateAndGetLevelStateObject(e){const t=this.gameState.data.levels.find(t=>t.name===e);if(!t)throw new Error(`Didnt find level data for ${e}`);return t}handleAddedHole(e,t,i){this.validateAndGetLevelStateObject("island").state.items.push({x:e,y:t,uid:i,name:"hole"}),this.gameState.save()}handleDrop(e){const{level:t,data:i}=e;this.validateAndGetLevelStateObject(t).state.items.push(Object.assign({},i)),this.gameState.save()}handleRemovedDrop(e){const{level:t,uid:i}=e,n=this.validateAndGetLevelStateObject(t),s=n.state.items.find(e=>e.uid===i);if(!s)throw new Error(`No item found with uid ${i}`);n.state.items.splice(n.state.items.indexOf(s),1),this.gameState.save()}handleInventoryChange(e){const{quantity:t,name:i,type:n,index:s}=e,r=this.gameState.data.inventory.find(e=>e.name===i);switch(n){case"add":this.gameState.data.inventory.push({quantity:t,name:i,index:s});break;case"remove":case"update":if(!r||r.name!==i)throw new Error(`Did not find item at inventory ${i} ${s}`);case"remove":this.gameState.data.inventory.splice(this.gameState.data.inventory.indexOf(r),1);break;case"update":r.quantity+=t}this.gameState.save()}onPeerMessage(e,t){}onStart(){}onEntityAddedComponent(e,t){this.gameState=t,this.lastUid=t.data.lastUid,this.dispatchAllLocal({type:s.MESSAGES.GAME_STATE_INITIALIZED,data:t.data}),setTimeout(()=>{e.on(s.PLAYER_EVENTS.INVENTORY_CHANGE,this.handleInventoryChange)})}getUid(){return this.gameState.data.lastUid++,this.gameState.save(),this.gameState.data.lastUid}onServerMessage(e){}update(e){}}t.GameStateSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugCatchSystem=void 0;const n=i(0),s=i(1),r=i(6);class o extends n.ClientSystem{constructor(){super(s.SYSTEMS.BUG_CATCH),this.bugsWithinPlayer=[];const e=(e,t)=>{e.gameObject.entity;const i=t.gameObject.entity;this.bugsWithinPlayer.includes(i)||this.bugsWithinPlayer.push(i)};this.bugCatchPlugin={type:"collision",name:"bugcatch",tagAs:[s.COLLIDER_TAGS.client_player_bug_detector],tagBs:[s.COLLIDER_TAGS.bug],onCollision:e,onCollisionStart:e,onAfterCollision:()=>{var e;let t=[];if(this.bugsWithinPlayer.length&&this.playerIsSwingingNet){const i=null===(e=this.globals.clientPlayer.getComponent(s.SYSTEMS.PLAYER_ANIMATION).skeleton.getFirstSlotColliderWithTag("net"))||void 0===e?void 0:e.shapeData;if(!i)throw new Error("Expected net shape data ");for(let e=0;e<this.bugsWithinPlayer.length;e++){const n=this.bugsWithinPlayer[e].gameObject.colliders[0].shapeData;r.circleCircleColliding(i,n)&&t.push(this.bugsWithinPlayer[e])}}t.length&&t.forEach(e=>{this.globals.clientPlayer.addItem(e.type)&&this.destroyEntity(e)}),this.bugsWithinPlayer.length=0}}}onClear(){}onLocalMessage(e){}onPeerMessage(e,t){}onServerMessage(e){}onEntityRemovedComponent(e,t){this.playerIsSwingingNet=!1}onEntityAddedComponent(e,t){const i=e.getComponent(s.SYSTEMS.PLAYER_ANIMATION).skeleton,n=e=>{e.onStart(e=>{"swing-net"===e&&(this.playerIsSwingingNet=!0)}),e.onEnd(e=>{"swing-net"===e&&(this.playerIsSwingingNet=!1)})};i?n(i):e.once("skeleton-ready",n)}update(e){}}t.BugCatchSystem=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugMovementSystem=void 0;const n=i(0),s=i(1);class r extends n.ClientSystem{constructor(){super(s.SYSTEMS.BUG_MOVEMENT),this.bugs=[]}onClear(){}onLocalMessage(e){}onPeerMessage(e,t){}onServerMessage(e){}onEntityAddedComponent(e,t){this.bugs.push({bug:e,movementComponent:t})}update(e){this.bugs.forEach(({bug:t,movementComponent:i})=>{i.updateMovement(e)})}}t.BugMovementSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugSpawnSystem=void 0;const n=i(0),s=i(1),r=i(6),o=i(3),a=i(135);class h extends n.ClientSystem{constructor(){super(s.SYSTEMS.BUG_SPAWN),this.bugTypeLookup={},this.timeSinceLastSpawn=0,this.bugProbabilityLookup={},this.previous30SpawnedBugs=[]}onClear(){}onLocalMessage(e){switch(e.type){case s.MESSAGES.NEW_FLOWER:this.bugProbabilityLookup[o.BugTypes.BEE]++}}onPeerMessage(e,t){}onServerMessage(e){}onEntityRemovedComponent(e,t){this.dispatchAllLocal({type:s.MESSAGES.REMOVED_BUG,data:e})}getNextBugToSpawn(){const e=[];let t,i=0;Object.keys(this.bugProbabilityLookup).forEach(t=>{e.push({bugType:t,start:i,end:i+=this.bugProbabilityLookup[t]})});const n=r.getRandomNumber(0,i);for(let i=0;i<e.length;i++)if(e[i].start<=n&&e[i].end<=n){t=e[i].type;break}if(t){let e=0;for(let i=0;i<this.previous30SpawnedBugs.length;i++)this.previous30SpawnedBugs[i]===t&&e++;return e>5&&(this.bugProbabilityLookup[t]-=1),t}}update(e){if(this.timeSinceLastSpawn+=e,this.timeSinceLastSpawn>1){const e=this.getNextBugToSpawn();if(e){this.globals.itemData[e];const t=new a.Bug(this.$api.getUid(),e);this.dispatchLocal({to:s.SYSTEMS.GAME_STATE,data:t,type:s.MESSAGES.SPAWNED_BUG}),this.timeSinceLastSpawn=0}}}}t.BugSpawnSystem=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bug=void 0;const n=i(3),s=i(0),r=i(13),o=i(136),a=i(137),h=i(41);class l extends s.Entity{constructor(e,t){super(e,n.EntityTypes.Bug),this.bugType=t}initialize(e){this.addComponent(new r.Position(e.position.x,e.position.y)),this.addComponent(new a.BugSpawnComponent),this.addComponent(new o.BugMovementComponent),this.addComponent(new h.ItemDropComponent("",""))}}t.Bug=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugMovementComponent=void 0;const n=i(0),s=i(1),r=i(6);class o extends n.Component{constructor(){super(s.SYSTEMS.BUG_MOVEMENT),this.timeSinceLastMovementChange=0,this.changeMovementIn=100}getNewDegreeDirection(){const e=r.getRandomNumber(0,360);if(this.position.getPosition().x>1500&&e>0&&e<180)return this.getNewDegreeDirection()}updateMovement(e){this.timeSinceLastMovementChange+=e,this.timeSinceLastMovementChange>this.changeMovementIn&&(this.timeSinceLastMovementChange=0)}onAdded(e){if(this.bugType=e.bugType,this.position=e.getComponent(s.SYSTEMS.POSITION),!this.position)throw new Error("Expected position")}}t.BugMovementComponent=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BugSpawnComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(){super(s.SYSTEMS.BUG_SPAWN)}}t.BugSpawnComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BeeKeepSystem=void 0;const n=i(0),s=i(1);class r extends n.ClientSystem{constructor(){super(s.SYSTEMS.BEE_KEEP)}onClear(){}onLocalMessage(e){}onPeerMessage(e,t){}onServerMessage(e){}update(e){}}t.BeeKeepSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlowerSystem=void 0;const n=i(0),s=i(1),r=i(3),o=i(140),a=i(142),h=i(6);class l extends n.ClientSystem{constructor(){super(s.SYSTEMS.FLOWER),this.numberOfBees=0,this.numberOfTrees=0,this.numberOfFullGrownFlowers=0,this.initializingGameState=!1,this.holes=[];this.playerFlowCollisionPlugin={type:"collision",name:"flower",tagAs:[s.COLLIDER_TAGS.in_front_of_client_player],tagBs:[s.COLLIDER_TAGS.flower],onCollisionStart:(e,t)=>{this.focusedFlower||(this.focusedFlower=t.gameObject.entity)},onCollision:(e,t)=>{this.focusedFlower||(this.focusedFlower=t.gameObject.entity)},onCollisionEnd:(e,t)=>{this.focusedFlower===t.gameObject.entity&&(this.focusedFlower=null)}}}onClear(){}get growthHash(){return`${this.numberOfBees}_${this.numberOfTrees}_${this.numberOfFullGrownFlowers}`}get growthRate(){return this.numberOfBees+this.numberOfTrees+this.numberOfFullGrownFlowers}handleSpawnedBug(e){e.bugType===r.BugTypes.BEE&&this.numberOfBees--}handleInitializedClientPlayer(){this.globals.clientPlayer.on("action",({actionName:e})=>{})}handleRemovedBug(e){e.bugType===r.BugTypes.BEE&&this.numberOfBees++}isPlant(e){}getSeedDataForFlower(e){const t=e.replace("flower","seed");if(!(t in a.PlatableGameData))throw new Error(`Could not find flower: ${e} from seed: ${t} in the lookup`);return a.PlatableGameData[t]}createFlowerEntity(e,t,i,n,s,r){this.getSeedDataForFlower(e);const a={uid:r,name:e,x:n,y:s,state:{elapsedTimeAlive:i,plantedByPlayer:t}},h=new o.Flower(a);return this.initializeEntity(h),h}handleInitializedGameState(e){this.initializingGameState=!0,e.levels.find(e=>"island"===e.name).state.items.filter(e=>this.globals.gameData[e.name].type===r.ItemTypes.FLOWER).forEach(e=>{this.createFlowerEntity(e.name,e.state.plantedByPlayer,e.state.elapsedTimeAlive,e.x,e.y,e.uid)}),this.initializingGameState=!1}onLocalMessage(e){switch(e.type){case s.MESSAGES.GAME_STATE_INITIALIZED:this.handleInitializedGameState(e.data);break;case s.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED:this.handleInitializedClientPlayer();break;case s.MESSAGES.REMOVED_TREE:this.numberOfTrees--;break;case s.MESSAGES.REMOVED_BUG:this.handleRemovedBug(e.data.bug);break;case s.MESSAGES.SPAWNED_BUG:this.handleSpawnedBug(e.data.bug);break;case s.MESSAGES.ADDED_HOLE:this.handleAddedHole(e.data.gameObject)}}handleAddedHole(e){const t=e.colliders[0].shapeData;this.focusedFlower&&h.rectsAreColliding(t,this.focusedFlower.gameObject.colliders[0].shapeData)&&(this.isFullyGrown(this.focusedFlower),this.removeFlower(this.focusedFlower))}removeFlower(e){const t=this.isFullyGrown(e);e.gameObject.removeFromMap();const i=e.getPosition(),n=e.flowerType;this.destroyEntity(e),this.dispatchLocal({to:[s.SYSTEMS.GAME_STATE,s.SYSTEMS.BUG_SPAWN],type:s.MESSAGES.REMOVED_FLOWER,data:{uid:e.id,type:e.flowerType,wasFullyGrown:t}});const r=n.replace("flower","seed"),o=n.replace("flower","pedal"),a={x:h.getRandomNumber(i.x-15,i.x+5),y:h.getRandomNumber(i.y-15,i.y+15)},l={x:h.getRandomNumber(i.x-5,i.x+15),y:h.getRandomNumber(i.y-15,i.y+15)},d={x:h.getRandomNumber(i.x-15,i.x+15),y:h.getRandomNumber(i.y-15,i.y+15)};this.$api.dropItem(r,a.x,a.y),this.$api.dropItem(r,l.x,l.y),this.$api.dropItem(o,d.x,d.y)}isFullyGrown(e){return this.getSeedDataForFlower(e.flowerType).timeToGrow<e.timeAlive}onEntityRemovedComponent(e,t){e.gameObject&&(delete e.gameObject.entity,delete e.gameObject)}onEntityAddedComponent(e,t){const i=this.initializingGameState?[s.SYSTEMS.BUG_SPAWN,s.SYSTEMS.GAME_STATE]:[s.SYSTEMS.BUG_SPAWN];e.gameObject=this.globals.tileWorld.addGameObject({texture:this.globals.gameTextures.items.placed[e.flowerType],p:Object.assign({},e.getPosition()),collider:[{dynamic:!1,shapeData:[{x:0,y:0,w:10,h:10}],tags:[s.COLLIDER_TAGS.flower]}]}),e.gameObject.entity=e,this.dispatchLocal({type:s.MESSAGES.NEW_FLOWER,data:e,to:i}),this.isFullyGrown(e)&&this.dispatchLocal({type:s.MESSAGES.FLOWER_FULLY_GROWN,data:e,to:i})}onPeerMessage(e,t){}onServerMessage(e){}update(e){}}t.FlowerSystem=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flower=void 0;const n=i(0),s=i(13),r=i(141),o=i(3);class a extends n.Entity{constructor(e){super(e.uid,o.ItemTypes.FLOWER),this.flowerType=e.name,this.initializedState=e}initialize(e){const{x:t,y:i,state:n}=this.initializedState;this.addComponent(new s.Position(t,i)),this.flowerComponent=new r.FlowerComponent(n),this.addComponent(this.flowerComponent)}get timeAlive(){return this.flowerComponent.timeAlive}}t.Flower=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlowerComponent=void 0;const n=i(0),s=i(1);class r extends n.Component{constructor(e){super(s.SYSTEMS.FLOWER),this.state=e}get timeAlive(){return this.state.elapsedTimeAlive}updateTimeAlive(e){this.state.elapsedTimeAlive+=e}onAdded(e){}}t.FlowerComponent=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalGameData=t.PlatableGameData=void 0;const n=i(3),s={type:n.ItemTypes.FURNITURE,shop:{shopPrice:1e3,sellPrice:500}},r={type:n.ItemTypes.TOOL},o={type:n.ItemTypes.PLANTABLE},a=["drop"];n.ItemTypes.TOOL,n.ItemTypes.RESOURCE,n.ItemTypes.BUG,n.ItemTypes.FURNITURE,n.ItemTypes.PLANTABLE,n.ItemTypes.TREE;t.PlatableGameData={seed1:{flower:"flower1",timeToGrow:100,beeFactor:1,spawnRate:1e4},seed2:{flower:"flower2",timeToGrow:150,beeFactor:1.5,spawnRate:15e3},seed3:{flower:"flower3",timeToGrow:500,beeFactor:5,spawnRate:25e3},seed4:{flower:"flower4",timeToGrow:1e3,beeFactor:10,spawnRate:5e4},seed5:{flower:"flower4",timeToGrow:1500,beeFactor:15,spawnRate:55e3}};const h={type:n.ItemTypes.FLOWER};t.GlobalGameData={items:{butterfly:{type:n.ItemTypes.BUG,shop:{sellPrice:1500}},bee:{type:n.ItemTypes.BUG,shop:{sellPrice:1500}},net:r,axe:r,red_bed:s,blue_bed:s,green_bed:s,seeds1:o,seeds2:o,seeds3:o,seeds4:o,pedals1:{type:n.ItemTypes.RESOURCE,shop:{sellPrice:100}},pedals2:{type:n.ItemTypes.RESOURCE,shop:{sellPrice:150}},pedals3:{type:n.ItemTypes.RESOURCE,shop:{sellPrice:250}},pedals4:{type:n.ItemTypes.RESOURCE,shop:{sellPrice:500}},pedals5:{type:n.ItemTypes.RESOURCE,shop:{sellPrice:1e3}},flower1:h,flower2:h,flower3:h,flower4:h,flower5:h}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DigSystem=void 0;const n=i(0),s=i(1);class r extends n.ClientSystem{constructor(){super(s.SYSTEMS.DIG),this.isReady=!1,this.holes=[],this.possibleCollidersPreventingHole=[],this.initializingFromGameState=!1,this.playerHoleCollisionPlugin={type:"collision",name:"holes",tagAs:[s.COLLIDER_TAGS.in_front_of_client_player],tagBs:[s.COLLIDER_TAGS.hole],onCollisionStart:(e,t)=>{this.focusedHole||(this.focusedHole=t.gameObject)},onCollision:(e,t)=>{this.focusedHole||(this.focusedHole=t.gameObject)},onCollisionEnd:(e,t)=>{this.focusedHole===t.gameObject&&(this.focusedHole=null)}},this.playerPreventHoleCollisionPlugin={type:"collision",name:"prevent_holes",tagAs:[s.COLLIDER_TAGS.in_front_of_client_player],tagBs:[s.COLLIDER_TAGS.npc,s.COLLIDER_TAGS.dropped_item,s.COLLIDER_TAGS.hole,s.COLLIDER_TAGS.blocking],onCollisionStart:(e,t)=>{this.possibleCollidersPreventingHole.push(t)},onCollision:(e,t)=>{this.possibleCollidersPreventingHole.push(t)}}}onClear(){}addHole(){}handleInitPlayer(){this.playerInput=this.globals.clientPlayer.playerInput,this.playerAction=this.globals.clientPlayer.getComponent(s.SYSTEMS.PLAYER_ACTION),this.playerAnimation=this.globals.clientPlayer.getComponent(s.SYSTEMS.PLAYER_ANIMATION),this.playerAnimation.skeleton?this.isReady=!0:this.globals.clientPlayer.once("skeleton-ready",()=>{})}getFocusedHole(){return this.focusedHole}onPlayerReady(){this.isReady=!0}canDig(){return"island"===this.globals.tileWorld.loadedMap&&!this.possibleCollidersPreventingHole.length&&this.playerAnimation.canPlayActionAnimation()}tryingToDig(){return this.playerInput.grab&&"shovel"===this.playerAction.actionAttachment}handleGameStateInitialized(e){this.initializingFromGameState=!0,e.levels.find(e=>"island"===e.name).state.items.forEach(e=>{"hole"===e.name&&this.addNewHole(e.x,e.y,e.uid)}),this.initializingFromGameState=!1}addNewHole(e,t,i){const n=this.initializingFromGameState?[s.SYSTEMS.FLOWER]:[s.SYSTEMS.GAME_STATE,s.SYSTEMS.FLOWER],r={texture:this.globals.gameTextures.items.placed.hole,position:{x:e,y:t},colliders:[{shapeData:{x:0,y:0,w:this.holeTexture.width,h:this.holeTexture.height},tags:[s.COLLIDER_TAGS.hole]}],data:{uid:i}};this.holes.push(this.globals.tileWorld.addGameObject()),this.dispatchLocal({type:s.MESSAGES.ADDED_HOLE,data:{uid:i,x:e,y:t,gameObject:r},to:n})}removeHole(e){let t,i=e;if("object"!=typeof e){if(!(i=this.holes.find(t=>t.data.uid===e)))throw new Error(`Could not find hole ${e}`);t=e,i.removeFromMap(),e===this.focusedHole&&(this.focusedHole=null),this.holes=this.holes.splice(this.holes.indexOf(i),1)}else t=i.data.uid;this.dispatchLocal({type:s.MESSAGES.REMOVED_HOLE,data:t,to:[s.SYSTEMS.GAME_STATE]})}onLocalMessage(e){switch(e.type){case s.MESSAGES.GAME_STATE_INITIALIZED:this.handleGameStateInitialized(e.data);break;case s.MESSAGES.CLIENT_PLAYER_ENTITY_INITIALIZED:this.handleInitPlayer()}}onPeerMessage(e,t){}onServerMessage(e){}onInit(){this.holeTexture=this.globals.gameTextures.items.placed.hole.width,this.addApi(this.removeHole),this.addApi(this.getFocusedHole)}update(e){if(this.isReady){if(this.tryingToDig()&&this.canDig()){this.playerAnimation.skeleton.play("dig",null,{loop:!1});const{x:e,y:t}=this.$api.getAheadOfPlayerPosition();this.addNewHole(e,t,this.$api.getUid())}this.possibleCollidersPreventingHole.length=0}}}t.DigSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(145);t.default=n.GameInput},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameInput=void 0;const n=i(146),s=i(151),r=i(152);t.GameInput=class{constructor(e,t){this.updateController=()=>[],this.updateKeyboard=()=>null,this.updateTouch=()=>null,this.updateMouse=()=>null,!(t=t||{}).keyboard&&this.initializeKeyboardSystem(null==e?void 0:e.keyboard),!t.mouse&&this.initializeMouseManager(),!t.controller&&this.initializeControllerManager(e.controller)}update(){return{keyboard:this.updateKeyboard(),mouse:this.updateMouse(),controller:this.updateController(),touch:this.updateTouch()}}unmapKeyboardAction(e,t){this.keyboardSystem.unmapInputFromAction(t,e)}mapKeyboardAction(e,t){this.keyboardSystem.mapInputIdToAction(t,e)}mapController(e,t){}updateOnlyTouch(){}registerSystemHandlers(e){}initializeKeyboardSystem(e){this.keyboardSystem=new s.KeyboardSystem(e),this.updateKeyboard=this.keyboardSystem.update.bind(this.keyboardSystem)}initializeTouchManager(e){this.touchSystem=e(),this.updateTouch=this.touchSystem.update.bind(this.touchSystem)}initializeMouseManager(e){this.mouseSystem=new r.MouseSystem(e),this.updateMouse=this.mouseSystem.update.bind(this.mouseSystem)}initializeControllerManager(e){this.controllerManager=new n.ControllerManager(e),this.controllerManager.on("add",e=>{console.error("ADDED CONTROLLER SYSTEM:",e)}),this.controllerManager.on("remove",e=>{}),this.controllerManager.init(),this.updateController=this.controllerManager.update.bind(this.controllerManager)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControllerManager=void 0;const n=i(147),s=i(150);class r extends s.BaseManager{constructor(e){if(super(),this.needsPolling=!1,this.trackedSystemArray=[],this.initializedSystemArray=[],this.state=e,"undefined"==typeof navigator)throw new Error("No navigator object found.");if("undefined"==typeof window)throw new Error("No window object found.");this.needsPolling=!("ongamepadconnected"in window)}onClear(){if(this.needsPolling||(window.removeEventListener("gamepadconnected",this.handleGamePadConnected),window.removeEventListener("gamepaddisconnected",this.handleGamePadDisconnected)),[...this.initializedSystemArray].forEach(e=>this.handleGamePadDisconnected({gamepad:e.gamepad})),this.initializedSystemArray.length)throw new Error("Should have no initialized systems left.");if(!this.trackedSystemArray.every(e=>!!e))throw new Error("Should have no truthy values in the tracked system array")}onUpdate(){this.needsPolling&&this.pollGamepads()}init(){this.handleGamePadConnected=this.handleGamePadConnected.bind(this),this.handleGamePadDisconnected=this.handleGamePadDisconnected.bind(this),this.needsPolling||(window.addEventListener("gamepadconnected",this.handleGamePadConnected),window.addEventListener("gamepaddisconnected",this.handleGamePadDisconnected)),this.pollGamepads()}handleGamePadConnected(e){const t=e.gamepad.index,i=navigator.getGamepads()[t];if(i){if(this.trackedSystemArray[t])throw console.error("gamepad:",i,"index:",e.gamepad.index),new Error("This gamepad already had an initialized system at the index");const n=this.controllerSystemFactory(i);this.trackedSystemArray[t]=n,this.initializedSystemArray.push(n),this.addSystem(n)}}handleGamePadDisconnected(e){const t=e.gamepad.index;if(navigator.getGamepads()[t]){const e=this.trackedSystemArray[t];if(!e)throw new Error(`No tracked system found for index: ${t}`);this.trackedSystemArray[t]=null;const i=this.initializedSystemArray.indexOf(e);if(i<0)throw new Error("Expected init index to be greater than -1.");this.initializedSystemArray.splice(i,1),this.removeSystem(e)}}pollGamepads(){const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<e.length;t++){const i=e[t];if(i){const e=this.initializedSystemArray[i.index];i.connected?e?e.gamepad=i:this.handleGamePadConnected({gamepad:i}):!i.connected&&e&&this.handleGamePadDisconnected({gamepad:i})}}}controllerSystemFactory(e){return new n.DefaultController(e,this.state.default)}}t.ControllerManager=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultController=void 0;var n=i(148);Object.defineProperty(t,"DefaultController",{enumerable:!0,get:function(){return n.DefaultController}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultController=void 0;const n=i(149),s=i(42);class r extends n.BaseControllerSystem{constructor(e,t){super(e,t),t&&this.applyControllerState(t)}applyControllerTriggers(e){const{l1:t,l2:i,r1:n,r2:s}=e,r=(e,t,i)=>{Array.isArray(e)?e.forEach(e=>{this.mapInputIdToAction(t,e),this.actionState[e]=!!i&&0}):(this.mapInputIdToAction(t,e),this.actionState[e]=!!i&&0)};t&&r(t,4,!1),i&&r(i,6,!0),n&&r(n,5,!1),s&&r(s,7,!0)}applyControllerSticks(e){const{left:t,leftPress:i,right:n,rightPress:s}=e,r=(e,t,i)=>{if(Array.isArray(e)||"string"==typeof e)this.mapStickToAction(t,e,i);else{if("object"!=typeof e)throw new Error("unhandled left controller state");for(let n in e)this.mapStickToAction(t,{action:n,direction:e[n]},i)}};t&&r(t,0,!1),i&&r(i,0,!0),n&&r(n,1,!1),s&&r(s,1,!0)}applyControllerDPad(e){if(Array.isArray(e))e.forEach(this.applyControllerDPad.bind(this));else{const{north:t,west:i,east:n,south:s}=e;t&&this.mapInputIdToAction(12,t),s&&this.mapInputIdToAction(13,s),i&&this.mapInputIdToAction(14,i),n&&this.mapInputIdToAction(15,n)}}isPowerBtn(e){return 6===e||7===e}applyControllerState(e){const{sticks:t,triggers:i,dpad:n,buttons:s}=e;t&&this.applyControllerSticks(t),n&&this.applyControllerDPad(n),i&&this.applyControllerTriggers(i),s&&this.applyControllerButtons(s)}applyControllerButtons(e){const{select:t,start:i,north:n,south:s,east:r,west:o}=e;t&&this.mapInputIdToAction(8,t),i&&this.mapInputIdToAction(9,i),n&&this.mapInputIdToAction(3,n),o&&this.mapInputIdToAction(2,o),r&&this.mapInputIdToAction(1,r),s&&this.mapInputIdToAction(0,s)}isStickPressed(e){return this.gamepad.buttons[e+10].pressed}updateState(){super.updateState();for(let e=0;e<this.stickActionArray.length;e++)this.currentIterationTrueLookup[this.stickActionArray[e]]||(this.actionState[this.stickActionArray[e]]=!1);const e=(e,t)=>{var i,n,r;const o=this.mappedStickActions.move[e],a=this.mappedStickActions.press[e];if(o||a){const h=parseFloat(this.gamepad.axes[2*e].toFixed(2)),l=-1*parseFloat(this.gamepad.axes[2*e+1].toFixed(2)),{angles:d,power:c}=s.normalizeAxes(h,l);if(c){const{degrees:e}=d.north0,i=s.getDirectionFromNorth0Degrees(e);o&&this.updateStickState(d,c,i,o),t&&a&&this.updateStickState(d,c,i,a)}else{if(o){if(null===(i=o.degreeDirections)||void 0===i||i.forEach(e=>{e.actions.forEach(e=>{this.currentIterationTrueLookup[e]||(this.actionState[e]=!1)})}),o.stringDirections){Object.keys(o.stringDirections).forEach(e=>{o.stringDirections[e].forEach(e=>{this.currentIterationTrueLookup[e]||(this.actionState[e]=!1)})})}null===(n=o.actions)||void 0===n||n.forEach(e=>{this.actionState[e]={angles:d,power:c}})}t&&(null===(r=null==a?void 0:a.actions)||void 0===r||r.forEach(e=>{this.actionState[e]=!0}))}}};e(0,this.isStickPressed(0)),e(1,this.isStickPressed(1))}}t.DefaultController=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseControllerSystem=void 0;const n=i(25),s=i(42);class r extends n.InputSystem{constructor(e,t){super(),this.stickActionCount={},this._onMappedStickActionAddedListeners=[],this._onMappedStickActionRemovedListeners=[],this.stickActionArray=[],this.mappedStickRotationActions={},this.mappedAxesActions={},this.mappedStickActions={press:[],move:[]},this.trackedStickActions=[],this.currentIterationTrueLookup={},this.gamepad=e}onClear(){}mapStickRangeToAction(e,t,i,n){this.mappedStickRotationActions[e]}unmapStickFromAction(e,t,i){if(Array.isArray(t))return void t.forEach(n=>{this.unmapStickFromAction(e,t,i)});const n=this.validateStickActionType(t),s=this.getStickActionLookup(e,i,!1),r={index:e},o={inputId:r,actionNowUnmapped:!1,action:""};let a;if("string"===n){a=t;const e=s.actions.indexOf(a);if(e<0)throw new Error("Expected");s.actions.splice(e,1),s.actions.length||delete s.actions,o.action=a,this.updateStickActionCount(a,!1),o.actionNowUnmapped=!this.actionIsMapped(a),this._onMappedActionRemovedListeners.forEach(e=>e(o))}else{a=(t=t).action,(Array.isArray(t.direction)?t.direction:[t.direction]).forEach(t=>{if(r.direction=t,"string"==typeof t){const i=s.stringDirections[t].indexOf(a);if(i<0)throw new Error(`Action ${a} was not mapped to direction ${t} on the ${e} stick`);s.stringDirections[t].splice(i,1),s.stringDirections[t].length||(delete s.stringDirections[t],Object.keys(s.stringDirections).length||delete s.stringDirections)}else{const{min:i,max:n}=t,r=s.degreeDirections.find(e=>e.min==i&&e.max==e.max&&e.actions.includes(a));if(!r)throw new Error(`Action ${a} was not mapped to direction min max: ${t} on the ${e} stick`);r.actions.splice(r.actions.indexOf(a),1),r.actions.length||(s.degreeDirections.splice(s.degreeDirections.indexOf(r),1),s.degreeDirections.length||delete s.degreeDirections)}this.updateStickActionCount(a,!1),o.action=a,o.actionNowUnmapped=!this.actionIsMapped(a),this._onMappedActionRemovedListeners.forEach(e=>e(o))})}}actionIsMapped(e){var t;return!!this.stickActionCount[e]||!(null===(t=this.mappedActionToInputIds[e])||void 0===t||!t.length)}getStickActionLookup(e,t,i=!0){const n=t?"press":"move";if(!this.mappedStickActions[n][e]){if(!i)throw new Error("Expected to have index");this.mappedStickActions[n][e]={}}return this.mappedStickActions[n][e]}validateStickActionType(e){const t=typeof e;if("string"!==t&&"object"!==t)throw new Error(`Invalid action type: ${e}`);return t}updateStickActionCount(e,t,i){if(t)this.stickActionCount[e]?this.stickActionCount[e]++:(this.stickActionArray.push(e),this.stickActionCount[e]=1);else if(this.stickActionCount[e]--,!this.stickActionCount[e]){const t=this.stickActionArray.indexOf(e);if(t<0)throw new Error("Mismatch stick action array and count tracker.");this.stickActionArray.splice(t,1),delete this.stickActionCount[e]}}mapStickToAction(e,t,i){if(Array.isArray(t))return void t.forEach(t=>{this.mapStickToAction(e,t,i)});const n=this.validateStickActionType(t),r=this.getStickActionLookup(e,i,!0),o={index:e},a={inputId:o,action:""};let h;if("string"===n)h=t,r.actions?r.actions.push(h):r.actions=[h],a.action=h,this.updateStickActionCount(h,!0),this._onMappedActionAddedListeners.forEach(e=>e(a));else{h=(t=t).action,(Array.isArray(t.direction)?t.direction:[t.direction]).forEach(e=>{if(o.direction=e,"string"==typeof e){if(!s.isValidDirection(e))throw new Error(`Invalid direction string ${e}`);r.stringDirections?r.stringDirections[e]?r.stringDirections[e].push(h):r.stringDirections[e]=[h]:r.stringDirections={[e]:[h]}}else{const{min:t,max:i}=e;if(this.validateMinMax(t,i),r.degreeDirections){const e=r.degreeDirections.find(e=>e.min==t&&e.max==i);e?e.actions.push(h):(r.degreeDirections.push({min:t,max:i,actions:[h]}),r.degreeDirections.sort((e,t)=>{return(e.min||0)-(t.min||0)}))}else r.degreeDirections=[{min:t,max:i,actions:[h]}]}this.updateStickActionCount(h,!0),a.action=h,this._onMappedActionAddedListeners.forEach(e=>e(a))})}}updateState(){this.currentIterationTrueLookup={},this.gamepad.buttons.forEach((e,t)=>{const i=this.resolveActions(t);i&&i.forEach(i=>{if(!this.currentIterationTrueLookup[i]){const n=this.isPowerBtn(t)?e.value:e.pressed;this.actionState[i]=n,n&&(this.currentIterationTrueLookup[i]=!0)}})})}validateMinMax(e,t){const i=null!=e,n=null!=t;if(i&&(e<0||e>360))throw new Error("Invalid degree value, must be 0-360");if(n&&(t<0||t>360))throw new Error("Invalid degree value, must be 0-360");if(n&&i&&e>=t)throw new Error("Min should be less than max.")}updateStickState(e,t,i,n){const{degrees:r}=e.north0,o=s.getDirectionFromNorth0Degrees(r);if(n.actions&&n.actions.forEach(i=>{this.actionState[i]={angles:e,power:t}}),n.stringDirections){Object.keys(n.stringDirections).forEach(e=>{n.stringDirections[e].forEach(t=>{const i=e===o;i&&!this.currentIterationTrueLookup[t]?(this.currentIterationTrueLookup[t]=!0,this.actionState[t]=!0):i||this.currentIterationTrueLookup[t]||(this.actionState[t]=!1)})})}if(n.degreeDirections)for(let e=0;e<n.degreeDirections.length;e++){const t=n.degreeDirections[e],i=(!t.min||t.min<=r)&&(!t.max||t.max>=r);t.actions.forEach(e=>{i&&!this.currentIterationTrueLookup[e]?(this.currentIterationTrueLookup[e]=!0,this.actionState[e]=!0):i||this.currentIterationTrueLookup[e]||(this.actionState[e]=!1)})}}}t.BaseControllerSystem=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseManager=void 0;t.BaseManager=class{constructor(){this.managedSystems=[],this._systemListeners={add:[],remove:[]}}update(){return this.onUpdate(),this.managedSystems.map(e=>e.update())}clear(){this.onClear(),[...this.managedSystems].forEach(this.removeSystem.bind(this))}emit(e,t){"add"===e&&this.managedSystems.push(t);for(let i=0;i<this._systemListeners[e].length;i++)this._systemListeners[e][i](t)}addSystem(e){for(let t=0;t<this._systemListeners.add.length;t++)this._systemListeners.add[t](e);this.managedSystems.push(e)}removeSystem(e){e.onClear();for(let t=0;t<this._systemListeners.remove.length;t++)this._systemListeners.remove[t](e);const t=this.managedSystems.indexOf(e);t>-1&&this.managedSystems.splice(t,1)}on(e,t){this._systemListeners[e].push(t)}off(e,t){const i=this._systemListeners[e].indexOf(t);i>-1&&this._systemListeners[e].splice(i,1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardSystem=void 0;const n=i(25);class s extends n.InputSystem{constructor(e){super(e),this.actionsQueued=[],this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}updateState(){this.actionsQueued.forEach(({action:e,value:t})=>{this.actionState[e]=t}),this.actionsQueued.length=0}handleKeyDown(e){const t=this.resolveActions(e.code);t&&this.actionsQueued.push(...t.map(e=>({action:e,value:!0})))}handleKeyUp(e){const t=this.resolveActions(e.code);t&&this.actionsQueued.push(...t.map(e=>({action:e,value:!1})))}onClear(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)}}t.KeyboardSystem=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MouseSystem=void 0;const n=i(25);class s extends n.InputSystem{constructor(e){super(e),this.actionsFinished=[],this.actionsStarted=[],this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),window.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mouseup",this.handleMouseUp),window.addEventListener("mousemove",this.handleMouseMove)}updateState(){this.actionsFinished.forEach(e=>{this.actionState[e]=!1}),this.actionsStarted.forEach(e=>{this.actionState[e]=!0}),this.actionsStarted.length=0,this.actionsFinished.length=0}handleMouseMove(e){}handleMouseDown(e){const t=this.resolveActions(e.button);t&&this.actionsStarted.push(...t)}handleMouseUp(e){const t=this.resolveActions(e.button);t&&this.actionsFinished.push(...t)}onClear(){window.removeEventListener("mousedown",this.handleMouseDown),window.removeEventListener("mouseup",this.handleMouseUp),window.removeEventListener("mousemove",this.handleMouseMove)}}t.MouseSystem=s},function(e,t,i){"use strict";i.r(t),function(e,i){
/*!
 * Vue.js v2.6.12
 * (c) 2014-2020 Evan You
 * Released under the MIT License.
 */
var n=Object.freeze({});function s(e){return null==e}function r(e){return null!=e}function o(e){return!0===e}function a(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function h(e){return null!==e&&"object"==typeof e}var l=Object.prototype.toString;function d(e){return"[object Object]"===l.call(e)}function c(e){return"[object RegExp]"===l.call(e)}function u(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function p(e){return r(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function f(e){return null==e?"":Array.isArray(e)||d(e)&&e.toString===l?JSON.stringify(e,null,2):String(e)}function m(e){var t=parseFloat(e);return isNaN(t)?e:t}function g(e,t){for(var i=Object.create(null),n=e.split(","),s=0;s<n.length;s++)i[n[s]]=!0;return t?function(e){return i[e.toLowerCase()]}:function(e){return i[e]}}g("slot,component",!0);var y=g("key,ref,slot,slot-scope,is");function v(e,t){if(e.length){var i=e.indexOf(t);if(i>-1)return e.splice(i,1)}}var C=Object.prototype.hasOwnProperty;function S(e,t){return C.call(e,t)}function w(e){var t=Object.create(null);return function(i){return t[i]||(t[i]=e(i))}}var b=/-(\w)/g,T=w((function(e){return e.replace(b,(function(e,t){return t?t.toUpperCase():""}))})),_=w((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})),x=/\B([A-Z])/g,E=w((function(e){return e.replace(x,"-$1").toLowerCase()}));var A=Function.prototype.bind?function(e,t){return e.bind(t)}:function(e,t){function i(i){var n=arguments.length;return n?n>1?e.apply(t,arguments):e.call(t,i):e.call(t)}return i._length=e.length,i};function k(e,t){t=t||0;for(var i=e.length-t,n=new Array(i);i--;)n[i]=e[i+t];return n}function P(e,t){for(var i in t)e[i]=t[i];return e}function I(e){for(var t={},i=0;i<e.length;i++)e[i]&&P(t,e[i]);return t}function M(e,t,i){}var R=function(e,t,i){return!1},O=function(e){return e};function L(e,t){if(e===t)return!0;var i=h(e),n=h(t);if(!i||!n)return!i&&!n&&String(e)===String(t);try{var s=Array.isArray(e),r=Array.isArray(t);if(s&&r)return e.length===t.length&&e.every((function(e,i){return L(e,t[i])}));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(s||r)return!1;var o=Object.keys(e),a=Object.keys(t);return o.length===a.length&&o.every((function(i){return L(e[i],t[i])}))}catch(e){return!1}}function D(e,t){for(var i=0;i<e.length;i++)if(L(e[i],t))return i;return-1}function N(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var B="data-server-rendered",j=["component","directive","filter"],F=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],G={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:R,isReservedAttr:R,isUnknownElement:R,getTagNamespace:M,parsePlatformTagName:O,mustUseProp:R,async:!0,_lifecycleHooks:F},U=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function H(e,t,i,n){Object.defineProperty(e,t,{value:i,enumerable:!!n,writable:!0,configurable:!0})}var $=new RegExp("[^"+U.source+".$_\\d]");var W,z="__proto__"in{},Y="undefined"!=typeof window,V="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,X=V&&WXEnvironment.platform.toLowerCase(),q=Y&&window.navigator.userAgent.toLowerCase(),K=q&&/msie|trident/.test(q),J=q&&q.indexOf("msie 9.0")>0,Q=q&&q.indexOf("edge/")>0,Z=(q&&q.indexOf("android"),q&&/iphone|ipad|ipod|ios/.test(q)||"ios"===X),ee=(q&&/chrome\/\d+/.test(q),q&&/phantomjs/.test(q),q&&q.match(/firefox\/(\d+)/)),te={}.watch,ie=!1;if(Y)try{var ne={};Object.defineProperty(ne,"passive",{get:function(){ie=!0}}),window.addEventListener("test-passive",null,ne)}catch(e){}var se=function(){return void 0===W&&(W=!Y&&!V&&void 0!==e&&(e.process&&"server"===e.process.env.VUE_ENV)),W},re=Y&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function oe(e){return"function"==typeof e&&/native code/.test(e.toString())}var ae,he="undefined"!=typeof Symbol&&oe(Symbol)&&"undefined"!=typeof Reflect&&oe(Reflect.ownKeys);ae="undefined"!=typeof Set&&oe(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var le=M,de=0,ce=function(){this.id=de++,this.subs=[]};ce.prototype.addSub=function(e){this.subs.push(e)},ce.prototype.removeSub=function(e){v(this.subs,e)},ce.prototype.depend=function(){ce.target&&ce.target.addDep(this)},ce.prototype.notify=function(){var e=this.subs.slice();for(var t=0,i=e.length;t<i;t++)e[t].update()},ce.target=null;var ue=[];function pe(e){ue.push(e),ce.target=e}function fe(){ue.pop(),ce.target=ue[ue.length-1]}var me=function(e,t,i,n,s,r,o,a){this.tag=e,this.data=t,this.children=i,this.text=n,this.elm=s,this.ns=void 0,this.context=r,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},ge={child:{configurable:!0}};ge.child.get=function(){return this.componentInstance},Object.defineProperties(me.prototype,ge);var ye=function(e){void 0===e&&(e="");var t=new me;return t.text=e,t.isComment=!0,t};function ve(e){return new me(void 0,void 0,void 0,String(e))}function Ce(e){var t=new me(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}var Se=Array.prototype,we=Object.create(Se);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(e){var t=Se[e];H(we,e,(function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];var s,r=t.apply(this,i),o=this.__ob__;switch(e){case"push":case"unshift":s=i;break;case"splice":s=i.slice(2)}return s&&o.observeArray(s),o.dep.notify(),r}))}));var be=Object.getOwnPropertyNames(we),Te=!0;function _e(e){Te=e}var xe=function(e){this.value=e,this.dep=new ce,this.vmCount=0,H(e,"__ob__",this),Array.isArray(e)?(z?function(e,t){e.__proto__=t}(e,we):function(e,t,i){for(var n=0,s=i.length;n<s;n++){var r=i[n];H(e,r,t[r])}}(e,we,be),this.observeArray(e)):this.walk(e)};function Ee(e,t){var i;if(h(e)&&!(e instanceof me))return S(e,"__ob__")&&e.__ob__ instanceof xe?i=e.__ob__:Te&&!se()&&(Array.isArray(e)||d(e))&&Object.isExtensible(e)&&!e._isVue&&(i=new xe(e)),t&&i&&i.vmCount++,i}function Ae(e,t,i,n,s){var r=new ce,o=Object.getOwnPropertyDescriptor(e,t);if(!o||!1!==o.configurable){var a=o&&o.get,h=o&&o.set;a&&!h||2!==arguments.length||(i=e[t]);var l=!s&&Ee(i);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=a?a.call(e):i;return ce.target&&(r.depend(),l&&(l.dep.depend(),Array.isArray(t)&&function e(t){for(var i=void 0,n=0,s=t.length;n<s;n++)(i=t[n])&&i.__ob__&&i.__ob__.dep.depend(),Array.isArray(i)&&e(i)}(t))),t},set:function(t){var n=a?a.call(e):i;t===n||t!=t&&n!=n||a&&!h||(h?h.call(e,t):i=t,l=!s&&Ee(t),r.notify())}})}}function ke(e,t,i){if(Array.isArray(e)&&u(t))return e.length=Math.max(e.length,t),e.splice(t,1,i),i;if(t in e&&!(t in Object.prototype))return e[t]=i,i;var n=e.__ob__;return e._isVue||n&&n.vmCount?i:n?(Ae(n.value,t,i),n.dep.notify(),i):(e[t]=i,i)}function Pe(e,t){if(Array.isArray(e)&&u(t))e.splice(t,1);else{var i=e.__ob__;e._isVue||i&&i.vmCount||S(e,t)&&(delete e[t],i&&i.dep.notify())}}xe.prototype.walk=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)Ae(e,t[i])},xe.prototype.observeArray=function(e){for(var t=0,i=e.length;t<i;t++)Ee(e[t])};var Ie=G.optionMergeStrategies;function Me(e,t){if(!t)return e;for(var i,n,s,r=he?Reflect.ownKeys(t):Object.keys(t),o=0;o<r.length;o++)"__ob__"!==(i=r[o])&&(n=e[i],s=t[i],S(e,i)?n!==s&&d(n)&&d(s)&&Me(n,s):ke(e,i,s));return e}function Re(e,t,i){return i?function(){var n="function"==typeof t?t.call(i,i):t,s="function"==typeof e?e.call(i,i):e;return n?Me(n,s):s}:t?e?function(){return Me("function"==typeof t?t.call(this,this):t,"function"==typeof e?e.call(this,this):e)}:t:e}function Oe(e,t){var i=t?e?e.concat(t):Array.isArray(t)?t:[t]:e;return i?function(e){for(var t=[],i=0;i<e.length;i++)-1===t.indexOf(e[i])&&t.push(e[i]);return t}(i):i}function Le(e,t,i,n){var s=Object.create(e||null);return t?P(s,t):s}Ie.data=function(e,t,i){return i?Re(e,t,i):t&&"function"!=typeof t?e:Re(e,t)},F.forEach((function(e){Ie[e]=Oe})),j.forEach((function(e){Ie[e+"s"]=Le})),Ie.watch=function(e,t,i,n){if(e===te&&(e=void 0),t===te&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var s={};for(var r in P(s,e),t){var o=s[r],a=t[r];o&&!Array.isArray(o)&&(o=[o]),s[r]=o?o.concat(a):Array.isArray(a)?a:[a]}return s},Ie.props=Ie.methods=Ie.inject=Ie.computed=function(e,t,i,n){if(!e)return t;var s=Object.create(null);return P(s,e),t&&P(s,t),s},Ie.provide=Re;var De=function(e,t){return void 0===t?e:t};function Ne(e,t,i){if("function"==typeof t&&(t=t.options),function(e,t){var i=e.props;if(i){var n,s,r={};if(Array.isArray(i))for(n=i.length;n--;)"string"==typeof(s=i[n])&&(r[T(s)]={type:null});else if(d(i))for(var o in i)s=i[o],r[T(o)]=d(s)?s:{type:s};else 0;e.props=r}}(t),function(e,t){var i=e.inject;if(i){var n=e.inject={};if(Array.isArray(i))for(var s=0;s<i.length;s++)n[i[s]]={from:i[s]};else if(d(i))for(var r in i){var o=i[r];n[r]=d(o)?P({from:r},o):{from:o}}else 0}}(t),function(e){var t=e.directives;if(t)for(var i in t){var n=t[i];"function"==typeof n&&(t[i]={bind:n,update:n})}}(t),!t._base&&(t.extends&&(e=Ne(e,t.extends,i)),t.mixins))for(var n=0,s=t.mixins.length;n<s;n++)e=Ne(e,t.mixins[n],i);var r,o={};for(r in e)a(r);for(r in t)S(e,r)||a(r);function a(n){var s=Ie[n]||De;o[n]=s(e[n],t[n],i,n)}return o}function Be(e,t,i,n){if("string"==typeof i){var s=e[t];if(S(s,i))return s[i];var r=T(i);if(S(s,r))return s[r];var o=_(r);return S(s,o)?s[o]:s[i]||s[r]||s[o]}}function je(e,t,i,n){var s=t[e],r=!S(i,e),o=i[e],a=Ue(Boolean,s.type);if(a>-1)if(r&&!S(s,"default"))o=!1;else if(""===o||o===E(e)){var h=Ue(String,s.type);(h<0||a<h)&&(o=!0)}if(void 0===o){o=function(e,t,i){if(!S(t,"default"))return;var n=t.default;0;if(e&&e.$options.propsData&&void 0===e.$options.propsData[i]&&void 0!==e._props[i])return e._props[i];return"function"==typeof n&&"Function"!==Fe(t.type)?n.call(e):n}(n,s,e);var l=Te;_e(!0),Ee(o),_e(l)}return o}function Fe(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Ge(e,t){return Fe(e)===Fe(t)}function Ue(e,t){if(!Array.isArray(t))return Ge(t,e)?0:-1;for(var i=0,n=t.length;i<n;i++)if(Ge(t[i],e))return i;return-1}function He(e,t,i){pe();try{if(t)for(var n=t;n=n.$parent;){var s=n.$options.errorCaptured;if(s)for(var r=0;r<s.length;r++)try{if(!1===s[r].call(n,e,t,i))return}catch(e){We(e,n,"errorCaptured hook")}}We(e,t,i)}finally{fe()}}function $e(e,t,i,n,s){var r;try{(r=i?e.apply(t,i):e.call(t))&&!r._isVue&&p(r)&&!r._handled&&(r.catch((function(e){return He(e,n,s+" (Promise/async)")})),r._handled=!0)}catch(e){He(e,n,s)}return r}function We(e,t,i){if(G.errorHandler)try{return G.errorHandler.call(null,e,t,i)}catch(t){t!==e&&ze(t,null,"config.errorHandler")}ze(e,t,i)}function ze(e,t,i){if(!Y&&!V||"undefined"==typeof console)throw e;console.error(e)}var Ye,Ve=!1,Xe=[],qe=!1;function Ke(){qe=!1;var e=Xe.slice(0);Xe.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!=typeof Promise&&oe(Promise)){var Je=Promise.resolve();Ye=function(){Je.then(Ke),Z&&setTimeout(M)},Ve=!0}else if(K||"undefined"==typeof MutationObserver||!oe(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Ye=void 0!==i&&oe(i)?function(){i(Ke)}:function(){setTimeout(Ke,0)};else{var Qe=1,Ze=new MutationObserver(Ke),et=document.createTextNode(String(Qe));Ze.observe(et,{characterData:!0}),Ye=function(){Qe=(Qe+1)%2,et.data=String(Qe)},Ve=!0}function tt(e,t){var i;if(Xe.push((function(){if(e)try{e.call(t)}catch(e){He(e,t,"nextTick")}else i&&i(t)})),qe||(qe=!0,Ye()),!e&&"undefined"!=typeof Promise)return new Promise((function(e){i=e}))}var it=new ae;function nt(e){!function e(t,i){var n,s,r=Array.isArray(t);if(!r&&!h(t)||Object.isFrozen(t)||t instanceof me)return;if(t.__ob__){var o=t.__ob__.dep.id;if(i.has(o))return;i.add(o)}if(r)for(n=t.length;n--;)e(t[n],i);else for(s=Object.keys(t),n=s.length;n--;)e(t[s[n]],i)}(e,it),it.clear()}var st=w((function(e){var t="&"===e.charAt(0),i="~"===(e=t?e.slice(1):e).charAt(0),n="!"===(e=i?e.slice(1):e).charAt(0);return{name:e=n?e.slice(1):e,once:i,capture:n,passive:t}}));function rt(e,t){function i(){var e=arguments,n=i.fns;if(!Array.isArray(n))return $e(n,null,arguments,t,"v-on handler");for(var s=n.slice(),r=0;r<s.length;r++)$e(s[r],null,e,t,"v-on handler")}return i.fns=e,i}function ot(e,t,i,n,r,a){var h,l,d,c;for(h in e)l=e[h],d=t[h],c=st(h),s(l)||(s(d)?(s(l.fns)&&(l=e[h]=rt(l,a)),o(c.once)&&(l=e[h]=r(c.name,l,c.capture)),i(c.name,l,c.capture,c.passive,c.params)):l!==d&&(d.fns=l,e[h]=d));for(h in t)s(e[h])&&n((c=st(h)).name,t[h],c.capture)}function at(e,t,i){var n;e instanceof me&&(e=e.data.hook||(e.data.hook={}));var a=e[t];function h(){i.apply(this,arguments),v(n.fns,h)}s(a)?n=rt([h]):r(a.fns)&&o(a.merged)?(n=a).fns.push(h):n=rt([a,h]),n.merged=!0,e[t]=n}function ht(e,t,i,n,s){if(r(t)){if(S(t,i))return e[i]=t[i],s||delete t[i],!0;if(S(t,n))return e[i]=t[n],s||delete t[n],!0}return!1}function lt(e){return a(e)?[ve(e)]:Array.isArray(e)?function e(t,i){var n,h,l,d,c=[];for(n=0;n<t.length;n++)s(h=t[n])||"boolean"==typeof h||(l=c.length-1,d=c[l],Array.isArray(h)?h.length>0&&(dt((h=e(h,(i||"")+"_"+n))[0])&&dt(d)&&(c[l]=ve(d.text+h[0].text),h.shift()),c.push.apply(c,h)):a(h)?dt(d)?c[l]=ve(d.text+h):""!==h&&c.push(ve(h)):dt(h)&&dt(d)?c[l]=ve(d.text+h.text):(o(t._isVList)&&r(h.tag)&&s(h.key)&&r(i)&&(h.key="__vlist"+i+"_"+n+"__"),c.push(h)));return c}(e):void 0}function dt(e){return r(e)&&r(e.text)&&!1===e.isComment}function ct(e,t){if(e){for(var i=Object.create(null),n=he?Reflect.ownKeys(e):Object.keys(e),s=0;s<n.length;s++){var r=n[s];if("__ob__"!==r){for(var o=e[r].from,a=t;a;){if(a._provided&&S(a._provided,o)){i[r]=a._provided[o];break}a=a.$parent}if(!a)if("default"in e[r]){var h=e[r].default;i[r]="function"==typeof h?h.call(t):h}else 0}}return i}}function ut(e,t){if(!e||!e.length)return{};for(var i={},n=0,s=e.length;n<s;n++){var r=e[n],o=r.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,r.context!==t&&r.fnContext!==t||!o||null==o.slot)(i.default||(i.default=[])).push(r);else{var a=o.slot,h=i[a]||(i[a]=[]);"template"===r.tag?h.push.apply(h,r.children||[]):h.push(r)}}for(var l in i)i[l].every(pt)&&delete i[l];return i}function pt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function ft(e,t,i){var s,r=Object.keys(t).length>0,o=e?!!e.$stable:!r,a=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(o&&i&&i!==n&&a===i.$key&&!r&&!i.$hasNormal)return i;for(var h in s={},e)e[h]&&"$"!==h[0]&&(s[h]=mt(t,h,e[h]))}else s={};for(var l in t)l in s||(s[l]=gt(t,l));return e&&Object.isExtensible(e)&&(e._normalized=s),H(s,"$stable",o),H(s,"$key",a),H(s,"$hasNormal",r),s}function mt(e,t,i){var n=function(){var e=arguments.length?i.apply(null,arguments):i({});return(e=e&&"object"==typeof e&&!Array.isArray(e)?[e]:lt(e))&&(0===e.length||1===e.length&&e[0].isComment)?void 0:e};return i.proxy&&Object.defineProperty(e,t,{get:n,enumerable:!0,configurable:!0}),n}function gt(e,t){return function(){return e[t]}}function yt(e,t){var i,n,s,o,a;if(Array.isArray(e)||"string"==typeof e)for(i=new Array(e.length),n=0,s=e.length;n<s;n++)i[n]=t(e[n],n);else if("number"==typeof e)for(i=new Array(e),n=0;n<e;n++)i[n]=t(n+1,n);else if(h(e))if(he&&e[Symbol.iterator]){i=[];for(var l=e[Symbol.iterator](),d=l.next();!d.done;)i.push(t(d.value,i.length)),d=l.next()}else for(o=Object.keys(e),i=new Array(o.length),n=0,s=o.length;n<s;n++)a=o[n],i[n]=t(e[a],a,n);return r(i)||(i=[]),i._isVList=!0,i}function vt(e,t,i,n){var s,r=this.$scopedSlots[e];r?(i=i||{},n&&(i=P(P({},n),i)),s=r(i)||t):s=this.$slots[e]||t;var o=i&&i.slot;return o?this.$createElement("template",{slot:o},s):s}function Ct(e){return Be(this.$options,"filters",e)||O}function St(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function wt(e,t,i,n,s){var r=G.keyCodes[t]||i;return s&&n&&!G.keyCodes[t]?St(s,n):r?St(r,e):n?E(n)!==t:void 0}function bt(e,t,i,n,s){if(i)if(h(i)){var r;Array.isArray(i)&&(i=I(i));var o=function(o){if("class"===o||"style"===o||y(o))r=e;else{var a=e.attrs&&e.attrs.type;r=n||G.mustUseProp(t,a,o)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var h=T(o),l=E(o);h in r||l in r||(r[o]=i[o],s&&((e.on||(e.on={}))["update:"+o]=function(e){i[o]=e}))};for(var a in i)o(a)}else;return e}function Tt(e,t){var i=this._staticTrees||(this._staticTrees=[]),n=i[e];return n&&!t?n:(xt(n=i[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),"__static__"+e,!1),n)}function _t(e,t,i){return xt(e,"__once__"+t+(i?"_"+i:""),!0),e}function xt(e,t,i){if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]&&"string"!=typeof e[n]&&Et(e[n],t+"_"+n,i);else Et(e,t,i)}function Et(e,t,i){e.isStatic=!0,e.key=t,e.isOnce=i}function At(e,t){if(t)if(d(t)){var i=e.on=e.on?P({},e.on):{};for(var n in t){var s=i[n],r=t[n];i[n]=s?[].concat(s,r):r}}else;return e}function kt(e,t,i,n){t=t||{$stable:!i};for(var s=0;s<e.length;s++){var r=e[s];Array.isArray(r)?kt(r,t,i):r&&(r.proxy&&(r.fn.proxy=!0),t[r.key]=r.fn)}return n&&(t.$key=n),t}function Pt(e,t){for(var i=0;i<t.length;i+=2){var n=t[i];"string"==typeof n&&n&&(e[t[i]]=t[i+1])}return e}function It(e,t){return"string"==typeof e?t+e:e}function Mt(e){e._o=_t,e._n=m,e._s=f,e._l=yt,e._t=vt,e._q=L,e._i=D,e._m=Tt,e._f=Ct,e._k=wt,e._b=bt,e._v=ve,e._e=ye,e._u=kt,e._g=At,e._d=Pt,e._p=It}function Rt(e,t,i,s,r){var a,h=this,l=r.options;S(s,"_uid")?(a=Object.create(s))._original=s:(a=s,s=s._original);var d=o(l._compiled),c=!d;this.data=e,this.props=t,this.children=i,this.parent=s,this.listeners=e.on||n,this.injections=ct(l.inject,s),this.slots=function(){return h.$slots||ft(e.scopedSlots,h.$slots=ut(i,s)),h.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ft(e.scopedSlots,this.slots())}}),d&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=ft(e.scopedSlots,this.$slots)),l._scopeId?this._c=function(e,t,i,n){var r=Ut(a,e,t,i,n,c);return r&&!Array.isArray(r)&&(r.fnScopeId=l._scopeId,r.fnContext=s),r}:this._c=function(e,t,i,n){return Ut(a,e,t,i,n,c)}}function Ot(e,t,i,n,s){var r=Ce(e);return r.fnContext=i,r.fnOptions=n,t.slot&&((r.data||(r.data={})).slot=t.slot),r}function Lt(e,t){for(var i in t)e[T(i)]=t[i]}Mt(Rt.prototype);var Dt={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var i=e;Dt.prepatch(i,i)}else{(e.componentInstance=function(e,t){var i={_isComponent:!0,_parentVnode:e,parent:t},n=e.data.inlineTemplate;r(n)&&(i.render=n.render,i.staticRenderFns=n.staticRenderFns);return new e.componentOptions.Ctor(i)}(e,Jt)).$mount(t?e.elm:void 0,t)}},prepatch:function(e,t){var i=t.componentOptions;!function(e,t,i,s,r){0;var o=s.data.scopedSlots,a=e.$scopedSlots,h=!!(o&&!o.$stable||a!==n&&!a.$stable||o&&e.$scopedSlots.$key!==o.$key),l=!!(r||e.$options._renderChildren||h);e.$options._parentVnode=s,e.$vnode=s,e._vnode&&(e._vnode.parent=s);if(e.$options._renderChildren=r,e.$attrs=s.data.attrs||n,e.$listeners=i||n,t&&e.$options.props){_e(!1);for(var d=e._props,c=e.$options._propKeys||[],u=0;u<c.length;u++){var p=c[u],f=e.$options.props;d[p]=je(p,f,t,e)}_e(!0),e.$options.propsData=t}i=i||n;var m=e.$options._parentListeners;e.$options._parentListeners=i,Kt(e,i,m),l&&(e.$slots=ut(r,s.context),e.$forceUpdate());0}(t.componentInstance=e.componentInstance,i.propsData,i.listeners,t,i.children)},insert:function(e){var t,i=e.context,n=e.componentInstance;n._isMounted||(n._isMounted=!0,ti(n,"mounted")),e.data.keepAlive&&(i._isMounted?((t=n)._inactive=!1,ni.push(t)):ei(n,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?function e(t,i){if(i&&(t._directInactive=!0,Zt(t)))return;if(!t._inactive){t._inactive=!0;for(var n=0;n<t.$children.length;n++)e(t.$children[n]);ti(t,"deactivated")}}(t,!0):t.$destroy())}},Nt=Object.keys(Dt);function Bt(e,t,i,a,l){if(!s(e)){var d=i.$options._base;if(h(e)&&(e=d.extend(e)),"function"==typeof e){var c;if(s(e.cid)&&void 0===(e=function(e,t){if(o(e.error)&&r(e.errorComp))return e.errorComp;if(r(e.resolved))return e.resolved;var i=$t;i&&r(e.owners)&&-1===e.owners.indexOf(i)&&e.owners.push(i);if(o(e.loading)&&r(e.loadingComp))return e.loadingComp;if(i&&!r(e.owners)){var n=e.owners=[i],a=!0,l=null,d=null;i.$on("hook:destroyed",(function(){return v(n,i)}));var c=function(e){for(var t=0,i=n.length;t<i;t++)n[t].$forceUpdate();e&&(n.length=0,null!==l&&(clearTimeout(l),l=null),null!==d&&(clearTimeout(d),d=null))},u=N((function(i){e.resolved=Wt(i,t),a?n.length=0:c(!0)})),f=N((function(t){r(e.errorComp)&&(e.error=!0,c(!0))})),m=e(u,f);return h(m)&&(p(m)?s(e.resolved)&&m.then(u,f):p(m.component)&&(m.component.then(u,f),r(m.error)&&(e.errorComp=Wt(m.error,t)),r(m.loading)&&(e.loadingComp=Wt(m.loading,t),0===m.delay?e.loading=!0:l=setTimeout((function(){l=null,s(e.resolved)&&s(e.error)&&(e.loading=!0,c(!1))}),m.delay||200)),r(m.timeout)&&(d=setTimeout((function(){d=null,s(e.resolved)&&f(null)}),m.timeout)))),a=!1,e.loading?e.loadingComp:e.resolved}}(c=e,d)))return function(e,t,i,n,s){var r=ye();return r.asyncFactory=e,r.asyncMeta={data:t,context:i,children:n,tag:s},r}(c,t,i,a,l);t=t||{},Ti(e),r(t.model)&&function(e,t){var i=e.model&&e.model.prop||"value",n=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[i]=t.model.value;var s=t.on||(t.on={}),o=s[n],a=t.model.callback;r(o)?(Array.isArray(o)?-1===o.indexOf(a):o!==a)&&(s[n]=[a].concat(o)):s[n]=a}(e.options,t);var u=function(e,t,i){var n=t.options.props;if(!s(n)){var o={},a=e.attrs,h=e.props;if(r(a)||r(h))for(var l in n){var d=E(l);ht(o,h,l,d,!0)||ht(o,a,l,d,!1)}return o}}(t,e);if(o(e.options.functional))return function(e,t,i,s,o){var a=e.options,h={},l=a.props;if(r(l))for(var d in l)h[d]=je(d,l,t||n);else r(i.attrs)&&Lt(h,i.attrs),r(i.props)&&Lt(h,i.props);var c=new Rt(i,h,o,s,e),u=a.render.call(null,c._c,c);if(u instanceof me)return Ot(u,i,c.parent,a,c);if(Array.isArray(u)){for(var p=lt(u)||[],f=new Array(p.length),m=0;m<p.length;m++)f[m]=Ot(p[m],i,c.parent,a,c);return f}}(e,u,t,i,a);var f=t.on;if(t.on=t.nativeOn,o(e.options.abstract)){var m=t.slot;t={},m&&(t.slot=m)}!function(e){for(var t=e.hook||(e.hook={}),i=0;i<Nt.length;i++){var n=Nt[i],s=t[n],r=Dt[n];s===r||s&&s._merged||(t[n]=s?jt(r,s):r)}}(t);var g=e.options.name||l;return new me("vue-component-"+e.cid+(g?"-"+g:""),t,void 0,void 0,void 0,i,{Ctor:e,propsData:u,listeners:f,tag:l,children:a},c)}}}function jt(e,t){var i=function(i,n){e(i,n),t(i,n)};return i._merged=!0,i}var Ft=1,Gt=2;function Ut(e,t,i,n,l,d){return(Array.isArray(i)||a(i))&&(l=n,n=i,i=void 0),o(d)&&(l=Gt),function(e,t,i,n,a){if(r(i)&&r(i.__ob__))return ye();r(i)&&r(i.is)&&(t=i.is);if(!t)return ye();0;Array.isArray(n)&&"function"==typeof n[0]&&((i=i||{}).scopedSlots={default:n[0]},n.length=0);a===Gt?n=lt(n):a===Ft&&(n=function(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}(n));var l,d;if("string"==typeof t){var c;d=e.$vnode&&e.$vnode.ns||G.getTagNamespace(t),l=G.isReservedTag(t)?new me(G.parsePlatformTagName(t),i,n,void 0,void 0,e):i&&i.pre||!r(c=Be(e.$options,"components",t))?new me(t,i,n,void 0,void 0,e):Bt(c,i,e,n,t)}else l=Bt(t,i,e,n);return Array.isArray(l)?l:r(l)?(r(d)&&function e(t,i,n){t.ns=i,"foreignObject"===t.tag&&(i=void 0,n=!0);if(r(t.children))for(var a=0,h=t.children.length;a<h;a++){var l=t.children[a];r(l.tag)&&(s(l.ns)||o(n)&&"svg"!==l.tag)&&e(l,i,n)}}(l,d),r(i)&&function(e){h(e.style)&&nt(e.style);h(e.class)&&nt(e.class)}(i),l):ye()}(e,t,i,n,l)}var Ht,$t=null;function Wt(e,t){return(e.__esModule||he&&"Module"===e[Symbol.toStringTag])&&(e=e.default),h(e)?t.extend(e):e}function zt(e){return e.isComment&&e.asyncFactory}function Yt(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];if(r(i)&&(r(i.componentOptions)||zt(i)))return i}}function Vt(e,t){Ht.$on(e,t)}function Xt(e,t){Ht.$off(e,t)}function qt(e,t){var i=Ht;return function n(){var s=t.apply(null,arguments);null!==s&&i.$off(e,n)}}function Kt(e,t,i){Ht=e,ot(t,i||{},Vt,Xt,qt,e),Ht=void 0}var Jt=null;function Qt(e){var t=Jt;return Jt=e,function(){Jt=t}}function Zt(e){for(;e&&(e=e.$parent);)if(e._inactive)return!0;return!1}function ei(e,t){if(t){if(e._directInactive=!1,Zt(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var i=0;i<e.$children.length;i++)ei(e.$children[i]);ti(e,"activated")}}function ti(e,t){pe();var i=e.$options[t],n=t+" hook";if(i)for(var s=0,r=i.length;s<r;s++)$e(i[s],e,null,e,n);e._hasHookEvent&&e.$emit("hook:"+t),fe()}var ii=[],ni=[],si={},ri=!1,oi=!1,ai=0;var hi=0,li=Date.now;if(Y&&!K){var di=window.performance;di&&"function"==typeof di.now&&li()>document.createEvent("Event").timeStamp&&(li=function(){return di.now()})}function ci(){var e,t;for(hi=li(),oi=!0,ii.sort((function(e,t){return e.id-t.id})),ai=0;ai<ii.length;ai++)(e=ii[ai]).before&&e.before(),t=e.id,si[t]=null,e.run();var i=ni.slice(),n=ii.slice();ai=ii.length=ni.length=0,si={},ri=oi=!1,function(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,ei(e[t],!0)}(i),function(e){var t=e.length;for(;t--;){var i=e[t],n=i.vm;n._watcher===i&&n._isMounted&&!n._isDestroyed&&ti(n,"updated")}}(n),re&&G.devtools&&re.emit("flush")}var ui=0,pi=function(e,t,i,n,s){this.vm=e,s&&(e._watcher=this),e._watchers.push(this),n?(this.deep=!!n.deep,this.user=!!n.user,this.lazy=!!n.lazy,this.sync=!!n.sync,this.before=n.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=i,this.id=++ui,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ae,this.newDepIds=new ae,this.expression="","function"==typeof t?this.getter=t:(this.getter=function(e){if(!$.test(e)){var t=e.split(".");return function(e){for(var i=0;i<t.length;i++){if(!e)return;e=e[t[i]]}return e}}}(t),this.getter||(this.getter=M)),this.value=this.lazy?void 0:this.get()};pi.prototype.get=function(){var e;pe(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;He(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&nt(e),fe(),this.cleanupDeps()}return e},pi.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},pi.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},pi.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(e){var t=e.id;if(null==si[t]){if(si[t]=!0,oi){for(var i=ii.length-1;i>ai&&ii[i].id>e.id;)i--;ii.splice(i+1,0,e)}else ii.push(e);ri||(ri=!0,tt(ci))}}(this)},pi.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||h(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){He(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},pi.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},pi.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},pi.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||v(this.vm._watchers,this);for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1}};var fi={enumerable:!0,configurable:!0,get:M,set:M};function mi(e,t,i){fi.get=function(){return this[t][i]},fi.set=function(e){this[t][i]=e},Object.defineProperty(e,i,fi)}function gi(e){e._watchers=[];var t=e.$options;t.props&&function(e,t){var i=e.$options.propsData||{},n=e._props={},s=e.$options._propKeys=[];e.$parent&&_e(!1);var r=function(r){s.push(r);var o=je(r,t,i,e);Ae(n,r,o),r in e||mi(e,"_props",r)};for(var o in t)r(o);_e(!0)}(e,t.props),t.methods&&function(e,t){e.$options.props;for(var i in t)e[i]="function"!=typeof t[i]?M:A(t[i],e)}(e,t.methods),t.data?function(e){var t=e.$options.data;d(t=e._data="function"==typeof t?function(e,t){pe();try{return e.call(t,t)}catch(e){return He(e,t,"data()"),{}}finally{fe()}}(t,e):t||{})||(t={});var i=Object.keys(t),n=e.$options.props,s=(e.$options.methods,i.length);for(;s--;){var r=i[s];0,n&&S(n,r)||(o=void 0,36!==(o=(r+"").charCodeAt(0))&&95!==o&&mi(e,"_data",r))}var o;Ee(t,!0)}(e):Ee(e._data={},!0),t.computed&&function(e,t){var i=e._computedWatchers=Object.create(null),n=se();for(var s in t){var r=t[s],o="function"==typeof r?r:r.get;0,n||(i[s]=new pi(e,o||M,M,yi)),s in e||vi(e,s,r)}}(e,t.computed),t.watch&&t.watch!==te&&function(e,t){for(var i in t){var n=t[i];if(Array.isArray(n))for(var s=0;s<n.length;s++)wi(e,i,n[s]);else wi(e,i,n)}}(e,t.watch)}var yi={lazy:!0};function vi(e,t,i){var n=!se();"function"==typeof i?(fi.get=n?Ci(t):Si(i),fi.set=M):(fi.get=i.get?n&&!1!==i.cache?Ci(t):Si(i.get):M,fi.set=i.set||M),Object.defineProperty(e,t,fi)}function Ci(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),ce.target&&t.depend(),t.value}}function Si(e){return function(){return e.call(this,this)}}function wi(e,t,i,n){return d(i)&&(n=i,i=i.handler),"string"==typeof i&&(i=e[i]),e.$watch(t,i,n)}var bi=0;function Ti(e){var t=e.options;if(e.super){var i=Ti(e.super);if(i!==e.superOptions){e.superOptions=i;var n=function(e){var t,i=e.options,n=e.sealedOptions;for(var s in i)i[s]!==n[s]&&(t||(t={}),t[s]=i[s]);return t}(e);n&&P(e.extendOptions,n),(t=e.options=Ne(i,e.extendOptions)).name&&(t.components[t.name]=e)}}return t}function _i(e){this._init(e)}function xi(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var i=this,n=i.cid,s=e._Ctor||(e._Ctor={});if(s[n])return s[n];var r=e.name||i.options.name;var o=function(e){this._init(e)};return(o.prototype=Object.create(i.prototype)).constructor=o,o.cid=t++,o.options=Ne(i.options,e),o.super=i,o.options.props&&function(e){var t=e.options.props;for(var i in t)mi(e.prototype,"_props",i)}(o),o.options.computed&&function(e){var t=e.options.computed;for(var i in t)vi(e.prototype,i,t[i])}(o),o.extend=i.extend,o.mixin=i.mixin,o.use=i.use,j.forEach((function(e){o[e]=i[e]})),r&&(o.options.components[r]=o),o.superOptions=i.options,o.extendOptions=e,o.sealedOptions=P({},o.options),s[n]=o,o}}function Ei(e){return e&&(e.Ctor.options.name||e.tag)}function Ai(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:!!c(e)&&e.test(t)}function ki(e,t){var i=e.cache,n=e.keys,s=e._vnode;for(var r in i){var o=i[r];if(o){var a=Ei(o.componentOptions);a&&!t(a)&&Pi(i,r,n,s)}}}function Pi(e,t,i,n){var s=e[t];!s||n&&s.tag===n.tag||s.componentInstance.$destroy(),e[t]=null,v(i,t)}!function(e){e.prototype._init=function(e){var t=this;t._uid=bi++,t._isVue=!0,e&&e._isComponent?function(e,t){var i=e.$options=Object.create(e.constructor.options),n=t._parentVnode;i.parent=t.parent,i._parentVnode=n;var s=n.componentOptions;i.propsData=s.propsData,i._parentListeners=s.listeners,i._renderChildren=s.children,i._componentTag=s.tag,t.render&&(i.render=t.render,i.staticRenderFns=t.staticRenderFns)}(t,e):t.$options=Ne(Ti(t.constructor),e||{},t),t._renderProxy=t,t._self=t,function(e){var t=e.$options,i=t.parent;if(i&&!t.abstract){for(;i.$options.abstract&&i.$parent;)i=i.$parent;i.$children.push(e)}e.$parent=i,e.$root=i?i.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}(t),function(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&Kt(e,t)}(t),function(e){e._vnode=null,e._staticTrees=null;var t=e.$options,i=e.$vnode=t._parentVnode,s=i&&i.context;e.$slots=ut(t._renderChildren,s),e.$scopedSlots=n,e._c=function(t,i,n,s){return Ut(e,t,i,n,s,!1)},e.$createElement=function(t,i,n,s){return Ut(e,t,i,n,s,!0)};var r=i&&i.data;Ae(e,"$attrs",r&&r.attrs||n,null,!0),Ae(e,"$listeners",t._parentListeners||n,null,!0)}(t),ti(t,"beforeCreate"),function(e){var t=ct(e.$options.inject,e);t&&(_e(!1),Object.keys(t).forEach((function(i){Ae(e,i,t[i])})),_e(!0))}(t),gi(t),function(e){var t=e.$options.provide;t&&(e._provided="function"==typeof t?t.call(e):t)}(t),ti(t,"created"),t.$options.el&&t.$mount(t.$options.el)}}(_i),function(e){var t={get:function(){return this._data}},i={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",i),e.prototype.$set=ke,e.prototype.$delete=Pe,e.prototype.$watch=function(e,t,i){if(d(t))return wi(this,e,t,i);(i=i||{}).user=!0;var n=new pi(this,e,t,i);if(i.immediate)try{t.call(this,n.value)}catch(e){He(e,this,'callback for immediate watcher "'+n.expression+'"')}return function(){n.teardown()}}}(_i),function(e){var t=/^hook:/;e.prototype.$on=function(e,i){var n=this;if(Array.isArray(e))for(var s=0,r=e.length;s<r;s++)n.$on(e[s],i);else(n._events[e]||(n._events[e]=[])).push(i),t.test(e)&&(n._hasHookEvent=!0);return n},e.prototype.$once=function(e,t){var i=this;function n(){i.$off(e,n),t.apply(i,arguments)}return n.fn=t,i.$on(e,n),i},e.prototype.$off=function(e,t){var i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(e)){for(var n=0,s=e.length;n<s;n++)i.$off(e[n],t);return i}var r,o=i._events[e];if(!o)return i;if(!t)return i._events[e]=null,i;for(var a=o.length;a--;)if((r=o[a])===t||r.fn===t){o.splice(a,1);break}return i},e.prototype.$emit=function(e){var t=this,i=t._events[e];if(i){i=i.length>1?k(i):i;for(var n=k(arguments,1),s='event handler for "'+e+'"',r=0,o=i.length;r<o;r++)$e(i[r],t,n,t,s)}return t}}(_i),function(e){e.prototype._update=function(e,t){var i=this,n=i.$el,s=i._vnode,r=Qt(i);i._vnode=e,i.$el=s?i.__patch__(s,e):i.__patch__(i.$el,e,t,!1),r(),n&&(n.__vue__=null),i.$el&&(i.$el.__vue__=i),i.$vnode&&i.$parent&&i.$vnode===i.$parent._vnode&&(i.$parent.$el=i.$el)},e.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){ti(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||v(t.$children,e),e._watcher&&e._watcher.teardown();for(var i=e._watchers.length;i--;)e._watchers[i].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),ti(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}(_i),function(e){Mt(e.prototype),e.prototype.$nextTick=function(e){return tt(e,this)},e.prototype._render=function(){var e,t=this,i=t.$options,n=i.render,s=i._parentVnode;s&&(t.$scopedSlots=ft(s.data.scopedSlots,t.$slots,t.$scopedSlots)),t.$vnode=s;try{$t=t,e=n.call(t._renderProxy,t.$createElement)}catch(i){He(i,t,"render"),e=t._vnode}finally{$t=null}return Array.isArray(e)&&1===e.length&&(e=e[0]),e instanceof me||(e=ye()),e.parent=s,e}}(_i);var Ii=[String,RegExp,Array],Mi={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Ii,exclude:Ii,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)Pi(this.cache,e,this.keys)},mounted:function(){var e=this;this.$watch("include",(function(t){ki(e,(function(e){return Ai(t,e)}))})),this.$watch("exclude",(function(t){ki(e,(function(e){return!Ai(t,e)}))}))},render:function(){var e=this.$slots.default,t=Yt(e),i=t&&t.componentOptions;if(i){var n=Ei(i),s=this.include,r=this.exclude;if(s&&(!n||!Ai(s,n))||r&&n&&Ai(r,n))return t;var o=this.cache,a=this.keys,h=null==t.key?i.Ctor.cid+(i.tag?"::"+i.tag:""):t.key;o[h]?(t.componentInstance=o[h].componentInstance,v(a,h),a.push(h)):(o[h]=t,a.push(h),this.max&&a.length>parseInt(this.max)&&Pi(o,a[0],a,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}}};!function(e){var t={get:function(){return G}};Object.defineProperty(e,"config",t),e.util={warn:le,extend:P,mergeOptions:Ne,defineReactive:Ae},e.set=ke,e.delete=Pe,e.nextTick=tt,e.observable=function(e){return Ee(e),e},e.options=Object.create(null),j.forEach((function(t){e.options[t+"s"]=Object.create(null)})),e.options._base=e,P(e.options.components,Mi),function(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var i=k(arguments,1);return i.unshift(this),"function"==typeof e.install?e.install.apply(e,i):"function"==typeof e&&e.apply(null,i),t.push(e),this}}(e),function(e){e.mixin=function(e){return this.options=Ne(this.options,e),this}}(e),xi(e),function(e){j.forEach((function(t){e[t]=function(e,i){return i?("component"===t&&d(i)&&(i.name=i.name||e,i=this.options._base.extend(i)),"directive"===t&&"function"==typeof i&&(i={bind:i,update:i}),this.options[t+"s"][e]=i,i):this.options[t+"s"][e]}}))}(e)}(_i),Object.defineProperty(_i.prototype,"$isServer",{get:se}),Object.defineProperty(_i.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(_i,"FunctionalRenderContext",{value:Rt}),_i.version="2.6.12";var Ri=g("style,class"),Oi=g("input,textarea,option,select,progress"),Li=g("contenteditable,draggable,spellcheck"),Di=g("events,caret,typing,plaintext-only"),Ni=function(e,t){return Ui(t)||"false"===t?"false":"contenteditable"===e&&Di(t)?t:"true"},Bi=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),ji="http://www.w3.org/1999/xlink",Fi=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Gi=function(e){return Fi(e)?e.slice(6,e.length):""},Ui=function(e){return null==e||!1===e};function Hi(e){for(var t=e.data,i=e,n=e;r(n.componentInstance);)(n=n.componentInstance._vnode)&&n.data&&(t=$i(n.data,t));for(;r(i=i.parent);)i&&i.data&&(t=$i(t,i.data));return function(e,t){if(r(e)||r(t))return Wi(e,zi(t));return""}(t.staticClass,t.class)}function $i(e,t){return{staticClass:Wi(e.staticClass,t.staticClass),class:r(e.class)?[e.class,t.class]:t.class}}function Wi(e,t){return e?t?e+" "+t:e:t||""}function zi(e){return Array.isArray(e)?function(e){for(var t,i="",n=0,s=e.length;n<s;n++)r(t=zi(e[n]))&&""!==t&&(i&&(i+=" "),i+=t);return i}(e):h(e)?function(e){var t="";for(var i in e)e[i]&&(t&&(t+=" "),t+=i);return t}(e):"string"==typeof e?e:""}var Yi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Vi=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Xi=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),qi=function(e){return Vi(e)||Xi(e)};var Ki=Object.create(null);var Ji=g("text,number,password,search,email,tel,url");var Qi=Object.freeze({createElement:function(e,t){var i=document.createElement(e);return"select"!==e?i:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&i.setAttribute("multiple","multiple"),i)},createElementNS:function(e,t){return document.createElementNS(Yi[e],t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,i){e.insertBefore(t,i)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},setStyleScope:function(e,t){e.setAttribute(t,"")}}),Zi={create:function(e,t){en(t)},update:function(e,t){e.data.ref!==t.data.ref&&(en(e,!0),en(t))},destroy:function(e){en(e,!0)}};function en(e,t){var i=e.data.ref;if(r(i)){var n=e.context,s=e.componentInstance||e.elm,o=n.$refs;t?Array.isArray(o[i])?v(o[i],s):o[i]===s&&(o[i]=void 0):e.data.refInFor?Array.isArray(o[i])?o[i].indexOf(s)<0&&o[i].push(s):o[i]=[s]:o[i]=s}}var tn=new me("",{},[]),nn=["create","activate","update","remove","destroy"];function sn(e,t){return e.key===t.key&&(e.tag===t.tag&&e.isComment===t.isComment&&r(e.data)===r(t.data)&&function(e,t){if("input"!==e.tag)return!0;var i,n=r(i=e.data)&&r(i=i.attrs)&&i.type,s=r(i=t.data)&&r(i=i.attrs)&&i.type;return n===s||Ji(n)&&Ji(s)}(e,t)||o(e.isAsyncPlaceholder)&&e.asyncFactory===t.asyncFactory&&s(t.asyncFactory.error))}function rn(e,t,i){var n,s,o={};for(n=t;n<=i;++n)r(s=e[n].key)&&(o[s]=n);return o}var on={create:an,update:an,destroy:function(e){an(e,tn)}};function an(e,t){(e.data.directives||t.data.directives)&&function(e,t){var i,n,s,r=e===tn,o=t===tn,a=ln(e.data.directives,e.context),h=ln(t.data.directives,t.context),l=[],d=[];for(i in h)n=a[i],s=h[i],n?(s.oldValue=n.value,s.oldArg=n.arg,cn(s,"update",t,e),s.def&&s.def.componentUpdated&&d.push(s)):(cn(s,"bind",t,e),s.def&&s.def.inserted&&l.push(s));if(l.length){var c=function(){for(var i=0;i<l.length;i++)cn(l[i],"inserted",t,e)};r?at(t,"insert",c):c()}d.length&&at(t,"postpatch",(function(){for(var i=0;i<d.length;i++)cn(d[i],"componentUpdated",t,e)}));if(!r)for(i in a)h[i]||cn(a[i],"unbind",e,e,o)}(e,t)}var hn=Object.create(null);function ln(e,t){var i,n,s=Object.create(null);if(!e)return s;for(i=0;i<e.length;i++)(n=e[i]).modifiers||(n.modifiers=hn),s[dn(n)]=n,n.def=Be(t.$options,"directives",n.name);return s}function dn(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function cn(e,t,i,n,s){var r=e.def&&e.def[t];if(r)try{r(i.elm,e,i,n,s)}catch(n){He(n,i.context,"directive "+e.name+" "+t+" hook")}}var un=[Zi,on];function pn(e,t){var i=t.componentOptions;if(!(r(i)&&!1===i.Ctor.options.inheritAttrs||s(e.data.attrs)&&s(t.data.attrs))){var n,o,a=t.elm,h=e.data.attrs||{},l=t.data.attrs||{};for(n in r(l.__ob__)&&(l=t.data.attrs=P({},l)),l)o=l[n],h[n]!==o&&fn(a,n,o);for(n in(K||Q)&&l.value!==h.value&&fn(a,"value",l.value),h)s(l[n])&&(Fi(n)?a.removeAttributeNS(ji,Gi(n)):Li(n)||a.removeAttribute(n))}}function fn(e,t,i){e.tagName.indexOf("-")>-1?mn(e,t,i):Bi(t)?Ui(i)?e.removeAttribute(t):(i="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,i)):Li(t)?e.setAttribute(t,Ni(t,i)):Fi(t)?Ui(i)?e.removeAttributeNS(ji,Gi(t)):e.setAttributeNS(ji,t,i):mn(e,t,i)}function mn(e,t,i){if(Ui(i))e.removeAttribute(t);else{if(K&&!J&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==i&&!e.__ieph){var n=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",n)};e.addEventListener("input",n),e.__ieph=!0}e.setAttribute(t,i)}}var gn={create:pn,update:pn};function yn(e,t){var i=t.elm,n=t.data,o=e.data;if(!(s(n.staticClass)&&s(n.class)&&(s(o)||s(o.staticClass)&&s(o.class)))){var a=Hi(t),h=i._transitionClasses;r(h)&&(a=Wi(a,zi(h))),a!==i._prevClass&&(i.setAttribute("class",a),i._prevClass=a)}}var vn,Cn={create:yn,update:yn},Sn="__r",wn="__c";function bn(e,t,i){var n=vn;return function s(){var r=t.apply(null,arguments);null!==r&&xn(e,s,i,n)}}var Tn=Ve&&!(ee&&Number(ee[1])<=53);function _n(e,t,i,n){if(Tn){var s=hi,r=t;t=r._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=s||e.timeStamp<=0||e.target.ownerDocument!==document)return r.apply(this,arguments)}}vn.addEventListener(e,t,ie?{capture:i,passive:n}:i)}function xn(e,t,i,n){(n||vn).removeEventListener(e,t._wrapper||t,i)}function En(e,t){if(!s(e.data.on)||!s(t.data.on)){var i=t.data.on||{},n=e.data.on||{};vn=t.elm,function(e){if(r(e[Sn])){var t=K?"change":"input";e[t]=[].concat(e[Sn],e[t]||[]),delete e[Sn]}r(e[wn])&&(e.change=[].concat(e[wn],e.change||[]),delete e[wn])}(i),ot(i,n,_n,xn,bn,t.context),vn=void 0}}var An,kn={create:En,update:En};function Pn(e,t){if(!s(e.data.domProps)||!s(t.data.domProps)){var i,n,o=t.elm,a=e.data.domProps||{},h=t.data.domProps||{};for(i in r(h.__ob__)&&(h=t.data.domProps=P({},h)),a)i in h||(o[i]="");for(i in h){if(n=h[i],"textContent"===i||"innerHTML"===i){if(t.children&&(t.children.length=0),n===a[i])continue;1===o.childNodes.length&&o.removeChild(o.childNodes[0])}if("value"===i&&"PROGRESS"!==o.tagName){o._value=n;var l=s(n)?"":String(n);In(o,l)&&(o.value=l)}else if("innerHTML"===i&&Xi(o.tagName)&&s(o.innerHTML)){(An=An||document.createElement("div")).innerHTML="<svg>"+n+"</svg>";for(var d=An.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;d.firstChild;)o.appendChild(d.firstChild)}else if(n!==a[i])try{o[i]=n}catch(e){}}}}function In(e,t){return!e.composing&&("OPTION"===e.tagName||function(e,t){var i=!0;try{i=document.activeElement!==e}catch(e){}return i&&e.value!==t}(e,t)||function(e,t){var i=e.value,n=e._vModifiers;if(r(n)){if(n.number)return m(i)!==m(t);if(n.trim)return i.trim()!==t.trim()}return i!==t}(e,t))}var Mn={create:Pn,update:Pn},Rn=w((function(e){var t={},i=/:(.+)/;return e.split(/;(?![^(]*\))/g).forEach((function(e){if(e){var n=e.split(i);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}));function On(e){var t=Ln(e.style);return e.staticStyle?P(e.staticStyle,t):t}function Ln(e){return Array.isArray(e)?I(e):"string"==typeof e?Rn(e):e}var Dn,Nn=/^--/,Bn=/\s*!important$/,jn=function(e,t,i){if(Nn.test(t))e.style.setProperty(t,i);else if(Bn.test(i))e.style.setProperty(E(t),i.replace(Bn,""),"important");else{var n=Gn(t);if(Array.isArray(i))for(var s=0,r=i.length;s<r;s++)e.style[n]=i[s];else e.style[n]=i}},Fn=["Webkit","Moz","ms"],Gn=w((function(e){if(Dn=Dn||document.createElement("div").style,"filter"!==(e=T(e))&&e in Dn)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),i=0;i<Fn.length;i++){var n=Fn[i]+t;if(n in Dn)return n}}));function Un(e,t){var i=t.data,n=e.data;if(!(s(i.staticStyle)&&s(i.style)&&s(n.staticStyle)&&s(n.style))){var o,a,h=t.elm,l=n.staticStyle,d=n.normalizedStyle||n.style||{},c=l||d,u=Ln(t.data.style)||{};t.data.normalizedStyle=r(u.__ob__)?P({},u):u;var p=function(e,t){var i,n={};if(t)for(var s=e;s.componentInstance;)(s=s.componentInstance._vnode)&&s.data&&(i=On(s.data))&&P(n,i);(i=On(e.data))&&P(n,i);for(var r=e;r=r.parent;)r.data&&(i=On(r.data))&&P(n,i);return n}(t,!0);for(a in c)s(p[a])&&jn(h,a,"");for(a in p)(o=p[a])!==c[a]&&jn(h,a,null==o?"":o)}}var Hn={create:Un,update:Un},$n=/\s+/;function Wn(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split($n).forEach((function(t){return e.classList.add(t)})):e.classList.add(t);else{var i=" "+(e.getAttribute("class")||"")+" ";i.indexOf(" "+t+" ")<0&&e.setAttribute("class",(i+t).trim())}}function zn(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split($n).forEach((function(t){return e.classList.remove(t)})):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var i=" "+(e.getAttribute("class")||"")+" ",n=" "+t+" ";i.indexOf(n)>=0;)i=i.replace(n," ");(i=i.trim())?e.setAttribute("class",i):e.removeAttribute("class")}}function Yn(e){if(e){if("object"==typeof e){var t={};return!1!==e.css&&P(t,Vn(e.name||"v")),P(t,e),t}return"string"==typeof e?Vn(e):void 0}}var Vn=w((function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}})),Xn=Y&&!J,qn="transition",Kn="animation",Jn="transition",Qn="transitionend",Zn="animation",es="animationend";Xn&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Jn="WebkitTransition",Qn="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Zn="WebkitAnimation",es="webkitAnimationEnd"));var ts=Y?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function is(e){ts((function(){ts(e)}))}function ns(e,t){var i=e._transitionClasses||(e._transitionClasses=[]);i.indexOf(t)<0&&(i.push(t),Wn(e,t))}function ss(e,t){e._transitionClasses&&v(e._transitionClasses,t),zn(e,t)}function rs(e,t,i){var n=as(e,t),s=n.type,r=n.timeout,o=n.propCount;if(!s)return i();var a=s===qn?Qn:es,h=0,l=function(){e.removeEventListener(a,d),i()},d=function(t){t.target===e&&++h>=o&&l()};setTimeout((function(){h<o&&l()}),r+1),e.addEventListener(a,d)}var os=/\b(transform|all)(,|$)/;function as(e,t){var i,n=window.getComputedStyle(e),s=(n[Jn+"Delay"]||"").split(", "),r=(n[Jn+"Duration"]||"").split(", "),o=hs(s,r),a=(n[Zn+"Delay"]||"").split(", "),h=(n[Zn+"Duration"]||"").split(", "),l=hs(a,h),d=0,c=0;return t===qn?o>0&&(i=qn,d=o,c=r.length):t===Kn?l>0&&(i=Kn,d=l,c=h.length):c=(i=(d=Math.max(o,l))>0?o>l?qn:Kn:null)?i===qn?r.length:h.length:0,{type:i,timeout:d,propCount:c,hasTransform:i===qn&&os.test(n[Jn+"Property"])}}function hs(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max.apply(null,t.map((function(t,i){return ls(t)+ls(e[i])})))}function ls(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function ds(e,t){var i=e.elm;r(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var n=Yn(e.data.transition);if(!s(n)&&!r(i._enterCb)&&1===i.nodeType){for(var o=n.css,a=n.type,l=n.enterClass,d=n.enterToClass,c=n.enterActiveClass,u=n.appearClass,p=n.appearToClass,f=n.appearActiveClass,g=n.beforeEnter,y=n.enter,v=n.afterEnter,C=n.enterCancelled,S=n.beforeAppear,w=n.appear,b=n.afterAppear,T=n.appearCancelled,_=n.duration,x=Jt,E=Jt.$vnode;E&&E.parent;)x=E.context,E=E.parent;var A=!x._isMounted||!e.isRootInsert;if(!A||w||""===w){var k=A&&u?u:l,P=A&&f?f:c,I=A&&p?p:d,M=A&&S||g,R=A&&"function"==typeof w?w:y,O=A&&b||v,L=A&&T||C,D=m(h(_)?_.enter:_);0;var B=!1!==o&&!J,j=ps(R),F=i._enterCb=N((function(){B&&(ss(i,I),ss(i,P)),F.cancelled?(B&&ss(i,k),L&&L(i)):O&&O(i),i._enterCb=null}));e.data.show||at(e,"insert",(function(){var t=i.parentNode,n=t&&t._pending&&t._pending[e.key];n&&n.tag===e.tag&&n.elm._leaveCb&&n.elm._leaveCb(),R&&R(i,F)})),M&&M(i),B&&(ns(i,k),ns(i,P),is((function(){ss(i,k),F.cancelled||(ns(i,I),j||(us(D)?setTimeout(F,D):rs(i,a,F)))}))),e.data.show&&(t&&t(),R&&R(i,F)),B||j||F()}}}function cs(e,t){var i=e.elm;r(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var n=Yn(e.data.transition);if(s(n)||1!==i.nodeType)return t();if(!r(i._leaveCb)){var o=n.css,a=n.type,l=n.leaveClass,d=n.leaveToClass,c=n.leaveActiveClass,u=n.beforeLeave,p=n.leave,f=n.afterLeave,g=n.leaveCancelled,y=n.delayLeave,v=n.duration,C=!1!==o&&!J,S=ps(p),w=m(h(v)?v.leave:v);0;var b=i._leaveCb=N((function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[e.key]=null),C&&(ss(i,d),ss(i,c)),b.cancelled?(C&&ss(i,l),g&&g(i)):(t(),f&&f(i)),i._leaveCb=null}));y?y(T):T()}function T(){b.cancelled||(!e.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[e.key]=e),u&&u(i),C&&(ns(i,l),ns(i,c),is((function(){ss(i,l),b.cancelled||(ns(i,d),S||(us(w)?setTimeout(b,w):rs(i,a,b)))}))),p&&p(i,b),C||S||b())}}function us(e){return"number"==typeof e&&!isNaN(e)}function ps(e){if(s(e))return!1;var t=e.fns;return r(t)?ps(Array.isArray(t)?t[0]:t):(e._length||e.length)>1}function fs(e,t){!0!==t.data.show&&ds(t)}var ms=function(e){var t,i,n={},h=e.modules,l=e.nodeOps;for(t=0;t<nn.length;++t)for(n[nn[t]]=[],i=0;i<h.length;++i)r(h[i][nn[t]])&&n[nn[t]].push(h[i][nn[t]]);function d(e){var t=l.parentNode(e);r(t)&&l.removeChild(t,e)}function c(e,t,i,s,a,h,d){if(r(e.elm)&&r(h)&&(e=h[d]=Ce(e)),e.isRootInsert=!a,!function(e,t,i,s){var a=e.data;if(r(a)){var h=r(e.componentInstance)&&a.keepAlive;if(r(a=a.hook)&&r(a=a.init)&&a(e,!1),r(e.componentInstance))return u(e,t),p(i,e.elm,s),o(h)&&function(e,t,i,s){var o,a=e;for(;a.componentInstance;)if(a=a.componentInstance._vnode,r(o=a.data)&&r(o=o.transition)){for(o=0;o<n.activate.length;++o)n.activate[o](tn,a);t.push(a);break}p(i,e.elm,s)}(e,t,i,s),!0}}(e,t,i,s)){var c=e.data,m=e.children,g=e.tag;r(g)?(e.elm=e.ns?l.createElementNS(e.ns,g):l.createElement(g,e),v(e),f(e,m,t),r(c)&&y(e,t),p(i,e.elm,s)):o(e.isComment)?(e.elm=l.createComment(e.text),p(i,e.elm,s)):(e.elm=l.createTextNode(e.text),p(i,e.elm,s))}}function u(e,t){r(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,m(e)?(y(e,t),v(e)):(en(e),t.push(e))}function p(e,t,i){r(e)&&(r(i)?l.parentNode(i)===e&&l.insertBefore(e,t,i):l.appendChild(e,t))}function f(e,t,i){if(Array.isArray(t)){0;for(var n=0;n<t.length;++n)c(t[n],i,e.elm,null,!0,t,n)}else a(e.text)&&l.appendChild(e.elm,l.createTextNode(String(e.text)))}function m(e){for(;e.componentInstance;)e=e.componentInstance._vnode;return r(e.tag)}function y(e,i){for(var s=0;s<n.create.length;++s)n.create[s](tn,e);r(t=e.data.hook)&&(r(t.create)&&t.create(tn,e),r(t.insert)&&i.push(e))}function v(e){var t;if(r(t=e.fnScopeId))l.setStyleScope(e.elm,t);else for(var i=e;i;)r(t=i.context)&&r(t=t.$options._scopeId)&&l.setStyleScope(e.elm,t),i=i.parent;r(t=Jt)&&t!==e.context&&t!==e.fnContext&&r(t=t.$options._scopeId)&&l.setStyleScope(e.elm,t)}function C(e,t,i,n,s,r){for(;n<=s;++n)c(i[n],r,e,t,!1,i,n)}function S(e){var t,i,s=e.data;if(r(s))for(r(t=s.hook)&&r(t=t.destroy)&&t(e),t=0;t<n.destroy.length;++t)n.destroy[t](e);if(r(t=e.children))for(i=0;i<e.children.length;++i)S(e.children[i])}function w(e,t,i){for(;t<=i;++t){var n=e[t];r(n)&&(r(n.tag)?(b(n),S(n)):d(n.elm))}}function b(e,t){if(r(t)||r(e.data)){var i,s=n.remove.length+1;for(r(t)?t.listeners+=s:t=function(e,t){function i(){0==--i.listeners&&d(e)}return i.listeners=t,i}(e.elm,s),r(i=e.componentInstance)&&r(i=i._vnode)&&r(i.data)&&b(i,t),i=0;i<n.remove.length;++i)n.remove[i](e,t);r(i=e.data.hook)&&r(i=i.remove)?i(e,t):t()}else d(e.elm)}function T(e,t,i,n){for(var s=i;s<n;s++){var o=t[s];if(r(o)&&sn(e,o))return s}}function _(e,t,i,a,h,d){if(e!==t){r(t.elm)&&r(a)&&(t=a[h]=Ce(t));var u=t.elm=e.elm;if(o(e.isAsyncPlaceholder))r(t.asyncFactory.resolved)?A(e.elm,t,i):t.isAsyncPlaceholder=!0;else if(o(t.isStatic)&&o(e.isStatic)&&t.key===e.key&&(o(t.isCloned)||o(t.isOnce)))t.componentInstance=e.componentInstance;else{var p,f=t.data;r(f)&&r(p=f.hook)&&r(p=p.prepatch)&&p(e,t);var g=e.children,y=t.children;if(r(f)&&m(t)){for(p=0;p<n.update.length;++p)n.update[p](e,t);r(p=f.hook)&&r(p=p.update)&&p(e,t)}s(t.text)?r(g)&&r(y)?g!==y&&function(e,t,i,n,o){var a,h,d,u=0,p=0,f=t.length-1,m=t[0],g=t[f],y=i.length-1,v=i[0],S=i[y],b=!o;for(0;u<=f&&p<=y;)s(m)?m=t[++u]:s(g)?g=t[--f]:sn(m,v)?(_(m,v,n,i,p),m=t[++u],v=i[++p]):sn(g,S)?(_(g,S,n,i,y),g=t[--f],S=i[--y]):sn(m,S)?(_(m,S,n,i,y),b&&l.insertBefore(e,m.elm,l.nextSibling(g.elm)),m=t[++u],S=i[--y]):sn(g,v)?(_(g,v,n,i,p),b&&l.insertBefore(e,g.elm,m.elm),g=t[--f],v=i[++p]):(s(a)&&(a=rn(t,u,f)),s(h=r(v.key)?a[v.key]:T(v,t,u,f))?c(v,n,e,m.elm,!1,i,p):sn(d=t[h],v)?(_(d,v,n,i,p),t[h]=void 0,b&&l.insertBefore(e,d.elm,m.elm)):c(v,n,e,m.elm,!1,i,p),v=i[++p]);u>f?C(e,s(i[y+1])?null:i[y+1].elm,i,p,y,n):p>y&&w(t,u,f)}(u,g,y,i,d):r(y)?(r(e.text)&&l.setTextContent(u,""),C(u,null,y,0,y.length-1,i)):r(g)?w(g,0,g.length-1):r(e.text)&&l.setTextContent(u,""):e.text!==t.text&&l.setTextContent(u,t.text),r(f)&&r(p=f.hook)&&r(p=p.postpatch)&&p(e,t)}}}function x(e,t,i){if(o(i)&&r(e.parent))e.parent.data.pendingInsert=t;else for(var n=0;n<t.length;++n)t[n].data.hook.insert(t[n])}var E=g("attrs,class,staticClass,staticStyle,key");function A(e,t,i,n){var s,a=t.tag,h=t.data,l=t.children;if(n=n||h&&h.pre,t.elm=e,o(t.isComment)&&r(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(r(h)&&(r(s=h.hook)&&r(s=s.init)&&s(t,!0),r(s=t.componentInstance)))return u(t,i),!0;if(r(a)){if(r(l))if(e.hasChildNodes())if(r(s=h)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==e.innerHTML)return!1}else{for(var d=!0,c=e.firstChild,p=0;p<l.length;p++){if(!c||!A(c,l[p],i,n)){d=!1;break}c=c.nextSibling}if(!d||c)return!1}else f(t,l,i);if(r(h)){var m=!1;for(var g in h)if(!E(g)){m=!0,y(t,i);break}!m&&h.class&&nt(h.class)}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,t,i,a){if(!s(t)){var h,d=!1,u=[];if(s(e))d=!0,c(t,u);else{var p=r(e.nodeType);if(!p&&sn(e,t))_(e,t,u,null,null,a);else{if(p){if(1===e.nodeType&&e.hasAttribute(B)&&(e.removeAttribute(B),i=!0),o(i)&&A(e,t,u))return x(t,u,!0),e;h=e,e=new me(l.tagName(h).toLowerCase(),{},[],void 0,h)}var f=e.elm,g=l.parentNode(f);if(c(t,u,f._leaveCb?null:g,l.nextSibling(f)),r(t.parent))for(var y=t.parent,v=m(t);y;){for(var C=0;C<n.destroy.length;++C)n.destroy[C](y);if(y.elm=t.elm,v){for(var b=0;b<n.create.length;++b)n.create[b](tn,y);var T=y.data.hook.insert;if(T.merged)for(var E=1;E<T.fns.length;E++)T.fns[E]()}else en(y);y=y.parent}r(g)?w([e],0,0):r(e.tag)&&S(e)}}return x(t,u,d),t.elm}r(e)&&S(e)}}({nodeOps:Qi,modules:[gn,Cn,kn,Mn,Hn,Y?{create:fs,activate:fs,remove:function(e,t){!0!==e.data.show?cs(e,t):t()}}:{}].concat(un)});J&&document.addEventListener("selectionchange",(function(){var e=document.activeElement;e&&e.vmodel&&Ts(e,"input")}));var gs={inserted:function(e,t,i,n){"select"===i.tag?(n.elm&&!n.elm._vOptions?at(i,"postpatch",(function(){gs.componentUpdated(e,t,i)})):ys(e,t,i.context),e._vOptions=[].map.call(e.options,Ss)):("textarea"===i.tag||Ji(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",ws),e.addEventListener("compositionend",bs),e.addEventListener("change",bs),J&&(e.vmodel=!0)))},componentUpdated:function(e,t,i){if("select"===i.tag){ys(e,t,i.context);var n=e._vOptions,s=e._vOptions=[].map.call(e.options,Ss);if(s.some((function(e,t){return!L(e,n[t])})))(e.multiple?t.value.some((function(e){return Cs(e,s)})):t.value!==t.oldValue&&Cs(t.value,s))&&Ts(e,"change")}}};function ys(e,t,i){vs(e,t,i),(K||Q)&&setTimeout((function(){vs(e,t,i)}),0)}function vs(e,t,i){var n=t.value,s=e.multiple;if(!s||Array.isArray(n)){for(var r,o,a=0,h=e.options.length;a<h;a++)if(o=e.options[a],s)r=D(n,Ss(o))>-1,o.selected!==r&&(o.selected=r);else if(L(Ss(o),n))return void(e.selectedIndex!==a&&(e.selectedIndex=a));s||(e.selectedIndex=-1)}}function Cs(e,t){return t.every((function(t){return!L(t,e)}))}function Ss(e){return"_value"in e?e._value:e.value}function ws(e){e.target.composing=!0}function bs(e){e.target.composing&&(e.target.composing=!1,Ts(e.target,"input"))}function Ts(e,t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)}function _s(e){return!e.componentInstance||e.data&&e.data.transition?e:_s(e.componentInstance._vnode)}var xs={model:gs,show:{bind:function(e,t,i){var n=t.value,s=(i=_s(i)).data&&i.data.transition,r=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;n&&s?(i.data.show=!0,ds(i,(function(){e.style.display=r}))):e.style.display=n?r:"none"},update:function(e,t,i){var n=t.value;!n!=!t.oldValue&&((i=_s(i)).data&&i.data.transition?(i.data.show=!0,n?ds(i,(function(){e.style.display=e.__vOriginalDisplay})):cs(i,(function(){e.style.display="none"}))):e.style.display=n?e.__vOriginalDisplay:"none")},unbind:function(e,t,i,n,s){s||(e.style.display=e.__vOriginalDisplay)}}},Es={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function As(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?As(Yt(t.children)):e}function ks(e){var t={},i=e.$options;for(var n in i.propsData)t[n]=e[n];var s=i._parentListeners;for(var r in s)t[T(r)]=s[r];return t}function Ps(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}var Is=function(e){return e.tag||zt(e)},Ms=function(e){return"show"===e.name},Rs={name:"transition",props:Es,abstract:!0,render:function(e){var t=this,i=this.$slots.default;if(i&&(i=i.filter(Is)).length){0;var n=this.mode;0;var s=i[0];if(function(e){for(;e=e.parent;)if(e.data.transition)return!0}(this.$vnode))return s;var r=As(s);if(!r)return s;if(this._leaving)return Ps(e,s);var o="__transition-"+this._uid+"-";r.key=null==r.key?r.isComment?o+"comment":o+r.tag:a(r.key)?0===String(r.key).indexOf(o)?r.key:o+r.key:r.key;var h=(r.data||(r.data={})).transition=ks(this),l=this._vnode,d=As(l);if(r.data.directives&&r.data.directives.some(Ms)&&(r.data.show=!0),d&&d.data&&!function(e,t){return t.key===e.key&&t.tag===e.tag}(r,d)&&!zt(d)&&(!d.componentInstance||!d.componentInstance._vnode.isComment)){var c=d.data.transition=P({},h);if("out-in"===n)return this._leaving=!0,at(c,"afterLeave",(function(){t._leaving=!1,t.$forceUpdate()})),Ps(e,s);if("in-out"===n){if(zt(r))return l;var u,p=function(){u()};at(h,"afterEnter",p),at(h,"enterCancelled",p),at(c,"delayLeave",(function(e){u=e}))}}return s}}},Os=P({tag:String,moveClass:String},Es);function Ls(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function Ds(e){e.data.newPos=e.elm.getBoundingClientRect()}function Ns(e){var t=e.data.pos,i=e.data.newPos,n=t.left-i.left,s=t.top-i.top;if(n||s){e.data.moved=!0;var r=e.elm.style;r.transform=r.WebkitTransform="translate("+n+"px,"+s+"px)",r.transitionDuration="0s"}}delete Os.mode;var Bs={Transition:Rs,TransitionGroup:{props:Os,beforeMount:function(){var e=this,t=this._update;this._update=function(i,n){var s=Qt(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,s(),t.call(e,i,n)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",i=Object.create(null),n=this.prevChildren=this.children,s=this.$slots.default||[],r=this.children=[],o=ks(this),a=0;a<s.length;a++){var h=s[a];if(h.tag)if(null!=h.key&&0!==String(h.key).indexOf("__vlist"))r.push(h),i[h.key]=h,(h.data||(h.data={})).transition=o;else;}if(n){for(var l=[],d=[],c=0;c<n.length;c++){var u=n[c];u.data.transition=o,u.data.pos=u.elm.getBoundingClientRect(),i[u.key]?l.push(u):d.push(u)}this.kept=e(t,null,l),this.removed=d}return e(t,null,r)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(Ls),e.forEach(Ds),e.forEach(Ns),this._reflow=document.body.offsetHeight,e.forEach((function(e){if(e.data.moved){var i=e.elm,n=i.style;ns(i,t),n.transform=n.WebkitTransform=n.transitionDuration="",i.addEventListener(Qn,i._moveCb=function e(n){n&&n.target!==i||n&&!/transform$/.test(n.propertyName)||(i.removeEventListener(Qn,e),i._moveCb=null,ss(i,t))})}})))},methods:{hasMove:function(e,t){if(!Xn)return!1;if(this._hasMove)return this._hasMove;var i=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach((function(e){zn(i,e)})),Wn(i,t),i.style.display="none",this.$el.appendChild(i);var n=as(i);return this.$el.removeChild(i),this._hasMove=n.hasTransform}}}};_i.config.mustUseProp=function(e,t,i){return"value"===i&&Oi(e)&&"button"!==t||"selected"===i&&"option"===e||"checked"===i&&"input"===e||"muted"===i&&"video"===e},_i.config.isReservedTag=qi,_i.config.isReservedAttr=Ri,_i.config.getTagNamespace=function(e){return Xi(e)?"svg":"math"===e?"math":void 0},_i.config.isUnknownElement=function(e){if(!Y)return!0;if(qi(e))return!1;if(e=e.toLowerCase(),null!=Ki[e])return Ki[e];var t=document.createElement(e);return e.indexOf("-")>-1?Ki[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Ki[e]=/HTMLUnknownElement/.test(t.toString())},P(_i.options.directives,xs),P(_i.options.components,Bs),_i.prototype.__patch__=Y?ms:M,_i.prototype.$mount=function(e,t){return function(e,t,i){var n;return e.$el=t,e.$options.render||(e.$options.render=ye),ti(e,"beforeMount"),n=function(){e._update(e._render(),i)},new pi(e,n,M,{before:function(){e._isMounted&&!e._isDestroyed&&ti(e,"beforeUpdate")}},!0),i=!1,null==e.$vnode&&(e._isMounted=!0,ti(e,"mounted")),e}(this,e=e&&Y?function(e){if("string"==typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}(e):void 0,t)},Y&&setTimeout((function(){G.devtools&&re&&re.emit("init",_i)}),0),t.default=_i}.call(this,i(10),i(32).setImmediate)},function(e,t,i){"use strict";var n=i(14);i.n(n).a},function(e,t,i){(e.exports=i(26)(!1)).push([e.i,"#game-wrapper[data-v-0eca8650]{z-index:1;position:absolute;margin:0;padding:0;width:100%;min-height:100%;min-width:100%;max-width:100%;max-height:100%;height:100%}.hide-game[data-v-0eca8650]{opacity:0}.show-game[data-v-0eca8650]{opacity:1;transition:opacity 1.5s ease-in-out;-moz-transition:opacity 1.5s ease-in-out;-webkit-transition:opacity 1.5s ease-in-out}canvas[data-v-0eca8650]{margin:0;padding:0;width:100%;height:100%;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}\n",""])},function(e,t,i){"use strict";var n=i(15);i.n(n).a},function(e,t,i){t=e.exports=i(26)(!1);var n=i(158),s=n(i(159)),r=n(i(160));t.push([e.i,"\n@font-face {\n  font-family: 'Pixel';\n  src: url("+s+") format('woff'), \n      url("+r+")  format('truetype'); /* Safari, Android, iOS */\n}\nbody {\n  overflow: hidden;\n  margin: 0 !important;\n  padding: 0 !important;\n  height: 100%;\n  width: 100%;\n}\nhtml {\n  font-family: Pixel;\n  margin: 0 !important;\n  padding: 0 !important;\n  height: 100%;\n  width: 100%;\n}\n",""])},function(e,t,i){"use strict";e.exports=function(e,t){return"string"!=typeof(e=e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)||t?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},function(e,t,i){"use strict";i.r(t),t.default=i.p+"d41d8cd98f00b204e9800998ecf8427e.woff"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"ef420559f4952f516ac42e015c359e4c.ttf"},function(e,t,i){"use strict";var n=i(16);i.n(n).a},function(e,t,i){(e.exports=i(26)(!1)).push([e.i,".btn[data-v-4ea08217]{cursor:pointer}.disabled-btn[data-v-4ea08217]{color:darkgrey !important;opacity:.5 !important;cursor:not-allowed !important}.ready-btn[data-v-4ea08217]{color:white;opacity:1;cursor:pointer}.credits[data-v-4ea08217]{display:flex;flex-direction:column}.credits a[data-v-4ea08217]:hover{color:crimson}.hide-splash[data-v-4ea08217]{opacity:0;transition:opacity 1.1s ease-in-out;-moz-transition:opacity 1.1s ease-in-out;-webkit-transition:opacity 1.1s ease-in-out}.show-splash[data-v-4ea08217]{opacity:1;transition:opacity 1.1s ease-in-out;-moz-transition:opacity 1.1s ease-in-out;-webkit-transition:opacity 1.1s ease-in-out}#logo[data-v-4ea08217]{width:260px;-webkit-filter:drop-shadow(3px 3px 4px rgba(255,255,255,0.5)) drop-shadow(-3px 3px 4px rgba(255,255,255,0.5)) drop-shadow(3px -3px 4px rgba(255,255,255,0.5)) drop-shadow(-3px -3px 4px rgba(255,255,255,0.5));filter:drop-shadow(3px 3px 4px rgba(255,255,255,0.5)) drop-shadow(-3px 3px 4px rgba(255,255,255,0.5)) drop-shadow(3px -3px 4px rgba(255,255,255,0.5)) drop-shadow(-3px -3px 4px rgba(255,255,255,0.5))}#progress-info[data-v-4ea08217]{position:absolute;bottom:50px}#splash[data-v-4ea08217]{color:white;position:absolute;background-color:black;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%}#app[data-v-4ea08217]{background-color:black;width:100%;height:100%}#game-title[data-v-4ea08217]{font-size:36px}.main-container[data-v-4ea08217]{opacity:0;position:absolute;z-index:2;min-width:100%;max-width:100%;min-height:100%;max-height:100%;width:100%;height:100%;padding:0 !important;margin:0 !important}.main-container.show-main[data-v-4ea08217]{opacity:1;transition:opacity 1.5s ease-in-out;-moz-transition:opacity 1.5s ease-in-out;-webkit-transition:opacity 1.5s ease-in-out}.credits a[data-v-4ea08217]{text-decoration:none;color:white;background-color:transparent}.inner-container[data-v-4ea08217]{color:white;width:100%;height:100%;padding:0;margin:0;display:flex;flex-direction:column;justify-content:center;align-items:center}.inner-container .half-vert[data-v-4ea08217]{width:100%;min-width:100%;max-width:100%;height:50%;max-height:50%;height:50%;display:flex;flex-direction:column;align-items:center}.inner-container .half-vert.top[data-v-4ea08217]{justify-content:flex-end}.inner-container .half-vert.bottom[data-v-4ea08217]{justify-content:flex-start}.inner-container .option-container[data-v-4ea08217]{padding-top:50px;display:flex;flex-direction:row}.inner-container .option-container .play-btn[data-v-4ea08217]{font-size:50px;cursor:pointer}.inner-container .option-container .play-btn[data-v-4ea08217]:not(.disabled-btn):hover{font-size:55px}.inner-container .option-container .name-enter-wrapper[data-v-4ea08217]{display:flex;flex-direction:column}.inner-container .option-container .name-enter-wrapper .cancel-btn[data-v-4ea08217]{position:absolute;color:white;cursor:pointer}.inner-container .option-container .rdy-btn-wrapper[data-v-4ea08217]{padding-top:7px;width:100%;min-width:100%;max-width:100%;display:flex;flex-direction:row;align-items:center;justify-content:center}.inner-container .game-title[data-v-4ea08217]{font-size:84px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}\n",""])},function(e,t,i){"use strict";i.r(t);var n={};i.r(n),i.d(n,"shimGetUserMedia",(function(){return w})),i.d(n,"shimGetDisplayMedia",(function(){return b})),i.d(n,"shimMediaStream",(function(){return T})),i.d(n,"shimOnTrack",(function(){return _})),i.d(n,"shimGetSendersWithDtmf",(function(){return x})),i.d(n,"shimGetStats",(function(){return E})),i.d(n,"shimSenderReceiverGetStats",(function(){return A})),i.d(n,"shimAddTrackRemoveTrackWithNative",(function(){return k})),i.d(n,"shimAddTrackRemoveTrack",(function(){return P})),i.d(n,"shimPeerConnection",(function(){return I})),i.d(n,"fixNegotiationNeeded",(function(){return M}));var s={};i.r(s),i.d(s,"shimGetUserMedia",(function(){return L})),i.d(s,"shimGetDisplayMedia",(function(){return D})),i.d(s,"shimPeerConnection",(function(){return N})),i.d(s,"shimReplaceTrack",(function(){return B}));var r={};i.r(r),i.d(r,"shimGetUserMedia",(function(){return j})),i.d(r,"shimGetDisplayMedia",(function(){return F})),i.d(r,"shimOnTrack",(function(){return G})),i.d(r,"shimPeerConnection",(function(){return U})),i.d(r,"shimSenderGetStats",(function(){return H})),i.d(r,"shimReceiverGetStats",(function(){return $})),i.d(r,"shimRemoveStream",(function(){return W})),i.d(r,"shimRTCDataChannel",(function(){return z})),i.d(r,"shimAddTransceiver",(function(){return Y})),i.d(r,"shimGetParameters",(function(){return V})),i.d(r,"shimCreateOffer",(function(){return X})),i.d(r,"shimCreateAnswer",(function(){return q}));var o={};i.r(o),i.d(o,"shimLocalStreamsAPI",(function(){return K})),i.d(o,"shimRemoteStreamsAPI",(function(){return J})),i.d(o,"shimCallbacksAPI",(function(){return Q})),i.d(o,"shimGetUserMedia",(function(){return Z})),i.d(o,"shimConstraints",(function(){return ee})),i.d(o,"shimRTCIceServerUrls",(function(){return te})),i.d(o,"shimTrackEventTransceiver",(function(){return ie})),i.d(o,"shimCreateOfferLegacy",(function(){return ne})),i.d(o,"shimAudioContext",(function(){return se}));var a={};i.r(a),i.d(a,"shimRTCIceCandidate",(function(){return ae})),i.d(a,"shimMaxMessageSize",(function(){return he})),i.d(a,"shimSendThrowTypeError",(function(){return le})),i.d(a,"shimConnectionState",(function(){return de})),i.d(a,"removeAllowExtmapMixed",(function(){return ce}));let h=!0,l=!0;function d(e,t,i){const n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function c(e,t,i){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,s=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return s.apply(this,arguments);const r=e=>{const t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,r),s.apply(this,[e,r])};const r=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(i))return r.apply(this,arguments);const n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(h=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(l=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f(){if("object"==typeof window){if(h)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){l&&console.warn(e+" is deprecated, please use "+t+" instead.")}function g(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=d(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=d(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=d(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function y(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(e){return y(e)?Object.keys(e).reduce((function(t,i){const n=y(e[i]),s=n?v(e[i]):e[i],r=n&&!Object.keys(s).length;return void 0===s||r?t:Object.assign(t,{[i]:s})}),{}):e}function C(e,t,i){const n=i?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;const r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(i=>{i.type===n&&i.trackId===t.id&&function e(t,i,n){i&&!n.has(i.id)&&(n.set(i.id,i),Object.keys(i).forEach(s=>{s.endsWith("Id")?e(t,t.get(i[s]),n):s.endsWith("Ids")&&i[s].forEach(i=>{e(t,t.get(i),n)})}))}(e,i,s)})}),s}const S=f;function w(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const i=g(e),n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[s("min",i)]=n.ideal,t.optional.push(e),(e={})[s("max",i)]=n.ideal,t.optional.push(e)):(e[s("",i)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",i)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,i)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,s){if(i.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});const o=i.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||o)){let i;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?i=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(i=["front"]),i)return t.mediaDevices.enumerateDevices().then(t=>{let o=(t=t.filter(e=>"videoinput"===e.kind)).find(e=>i.some(t=>e.label.toLowerCase().includes(t)));return!o&&t.length&&i.includes("back")&&(o=t[t.length-1]),o&&(e.video.deviceId=r.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=n(e.video),S("chrome: "+JSON.stringify(e)),s(e)})}e.video=n(e.video)}return S("chrome: "+JSON.stringify(e)),s(e)},r=function(e){return i.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,i,n){s(e,e=>{t.webkitGetUserMedia(e,i,e=>{n&&n(r(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return s(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(r(e))))}}}function b(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(t=>{const n=i.video&&i.video.width,s=i.video&&i.video.height,r=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r||3}},n&&(i.video.mandatory.maxWidth=n),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function T(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function _(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)c(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=n,s.transceiver={receiver:n},s.streams=[t.stream],this.dispatchEvent(s)}),t.stream.getTracks().forEach(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=n,s.transceiver={receiver:n},s.streams=[t.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function x(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let s=i.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function E(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const s=function(e){const t={};return e.result().forEach(e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{i[t]=e.stat(t)}),t[i.id]=i}),t},r=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const n=function(e){i(r(s(e)))};return t.apply(this,[n,e])}return new Promise((e,i)=>{t.apply(this,[function(t){e(r(s(t)))},i])}).then(i,n)}}function A(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>C(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),c(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>C(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,n;return this.getSenders().forEach(i=>{i.track===e&&(t?n=!0:t=i)}),this.getReceivers().forEach(t=>(t.track===e&&(i?n=!0:i=t),t.track===e)),n||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function k(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();i.apply(this,arguments);const n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),s.apply(this,arguments)}}function P(e){if(!e.RTCPeerConnection)return;const t=g(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return k(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};const s=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],s=e._streams[n.id];i=i.replace(new RegExp(s.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:i})}function o(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],s=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const s=this.getSenders().find(e=>e.track===t);if(s)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[i.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[t=>{const i=r(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then(e=>r(this,e))}};e.RTCPeerConnection.prototype[t]=n[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=h.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(i=>{this._streams[i].getTracks().find(t=>e.track===t)&&(t=this._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function I(e){const t=g(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const i=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return i||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function M(e){const t=g(e);c(e,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e})}var R=i(43),O=i.n(R);function L(e){const t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function D(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function N(e){const t=g(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const i=new Event("enabled");i.enabled=e,this.dispatchEvent(i)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const i=O()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let i=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&m("RTCIceServer.url","RTCIceServer.urls");const n="string"==typeof t;return n&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=!0,!0):t&&!i}),delete e.url,e.urls=n?t[0]:t,!!t.length}})}(e.iceServers,t.version),f("ICE servers after filtering:",e.iceServers)),new i(e)},e.RTCPeerConnection.prototype=i.prototype}function B(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function j(e){const t=g(e),i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function F(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function G(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U(e){const t=g(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,s,r]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!s)try{e.forEach(e=>{e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(s,r)}}function H(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),c(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function W(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function z(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Y(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const n=t.apply(this,arguments);if(i){const{sender:t}=n,i=t.getParameters();"encodings"in i&&(1!==i.encodings.length||0!==Object.keys(i.encodings[0]).length)||(i.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(i).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function V(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function X(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function K(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach(e=>{i.includes(e.track)&&this.removeTrack(e)})})}}function J(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)})}),t.apply(e,arguments)}}}function Q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],s=i.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[i]);return t?(s.then(e,t),Promise.resolve()):s};let a=function(e,t,i){const n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,i){const n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,i){const n=o.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=a}function Z(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(ee(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))}function ee(e){return e&&void 0!==e.video?Object.assign({},e,{video:v(e.video)}):e}function te(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(m("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ie(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ne(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return t.apply(this,arguments)}}function se(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var re=i(7),oe=i.n(re);function ae(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),n=oe.a.parseCandidate(e.candidate),s=Object.assign(i,n);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,c(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function he(e){if(!e.RTCPeerConnection)return;const t=g(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=function(e){if(!e||!e.sdp)return!1;const t=oe.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=oe.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!=i?-1:i},s=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},r=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const s=oe.a.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?n=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const e=n(arguments[0]),t=s(e),i=r(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function le(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const n=arguments[0],s=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},c(e,"datachannel",e=>(t(e.channel,e.target),e))}function de(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ce(e){if(!e.RTCPeerConnection)return;const t=g(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n")),i.apply(this,arguments)}}const ue=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const i=f,h=g(e),l={browserDetails:h,commonShim:a,extractVersion:d,disableLog:u,disableWarnings:p};switch(h.browser){case"chrome":if(!n||!I||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),l;if(null===h.version)return i("Chrome shim can not determine version, not shimming."),l;i("adapter.js shimming chrome."),l.browserShim=n,w(e),T(e),I(e),_(e),P(e),x(e),E(e),A(e),M(e),ae(e),de(e),he(e),le(e),ce(e);break;case"firefox":if(!r||!U||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),l;i("adapter.js shimming firefox."),l.browserShim=r,j(e),U(e),G(e),W(e),H(e),$(e),z(e),Y(e),V(e),X(e),q(e),ae(e),de(e),he(e),le(e);break;case"edge":if(!s||!N||!t.shimEdge)return i("MS edge shim is not included in this adapter release."),l;i("adapter.js shimming edge."),l.browserShim=s,L(e),D(e),N(e),B(e),he(e),le(e);break;case"safari":if(!o||!t.shimSafari)return i("Safari shim is not included in this adapter release."),l;i("adapter.js shimming safari."),l.browserShim=o,te(e),ne(e),Q(e),K(e),J(e),ie(e),Z(e),se(e),ae(e),he(e),le(e),ce(e);break;default:i("Unsupported browser!")}return l}({window:"undefined"==typeof window?void 0:window});t.default=ue},function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("Game",{attrs:{"show-game":e.showApp&&e.mapLoaded}}),e._v(" "),e.showApp?e.showSplash||e.gameStarted?e._e():i("div",{staticClass:"main-container",class:{"show-main":e.showApp&&e.mapLoaded}},[i("div",{staticClass:"inner-container"},[e._m(0),e._v(" "),i("div",{staticClass:"half-vert bottom"},[i("div",{staticClass:"option-container"},[e.chosingName?i("div",{staticClass:"name-enter-wrapper"},[i("div",{staticClass:"cancel-btn",on:{click:function(t){e.chosingName=!1}}}),e._v(" "),i("h2",[e._v(" What is your name? ")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.chosenName,expression:"chosenName"}],ref:"entername",attrs:{type:"text"},domProps:{value:e.chosenName},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),t.stopPropagation(),e.startGame(!0))},input:function(t){t.target.composing||(e.chosenName=t.target.value)}}}),e._v(" "),i("div",{staticClass:"rdy-btn-wrapper"},[i("div",{staticClass:"play-btn",class:{"ready-btn":e.validChosenName,"disabled-btn":!e.validChosenName},on:{click:function(t){return e.startGame(!0)}}},[e._v(" Ready! ")])])]):i("div",{staticClass:"btn-options"},[e.previousGameState?i("div",{staticClass:"play-btn",on:{click:function(t){return e.startGame(!1)}}},[e._v("\n              Continue\n            ")]):e._e(),e._v(" "),i("div",{staticClass:"play-btn",on:{click:function(t){return e.startChosingName()}}},[e._v("\n              New Game\n            ")])])])])])]):i("div",{class:{"show-splash":e.showSplash,"hide-splash":!e.showSplash},attrs:{id:"splash"}},[i("h1",[e._v("Game Dev Bois Game Jam")])])],1)};n._withStripped=!0;var s=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{class:{"show-game":this.showGame,"hide-game":!this.showGame},attrs:{id:"game-wrapper"}},[t("canvas",{attrs:{oncontextmenu:"return false",id:"game-canvas"}})])};s._withStripped=!0;var r=i(0),o=i.n(r),a={name:"Game",props:{showGame:{type:Boolean},playerData:{type:Object,required:!1}},async mounted(){const e=this.playerData||{};await o.a.startOfflineGame("island",e)}};i(154);function h(e,t,i,n,s,r,o,a){var h,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=i,l._compiled=!0),n&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),o?(h=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},l._ssrRegister=h):s&&(h=a?function(){s.call(this,this.$root.$options.shadowRoot)}:s),h)if(l.functional){l._injectStyles=h;var d=l.render;l.render=function(e,t){return h.call(t),d(e,t)}}else{var c=l.beforeCreate;l.beforeCreate=c?[].concat(c,h):[h]}return{exports:e,options:l}}var l=h(a,s,[],!1,null,"0eca8650",null);let d;l.options.__file="builds/_prebuild/Client/components/Game.vue";var c={name:"app",components:{Game:l.exports},beforeMount(){this.tryGetPreviousGameState()},mounted(){this.handleKeyDown=this.handleKeyDown.bind(this),this.registerKeyEvents(),setTimeout(()=>{this.showSplash=!0,setTimeout(()=>{this.showSplash=!1,setTimeout(()=>{this.showApp=!0},1100)},2700)},100)},created(){o.a.on("game-input",e=>{d=e}),o.a.on("initial-map-load",()=>{this.mapLoaded=!0}),o.a.on("game-stopped",()=>{this.tryGetPreviousGameState(),this.gameStarted=!1,this.starting=!1,this.chosenName="",this.chosingName=!1,this.registerKeyEvents()})},data:()=>({startGameError:"",gameStarted:!1,previousGameState:null,error:"",showApp:!1,showSplash:!1,onGame:!1,mapLoaded:!1,chosenName:"",chosingName:!1,starting:!1,registeredKeyEvents:!1}),methods:{getFocusIndex(){},handleKeyDown(e){!(13==e.which||"Enter"===e.key||"Enter"===e.code)||this.gameStarted||this.chosingName||this.starting||this.startChosingName()},registerKeyEvents(){if(this.registeredKeyEvents)throw new Error("Trying to register key events multiple times");"undefined"!=typeof document?document.addEventListener("keydown",this.handleKeyDown):"undefined"!=typeof window&&window.addEventListener("keydown",this.handleKeyDown),this.registeredKeyEvents=!0},tryGetPreviousGameState(){if("undefined"!=typeof localStorage){const e=localStorage.getItem("game-state");e&&(this.previousGameState=JSON.stringify(e))}},onGameEnded(){this.gameStarted=!1},startChosingName(){this.chosingName=!0,this.$nextTick(()=>{this.$refs&&this.$refs.entername&&this.$refs.entername.focus()})},startGame(e,t){if(t=t||0,this.starting&&0===t||this.gameStarted||!this.validChosenName)return;if(this.starting=!0,t>25&&(this.starting=!1,this.startGameError="Game can not load the map."),!this.mapLoaded)return setTimeout(()=>{this.startGame(e,++t)},200);this.gameStarted=!0;const i=e?{isNew:!0,data:this.chosenName}:{isNew:!1,data:JSON.parse(JSON.stringify(this.previousGameState))};"undefined"!=typeof document?document.removeEventListener("keydown",this.handleKeyDown):"undefined"!=typeof window&&window.removeEventListener("keydown",this.handleKeyDown),o.a.emit("player-enter",i),this.previousGameState=null}},computed:{validChosenName(){return!!this.chosenName},newGameText(){return this.previousGameState?"Restart Game":"Start New Game"}}},u=(i(156),i(161),h(c,n,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"half-vert top"},[t("div",{staticClass:"game-title"},[this._v("\n          Animal Crossing SNES\n        ")]),this._v(" "),t("div",{staticClass:"credits"},[t("a",{attrs:{href:"http://www.fordesoft.com/",target:"_blank"}},[this._v("Graphics - Josh")]),this._v(" "),t("a",{attrs:{href:"https://twitter.com/lawofsavages",target:"_blank"}},[this._v("Code - visgotti ")]),this._v(" "),t("a",{attrs:{href:"https://itch.io"}},[this._v("Music/SFX - Francois")])])])}],!1,null,"4ea08217",null));u.options.__file="builds/_prebuild/Client/ProdApp.vue";t.default=u.exports}]);
//# sourceMappingURL=index.js.map